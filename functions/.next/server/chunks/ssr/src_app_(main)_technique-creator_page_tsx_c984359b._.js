module.exports=[77831,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33508),e=a.i(15618),f=a.i(5784),g=a.i(67552),h=a.i(19221),i=a.i(1027),j=a.i(50429),k=a.i(97063),l=a.i(96101);a.i(72500);var m=a.i(18239);a.i(76564);var n=a.i(20930);a.i(50889);var o=a.i(20747),p=a.i(97907);a.i(89606);var q=a.i(66206),r=a.i(77967);a.i(9912);var s=a.i(94318),t=a.i(31903),u=a.i(85693);a.i(39249);var v=a.i(74826);let w=[{value:"basic",label:"Basic Action"},{value:"quick",label:"Quick Action"},{value:"free",label:"Free Action"},{value:"long3",label:"Long Action (3 AP)"},{value:"long4",label:"Long Action (4 AP)"}],x=["none","physical","slashing","piercing","bludgeoning"],y=[4,6,8,10,12],z=[{id:0,name:"Unarmed"},{id:1,name:"Any Melee"},{id:2,name:"Any Ranged"},{id:3,name:"Sword"},{id:4,name:"Axe"},{id:5,name:"Spear"},{id:6,name:"Bow"},{id:7,name:"Crossbow"}];function A({selectedPart:a,index:e,onRemove:h,onUpdate:i,allParts:j}){let[k,l]=(0,c.useState)(!0),{part:m}=a,n=(0,c.useMemo)(()=>["any",...Array.from(new Set(j.map(a=>a.category))).sort()],[j]),o=(0,c.useMemo)(()=>{let b=a.selectedCategory;return b&&"any"!==b?j.filter(a=>a.category===b).sort((a,b)=>a.name.localeCompare(b.name)):j.sort((a,b)=>a.name.localeCompare(b.name))},[j,a.selectedCategory]),p=a=>{let b=m[`op_${a}_desc`],c=m[`op_${a}_en`],d=m[`op_${a}_tp`];return b&&""!==b.trim()||void 0!==c&&0!==c||void 0!==d&&0!==d},q=(m.base_stam||0)+(m.op_1_en||0)*a.op_1_lvl+(m.op_2_en||0)*a.op_2_lvl+(m.op_3_en||0)*a.op_3_lvl,r=(m.base_tp||0)+(m.op_1_tp||0)*a.op_1_lvl+(m.op_2_tp||0)*a.op_2_lvl+(m.op_3_tp||0)*a.op_3_lvl;return(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-gray-50 px-4 py-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>l(!k),className:"text-gray-500 hover:text-gray-700",children:k?(0,b.jsx)(g.ChevronUp,{className:"w-5 h-5"}):(0,b.jsx)(f.ChevronDown,{className:"w-5 h-5"})}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:m.name}),(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:["Stam: ",q.toFixed(1)," | TP: ",Math.floor(r)]})]}),(0,b.jsx)("button",{type:"button",onClick:h,className:"text-gray-400 hover:text-red-500",children:(0,b.jsx)(d.X,{className:"w-5 h-5"})})]}),k&&(0,b.jsxs)("div",{className:"px-4 py-4 space-y-4",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,b.jsx)("select",{value:a.selectedCategory,onChange:a=>i({selectedCategory:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:n.map(a=>(0,b.jsx)("option",{value:a,children:"any"===a?"All Categories":a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part"}),(0,b.jsx)("select",{value:o.findIndex(a=>a.id===m.id),onChange:a=>{let b=o[parseInt(a.target.value)];b&&i({part:b,op_1_lvl:0,op_2_lvl:0,op_3_lvl:0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:o.map((a,c)=>(0,b.jsx)("option",{value:c,children:a.name},a.id))})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:m.description}),(0,b.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:["Base Stamina: ",(0,b.jsx)("strong",{children:m.base_stam})]}),(0,b.jsxs)("span",{className:"text-gray-600",children:["Base TP: ",(0,b.jsx)("strong",{children:m.base_tp})]})]}),(p(1)||p(2)||p(3))&&(0,b.jsxs)("div",{className:"space-y-3 pt-2 border-t border-gray-100",children:[p(1)&&(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Option 1:"," ",(0,b.jsxs)("span",{className:"text-gray-500",children:["Stam ",(m.op_1_en||0)>=0?"+":"",m.op_1_en||0,", TP"," ",(m.op_1_tp||0)>=0?"+":"",m.op_1_tp||0]})]}),(0,b.jsx)(u.NumberStepper,{value:a.op_1_lvl,onChange:a=>i({op_1_lvl:a}),label:"Level:",variant:"technique"})]}),m.op_1_desc&&(0,b.jsx)("p",{className:"text-sm text-gray-600",children:m.op_1_desc})]}),p(2)&&(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Option 2:"," ",(0,b.jsxs)("span",{className:"text-gray-500",children:["Stam ",(m.op_2_en||0)>=0?"+":"",m.op_2_en||0,", TP"," ",(m.op_2_tp||0)>=0?"+":"",m.op_2_tp||0]})]}),(0,b.jsx)(u.NumberStepper,{value:a.op_2_lvl,onChange:a=>i({op_2_lvl:a}),label:"Level:",variant:"technique"})]}),m.op_2_desc&&(0,b.jsx)("p",{className:"text-sm text-gray-600",children:m.op_2_desc})]}),p(3)&&(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Option 3:"," ",(0,b.jsxs)("span",{className:"text-gray-500",children:["Stam ",(m.op_3_en||0)>=0?"+":"",m.op_3_en||0,", TP"," ",(m.op_3_tp||0)>=0?"+":"",m.op_3_tp||0]})]}),(0,b.jsx)(u.NumberStepper,{value:a.op_3_lvl,onChange:a=>i({op_3_lvl:a}),label:"Level:",variant:"technique"})]}),m.op_3_desc&&(0,b.jsx)("p",{className:"text-sm text-gray-600",children:m.op_3_desc})]})]})]})]})}function B(){let{user:a}=(0,q.useAuthStore)(),[d,f]=(0,c.useState)(""),[g,n]=(0,c.useState)(""),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)("basic"),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)({amount:0,size:6,type:"none"}),[J,K]=(0,c.useState)(z[0]),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!1),{data:R=[],isLoading:S,error:T}=(0,o.useTechniqueParts)(),{data:U,isLoading:V,error:W}=(0,p.useUserTechniques)(),X=(0,c.useMemo)(()=>B.map(a=>({id:Number(a.part.id),name:a.part.name,part:a.part,op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),[B]),Y=(0,c.useMemo)(()=>(0,v.calculateTechniqueCosts)(X,R),[X,R]),Z=(0,c.useMemo)(()=>(0,v.computeActionTypeFromSelection)(D,F),[D,F]),$=(0,c.useMemo)(()=>(0,v.formatTechniqueDamage)("none"!==H.type&&H.amount>0?H:void 0),[H]),_=(0,c.useCallback)(()=>{0!==R.length&&C(a=>[...a,{part:R[0],op_1_lvl:0,op_2_lvl:0,op_3_lvl:0,selectedCategory:"any"}])},[R]),aa=(0,c.useCallback)(a=>{C(b=>b.filter((b,c)=>c!==a))},[]),ab=(0,c.useCallback)((a,b)=>{C(c=>c.map((c,d)=>d===a?{...c,...b}:c))},[]),ac=async()=>{if(!d.trim())return void O({type:"error",text:"Please enter a technique name"});if(!a)return void O({type:"error",text:"You must be logged in to save"});M(!0),O(null);try{let a=(0,s.httpsCallable)(r.functions,"saveTechniqueToLibrary"),b=B.map(a=>({id:Number(a.part.id),name:a.part.name,op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),c="none"!==H.type&&H.amount>0?{amount:H.amount,size:H.size,type:H.type}:null;await a({techniqueName:d.trim(),techniqueDescription:g.trim(),parts:b,damage:c,weapon:J.id>0?J:null}),O({type:"success",text:"Technique saved successfully!"}),setTimeout(()=>{f(""),n(""),C([]),I({amount:0,size:6,type:"none"}),K(z[0]),O(null)},2e3)}catch(a){console.error("Error saving technique:",a),O({type:"error",text:`Failed to save: ${a.message}`})}finally{M(!1)}},ad=(0,c.useCallback)(a=>{f(a.name||""),n(a.description||"");let b=a.parts||a.techniqueParts||[],c=[];for(let a of b){let b=R.find(b=>b.id===String(a.id)||b.name===a.name);b&&c.push({part:b,op_1_lvl:a.op_1_lvl||0,op_2_lvl:a.op_2_lvl||0,op_3_lvl:a.op_3_lvl||0,selectedCategory:b.category||"any"})}if(C(c),a.weapon){let b=z.find(b=>b.id===a.weapon.id||b.name===a.weapon.name);b&&K(b)}if(a.damage){let b=a.damage;I({amount:b.amount||b.dice||0,size:b.size||b.sides||6,type:b.type||"none"})}else I({amount:0,size:6,type:"none"});O({type:"success",text:"Technique loaded successfully!"}),setTimeout(()=>O(null),2e3)},[R]);return S?(0,b.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,b.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})}):T?(0,b.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:(0,b.jsxs)("p",{className:"text-red-700",children:["Failed to load technique parts: ",T.message]})})}):(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[(0,b.jsx)(h.Swords,{className:"w-8 h-8 text-red-600"}),"Technique Creator"]}),(0,b.jsx)("p",{className:"text-gray-600",children:"Design custom martial techniques by combining technique parts. Each part contributes to the total stamina cost and training point requirements."})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>Q(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[(0,b.jsx)(l.FolderOpen,{className:"w-5 h-5"}),"Load from Library"]})]}),(0,b.jsx)(t.LoadFromLibraryModal,{isOpen:P,onClose:()=>Q(!1),onSelect:ad,items:U,isLoading:V,error:W,itemType:"technique",title:"Load Technique from Library"}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Technique Name *"}),(0,b.jsx)("input",{type:"text",value:d,onChange:a=>f(a.target.value),placeholder:"Enter technique name...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,b.jsx)("textarea",{value:g,onChange:a=>n(a.target.value),placeholder:"Describe what your technique does...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]})}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Combat Configuration"}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weapon Type"}),(0,b.jsx)("select",{value:J.id,onChange:a=>{let b=z.find(b=>b.id===parseInt(a.target.value));b&&K(b)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:z.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action Type"}),(0,b.jsx)("select",{value:D,onChange:a=>E(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:w.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:F,onChange:a=>G(a.target.checked),className:"rounded border-gray-300"}),(0,b.jsx)("span",{className:"text-sm",children:"Can be used as a Reaction"})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Technique Parts (",B.length,")"]}),(0,b.jsxs)("button",{type:"button",onClick:_,className:"flex items-center gap-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,b.jsx)(e.Plus,{className:"w-4 h-4"}),"Add Part"]})]}),0===B.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)(k.Info,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:'No parts added yet. Click "Add Part" to begin building your technique.'})]}):(0,b.jsx)("div",{className:"space-y-4",children:B.map((a,c)=>(0,b.jsx)(A,{selectedPart:a,index:c,onRemove:()=>aa(c),onUpdate:a=>ab(c,a),allParts:R},c))})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Additional Damage (Optional)"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,b.jsx)(u.NumberStepper,{value:H.amount,onChange:a=>I(b=>({...b,amount:a})),label:"Dice:",min:0,max:20,variant:"technique"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"font-bold text-lg",children:"d"}),(0,b.jsx)("select",{value:H.size,onChange:a=>I(b=>({...b,size:parseInt(a.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-lg",children:y.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsx)("select",{value:H.type,onChange:a=>I(b=>({...b,type:a.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg",children:x.map(a=>(0,b.jsx)("option",{value:a,children:"none"===a?"No additional damage":a.charAt(0).toUpperCase()+a.slice(1)},a))})]}),"none"!==H.type&&H.amount>0&&(0,b.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Additional Damage: ",(0,b.jsxs)("strong",{children:[H.amount,"d",H.size," ",H.type]})]})]})]}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 sticky top-24",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Technique Summary"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[(0,b.jsx)(i.Zap,{className:"w-6 h-6 mx-auto text-red-600 mb-1"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-red-600",children:Y.totalEnergy}),(0,b.jsx)("div",{className:"text-xs text-red-600",children:"Stamina Cost"})]}),(0,b.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[(0,b.jsx)(j.Target,{className:"w-6 h-6 mx-auto text-purple-600 mb-1"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:Y.totalTP}),(0,b.jsx)("div",{className:"text-xs text-purple-600",children:"Training Points"})]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Action:"}),(0,b.jsx)("span",{className:"font-medium",children:Z})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Weapon:"}),(0,b.jsx)("span",{className:"font-medium",children:J.name})]}),$&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Damage:"}),(0,b.jsx)("span",{className:"font-medium",children:$})]})]}),Y.tpSources.length>0&&(0,b.jsxs)("div",{className:"border-t border-gray-100 pt-4 mb-6",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"TP Breakdown"}),(0,b.jsx)("ul",{className:"text-xs text-gray-600 space-y-1",children:Y.tpSources.map((a,c)=>(0,b.jsxs)("li",{children:["â€¢ ",a]},c))})]}),N&&(0,b.jsx)("div",{className:(0,m.cn)("mb-4 p-3 rounded-lg text-sm","success"===N.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:N.text}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("button",{type:"button",onClick:ac,disabled:L||!d.trim(),className:(0,m.cn)("w-full py-3 rounded-xl font-bold transition-colors",L||!d.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:L?"Saving...":"Save to Library"}),(0,b.jsx)("button",{type:"button",onClick:()=>{f(""),n(""),C([]),E("basic"),G(!1),I({amount:0,size:6,type:"none"}),K(z[0]),O(null)},className:"w-full py-2 rounded-xl font-medium text-gray-600 hover:bg-gray-100 transition-colors",children:"Reset"})]})]})})]})]})}function C(){return(0,b.jsx)(n.ProtectedRoute,{children:(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,b.jsx)(B,{})})})}a.s(["default",()=>C],77831)}];

//# sourceMappingURL=src_app_%28main%29_technique-creator_page_tsx_c984359b._.js.map