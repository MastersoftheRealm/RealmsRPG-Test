module.exports=[99705,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);a.i(69387);var f=a.i(60574);a.i(60121);var g=a.i(5420),h=a.i(77967);a.i(50889);var i=a.i(45838),j=a.i(10499),k=a.i(97907);a.i(72500);var l=a.i(18239);function m(a,b){if(a&&0!==a.length){if("string"==typeof b){let c=b.toLowerCase();return a.find(a=>a.name.toLowerCase()===c||a.id===b)}if(void 0!==b.id){let c=a.find(a=>a.id===String(b.id));if(c)return c}if(b.name){let c=b.name.toLowerCase();return a.find(a=>a.name.toLowerCase()===c)}}}function n(a,b,c){return a&&0!==a.length?a.map(a=>{let d="string"==typeof a?a:a.name,e="object"==typeof a&&!!a.equipped,f=m(b,a);return f?{id:f.id,name:f.name,description:f.description||"",type:f.type||c,equipped:e,damage:f.damage,armorValue:f.armorValue,properties:f.properties||[],libraryItem:f}:{id:d,name:d,description:"Item not found in your library",type:c,equipped:e,notInLibrary:!0}}):[]}function o(a){return a?Array.isArray(a)?a.map(a=>({name:"string"==typeof a?a:a?.name||"",equipped:"object"==typeof a&&!!a?.equipped})).filter(a=>a.name):"object"==typeof a&&"name"in a&&a.name?[{name:a.name,equipped:!!a.equipped}]:[]:[]}var p=a.i(71987);let q=(0,c.createContext)(null),r=0;function s(){return`roll-${Date.now()}-${++r}`}function t(a){return Math.floor(Math.random()*parseInt(a.substring(1)))+1}let u={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20};function v({children:a,maxHistory:d=50}){let[e,f]=(0,c.useState)([]),g=(0,c.useCallback)(a=>{f(b=>[a,...b].slice(0,d))},[d]),h=(0,c.useCallback)(()=>{f([])},[]),i=(0,c.useCallback)((a,b,c)=>{let d,e=t("d20"),f=20===e,h=1===e,i=e+c;f?(i+=2,d="Natural 20! +2 to the total!"):h&&(i-=2,d="Natural 1! -2 from the total!");let j={id:s(),type:a,title:b,dice:[{type:"d20",value:e,isMax:f,isMin:h}],modifier:c,total:i,isCrit:f,isCritFail:h,critMessage:d,timestamp:new Date};return g(j),j},[g]),j=(0,c.useCallback)((a,b)=>{i("ability",a.charAt(0).toUpperCase()+a.slice(1)+" Check",b)},[i]),k=(0,c.useCallback)((a,b)=>{i("defense",`${a} Save`,b)},[i]),l=(0,c.useCallback)((a,b)=>{i("skill",a,b)},[i]),m=(0,c.useCallback)((a,b)=>{i("attack",`${a} Attack`,b)},[i]),n=(0,c.useCallback)((a,b=0)=>{let c=a.match(/(\d+)d(\d+)([+-]\d+)?(?:\s+([a-zA-Z]+))?/);if(!c)return;let[,d,e,f,h]=c,i=parseInt(d),j=parseInt(e),k=(f?parseInt(f):0)+b,l=[],m=k;for(let a=0;a<i;a++){let a=`d${j}`,b=t(a);l.push({type:a,value:b,isMax:b===j,isMin:1===b}),m+=b}let n=`Damage${h?` (${h})`:""}`;g({id:s(),type:"damage",title:n,dice:l,modifier:k,total:m,timestamp:new Date})},[g]),o=(0,c.useCallback)((a,b,c,d)=>{let e=[],f=d,h=u[b];for(let a=0;a<c;a++){let a=t(b);e.push({type:b,value:a,isMax:a===h,isMin:1===a}),f+=a}let i="d20"===b&&1===c&&e[0]?.value===20,j="d20"===b&&1===c&&e[0]?.value===1;g({id:s(),type:"custom",title:a,dice:e,modifier:d,total:f,isCrit:i,isCritFail:j,timestamp:new Date})},[g]);return(0,b.jsx)(q.Provider,{value:{rolls:e,rollAbility:j,rollDefense:k,rollSkill:l,rollAttack:m,rollDamage:n,rollCustom:o,clearHistory:h,addRoll:g},children:a})}function w(){return(0,c.useContext)(q)}function x({label:a,current:c,max:d,color:e,terminalThreshold:f,showControls:g,onChange:h}){let i=Math.max(0,Math.min(100,c/d*100)),j=f&&c<=f&&c>0;return(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm font-medium",children:[(0,b.jsx)("span",{className:"text-gray-700",children:a}),(0,b.jsxs)("span",{className:(0,l.cn)("font-bold",j&&"text-yellow-600",c<=0&&"text-red-600"),children:[c," / ",d]})]}),(0,b.jsxs)("div",{className:"relative h-6 bg-gray-200 rounded-full overflow-hidden",children:[(0,b.jsx)("div",{className:(0,l.cn)("absolute inset-y-0 left-0 transition-all duration-300","red"===e?"bg-red-500":"bg-blue-500",j&&"bg-yellow-500 animate-pulse"),style:{width:`${i}%`}}),f&&(0,b.jsx)("div",{className:"absolute inset-y-0 w-0.5 bg-yellow-600 opacity-50",style:{left:`${f/d*100}%`},title:`Terminal: ${f}`})]}),g&&h&&(0,b.jsxs)("div",{className:"flex gap-2 mt-1 items-center justify-center",children:[(0,b.jsx)("button",{onClick:()=>h(Math.max(0,c-1)),className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold",disabled:c<=0,children:"âˆ’"}),(0,b.jsx)("input",{type:"number",value:c,onChange:a=>h(Math.max(0,Math.min(d,parseInt(a.target.value)||0))),className:"w-16 text-center border rounded px-2 py-1 text-sm",min:0,max:d}),(0,b.jsx)("button",{onClick:()=>h(Math.min(d,c+1)),className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold",disabled:c>=d,children:"+"})]})]})}function y({label:a,value:c,subValue:d}){return(0,b.jsxs)("div",{className:"flex flex-col items-center p-2 bg-gray-100 rounded-lg min-w-[60px]",children:[(0,b.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:a}),(0,b.jsx)("span",{className:"text-xl font-bold text-gray-800",children:c}),d&&(0,b.jsx)("span",{className:"text-xs text-gray-500",children:d})]})}function z({name:a,bonus:c,score:d,onRoll:e}){let f=c>=0?`+${c}`:`${c}`;return(0,b.jsxs)("div",{onClick:e,className:(0,l.cn)("flex flex-col items-center p-2 bg-white border border-gray-200 rounded-lg min-w-[70px] transition-all",e&&"cursor-pointer hover:bg-teal-50 hover:border-teal-300 active:scale-95"),role:e?"button":void 0,title:e?`Click to roll ${a} save`:void 0,children:[(0,b.jsx)("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide",children:a}),(0,b.jsx)("span",{className:"text-lg font-bold text-gray-800",children:d}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:f})]})}function A({character:a,calculatedStats:c,isEditMode:d=!1,onHealthChange:e,onEnergyChange:f,onPortraitChange:g,isUploadingPortrait:h=!1}){let i=a.health?.current??c.maxHealth,j=a.energy?.current??c.maxEnergy,k=w(),m=a.description?.includes("female")?"â™€":a.description?.includes("male")?"â™‚":"",n=(a.experience??0)>=4*(a.level||1);return(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4",children:[(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("div",{className:(0,l.cn)("relative w-24 h-24 md:w-32 md:h-32 rounded-lg overflow-hidden bg-gray-200 flex-shrink-0",d&&g&&"cursor-pointer group"),onClick:()=>{if(!d||!g)return;let a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=a=>{let b=a.target.files?.[0];b&&g(b)},a.click()},title:d&&g?"Click to change portrait":void 0,children:[(0,b.jsx)(p.default,{src:a.portrait||"/images/placeholder-portrait.png",alt:a.name,fill:!0,className:(0,l.cn)("object-cover transition-opacity",h&&"opacity-50"),sizes:"(max-width: 768px) 96px, 128px"}),d&&g&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl",children:"ðŸ“·"})}),h&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,b.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,b.jsxs)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:[a.name,m&&(0,b.jsx)("span",{className:"ml-2 text-gray-400",children:m})]}),(0,b.jsxs)("p",{className:"text-gray-600",children:["Level ",a.level," ",a.ancestry?.name||"Unknown Ancestry"]}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:a.archetype?.name||"No Archetype"}),(0,b.jsxs)("p",{className:"text-gray-500 text-sm flex items-center gap-1",children:[(0,b.jsxs)("span",{children:["XP: ",a.experience??0]}),n&&(0,b.jsx)("span",{className:"text-green-600 animate-pulse",title:"Ready to level up!",children:"â¬†"}),n&&(0,b.jsx)("span",{className:"text-xs text-green-600",children:"(Level up available!)"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 items-start",children:[(0,b.jsx)(y,{label:"Speed",value:c.speed}),(0,b.jsx)(y,{label:"Evasion",value:c.evasion}),(0,b.jsx)(y,{label:"Armor",value:c.armor}),void 0!==a.innateEnergy&&a.innateEnergy>0&&(0,b.jsx)(y,{label:"Innate",value:a.innateEnergy})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-3 min-w-[200px]",children:[(0,b.jsx)(x,{label:"Health",current:i,max:c.maxHealth,color:"red",terminalThreshold:c.terminal,showControls:!0,onChange:e}),(0,b.jsx)(x,{label:"Energy",current:j,max:c.maxEnergy,color:"blue",showControls:!0,onChange:f})]})]}),(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Defenses"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries({might:"Might",fortitude:"Fortitude",reflex:"Reflex",discernment:"Discernment",mentalFortitude:"Mental Fort",resolve:"Resolve"}).map(([a,d])=>{let e=c.defenseBonuses[a]??0;return(0,b.jsx)(z,{name:d,bonus:e,score:c.defenseScores[a]??10,onRoll:k?()=>k.rollDefense(d,e):void 0},a)})})]})]})}let B={strength:{name:"Strength",description:"Physical power and melee attacks",defenseLink:"Might"},vitality:{name:"Vitality",description:"Health and endurance",defenseLink:"Fortitude"},agility:{name:"Agility",description:"Speed, dexterity, and finesse",defenseLink:"Reflex"},acuity:{name:"Acuity",description:"Perception and awareness",defenseLink:"Discernment"},intelligence:{name:"Intelligence",description:"Knowledge and reasoning",defenseLink:"Mental Fortitude"},charisma:{name:"Charisma",description:"Force of personality",defenseLink:"Resolve"}};function C({ability:a,value:c,info:d,isArchetypeAbility:e,isMartialAbility:f,isPowerAbility:g,isEditMode:h,onIncrease:i,onDecrease:j,onRoll:k}){let m=c>=0?`+${c}`:`${c}`,n="border-gray-200",o="";return e?(n="border-amber-400 border-2",o="bg-amber-100 text-amber-700"):g?(n="border-purple-400 border-2",o="bg-purple-100 text-purple-700"):f&&(n="border-red-400 border-2",o="bg-red-100 text-red-700"),(0,b.jsxs)("div",{onClick:()=>{!h&&k&&k()},className:(0,l.cn)("relative flex flex-col items-center p-4 bg-white rounded-xl shadow-sm border transition-all",n,h&&"hover:shadow-md",!h&&k&&"cursor-pointer hover:bg-gray-50 hover:shadow-md active:scale-95"),role:!h&&k?"button":void 0,title:!h&&k?`Click to roll ${d.name} check`:void 0,children:[(e||f||g)&&(0,b.jsx)("div",{className:(0,l.cn)("absolute -top-2 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase",o),children:e?"Archetype":g?"Power":"Martial"}),(0,b.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wider mt-1",children:d.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 my-2",children:[h&&(0,b.jsx)("button",{onClick:j,className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600",children:"âˆ’"}),(0,b.jsx)("span",{className:(0,l.cn)("text-3xl font-bold",c>0?"text-green-600":c<0?"text-red-600":"text-gray-700"),children:m}),h&&(0,b.jsx)("button",{onClick:i,className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600",children:"+"})]}),(0,b.jsxs)("span",{className:"text-[10px] text-gray-400",children:["â†’ ",d.defenseLink]})]})}function D({abilities:a,archetypeAbility:c,martialAbility:d,powerAbility:e,isEditMode:f=!1,availablePoints:g,onAbilityChange:h}){let i=w();return(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Abilities"}),f&&void 0!==g&&(0,b.jsxs)("span",{className:(0,l.cn)("px-3 py-1 rounded-full text-sm font-medium",g>0?"bg-green-100 text-green-700":g<0?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"),children:[g," points"]})]}),(0,b.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:["strength","vitality","agility","acuity","intelligence","charisma"].map(g=>(0,b.jsx)(C,{ability:g,value:a[g]??0,info:B[g],isArchetypeAbility:c?.toLowerCase()===g,isMartialAbility:d?.toLowerCase()===g,isPowerAbility:e?.toLowerCase()===g,isEditMode:f,onIncrease:()=>h?.(g,(a[g]??0)+1),onDecrease:()=>h?.(g,(a[g]??0)-1),onRoll:i?()=>i.rollAbility(g,a[g]??0):void 0},g))})]})}var E=a.i(15618);let F=[{id:"combat",name:"Combat",icon:"âš”ï¸"},{id:"physical",name:"Physical",icon:"ðŸƒ"},{id:"knowledge",name:"Knowledge",icon:"ðŸ“š"},{id:"social",name:"Social",icon:"ðŸ’¬"},{id:"other",name:"Other",icon:"â­"}];function G({skill:a,isEditMode:c,onToggleProf:d,onValueChange:e,onRoll:f}){let g=!!a.baseSkill,h=a.skill_val+ +!!a.prof,i=h>=0?`+${h}`:`${h}`;return(0,b.jsxs)("div",{onClick:a=>{c||a.target.closest("button")||f?.()},className:(0,l.cn)("flex items-center justify-between py-2 px-3 rounded-lg transition-colors",g?"ml-4 bg-gray-50":"bg-white",c&&"hover:bg-gray-100",!c&&f&&"cursor-pointer hover:bg-blue-50 active:bg-blue-100"),role:!c&&f?"button":void 0,title:!c&&f?`Click to roll ${a.name}`:void 0,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[!g&&(0,b.jsx)("button",{onClick:d,disabled:!c,className:(0,l.cn)("w-4 h-4 rounded-full border-2 transition-colors",a.prof?"bg-primary-600 border-primary-600":"bg-white border-gray-300",c&&"cursor-pointer hover:border-primary-400"),title:a.prof?"Proficient":"Not proficient"}),(0,b.jsxs)("span",{className:(0,l.cn)("text-sm",g?"text-gray-500 italic":"text-gray-700 font-medium"),children:[g&&"â”” ",a.name]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:c?(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("button",{onClick:()=>e?.(a.skill_val-1),className:"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm",disabled:a.skill_val<=0,children:"âˆ’"}),(0,b.jsx)("span",{className:"w-8 text-center font-mono",children:a.skill_val}),(0,b.jsx)("button",{onClick:()=>e?.(a.skill_val+1),className:"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm",children:"+"})]}):(0,b.jsx)("span",{className:(0,l.cn)("font-bold min-w-[40px] text-right",h>0?"text-green-600":h<0?"text-red-600":"text-gray-600"),children:i})})]})}function H({skills:a,abilities:d,isEditMode:e=!1,onSkillChange:f,onAddSkill:g,onAddSubSkill:h}){let[i,j]=(0,c.useState)(null),k=w(),m=F.reduce((b,c)=>(b[c.id]=a.filter(a=>(a.category?.toLowerCase()||"other")===c.id),b),{}),n=a.reduce((a,b)=>a+b.skill_val+ +!!b.prof,0);return(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Skills"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:g,className:"flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-100 hover:bg-emerald-200 text-emerald-700 text-sm font-medium transition-colors",title:"Add Skill",children:[(0,b.jsx)(E.Plus,{size:14}),"Skill"]}),(0,b.jsxs)("button",{onClick:h,className:"flex items-center gap-1 px-2 py-1 rounded-md bg-teal-100 hover:bg-teal-200 text-teal-700 text-sm font-medium transition-colors",title:"Add Sub-Skill",children:[(0,b.jsx)(E.Plus,{size:14}),"Sub-Skill"]}),(0,b.jsxs)("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm",children:[n," points spent"]})]})})]}),(0,b.jsx)("div",{className:"space-y-2",children:F.map(a=>{let c=m[a.id]||[];if(0===c.length)return null;let d=i===a.id||null===i;return(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,b.jsxs)("button",{onClick:()=>j(i===a.id?null:a.id),className:"w-full flex items-center justify-between px-4 py-2 bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("span",{className:"flex items-center gap-2 font-medium text-gray-700",children:[(0,b.jsx)("span",{children:a.icon}),a.name,(0,b.jsxs)("span",{className:"text-xs text-gray-400",children:["(",c.length,")"]})]}),(0,b.jsx)("span",{className:(0,l.cn)("transition-transform",d?"rotate-180":""),children:"â–¼"})]}),d&&(0,b.jsx)("div",{className:"divide-y divide-gray-100",children:c.map(a=>{let c=a.skill_val+ +!!a.prof;return(0,b.jsx)(G,{skill:a,isEditMode:e,onToggleProf:()=>f?.(a.id,{prof:!a.prof}),onValueChange:b=>f?.(a.id,{skill_val:b}),onRoll:k?()=>k.rollSkill(a.name,c):void 0},a.id)})})]},a.id)})})]})}function I({label:a,value:c,maxValue:d=6,color:e="blue"}){let f={blue:"bg-blue-500",purple:"bg-purple-500",red:"bg-red-500"};return(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:a}),(0,b.jsx)("span",{className:"font-bold",children:c})]}),(0,b.jsx)("div",{className:"flex gap-1",children:Array.from({length:d}).map((a,d)=>(0,b.jsx)("div",{className:(0,l.cn)("h-2 flex-1 rounded-full",d<c?f[e]:"bg-gray-200")},d))})]})}function J({feat:a,isEditMode:d,onUse:e}){let[f,g]=(0,c.useState)(!1),h=a.maxUses&&(a.currentUses??a.maxUses)>0;return(0,b.jsxs)("div",{className:(0,l.cn)("border border-gray-200 rounded-lg overflow-hidden transition-all",f&&"shadow-md"),children:[(0,b.jsxs)("button",{onClick:()=>g(!f),className:"w-full flex items-center justify-between px-3 py-2 bg-white hover:bg-gray-50 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),a.type&&(0,b.jsx)("span",{className:(0,l.cn)("text-xs px-1.5 py-0.5 rounded","archetype"===a.type?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"),children:a.type})]}),a.maxUses&&(0,b.jsxs)("span",{className:(0,l.cn)("text-sm font-medium",h?"text-green-600":"text-gray-400"),children:[a.currentUses??a.maxUses,"/",a.maxUses]})]}),f&&(0,b.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:a.description||"No description available."}),a.maxUses&&d&&(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),e?.()},disabled:!h,className:(0,l.cn)("px-3 py-1 rounded text-sm font-medium transition-colors",h?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"Use Ability"})]})]})}function K({character:a,isEditMode:c=!1,onFeatUse:d,onAddArchetypeFeat:e,onAddCharacterFeat:f}){let g=a.martialProficiency??0,h=a.powerProficiency??0,i=[...(a.archetypeFeats||[]).map(a=>({...a,type:"archetype"})),...(a.feats||[]).map(a=>({...a,type:"character"}))];return(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:a.archetype?.name||"No Archetype"}),a.archetype?.description&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:a.archetype.description})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,b.jsx)(I,{label:"Martial",value:g,color:"red"}),(0,b.jsx)(I,{label:"Power",value:h,color:"purple"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[a.mart_abil&&(0,b.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-sm",children:["Martial: ",a.mart_abil]}),a.pow_abil&&(0,b.jsxs)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm",children:["Power: ",a.pow_abil]})]}),(0,b.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide",children:["Feats (",i.length,")"]}),c&&(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:e,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded hover:bg-amber-200 transition-colors",children:[(0,b.jsx)(E.Plus,{className:"w-3 h-3"}),"Archetype"]}),(0,b.jsxs)("button",{onClick:f,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[(0,b.jsx)(E.Plus,{className:"w-3 h-3"}),"Character"]})]})]}),i.length>0?(0,b.jsx)("div",{className:"space-y-2",children:i.map((a,e)=>(0,b.jsx)(J,{feat:a,isEditMode:c,onUse:()=>d?.(String(a.id),(a.currentUses??a.maxUses??1)-1)},a.id||e))}):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic",children:"No feats selected"})]})]})}var L=a.i(33508),M=a.i(5784),N=a.i(67552);function O({weight:a=70,height:d=170,appearance:e="",archetypeDesc:f="",notes:g="",abilities:h,isEditMode:i=!1,onWeightChange:j,onHeightChange:k,onAppearanceChange:l,onArchetypeDescChange:m,onNotesChange:n}){let o=w(),[p,q]=(0,c.useState)(a.toString()),[r,s]=(0,c.useState)(d.toString()),t=h.strength||0,u=h.agility||0,v=h.vitality||0,x=(a,b,c)=>1===a?`${a} ${b}`:`${a} ${c}`,y=a=>Math.max(1,Math.ceil(a)),z=y(Math.max(t,u)),A=y(Math.max(t,u)/2),B=y(t/2),C=y(Math.max(t,v)/2),D=Math.max(200,200*Math.ceil(a/200)),E=Math.min(Math.ceil(a/200)||1,4),F=`${E}d4`,G=(0,c.useCallback)(()=>{o&&o.rollDamage(F)},[o,F]);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Physical Attributes & Movement"}),(0,b.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Weight"}),i&&j?(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("input",{type:"number",value:p,onChange:a=>q(a.target.value),onBlur:()=>{let b=parseInt(p)||70;b!==a&&j&&j(b)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"kg"})]}):(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[a," kg"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Height"}),i&&k?(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("input",{type:"number",value:r,onChange:a=>s(a.target.value),onBlur:()=>{let a=parseInt(r)||170;a!==d&&k&&k(a)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"cm"})]}):(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[d," cm"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Jump - Horizontal"}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:x(z,"space","spaces")})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Jump - Vertical"}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:x(A,"space","spaces")})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Climb Speed"}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:x(B,"space","spaces")}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"Requires successful Athletics roll"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Swim Speed"}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:x(C,"space","spaces")}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"DC 10 Acrobatics or Athletics (Vitality)"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 col-span-2 md:col-span-3",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Fall Damage"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:G,disabled:!o,className:"px-2 py-1 text-sm font-bold bg-gradient-to-b from-gray-50 to-indigo-50 border border-indigo-200 rounded-lg hover:shadow-sm transition-all disabled:opacity-50",title:o?"Click to roll":"Roll log not available",children:F}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:["bludgeoning per 2 spaces fallen (",D,"kg weight category)"]})]})]})]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Appearance"}),(0,b.jsx)("textarea",{value:e,onChange:a=>l?.(a.target.value),readOnly:!i,placeholder:"Describe your character's appearance...",className:"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!i})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Archetype Description"}),(0,b.jsx)("textarea",{value:f,onChange:a=>m?.(a.target.value),readOnly:!i,placeholder:"Describe your character's archetype background...",className:"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!i})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:g,onChange:a=>n?.(a.target.value),readOnly:!i,placeholder:"Additional notes, backstory, goals...",className:"w-full min-h-[120px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!i})]})]})}function P(a){return Math.floor((a.baseTP||0)+(a.op1TP||0)*(a.op1Lvl||0)+(a.op2TP||0)*(a.op2Lvl||0)+(a.op3TP||0)*(a.op3Lvl||0))}function Q(a,b){let c=new Map;return[...a,...b].forEach(a=>{a.properties&&a.properties.forEach(a=>{let b="string"==typeof a?a:a.name;b&&(c.has(b)||c.set(b,{name:b,baseTP:0,op1Lvl:0,op1TP:0}))})}),c}function R({title:a,profs:d}){let e=(0,c.useMemo)(()=>{let a=0;return d.forEach(b=>{a+=P(b)}),a},[d]);return(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-100 rounded-t-lg border border-gray-200",children:[(0,b.jsx)("span",{className:"font-semibold text-sm text-gray-700",children:a}),(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:["TP: ",(0,b.jsx)("span",{className:"font-semibold text-primary-600",children:e})]})]}),(0,b.jsx)("div",{className:"border border-t-0 border-gray-200 rounded-b-lg p-3",children:0===d.size?(0,b.jsx)("p",{className:"text-sm text-gray-400 italic text-center py-2",children:"No proficiencies"}):(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:Array.from(d.values()).map((a,c)=>{let d=P(a),e=a.name;return a.damageType&&(e+=` (${a.damageType})`),a.op1Lvl>0&&(e+=` Lvl ${a.op1Lvl}`),(0,b.jsxs)("div",{className:"px-2 py-1 text-xs bg-primary-50 text-primary-700 border border-primary-200 rounded-full",title:a.description||`${e} - TP: ${d}`,children:[e," | ",d," TP"]},c)})})})]})}function S({powers:a,techniques:d,weapons:e,armor:f,level:g,archetypeAbility:h}){let i=(0,c.useMemo)(()=>{let b;return b=new Map,a.forEach(a=>{a.parts&&a.parts.forEach(a=>{if("string"==typeof a){b.has(a)||b.set(a,{name:a,baseTP:0,op1Lvl:0,op1TP:0});return}if(!a.name)return;let c=a.op_1_lvl||0,d=a.op_2_lvl||0,e=a.op_3_lvl||0,f=a.base_tp||0,g=a.op_1_tp||0,h=a.op_2_tp||0,i=a.op_3_tp||0;if(0>=Math.floor(f+g*c+h*d+i*e))return;let j=a.name;if(b.has(j)){let a=b.get(j);a.op1Lvl=Math.max(a.op1Lvl,c),a.op2Lvl=Math.max(a.op2Lvl||0,d),a.op3Lvl=Math.max(a.op3Lvl||0,e)}else b.set(j,{name:a.name,baseTP:f,op1Lvl:c,op1TP:g,op2Lvl:d,op2TP:h,op3Lvl:e,op3TP:i})})}),b},[a]),j=(0,c.useMemo)(()=>{let a;return a=new Map,d.forEach(b=>{b.parts&&b.parts.forEach(b=>{if("string"==typeof b){a.has(b)||a.set(b,{name:b,baseTP:0,op1Lvl:0,op1TP:0});return}if(!b.name)return;let c=b.op_1_lvl||0,d=b.op_2_lvl||0,e=b.op_3_lvl||0,f=b.base_tp||0,g=b.op_1_tp||0,h=b.op_2_tp||0,i=b.op_3_tp||0;if(0>=Math.floor(f+g*c+h*d+i*e))return;let j=b.name;if(a.has(j)){let b=a.get(j);b.op1Lvl=Math.max(b.op1Lvl,c),b.op2Lvl=Math.max(b.op2Lvl||0,d),b.op3Lvl=Math.max(b.op3Lvl||0,e)}else a.set(j,{name:b.name,baseTP:f,op1Lvl:c,op1TP:g,op2Lvl:d,op2TP:h,op3Lvl:e,op3TP:i})})}),a},[d]),k=(0,c.useMemo)(()=>Q(e,[]),[e]),l=(0,c.useMemo)(()=>Q([],f),[f]),m=(0,c.useMemo)(()=>{let a=0;return[i,j,k,l].forEach(b=>{b.forEach(b=>{a+=P(b)})}),a},[i,j,k,l]),n=22+h*g+2*(g-1)-m;return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex justify-center mb-6",children:(0,b.jsxs)("div",{className:"px-8 py-4 bg-gray-50 border border-gray-200 rounded-xl shadow-sm",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("span",{className:"text-lg font-semibold text-gray-600",children:"Training Points: "}),(0,b.jsx)("span",{className:`text-2xl font-bold ${n>=0?"text-primary-600":"text-red-600"}`,children:n})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-400 text-center mt-1",children:[22," base + (",h," Ã— ",g,") + ",2*(g-1)," bonus - ",m," spent"]})]})}),(0,b.jsx)(R,{title:"Power Proficiencies",profs:i}),(0,b.jsx)(R,{title:"Technique Proficiencies",profs:j}),(0,b.jsx)(R,{title:"Weapon Proficiencies",profs:k}),(0,b.jsx)(R,{title:"Armor Proficiencies",profs:l})]})}function T({power:a,innateEnergy:d,isEditMode:e,onRemove:f}){let[g,h]=(0,c.useState)(!1),i=void 0!==a.cost&&void 0!==d&&a.cost<=d;return(0,b.jsxs)("div",{className:(0,l.cn)("border rounded-lg overflow-hidden",i?"border-purple-300 bg-purple-50":"border-gray-200 bg-white"),children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)("button",{onClick:()=>h(!g),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[g?(0,b.jsx)(N.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,b.jsx)(M.ChevronDown,{className:"w-4 h-4 text-gray-400"}),(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),i&&(0,b.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-purple-200 text-purple-700",children:"Innate"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[void 0!==a.cost&&(0,b.jsxs)("span",{className:"text-blue-600 font-medium",children:[a.cost," EP"]}),a.level&&(0,b.jsxs)("span",{children:["Lvl ",a.level]})]})]}),e&&f&&(0,b.jsx)("button",{onClick:f,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove power",children:(0,b.jsx)(L.X,{className:"w-4 h-4"})})]}),g&&a.description&&(0,b.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.description})})]})}function U({technique:a,isEditMode:d,onRemove:e}){let[f,g]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)("button",{onClick:()=>g(!f),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[f?(0,b.jsx)(N.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,b.jsx)(M.ChevronDown,{className:"w-4 h-4 text-gray-400"}),(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name})]}),void 0!==a.cost&&(0,b.jsxs)("span",{className:"text-sm text-red-600 font-medium",children:[a.cost," SP"]})]}),d&&e&&(0,b.jsx)("button",{onClick:e,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove technique",children:(0,b.jsx)(L.X,{className:"w-4 h-4"})})]}),f&&a.description&&(0,b.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.description})})]})}function V({item:a,type:d,isEditMode:e,onRemove:f,onToggleEquip:g,onRollAttack:h,onRollDamage:i}){let[j,k]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:(0,l.cn)("border rounded-lg overflow-hidden",a.equipped?"border-green-300 bg-green-50":"border-gray-200 bg-white"),children:[(0,b.jsxs)("div",{className:"flex items-center",children:[e&&g&&("weapon"===d||"armor"===d)&&(0,b.jsx)("button",{onClick:g,className:(0,l.cn)("px-2 py-2 transition-colors",a.equipped?"text-green-600 bg-green-100 hover:bg-green-200":"text-gray-400 hover:bg-gray-100"),title:a.equipped?"Unequip":"Equip",children:a.equipped?"âœ“":"â—‹"}),(0,b.jsxs)("button",{onClick:()=>k(!j),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[!e&&a.equipped&&(0,b.jsx)("span",{className:"text-green-600",children:"âœ“"}),(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),a.quantity&&a.quantity>1&&(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Ã—",a.quantity]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:["weapon"===d&&a.damage&&(0,b.jsx)("span",{className:"text-red-600 font-medium",children:a.damage}),"armor"===d&&a.armor&&(0,b.jsxs)("span",{className:"text-blue-600 font-medium",children:["+",a.armor," AR"]})]})]}),"weapon"===d&&!e&&(0,b.jsxs)("div",{className:"flex items-center gap-1 pr-2",children:[h&&(0,b.jsx)("button",{onClick:h,className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"Roll attack",children:"âš”ï¸ Atk"}),i&&a.damage&&(0,b.jsx)("button",{onClick:i,className:"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded hover:bg-orange-200 transition-colors",title:"Roll damage",children:"ðŸ’¥ Dmg"})]}),e&&f&&(0,b.jsx)("button",{onClick:f,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove item",children:(0,b.jsx)(L.X,{className:"w-4 h-4"})})]}),j&&(0,b.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:a.description}),a.properties&&a.properties.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:a.properties.map((a,c)=>(0,b.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 rounded",children:"string"==typeof a?a:a.name},c))})]})]})}function W({powers:a,techniques:d,weapons:e,armor:f,equipment:g,currency:h=0,innateEnergy:i=0,isEditMode:j=!1,onAddPower:k,onRemovePower:m,onAddTechnique:n,onRemoveTechnique:o,onAddWeapon:p,onRemoveWeapon:q,onToggleEquipWeapon:r,onAddArmor:s,onRemoveArmor:t,onToggleEquipArmor:u,onAddEquipment:v,onRemoveEquipment:x,onCurrencyChange:y,weight:z=70,height:A=170,appearance:B="",archetypeDesc:C="",notes:D="",abilities:F,onWeightChange:G,onHeightChange:H,onAppearanceChange:I,onArchetypeDescChange:J,onNotesChange:K,level:L=1,archetypeAbility:M=0}){let[N,P]=(0,c.useState)("powers"),[Q,R]=(0,c.useState)(h.toString()),W=w(),X=[{id:"powers",label:"Powers",count:a.length,onAdd:k},{id:"techniques",label:"Techniques",count:d.length,onAdd:n},{id:"weapons",label:"Weapons",count:e.length,onAdd:p},{id:"armor",label:"Armor",count:f.length,onAdd:s},{id:"equipment",label:"Equipment",count:g.length,onAdd:v},{id:"proficiencies",label:"Proficiencies"},{id:"notes",label:"Notes"}],Y=X.find(a=>a.id===N);return(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mb-4 border-b border-gray-200 pb-2",children:X.map(a=>(0,b.jsxs)("button",{onClick:()=>P(a.id),className:(0,l.cn)("px-3 py-1.5 rounded-t-lg text-sm font-medium transition-colors",N===a.id?"bg-primary-100 text-primary-700 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[a.label,void 0!==a.count&&(0,b.jsxs)("span",{className:"ml-1 text-xs opacity-70",children:["(",a.count,")"]})]},a.id))}),["powers","techniques","weapons","armor","equipment"].includes(N)&&(0,b.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"ðŸ’°"}),j&&y?(0,b.jsx)("input",{type:"number",value:Q,onChange:a=>R(a.target.value),onBlur:()=>{let a=parseInt(Q)||0;a!==h&&y&&y(a)},className:"w-24 px-2 py-1 text-sm font-bold text-amber-600 border border-amber-300 rounded focus:ring-2 focus:ring-amber-500"}):(0,b.jsx)("span",{className:"font-bold text-amber-600",children:h.toLocaleString()}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"gold"})]}),j&&Y?.onAdd&&(0,b.jsxs)("button",{onClick:Y.onAdd,className:"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded-lg transition-colors",children:[(0,b.jsx)(E.Plus,{className:"w-4 h-4"}),"Add"]})]}),(0,b.jsxs)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:["powers"===N&&(a.length>0?a.map((a,c)=>(0,b.jsx)(T,{power:a,innateEnergy:i,isEditMode:j,onRemove:m?()=>m(a.id||String(c)):void 0},a.id||c)):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No powers learned"})),"techniques"===N&&(d.length>0?d.map((a,c)=>(0,b.jsx)(U,{technique:a,isEditMode:j,onRemove:o?()=>o(a.id||String(c)):void 0},a.id||c)):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No techniques learned"})),"weapons"===N&&(e.length>0?e.map((a,c)=>{let d=a.attackBonus??0;return(0,b.jsx)(V,{item:a,type:"weapon",isEditMode:j,onRemove:q?()=>q(a.id||String(c)):void 0,onToggleEquip:r?()=>r(a.id||String(c)):void 0,onRollAttack:W?()=>W.rollAttack(a.name,d):void 0,onRollDamage:W&&a.damage?()=>W.rollDamage(a.damage):void 0},a.id||c)}):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No weapons equipped"})),"armor"===N&&(f.length>0?f.map((a,c)=>(0,b.jsx)(V,{item:a,type:"armor",isEditMode:j,onRemove:t?()=>t(a.id||String(c)):void 0,onToggleEquip:u?()=>u(a.id||String(c)):void 0},a.id||c)):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No armor equipped"})),"equipment"===N&&(g.length>0?g.map((a,c)=>(0,b.jsx)(V,{item:a,type:"equipment",isEditMode:j,onRemove:x?()=>x(a.id||String(c)):void 0},a.id||c)):(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No equipment in inventory"})),"proficiencies"===N&&(0,b.jsx)(S,{powers:a,techniques:d,weapons:e,armor:f,level:L,archetypeAbility:M}),"notes"===N&&F&&(0,b.jsx)(O,{weight:z,height:A,appearance:B,archetypeDesc:C,notes:D,abilities:F,isEditMode:j,onWeightChange:G,onHeightChange:H,onAppearanceChange:I,onArchetypeDescChange:J,onNotesChange:K}),"notes"===N&&!F&&(0,b.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"Character abilities not loaded"})]})]})}var X=a.i(60137);let Y=(0,X.default)("dices",[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]]),Z=(0,X.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),$={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20},_={attack:"border-l-red-500",damage:"border-l-orange-500",skill:"border-l-blue-500",ability:"border-l-purple-500",defense:"border-l-teal-500",custom:"border-l-gray-400"},aa={attack:"âš”ï¸",damage:"ðŸ’¥",skill:"ðŸŽ¯",ability:"ðŸ’ª",defense:"ðŸ›¡ï¸",custom:"ðŸŽ²"};function ab({className:a}){let d,{rolls:e,addRoll:f,clearHistory:g}=function(){let a=(0,c.useContext)(q);if(!a)throw Error("useRolls must be used within a RollProvider");return a}(),[h,i]=c.useState(!1),[j,k]=c.useState({d4:0,d6:0,d8:0,d10:0,d12:0,d20:0}),[m,n]=c.useState(0),[o,p]=c.useState("custom"),[r,s]=c.useState(""),t=()=>{k({d4:0,d6:0,d8:0,d10:0,d12:0,d20:0}),n(0)},u=Object.values(j).reduce((a,b)=>a+b,0);return(0,b.jsxs)("div",{className:(0,l.cn)("fixed bottom-5 right-5 z-[1000] flex flex-col items-end",a),children:[(0,b.jsxs)("div",{className:(0,l.cn)("absolute bottom-[70px] right-0 w-[360px] max-w-[calc(100vw-40px)]","bg-white rounded-xl shadow-2xl overflow-hidden","flex flex-col transition-all duration-300",h?"h-[70vh] max-h-[600px] opacity-100":"h-0 opacity-0 pointer-events-none"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-primary-dark to-[#053357] text-white",children:[(0,b.jsx)("h3",{className:"font-bold text-base tracking-wide",children:"ðŸŽ² Roll Log"}),(0,b.jsx)("button",{onClick:g,className:"px-3 py-1.5 rounded-md bg-white/15 border border-white/30 text-white text-xs font-semibold hover:bg-white/25 transition-colors",children:"Clear All"})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-2 bg-gray-50",children:0===e.length?(0,b.jsx)("p",{className:"text-center text-gray-500 italic py-10",children:"No rolls yet. Build your dice pool below!"}):e.map(a=>(0,b.jsx)(ac,{roll:a},a.id))}),(0,b.jsxs)("div",{className:"p-3 bg-gradient-to-r from-primary-dark to-[#053357] border-t-2 border-gray-300",children:[(0,b.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,b.jsxs)("select",{value:o,onChange:a=>p(a.target.value),className:"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white text-sm",children:[(0,b.jsx)("option",{value:"custom",className:"text-gray-900",children:"Custom"}),(0,b.jsx)("option",{value:"attack",className:"text-gray-900",children:"Attack"}),(0,b.jsx)("option",{value:"damage",className:"text-gray-900",children:"Damage"}),(0,b.jsx)("option",{value:"skill",className:"text-gray-900",children:"Skill"}),(0,b.jsx)("option",{value:"ability",className:"text-gray-900",children:"Ability"}),(0,b.jsx)("option",{value:"defense",className:"text-gray-900",children:"Defense"})]}),(0,b.jsx)("input",{type:"text",value:r,onChange:a=>s(a.target.value),placeholder:"Roll name...",className:"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white placeholder-white/50 text-sm"})]}),(0,b.jsx)("div",{className:"grid grid-cols-6 gap-1 mb-3",children:["d4","d6","d8","d10","d12","d20"].map(a=>(0,b.jsxs)("button",{onClick:()=>{k(b=>({...b,[a]:Math.min(b[a]+1,20)}))},onContextMenu:b=>{b.preventDefault(),k(b=>({...b,[a]:Math.max(b[a]-1,0)}))},className:(0,l.cn)("flex flex-col items-center justify-center py-2 px-1 rounded","bg-white/10 hover:bg-white/20 transition-colors text-white",j[a]>0&&"ring-2 ring-yellow-400"),children:[(0,b.jsx)("span",{className:"text-xs font-bold",children:a}),j[a]>0&&(0,b.jsx)("span",{className:"text-yellow-400 text-sm font-bold",children:j[a]})]},a))}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("button",{onClick:()=>n(a=>a-1),className:"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center",children:(0,b.jsx)(Z,{className:"w-4 h-4"})}),(0,b.jsxs)("span",{className:"text-white font-bold min-w-[40px] text-center",children:[m>=0?"+":"",m]}),(0,b.jsx)("button",{onClick:()=>n(a=>a+1),className:"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center",children:(0,b.jsx)(E.Plus,{className:"w-4 h-4"})})]}),(0,b.jsx)("span",{className:"text-white/70 text-xs flex-1 text-center",children:(d=[],Object.entries(j).forEach(([a,b])=>{b>0&&d.push(`${b}${a}`)}),0!==m&&d.push(m>0?`+${m}`:`${m}`),d.join(" + ")||"No dice selected")}),(0,b.jsx)("button",{onClick:t,className:"text-white/70 hover:text-white text-xs",children:"Clear"})]}),(0,b.jsxs)("button",{onClick:()=>{let a=[],b=0,c=!1,d=0;if(Object.entries(j).forEach(([e,f])=>{for(let g=0;g<f;g++){let f=Math.floor(Math.random()*$[e])+1,g=$[e];a.push({type:e,value:f,isMax:f===g,isMin:1===f}),b+=f,"d20"===e&&(c=!0,d=f)}}),0===a.length)return;b+=m;let e=c&&20===d,g=c&&1===d;f({id:`roll-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:o,title:r||`${o.charAt(0).toUpperCase()+o.slice(1)} Roll`,dice:a,modifier:m,total:b,isCrit:e,isCritFail:g,timestamp:new Date}),t(),s("")},disabled:0===u,className:(0,l.cn)("w-full py-2.5 rounded-lg font-bold text-white transition-all","bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700","disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed"),children:["ðŸŽ² Roll ",u>0?`(${u} dice)`:""]})]})]}),(0,b.jsx)("button",{onClick:()=>i(!h),className:(0,l.cn)("w-14 h-14 rounded-full shadow-lg transition-all duration-300","flex items-center justify-center","bg-gradient-to-br from-primary-light to-primary-dark hover:scale-110",h&&"from-primary-dark to-[#021a2e]"),"aria-label":h?"Close roll log":"Open roll log",children:(0,b.jsx)(Y,{className:"w-7 h-7 text-white"})})]})}function ac({roll:a}){return(0,b.jsxs)("div",{className:(0,l.cn)("bg-white rounded-lg mb-2 p-3 shadow-sm border-l-4 animate-slide-in-right",_[a.type],a.isCrit&&"ring-2 ring-green-400",a.isCritFail&&"ring-2 ring-red-400"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm",children:aa[a.type]}),(0,b.jsx)("span",{className:"font-semibold text-sm text-primary-dark",children:a.title})]}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:a.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[a.dice.map((a,c)=>(0,b.jsx)("span",{className:(0,l.cn)("inline-flex items-center justify-center min-w-[28px] h-7 px-1.5 rounded text-sm font-bold","d20"===a.type?(0,l.cn)("w-9 h-9 text-base border-2",a.isMax&&"bg-green-100 border-green-500 text-green-800",a.isMin&&"bg-red-100 border-red-500 text-red-800",!a.isMax&&!a.isMin&&"bg-gray-100 border-gray-300 text-gray-800"):(0,l.cn)("bg-amber-100 border border-amber-400 text-amber-800")),children:a.value},c)),0!==a.modifier&&(0,b.jsxs)("span",{className:"text-gray-500 font-semibold",children:[a.modifier>0?"+":"",a.modifier]}),(0,b.jsx)("span",{className:"text-gray-400",children:"="}),(0,b.jsx)("span",{className:(0,l.cn)("font-bold text-lg px-3 py-0.5 rounded border",a.isCrit&&"bg-green-100 border-green-400 text-green-800",a.isCritFail&&"bg-red-100 border-red-400 text-red-800",!a.isCrit&&!a.isCritFail&&"bg-blue-50 border-blue-200 text-primary-dark"),children:a.total})]}),a.isCrit&&(0,b.jsx)("div",{className:"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-green-500 to-teal-500 text-white animate-pulse-dot",children:"Critical Success!"}),a.isCritFail&&(0,b.jsx)("div",{className:"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-red-500 to-red-600 text-white animate-pulse-dot",children:"Critical Fail!"})]})}var ad=a.i(87532),ae=a.i(33441),af=a.i(96221);a.i(11909);var ag=a.i(41707);function ah({isOpen:a,onClose:d,itemType:e,existingIds:f,onAdd:g}){let[h,i]=(0,c.useState)(""),[j,l]=(0,c.useState)(new Set),{data:m=[],isLoading:n}=(0,k.useUserPowers)(),{data:o=[],isLoading:p}=(0,k.useUserTechniques)(),{data:q=[],isLoading:r}=(0,k.useUserItems)();(0,c.useEffect)(()=>{a&&(l(new Set),i(""))},[a]);let{items:s,isLoading:t}=(0,c.useMemo)(()=>{switch(e){case"power":return{items:m,isLoading:n};case"technique":return{items:o,isLoading:p};case"weapon":return{items:q.filter(a=>"weapon"===a.type),isLoading:r};case"armor":return{items:q.filter(a=>"armor"===a.type),isLoading:r};case"equipment":return{items:q.filter(a=>"equipment"===a.type),isLoading:r};default:return{items:[],isLoading:!1}}},[e,m,o,q,n,p,r]),u=(0,c.useMemo)(()=>s.filter(a=>{if(f.has(a.id))return!1;if(h){let b=h.toLowerCase();return a.name.toLowerCase().includes(b)||a.description?.toLowerCase().includes(b)}return!0}),[s,f,h]);return(0,b.jsx)(ag.Modal,{isOpen:a,onClose:d,title:(()=>{switch(e){case"power":return"Add Power from Library";case"technique":return"Add Technique from Library";case"weapon":return"Add Weapon from Library";case"armor":return"Add Armor from Library";case"equipment":return"Add Equipment from Library";default:return"Add Item"}})(),children:(0,b.jsxs)("div",{className:"flex flex-col h-[60vh]",children:[(0,b.jsxs)("div",{className:"relative mb-4",children:[(0,b.jsx)(ad.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),placeholder:`Search your ${e}s...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto border border-gray-200 rounded-lg",children:t?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(af.Loader2,{className:"w-8 h-8 animate-spin text-primary-600"})}):0===u.length?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:0===s.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{className:"text-lg font-medium",children:["No ",e,"s in your library"]}),(0,b.jsxs)("p",{className:"text-sm mt-1",children:["Create some in the ","power"===e?"Power":"technique"===e?"Technique":"Item"," Creator first!"]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{className:"text-lg font-medium",children:["All ",e,"s already added"]}),(0,b.jsxs)("p",{className:"text-sm mt-1",children:['or no matches for "',h,'"']})]})}):(0,b.jsx)("ul",{className:"divide-y divide-gray-100",children:u.map(a=>{var c,d;return(0,b.jsxs)("li",{onClick:()=>{var b;return b=a.id,void l(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:`
                    flex items-center gap-3 px-4 py-3 cursor-pointer transition-colors
                    ${j.has(a.id)?"bg-primary-50 border-l-4 border-primary-500":"hover:bg-gray-50 border-l-4 border-transparent"}
                  `,children:[(0,b.jsx)("div",{className:`
                    w-5 h-5 rounded border-2 flex items-center justify-center transition-colors
                    ${j.has(a.id)?"bg-primary-600 border-primary-600":"border-gray-300"}
                  `,children:j.has(a.id)&&(0,b.jsx)(ae.Check,{className:"w-3 h-3 text-white"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 truncate",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-500 truncate",children:a.description})]}),(c=a,"power"===(d=e)||"technique"===d?null:"weapon"===d?c.damage?(0,b.jsx)("span",{className:"text-sm text-red-600 font-medium",children:c.damage}):null:"armor"===d&&c.armorValue?(0,b.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["+",c.armorValue," AR"]}):null)]},a.id)})})}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 mt-4",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[j.size," selected"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:()=>{let a=s.filter(a=>j.has(a.id));"power"===e?g(a.map(a=>({id:a.id,name:a.name,description:a.description||"",parts:(a.parts||[]).map(a=>({id:String(a.id||""),name:a.name||"",op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),cost:0,level:1}))):"technique"===e?g(a.map(a=>({id:a.id,name:a.name,description:a.description||"",parts:(a.parts||[]).map(a=>({id:String(a.id||""),name:a.name||"",op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),cost:0}))):g(a.map(a=>({id:a.id,name:a.name,description:a.description||"",properties:a.properties||[],damage:a.damage||"",armor:a.armorValue||0,equipped:!1,quantity:1}))),d()},disabled:0===j.size,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,b.jsx)(E.Plus,{className:"w-4 h-4"}),"Add Selected"]})]})]})]})})}a.i(72029);var ai=a.i(50455);let aj={I:1,II:2,III:3,IV:4,V:5,VI:6,VII:7,VIII:8,IX:9,X:10};function ak(a){if(!a)return{baseName:a,level:1,hasLevel:!1};let b=a.match(/^(.+?)\s+(I{1,3}|IV|VI{0,3}|IX|X)$/i);return b?{baseName:b[1].trim(),level:aj[b[2].toUpperCase()]||1,hasLevel:!0}:{baseName:a,level:1,hasLevel:!1}}function al({feat:a,isSelected:d,onToggle:e,meetsRequirements:f,requirementWarning:g}){let[h,i]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:(0,l.cn)("border rounded-lg overflow-hidden transition-all",d?"border-primary-500 bg-primary-50":"border-gray-200",!f&&"opacity-50"),children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("button",{onClick:e,disabled:!f,className:(0,l.cn)("w-8 h-8 flex items-center justify-center border-r",d?"bg-primary-500 text-white":"bg-gray-50 text-gray-400",!f&&"cursor-not-allowed"),children:d?"âœ“":"+"}),(0,b.jsxs)("button",{onClick:()=>i(!h),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),a.category&&(0,b.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 text-gray-600",children:a.category})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.lvl_req&&a.lvl_req>1&&(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Lvl ",a.lvl_req,"+"]}),h?(0,b.jsx)(N.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,b.jsx)(M.ChevronDown,{className:"w-4 h-4 text-gray-400"})]})]})]}),h&&(0,b.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.description||a.effect||"No description available."}),g&&(0,b.jsxs)("p",{className:"text-xs text-amber-600 mt-2",children:["âš ï¸ ",g]})]})]})}function am({isOpen:a,onClose:d,featType:e,character:f,existingFeatIds:g,onAdd:i}){let[j,k]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&(async()=>{n(!0),p(null);try{let a=await (0,ai.get)((0,ai.ref)(h.rtdb,"feats"));if(a.exists()){let b=a.val(),c=Object.entries(b).map(([a,b])=>({id:a,...b}));k(c)}}catch(a){p(`Failed to load feats: ${a instanceof Error?a.message:"Unknown error"}`)}finally{n(!1)}})()},[a]),(0,c.useEffect)(()=>{a&&(v([]),r(""),t(""))},[a]);let w=(0,c.useMemo)(()=>{let a=new Set;return j.forEach(b=>{b.category&&a.add(b.category)}),Array.from(a).sort()},[j]),x=(0,c.useMemo)(()=>j.filter(a=>{if("character"===e&&!a.char_feat||"archetype"===e&&a.char_feat||g.includes(a.id)||g.includes(a.name))return!1;if(q){let b=q.toLowerCase();if(!a.name.toLowerCase().includes(b)&&!a.description?.toLowerCase().includes(b))return!1}return!s||a.category===s}).sort((a,b)=>a.name.localeCompare(b.name)),[j,e,g,q,s]);return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900",children:["Add ","archetype"===e?"Archetype":"Character"," Feat"]}),(0,b.jsx)("button",{onClick:d,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,b.jsx)(L.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,b.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 space-y-2",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ad.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:q,onChange:a=>r(a.target.value),placeholder:"Search feats...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsx)("button",{onClick:()=>t(""),className:(0,l.cn)("px-3 py-1 rounded-full text-sm transition-colors",s?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-primary-600 text-white"),children:"All"}),w.map(a=>(0,b.jsx)("button",{onClick:()=>t(a),className:(0,l.cn)("px-3 py-1 rounded-full text-sm transition-colors",s===a?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:a},a))]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[m&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading feats..."})]}),o&&(0,b.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,b.jsx)("p",{children:o})}),!m&&!o&&0===x.length&&(0,b.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No feats available"}),!m&&!o&&x.length>0&&(0,b.jsx)("div",{className:"space-y-2",children:x.map(a=>{let{meets:c,warning:d}=(a=>{let b=[];if(a.lvl_req&&f.level<a.lvl_req&&b.push(`Requires level ${a.lvl_req}`),a.ability_req&&a.abil_req_val){let c=f.abilities||{};a.ability_req.forEach((d,e)=>{let f=a.abil_req_val?.[e]??0;(c[d.toLowerCase()]??0)<f&&b.push(`Requires ${d} ${f}+`)})}let{baseName:c,level:d}=ak(a.name);if(d>1&&![...f.archetypeFeats||[],...f.feats||[]].some(a=>{let b=ak(a.name);return b.baseName===c&&b.level===d-1})){let a=["I","II","III","IV","V","VI","VII","VIII","IX"][d-2]||"I";b.push(`Requires ${c} ${a}`)}return{meets:0===b.length,warning:b.join(", ")}})(a);return(0,b.jsx)(al,{feat:a,isSelected:u.some(b=>b.id===a.id),onToggle:()=>{v(b=>b.some(b=>b.id===a.id)?b.filter(b=>b.id!==a.id):[...b,a])},meetsRequirements:c,requirementWarning:d},a.id)})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[u.length," feat",1!==u.length?"s":""," selected"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:d,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:()=>{u.length>0&&(i(u),d())},disabled:0===u.length,className:(0,l.cn)("px-4 py-2 rounded-lg font-medium transition-colors",u.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",u.length>0?`(${u.length})`:""]})]})]})]})}):null}function an({skill:a,isSelected:c,onToggle:d}){let e=Array.isArray(a.ability)?a.ability.join(", "):"";return(0,b.jsxs)("div",{className:(0,l.cn)("flex items-center justify-between px-3 py-2 border rounded-lg transition-all",c?"border-primary-500 bg-primary-50":"border-gray-200 hover:bg-gray-50"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:d,className:(0,l.cn)("w-6 h-6 rounded-full flex items-center justify-center transition-colors",c?"bg-primary-500 text-white":"bg-gray-100 text-gray-400 hover:bg-gray-200"),children:c?"âœ“":"+"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),e&&(0,b.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e,")"]})]})]}),a.category&&(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600",children:a.category})]})}function ao({isOpen:a,onClose:d,existingSkillNames:e,onAdd:f}){let[g,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&(async()=>{k(!0),n(null);try{let a=await (0,ai.get)((0,ai.ref)(h.rtdb,"skills"));if(a.exists()){let b=a.val(),c=Object.entries(b).map(([a,b])=>({id:a,...b})).filter(a=>!a.base_skill);i(c)}}catch(a){n(`Failed to load skills: ${a instanceof Error?a.message:"Unknown error"}`)}finally{k(!1)}})()},[a]),(0,c.useEffect)(()=>{a&&(r([]),p(""))},[a]);let s=(0,c.useMemo)(()=>{let a=e.map(a=>a.toLowerCase());return g.filter(b=>{if(a.includes(b.name.toLowerCase()))return!1;if(o){let a=o.toLowerCase();if(!b.name.toLowerCase().includes(a))return!1}return!0}).sort((a,b)=>a.name.localeCompare(b.name))},[g,e,o]);return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Add Skill"}),(0,b.jsx)("button",{onClick:d,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,b.jsx)(L.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,b.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ad.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:o,onChange:a=>p(a.target.value),placeholder:"Search skills...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[j&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading skills..."})]}),m&&(0,b.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,b.jsx)("p",{children:m})}),!j&&!m&&0===s.length&&(0,b.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No skills available to add"}),!j&&!m&&s.length>0&&(0,b.jsx)("div",{className:"space-y-2",children:s.map(a=>(0,b.jsx)(an,{skill:a,isSelected:q.some(b=>b.id===a.id),onToggle:()=>{r(b=>b.some(b=>b.id===a.id)?b.filter(b=>b.id!==a.id):[...b,a])}},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[q.length," skill",1!==q.length?"s":""," selected"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:d,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:()=>{q.length>0&&(f(q),d())},disabled:0===q.length,className:(0,l.cn)("px-4 py-2 rounded-lg font-medium transition-colors",q.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",q.length>0?`(${q.length})`:""]})]})]})]})}):null}function ap({skill:a,isSelected:c,onToggle:d}){let e=Array.isArray(a.ability)?a.ability.join(", "):"";return(0,b.jsx)("div",{className:(0,l.cn)("flex items-center justify-between px-3 py-2 border rounded-lg transition-all",c?"border-primary-500 bg-primary-50":"border-gray-200 hover:bg-gray-50"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:d,className:(0,l.cn)("w-6 h-6 rounded-full flex items-center justify-center transition-colors",c?"bg-primary-500 text-white":"bg-gray-100 text-gray-400 hover:bg-gray-200"),children:c?"âœ“":"+"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:a.name}),(0,b.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",a.base_skill,")"]}),e&&(0,b.jsx)("span",{className:"ml-1 text-xs text-gray-400",children:e})]})]})})}function aq({isOpen:a,onClose:d,characterSkills:e,existingSkillNames:f,onAdd:g}){let[i,j]=(0,c.useState)([]),[k,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),t=(0,c.useMemo)(()=>e.filter(a=>a.prof).map(a=>a.name),[e]);(0,c.useEffect)(()=>{a&&(async()=>{m(!0),o(null);try{let a=await (0,ai.get)((0,ai.ref)(h.rtdb,"skills"));if(a.exists()){let b=a.val(),c=Object.entries(b).map(([a,b])=>({id:a,...b})).filter(a=>a.base_skill&&t.includes(a.base_skill));j(c)}}catch(a){o(`Failed to load sub-skills: ${a instanceof Error?a.message:"Unknown error"}`)}finally{m(!1)}})()},[a,t]),(0,c.useEffect)(()=>{a&&(s([]),q(""))},[a]);let u=(0,c.useMemo)(()=>{let a=f.map(a=>a.toLowerCase());return i.filter(b=>{if(a.includes(b.name.toLowerCase()))return!1;if(p){let a=p.toLowerCase();if(!b.name.toLowerCase().includes(a)&&!b.base_skill.toLowerCase().includes(a))return!1}return!0}).sort((a,b)=>a.name.localeCompare(b.name))},[i,f,p]);return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Add Sub-Skill"}),(0,b.jsx)("button",{onClick:d,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,b.jsx)(L.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,b.jsx)("div",{className:"px-4 py-2 bg-blue-50 border-b border-blue-100",children:(0,b.jsx)("p",{className:"text-sm text-blue-700",children:"Sub-skills are available for skills you are proficient in."})}),(0,b.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(ad.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:p,onChange:a=>q(a.target.value),placeholder:"Search sub-skills...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[k&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading sub-skills..."})]}),n&&(0,b.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,b.jsx)("p",{children:n})}),!k&&!n&&0===t.length&&(0,b.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"You need at least one proficient skill to add sub-skills."}),!k&&!n&&t.length>0&&0===u.length&&(0,b.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No sub-skills available to add"}),!k&&!n&&u.length>0&&(0,b.jsx)("div",{className:"space-y-2",children:u.map(a=>(0,b.jsx)(ap,{skill:a,isSelected:r.some(b=>b.id===a.id),onToggle:()=>{s(b=>b.some(b=>b.id===a.id)?b.filter(b=>b.id!==a.id):[...b,a])}},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[r.length," sub-skill",1!==r.length?"s":""," selected"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:d,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:()=>{r.length>0&&(g(r),d())},disabled:0===r.length,className:(0,l.cn)("px-4 py-2 rounded-lg font-medium transition-colors",r.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",r.length>0?`(${r.length})`:""]})]})]})]})}):null}let ar=(0,X.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),as=(0,X.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var at=a.i(76472),au=a.i(3314),av=a.i(58120),aw=a.i(40104);function ax({isOpen:a,onClose:d,character:e,onConfirm:f}){let g,[h,i]=(0,c.useState)((e.level||1)+1),j=e.level||1,k=(0,c.useMemo)(()=>{let a=e.abilities||{};return Math.max(...[e.archetype?.ability?.toLowerCase(),e.mart_abil?.toLowerCase(),e.pow_abil?.toLowerCase()].filter(Boolean).map(b=>a[b]||0),0)},[e]),l=(0,c.useMemo)(()=>(function(a,b,c=0){let d=(0,aw.calculateHealthEnergyPool)(a,"PLAYER"),e=(0,aw.calculateHealthEnergyPool)(b,"PLAYER"),f=(0,aw.calculateAbilityPoints)(a),g=(0,aw.calculateAbilityPoints)(b),h=(0,aw.calculateSkillPoints)(a),i=(0,aw.calculateSkillPoints)(b),j=(0,aw.calculateTrainingPoints)(a,c),k=(0,aw.calculateTrainingPoints)(b,c),l=(0,aw.calculateProficiency)(a);return{healthEnergy:e-d,abilityPoints:g-f,skillPoints:i-h,trainingPoints:k-j,proficiency:(0,aw.calculateProficiency)(b)-l,archetypeFeats:b-a,characterFeats:b-a}})(j,h,k),[j,h,k]),m=(g=[],l.abilityPoints>0&&g.push(`+${l.abilityPoints} Ability Point${l.abilityPoints>1?"s":""}`),l.proficiency>0&&g.push(`+${l.proficiency} Proficiency`),g);return(0,b.jsx)(ag.Modal,{isOpen:a,onClose:d,title:"Level Up!",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("p",{className:"text-gray-600 mb-2",children:[e.name," â€¢ Level ",j]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,b.jsx)("button",{onClick:()=>i(Math.max(j+1,h-1)),disabled:h<=j+1,className:"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:"-"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-5xl font-bold text-primary-600",children:h}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"New Level"})]}),(0,b.jsx)("button",{onClick:()=>i(Math.min(20,h+1)),disabled:h>=20,className:"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:"+"})]})]}),m.length>0&&(0,b.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700 font-medium mb-2",children:[(0,b.jsx)(as,{className:"w-5 h-5"}),"Milestone Bonuses!"]}),(0,b.jsx)("ul",{className:"text-sm text-yellow-600 space-y-1",children:m.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)(ae.Check,{className:"w-4 h-4"}),a]},c))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)(ay,{icon:(0,b.jsx)(at.Heart,{className:"w-5 h-5 text-red-500"}),label:"Health & Energy",value:`+${l.healthEnergy}`,description:"Hit points"}),(0,b.jsx)(ay,{icon:(0,b.jsx)(av.Sword,{className:"w-5 h-5 text-orange-500"}),label:"Training Points",value:`+${l.trainingPoints}`,description:"For powers/techniques"}),(0,b.jsx)(ay,{icon:(0,b.jsx)(au.Shield,{className:"w-5 h-5 text-blue-500"}),label:"Skill Points",value:`+${l.skillPoints}`,description:"For skills"}),(0,b.jsx)(ay,{icon:(0,b.jsx)(as,{className:"w-5 h-5 text-purple-500"}),label:"Feats",value:`+${l.archetypeFeats}`,description:"Archetype & Character"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:d,className:"flex-1 px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:()=>{f(h),d()},className:"flex-1 px-4 py-3 rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,b.jsx)(ar,{className:"w-5 h-5"}),"Level Up to ",h,"!"]})]})]})})}function ay({icon:a,label:c,value:d,description:e}){return(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a,(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:c})]}),(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:d}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:e})]})}var az=a.i(39420);function aA({params:a}){let{id:p}=(0,c.use)(a),q=(0,d.useRouter)(),{user:r,loading:s}=(0,i.useAuth)(),[t,u]=(0,c.useState)(null),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,I]=(0,c.useState)(!1),[J,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(!1),{data:S=[]}=(0,k.useUserPowers)(),{data:T=[]}=(0,k.useUserTechniques)(),{data:U=[]}=(0,k.useUserItems)(),V=(0,c.useMemo)(()=>{var a,b;let c,d,e;return t?(c=U.filter(a=>"weapon"===a.type),d=U.filter(a=>"armor"===a.type),e=U.filter(a=>"equipment"===a.type),{powers:(a=t.powers,a&&0!==a.length?a.map(a=>{let b="string"==typeof a?a:a.name,c="object"==typeof a&&!!a.innate,d=m(S,a);return d?{id:d.id,name:d.name,description:d.description||"",parts:(d.parts||[]).map(a=>({id:String(a.id||""),name:a.name||"",op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),innate:c,libraryItem:d}:{id:"object"==typeof a?String(a.id||""):b,name:b,description:"Power not found in your library",innate:c,notInLibrary:!0}}):[]),techniques:(b=t.techniques,b&&0!==b.length?b.map(a=>{let b="string"==typeof a?a:a.name,c=m(T,a);return c?{id:c.id,name:c.name,description:c.description||"",parts:(c.parts||[]).map(a=>({id:String(a.id||""),name:a.name||"",op_1_lvl:a.op_1_lvl,op_2_lvl:a.op_2_lvl,op_3_lvl:a.op_3_lvl})),libraryItem:c}:{id:"object"==typeof a?String(a.id||""):b,name:b,description:"Technique not found in your library",notInLibrary:!0}}):[]),weapons:n(o(t.equipment?.weapons),c,"weapon"),armor:n(o(t.equipment?.armor),d,"armor"),equipment:n(o(t.equipment?.items),e,"equipment")}):null},[t,S,T,U]);(0,c.useEffect)(()=>{!async function(){if(r&&!s)try{x(!0);let a=(0,f.doc)(h.db,"users",r.uid,"character",p),b=await (0,f.getDoc)(a);if(!b.exists())return void z("Character not found");let c=b.data();u({id:b.id,...c})}catch(a){console.error("Error loading character:",a),z("Failed to load character")}finally{x(!1)}}()},[p,r,s]);let X=(0,c.useMemo)(()=>{let a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;return t?(a=t.abilities||{strength:0,vitality:0,agility:0,acuity:0,intelligence:0,charisma:0},b=t.defenseSkills?{...az.DEFAULT_DEFENSE_SKILLS,...t.defenseSkills}:az.DEFAULT_DEFENSE_SKILLS,d=Object.entries(c={might:(a.strength||0)+(b.might||0),fortitude:(a.vitality||0)+(b.fortitude||0),reflex:(a.agility||0)+(b.reflex||0),discernment:(a.acuity||0)+(b.discernment||0),mentalFortitude:(a.intelligence||0)+(b.mentalFortitude||0),resolve:(a.charisma||0)+(b.resolve||0)}).reduce((a,[b,c])=>(a[b]=10+c,a),{}),e=(t.speedBase??6)+Math.ceil((a.agility||0)/2),f=(t.evasionBase??10)+(a.agility||0),g=(t.equipment?.armor||[]).filter(a=>a.equipped).reduce((a,b)=>a+(b.armor||0),0),h=t.level||1,i=a.vitality||0,j=t.healthPoints||0,k=i<0?8+i+j:8+i*h+j,m=(l=t.pow_abil?.toLowerCase())&&a[l]||0,n=t.energyPoints||0,o=Math.ceil(k/4),{maxHealth:k,maxEnergy:m*h+n,terminal:o,speed:e,evasion:f,armor:g,defenseBonuses:c,defenseScores:d}):null},[t]),Y=(0,c.useMemo)(()=>{if(!t)return!1;let a=t.level||1,b=t.experience??0,c=t.abilities||{},d=Object.values(c).reduce((a,b)=>a+(b||0),0),e=c.vitality||0,f=(t.healthPoints||0)+(t.energyPoints||0),g=(t.skills||[]).reduce((a,b)=>{let c=b.skill_val||0;return b.prof&&!b.baseSkill&&(c+=1),a+c},0),h=Object.values(t.defenseSkills||{}).reduce((a,b)=>a+2*b,0),i=Math.floor(a/4)+1,j=Math.floor(a/4)+1,k=(t.archetypeFeats||[]).length,l=(t.feats||[]).length;return b>=4*a||6+a-d>0||e+a-f>0||12+4*a-g-h>0||i-k>0||j-l>0},[t]),{hasUnsavedChanges:Z,isSaving:$,lastSaved:_,saveNow:aa}=(0,j.useAutoSave)({data:t,onSave:async a=>{if(r&&a){F(!0);try{let b=(0,f.doc)(h.db,"users",r.uid,"character",p);await (0,f.updateDoc)(b,{...a,updatedAt:f.Timestamp.now()})}finally{F(!1)}}},delay:2e3,enabled:B,onSaveStart:()=>F(!0),onSaveComplete:()=>F(!1),onSaveError:a=>{console.error("Auto-save failed:",a),F(!1)}}),ac=(0,c.useCallback)(async()=>{B&&Z&&await aa(),C(!B)},[B,Z,aa]),ad=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,health:{...b.health,current:a,max:b.health?.max||0}}:null)},[t]),ae=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,energy:{...b.energy,current:a,max:b.energy?.max||0}}:null)},[t]),af=(0,c.useCallback)(async a=>{if(t&&r&&h.storage){if(!a.type.startsWith("image/"))return void z("Please select an image file");if(a.size>5242880)return void z("Image must be less than 5MB");try{R(!0),z(null);let b=a.name.split(".").pop(),c=`portraits/${r.uid}/${t.id}.${b}`,d=(0,g.ref)(h.storage,c);await (0,g.uploadBytes)(d,a,{contentType:a.type});let e=await (0,g.getDownloadURL)(d);u(a=>a?{...a,portrait:e}:null);let i=(0,f.doc)(h.db,"users",r.uid,"characters",t.id);await (0,f.updateDoc)(i,{portrait:e,updatedAt:f.Timestamp.now()})}catch(a){console.error("Portrait upload error:",a),z("Failed to upload portrait")}finally{R(!1)}}},[t,r]),ag=(0,c.useCallback)((a,b)=>{t&&u(c=>c?{...c,abilities:{...c.abilities,[a]:b}}:null)},[t]),ai=(0,c.useCallback)(()=>{t&&X&&confirm("Take a long rest? This will restore all health and energy to maximum.")&&u(a=>a?{...a,health:{current:X.maxHealth,max:X.maxHealth},energy:{current:X.maxEnergy,max:X.maxEnergy}}:null)},[t,X]),aj=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,level:a}:null)},[t]),ak=(0,c.useMemo)(()=>{if(!t)return new Set;let a=new Set;return t.powers?.forEach(b=>a.add(String(b.id||""))),t.techniques?.forEach(b=>a.add(String(b.id||""))),(t.equipment?.weapons||[]).forEach(b=>a.add(String(b.id||""))),(t.equipment?.armor||[]).forEach(b=>a.add(String(b.id||""))),(t.equipment?.items||[]).forEach(b=>a.add(String(b.id||""))),a},[t]),al=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,powers:[...b.powers||[],...a]}:null)},[t]),an=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,powers:(b.powers||[]).filter(b=>b.id!==a&&String(b.id)!==String(a))}:null)},[t]),ap=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,techniques:[...b.techniques||[],...a]}:null)},[t]),ar=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,techniques:(b.techniques||[]).filter(b=>b.id!==a&&String(b.id)!==String(a))}:null)},[t]),as=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,weapons:[...b.equipment?.weapons||[],...a]}}:null)},[t]),at=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,weapons:(b.equipment?.weapons||[]).filter(b=>b.id!==a&&String(b.id)!==String(a))}}:null)},[t]),au=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,weapons:(b.equipment?.weapons||[]).map(b=>b.id===a||String(b.id)===String(a)?{...b,equipped:!b.equipped}:b)}}:null)},[t]),av=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,armor:[...b.equipment?.armor||[],...a]}}:null)},[t]),aw=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,armor:(b.equipment?.armor||[]).filter(b=>b.id!==a&&String(b.id)!==String(a))}}:null)},[t]),ay=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,armor:(b.equipment?.armor||[]).map(b=>b.id===a||String(b.id)===String(a)?{...b,equipped:!b.equipped}:b)}}:null)},[t]),aA=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,items:[...b.equipment?.items||[],...a]}}:null)},[t]),aB=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,equipment:{...b.equipment,items:(b.equipment?.items||[]).filter(b=>b.id!==a&&String(b.id)!==String(a))}}:null)},[t]),aC=(0,c.useCallback)(a=>{t&&u(b=>b?{...b,currency:a}:null)},[t]),aD=(0,c.useCallback)((a,b)=>{if(!t)return;let c=a.map(a=>({id:a.id,name:a.name,description:a.description||a.effect||"",maxUses:a.max_uses,currentUses:a.max_uses}));"archetype"===b?u(a=>a?{...a,archetypeFeats:[...a.archetypeFeats||[],...c]}:null):u(a=>a?{...a,feats:[...a.feats||[],...c]}:null),N(null)},[t]),aE=(0,c.useCallback)(a=>{if(!t)return;let b=a.map(a=>({id:a.id,name:a.name,category:a.ability?.[0]||"other",skill_val:0,prof:!1,baseSkill:a.base_skill||void 0}));u(a=>{if(!a)return null;let c=a.skills||[];return{...a,skills:[...c,...b]}}),P(null)},[t]),aF=(0,c.useCallback)(a=>{if(J)switch(J){case"power":al(a);break;case"technique":ap(a);break;case"weapon":as(a);break;case"armor":av(a);break;case"equipment":aA(a)}},[J,al,ap,as,av,aA]);if((0,c.useEffect)(()=>{s||r||q.push("/login")},[s,r,q]),s||w)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading character..."})]})});if(y||!t)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:y||"Character not found"}),(0,b.jsx)(e.default,{href:"/characters",className:"text-primary-600 hover:text-primary-700",children:"â† Back to Characters"})]})});let aG=t.skills||[];return(0,b.jsx)(v,{children:(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-8",children:[(0,b.jsx)("div",{className:"sticky top-20 z-40 bg-white border-b border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between",children:[(0,b.jsx)(e.default,{href:"/characters",className:"text-gray-600 hover:text-gray-900 flex items-center gap-1",children:"â† Characters"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(E||$)&&(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"Saving..."}),Z&&!E&&!$&&(0,b.jsx)("span",{className:"text-sm text-amber-600",children:"Unsaved changes"}),_&&!Z&&!E&&(0,b.jsx)("span",{className:"text-sm text-green-600",children:"Saved"}),(0,b.jsx)("button",{onClick:()=>I(!0),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors",children:"â¬†ï¸ Level Up"}),(0,b.jsx)("button",{onClick:ai,className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors",children:"ðŸ˜´ Recover"}),(0,b.jsxs)("button",{onClick:ac,className:(0,l.cn)("relative px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",B?"bg-green-600 text-white hover:bg-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[B?"âœ“ Done":"ðŸ–‰ Edit",Y&&!B&&(0,b.jsx)("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse",title:"You have unspent points!"})]})]})]})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 pt-4",children:X&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A,{character:t,calculatedStats:X,isEditMode:B,onHealthChange:ad,onEnergyChange:ae,onPortraitChange:af,isUploadingPortrait:Q}),(0,b.jsx)(D,{abilities:t.abilities,archetypeAbility:t.archetype?.ability,martialAbility:t.mart_abil,powerAbility:t.pow_abil,isEditMode:B,onAbilityChange:ag}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsx)(H,{skills:aG,abilities:t.abilities,isEditMode:B,onAddSkill:()=>P("skill"),onAddSubSkill:()=>P("subskill")})}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsx)(K,{character:t,isEditMode:B,onAddArchetypeFeat:()=>N("archetype"),onAddCharacterFeat:()=>N("character")})}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsx)(W,{powers:V?.powers||t.powers||[],techniques:V?.techniques||t.techniques||[],weapons:V?.weapons||t.equipment?.weapons||[],armor:V?.armor||t.equipment?.armor||[],equipment:V?.equipment||t.equipment?.items||[],currency:t.currency,innateEnergy:t.innateEnergy,isEditMode:B,onAddPower:()=>L("power"),onRemovePower:an,onAddTechnique:()=>L("technique"),onRemoveTechnique:ar,onAddWeapon:()=>L("weapon"),onRemoveWeapon:at,onToggleEquipWeapon:au,onAddArmor:()=>L("armor"),onRemoveArmor:aw,onToggleEquipArmor:ay,onAddEquipment:()=>L("equipment"),onRemoveEquipment:aB,onCurrencyChange:aC,weight:t.weight,height:t.height,appearance:t.appearance,archetypeDesc:t.archetypeDesc,notes:t.notes,abilities:t.abilities,onWeightChange:a=>u(b=>b?{...b,weight:a}:null),onHeightChange:a=>u(b=>b?{...b,height:a}:null),onAppearanceChange:a=>u(b=>b?{...b,appearance:a}:null),onArchetypeDescChange:a=>u(b=>b?{...b,archetypeDesc:a}:null),onNotesChange:a=>u(b=>b?{...b,notes:a}:null),level:t.level,archetypeAbility:t.abilities?.[t.pow_abil]||0})})]})]})}),(0,b.jsx)(ab,{}),J&&(0,b.jsx)(ah,{isOpen:!!J,onClose:()=>L(null),itemType:J,existingIds:ak,onAdd:aF}),t&&M&&(0,b.jsx)(am,{isOpen:!!M,onClose:()=>N(null),featType:M,character:t,existingFeatIds:[...(t.archetypeFeats||[]).map(a=>a.id||a.name),...(t.feats||[]).map(a=>a.id||a.name)],onAdd:a=>aD(a,M)}),t&&"skill"===O&&(0,b.jsx)(ao,{isOpen:!0,onClose:()=>P(null),existingSkillNames:aG.map(a=>a.name),onAdd:aE}),t&&"subskill"===O&&(0,b.jsx)(aq,{isOpen:!0,onClose:()=>P(null),characterSkills:aG.map(a=>({name:a.name,prof:a.prof||!1})),existingSkillNames:aG.map(a=>a.name),onAdd:aE}),t&&(0,b.jsx)(ax,{isOpen:G,onClose:()=>I(!1),character:t,onConfirm:aj})]})})}a.s(["default",()=>aA],99705)}];

//# sourceMappingURL=src_app_%28main%29_characters_%5Bid%5D_page_tsx_976a65f6._.js.map