(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28509,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),r=e.i(22016);e.i(36180);var l=e.i(98925);e.i(61086);var i=e.i(27215),n=e.i(6245);e.i(64485);var o=e.i(48114),c=e.i(96885),d=e.i(46775);e.i(79121);var m=e.i(49838);function x(e,t){if(e&&0!==e.length){if("string"==typeof t){let s=t.toLowerCase();return e.find(e=>e.name.toLowerCase()===s||e.id===t)}if(void 0!==t.id){let s=e.find(e=>e.id===String(t.id));if(s)return s}if(t.name){let s=t.name.toLowerCase();return e.find(e=>e.name.toLowerCase()===s)}}}function p(e,t,s){return e&&0!==e.length?e.map(e=>{let a="string"==typeof e?e:e.name,r="object"==typeof e&&!!e.equipped,l=x(t,e);return l?{id:l.id,name:l.name,description:l.description||"",type:l.type||s,equipped:r,damage:l.damage,armorValue:l.armorValue,properties:l.properties||[],libraryItem:l}:{id:a,name:a,description:"Item not found in your library",type:s,equipped:r,notInLibrary:!0}}):[]}function u(e){return e?Array.isArray(e)?e.map(e=>({name:"string"==typeof e?e:e?.name||"",equipped:"object"==typeof e&&!!e?.equipped})).filter(e=>e.name):"object"==typeof e&&"name"in e&&e.name?[{name:e.name,equipped:!!e.equipped}]:[]:[]}var h=e.i(57688);let g=(0,s.createContext)(null),b=0;function y(){return`roll-${Date.now()}-${++b}`}function f(e){return Math.floor(Math.random()*parseInt(e.substring(1)))+1}let j={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20};function v({children:e,maxHistory:a=50}){let[r,l]=(0,s.useState)([]),i=(0,s.useCallback)(e=>{l(t=>[e,...t].slice(0,a))},[a]),n=(0,s.useCallback)(()=>{l([])},[]),o=(0,s.useCallback)((e,t,s)=>{let a,r=f("d20"),l=20===r,n=1===r,o=r+s;l?(o+=2,a="Natural 20! +2 to the total!"):n&&(o-=2,a="Natural 1! -2 from the total!");let c={id:y(),type:e,title:t,dice:[{type:"d20",value:r,isMax:l,isMin:n}],modifier:s,total:o,isCrit:l,isCritFail:n,critMessage:a,timestamp:new Date};return i(c),c},[i]),c=(0,s.useCallback)((e,t)=>{o("ability",e.charAt(0).toUpperCase()+e.slice(1)+" Check",t)},[o]),d=(0,s.useCallback)((e,t)=>{o("defense",`${e} Save`,t)},[o]),m=(0,s.useCallback)((e,t)=>{o("skill",e,t)},[o]),x=(0,s.useCallback)((e,t)=>{o("attack",`${e} Attack`,t)},[o]),p=(0,s.useCallback)((e,t=0)=>{let s=e.match(/(\d+)d(\d+)([+-]\d+)?(?:\s+([a-zA-Z]+))?/);if(!s)return;let[,a,r,l,n]=s,o=parseInt(a),c=parseInt(r),d=(l?parseInt(l):0)+t,m=[],x=d;for(let e=0;e<o;e++){let e=`d${c}`,t=f(e);m.push({type:e,value:t,isMax:t===c,isMin:1===t}),x+=t}let p=`Damage${n?` (${n})`:""}`;i({id:y(),type:"damage",title:p,dice:m,modifier:d,total:x,timestamp:new Date})},[i]),u=(0,s.useCallback)((e,t,s,a)=>{let r=[],l=a,n=j[t];for(let e=0;e<s;e++){let e=f(t);r.push({type:t,value:e,isMax:e===n,isMin:1===e}),l+=e}let o="d20"===t&&1===s&&r[0]?.value===20,c="d20"===t&&1===s&&r[0]?.value===1;i({id:y(),type:"custom",title:e,dice:r,modifier:a,total:l,isCrit:o,isCritFail:c,timestamp:new Date})},[i]);return(0,t.jsx)(g.Provider,{value:{rolls:r,rollAbility:c,rollDefense:d,rollSkill:m,rollAttack:x,rollDamage:p,rollCustom:u,clearHistory:n,addRoll:i},children:e})}function N(){return(0,s.useContext)(g)}function w({label:e,current:s,max:a,color:r,terminalThreshold:l,showControls:i,onChange:n}){let o=Math.max(0,Math.min(100,s/a*100)),c=l&&s<=l&&s>0;return(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm font-medium",children:[(0,t.jsx)("span",{className:"text-gray-700",children:e}),(0,t.jsxs)("span",{className:(0,m.cn)("font-bold",c&&"text-yellow-600",s<=0&&"text-red-600"),children:[s," / ",a]})]}),(0,t.jsxs)("div",{className:"relative h-6 bg-gray-200 rounded-full overflow-hidden",children:[(0,t.jsx)("div",{className:(0,m.cn)("absolute inset-y-0 left-0 transition-all duration-300","red"===r?"bg-red-500":"bg-blue-500",c&&"bg-yellow-500 animate-pulse"),style:{width:`${o}%`}}),l&&(0,t.jsx)("div",{className:"absolute inset-y-0 w-0.5 bg-yellow-600 opacity-50",style:{left:`${l/a*100}%`},title:`Terminal: ${l}`})]}),i&&n&&(0,t.jsxs)("div",{className:"flex gap-2 mt-1 items-center justify-center",children:[(0,t.jsx)("button",{onClick:()=>n(Math.max(0,s-1)),className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold",disabled:s<=0,children:"âˆ’"}),(0,t.jsx)("input",{type:"number",value:s,onChange:e=>n(Math.max(0,Math.min(a,parseInt(e.target.value)||0))),className:"w-16 text-center border rounded px-2 py-1 text-sm",min:0,max:a}),(0,t.jsx)("button",{onClick:()=>n(Math.min(a,s+1)),className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold",disabled:s>=a,children:"+"})]})]})}function k({label:e,value:s,subValue:a}){return(0,t.jsxs)("div",{className:"flex flex-col items-center p-2 bg-gray-100 rounded-lg min-w-[60px]",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:e}),(0,t.jsx)("span",{className:"text-xl font-bold text-gray-800",children:s}),a&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:a})]})}function C({name:e,bonus:s,score:a,onRoll:r}){let l=s>=0?`+${s}`:`${s}`;return(0,t.jsxs)("div",{onClick:r,className:(0,m.cn)("flex flex-col items-center p-2 bg-white border border-gray-200 rounded-lg min-w-[70px] transition-all",r&&"cursor-pointer hover:bg-teal-50 hover:border-teal-300 active:scale-95"),role:r?"button":void 0,title:r?`Click to roll ${e} save`:void 0,children:[(0,t.jsx)("span",{className:"text-[10px] text-gray-500 uppercase tracking-wide",children:e}),(0,t.jsx)("span",{className:"text-lg font-bold text-gray-800",children:a}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:l})]})}function S({character:e,calculatedStats:s,isEditMode:a=!1,onHealthChange:r,onEnergyChange:l,onPortraitChange:i,isUploadingPortrait:n=!1}){let o=e.health?.current??s.maxHealth,c=e.energy?.current??s.maxEnergy,d=N(),x=e.description?.includes("female")?"â™€":e.description?.includes("male")?"â™‚":"",p=(e.experience??0)>=4*(e.level||1);return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:(0,m.cn)("relative w-24 h-24 md:w-32 md:h-32 rounded-lg overflow-hidden bg-gray-200 flex-shrink-0",a&&i&&"cursor-pointer group"),onClick:()=>{if(!a||!i)return;let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{let t=e.target.files?.[0];t&&i(t)},e.click()},title:a&&i?"Click to change portrait":void 0,children:[(0,t.jsx)(h.default,{src:e.portrait||"/images/placeholder-portrait.png",alt:e.name,fill:!0,className:(0,m.cn)("object-cover transition-opacity",n&&"opacity-50"),sizes:"(max-width: 768px) 96px, 128px"}),a&&i&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl",children:"ðŸ“·"})}),n&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,t.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,t.jsxs)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:[e.name,x&&(0,t.jsx)("span",{className:"ml-2 text-gray-400",children:x})]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Level ",e.level," ",e.ancestry?.name||"Unknown Ancestry"]}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:e.archetype?.name||"No Archetype"}),(0,t.jsxs)("p",{className:"text-gray-500 text-sm flex items-center gap-1",children:[(0,t.jsxs)("span",{children:["XP: ",e.experience??0]}),p&&(0,t.jsx)("span",{className:"text-green-600 animate-pulse",title:"Ready to level up!",children:"â¬†"}),p&&(0,t.jsx)("span",{className:"text-xs text-green-600",children:"(Level up available!)"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-start",children:[(0,t.jsx)(k,{label:"Speed",value:s.speed}),(0,t.jsx)(k,{label:"Evasion",value:s.evasion}),(0,t.jsx)(k,{label:"Armor",value:s.armor}),void 0!==e.innateEnergy&&e.innateEnergy>0&&(0,t.jsx)(k,{label:"Innate",value:e.innateEnergy})]}),(0,t.jsxs)("div",{className:"flex-1 space-y-3 min-w-[200px]",children:[(0,t.jsx)(w,{label:"Health",current:o,max:s.maxHealth,color:"red",terminalThreshold:s.terminal,showControls:!0,onChange:r}),(0,t.jsx)(w,{label:"Energy",current:c,max:s.maxEnergy,color:"blue",showControls:!0,onChange:l})]})]}),(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Defenses"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries({might:"Might",fortitude:"Fortitude",reflex:"Reflex",discernment:"Discernment",mentalFortitude:"Mental Fort",resolve:"Resolve"}).map(([e,a])=>{let r=s.defenseBonuses[e]??0;return(0,t.jsx)(C,{name:a,bonus:r,score:s.defenseScores[e]??10,onRoll:d?()=>d.rollDefense(a,r):void 0},e)})})]})]})}let q={strength:{name:"Strength",description:"Physical power and melee attacks",defenseLink:"Might"},vitality:{name:"Vitality",description:"Health and endurance",defenseLink:"Fortitude"},agility:{name:"Agility",description:"Speed, dexterity, and finesse",defenseLink:"Reflex"},acuity:{name:"Acuity",description:"Perception and awareness",defenseLink:"Discernment"},intelligence:{name:"Intelligence",description:"Knowledge and reasoning",defenseLink:"Mental Fortitude"},charisma:{name:"Charisma",description:"Force of personality",defenseLink:"Resolve"}};function _({ability:e,value:s,info:a,isArchetypeAbility:r,isMartialAbility:l,isPowerAbility:i,isEditMode:n,onIncrease:o,onDecrease:c,onRoll:d}){let x=s>=0?`+${s}`:`${s}`,p="border-gray-200",u="";return r?(p="border-amber-400 border-2",u="bg-amber-100 text-amber-700"):i?(p="border-purple-400 border-2",u="bg-purple-100 text-purple-700"):l&&(p="border-red-400 border-2",u="bg-red-100 text-red-700"),(0,t.jsxs)("div",{onClick:()=>{!n&&d&&d()},className:(0,m.cn)("relative flex flex-col items-center p-4 bg-white rounded-xl shadow-sm border transition-all",p,n&&"hover:shadow-md",!n&&d&&"cursor-pointer hover:bg-gray-50 hover:shadow-md active:scale-95"),role:!n&&d?"button":void 0,title:!n&&d?`Click to roll ${a.name} check`:void 0,children:[(r||l||i)&&(0,t.jsx)("div",{className:(0,m.cn)("absolute -top-2 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase",u),children:r?"Archetype":i?"Power":"Martial"}),(0,t.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wider mt-1",children:a.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 my-2",children:[n&&(0,t.jsx)("button",{onClick:c,className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600",children:"âˆ’"}),(0,t.jsx)("span",{className:(0,m.cn)("text-3xl font-bold",s>0?"text-green-600":s<0?"text-red-600":"text-gray-700"),children:x}),n&&(0,t.jsx)("button",{onClick:o,className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600",children:"+"})]}),(0,t.jsxs)("span",{className:"text-[10px] text-gray-400",children:["â†’ ",a.defenseLink]})]})}function A({abilities:e,archetypeAbility:s,martialAbility:a,powerAbility:r,isEditMode:l=!1,availablePoints:i,onAbilityChange:n}){let o=N();return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Abilities"}),l&&void 0!==i&&(0,t.jsxs)("span",{className:(0,m.cn)("px-3 py-1 rounded-full text-sm font-medium",i>0?"bg-green-100 text-green-700":i<0?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"),children:[i," points"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:["strength","vitality","agility","acuity","intelligence","charisma"].map(i=>(0,t.jsx)(_,{ability:i,value:e[i]??0,info:q[i],isArchetypeAbility:s?.toLowerCase()===i,isMartialAbility:a?.toLowerCase()===i,isPowerAbility:r?.toLowerCase()===i,isEditMode:l,onIncrease:()=>n?.(i,(e[i]??0)+1),onDecrease:()=>n?.(i,(e[i]??0)-1),onRoll:o?()=>o.rollAbility(i,e[i]??0):void 0},i))})]})}var L=e.i(7233);let M=[{id:"combat",name:"Combat",icon:"âš”ï¸"},{id:"physical",name:"Physical",icon:"ðŸƒ"},{id:"knowledge",name:"Knowledge",icon:"ðŸ“š"},{id:"social",name:"Social",icon:"ðŸ’¬"},{id:"other",name:"Other",icon:"â­"}];function E({skill:e,isEditMode:s,onToggleProf:a,onValueChange:r,onRoll:l}){let i=!!e.baseSkill,n=e.skill_val+ +!!e.prof,o=n>=0?`+${n}`:`${n}`;return(0,t.jsxs)("div",{onClick:e=>{s||e.target.closest("button")||l?.()},className:(0,m.cn)("flex items-center justify-between py-2 px-3 rounded-lg transition-colors",i?"ml-4 bg-gray-50":"bg-white",s&&"hover:bg-gray-100",!s&&l&&"cursor-pointer hover:bg-blue-50 active:bg-blue-100"),role:!s&&l?"button":void 0,title:!s&&l?`Click to roll ${e.name}`:void 0,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!i&&(0,t.jsx)("button",{onClick:a,disabled:!s,className:(0,m.cn)("w-4 h-4 rounded-full border-2 transition-colors",e.prof?"bg-primary-600 border-primary-600":"bg-white border-gray-300",s&&"cursor-pointer hover:border-primary-400"),title:e.prof?"Proficient":"Not proficient"}),(0,t.jsxs)("span",{className:(0,m.cn)("text-sm",i?"text-gray-500 italic":"text-gray-700 font-medium"),children:[i&&"â”” ",e.name]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:s?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>r?.(e.skill_val-1),className:"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm",disabled:e.skill_val<=0,children:"âˆ’"}),(0,t.jsx)("span",{className:"w-8 text-center font-mono",children:e.skill_val}),(0,t.jsx)("button",{onClick:()=>r?.(e.skill_val+1),className:"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm",children:"+"})]}):(0,t.jsx)("span",{className:(0,m.cn)("font-bold min-w-[40px] text-right",n>0?"text-green-600":n<0?"text-red-600":"text-gray-600"),children:o})})]})}function P({skills:e,abilities:a,isEditMode:r=!1,onSkillChange:l,onAddSkill:i,onAddSubSkill:n}){let[o,c]=(0,s.useState)(null),d=N(),x=M.reduce((t,s)=>(t[s.id]=e.filter(e=>(e.category?.toLowerCase()||"other")===s.id),t),{}),p=e.reduce((e,t)=>e+t.skill_val+ +!!t.prof,0);return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Skills"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:i,className:"flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-100 hover:bg-emerald-200 text-emerald-700 text-sm font-medium transition-colors",title:"Add Skill",children:[(0,t.jsx)(L.Plus,{size:14}),"Skill"]}),(0,t.jsxs)("button",{onClick:n,className:"flex items-center gap-1 px-2 py-1 rounded-md bg-teal-100 hover:bg-teal-200 text-teal-700 text-sm font-medium transition-colors",title:"Add Sub-Skill",children:[(0,t.jsx)(L.Plus,{size:14}),"Sub-Skill"]}),(0,t.jsxs)("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm",children:[p," points spent"]})]})})]}),(0,t.jsx)("div",{className:"space-y-2",children:M.map(e=>{let s=x[e.id]||[];if(0===s.length)return null;let a=o===e.id||null===o;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>c(o===e.id?null:e.id),className:"w-full flex items-center justify-between px-4 py-2 bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("span",{className:"flex items-center gap-2 font-medium text-gray-700",children:[(0,t.jsx)("span",{children:e.icon}),e.name,(0,t.jsxs)("span",{className:"text-xs text-gray-400",children:["(",s.length,")"]})]}),(0,t.jsx)("span",{className:(0,m.cn)("transition-transform",a?"rotate-180":""),children:"â–¼"})]}),a&&(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:s.map(e=>{let s=e.skill_val+ +!!e.prof;return(0,t.jsx)(E,{skill:e,isEditMode:r,onToggleProf:()=>l?.(e.id,{prof:!e.prof}),onValueChange:t=>l?.(e.id,{skill_val:t}),onRoll:d?()=>d.rollSkill(e.name,s):void 0},e.id)})})]},e.id)})})]})}function $({label:e,value:s,maxValue:a=6,color:r="blue"}){let l={blue:"bg-blue-500",purple:"bg-purple-500",red:"bg-red-500"};return(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:e}),(0,t.jsx)("span",{className:"font-bold",children:s})]}),(0,t.jsx)("div",{className:"flex gap-1",children:Array.from({length:a}).map((e,a)=>(0,t.jsx)("div",{className:(0,m.cn)("h-2 flex-1 rounded-full",a<s?l[r]:"bg-gray-200")},a))})]})}function I({feat:e,isEditMode:a,onUse:r}){let[l,i]=(0,s.useState)(!1),n=e.maxUses&&(e.currentUses??e.maxUses)>0;return(0,t.jsxs)("div",{className:(0,m.cn)("border border-gray-200 rounded-lg overflow-hidden transition-all",l&&"shadow-md"),children:[(0,t.jsxs)("button",{onClick:()=>i(!l),className:"w-full flex items-center justify-between px-3 py-2 bg-white hover:bg-gray-50 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),e.type&&(0,t.jsx)("span",{className:(0,m.cn)("text-xs px-1.5 py-0.5 rounded","archetype"===e.type?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"),children:e.type})]}),e.maxUses&&(0,t.jsxs)("span",{className:(0,m.cn)("text-sm font-medium",n?"text-green-600":"text-gray-400"),children:[e.currentUses??e.maxUses,"/",e.maxUses]})]}),l&&(0,t.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description||"No description available."}),e.maxUses&&a&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),r?.()},disabled:!n,className:(0,m.cn)("px-3 py-1 rounded text-sm font-medium transition-colors",n?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"Use Ability"})]})]})}function T({character:e,isEditMode:s=!1,onFeatUse:a,onAddArchetypeFeat:r,onAddCharacterFeat:l}){let i=e.martialProficiency??0,n=e.powerProficiency??0,o=[...(e.archetypeFeats||[]).map(e=>({...e,type:"archetype"})),...(e.feats||[]).map(e=>({...e,type:"character"}))];return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:e.archetype?.name||"No Archetype"}),e.archetype?.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.archetype.description})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,t.jsx)($,{label:"Martial",value:i,color:"red"}),(0,t.jsx)($,{label:"Power",value:n,color:"purple"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.mart_abil&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-sm",children:["Martial: ",e.mart_abil]}),e.pow_abil&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm",children:["Power: ",e.pow_abil]})]}),(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide",children:["Feats (",o.length,")"]}),s&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:r,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded hover:bg-amber-200 transition-colors",children:[(0,t.jsx)(L.Plus,{className:"w-3 h-3"}),"Archetype"]}),(0,t.jsxs)("button",{onClick:l,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[(0,t.jsx)(L.Plus,{className:"w-3 h-3"}),"Character"]})]})]}),o.length>0?(0,t.jsx)("div",{className:"space-y-2",children:o.map((e,r)=>(0,t.jsx)(I,{feat:e,isEditMode:s,onUse:()=>a?.(String(e.id),(e.currentUses??e.maxUses??1)-1)},e.id||r))}):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic",children:"No feats selected"})]})]})}var R=e.i(37727),F=e.i(64659),D=e.i(55900);function U({weight:e=70,height:a=170,appearance:r="",archetypeDesc:l="",notes:i="",abilities:n,isEditMode:o=!1,onWeightChange:c,onHeightChange:d,onAppearanceChange:m,onArchetypeDescChange:x,onNotesChange:p}){let u=N(),[h,g]=(0,s.useState)(e.toString()),[b,y]=(0,s.useState)(a.toString()),f=n.strength||0,j=n.agility||0,v=n.vitality||0,w=(e,t,s)=>1===e?`${e} ${t}`:`${e} ${s}`,k=e=>Math.max(1,Math.ceil(e)),C=k(Math.max(f,j)),S=k(Math.max(f,j)/2),q=k(f/2),_=k(Math.max(f,v)/2),A=Math.max(200,200*Math.ceil(e/200)),L=Math.min(Math.ceil(e/200)||1,4),M=`${L}d4`,E=(0,s.useCallback)(()=>{u&&u.rollDamage(M)},[u,M]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Physical Attributes & Movement"}),(0,t.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Weight"}),o&&c?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("input",{type:"number",value:h,onChange:e=>g(e.target.value),onBlur:()=>{let t=parseInt(h)||70;t!==e&&c&&c(t)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"kg"})]}):(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[e," kg"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Height"}),o&&d?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("input",{type:"number",value:b,onChange:e=>y(e.target.value),onBlur:()=>{let e=parseInt(b)||170;e!==a&&d&&d(e)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"cm"})]}):(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[a," cm"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Jump - Horizontal"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:w(C,"space","spaces")})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Jump - Vertical"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:w(S,"space","spaces")})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Climb Speed"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:w(q,"space","spaces")}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"Requires successful Athletics roll"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Swim Speed"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:w(_,"space","spaces")}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"DC 10 Acrobatics or Athletics (Vitality)"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 col-span-2 md:col-span-3",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Fall Damage"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:E,disabled:!u,className:"px-2 py-1 text-sm font-bold bg-gradient-to-b from-gray-50 to-indigo-50 border border-indigo-200 rounded-lg hover:shadow-sm transition-all disabled:opacity-50",title:u?"Click to roll":"Roll log not available",children:M}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["bludgeoning per 2 spaces fallen (",A,"kg weight category)"]})]})]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Appearance"}),(0,t.jsx)("textarea",{value:r,onChange:e=>m?.(e.target.value),readOnly:!o,placeholder:"Describe your character's appearance...",className:"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!o})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Archetype Description"}),(0,t.jsx)("textarea",{value:l,onChange:e=>x?.(e.target.value),readOnly:!o,placeholder:"Describe your character's archetype background...",className:"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!o})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:i,onChange:e=>p?.(e.target.value),readOnly:!o,placeholder:"Additional notes, backstory, goals...",className:"w-full min-h-[120px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50",disabled:!o})]})]})}function O(e){return Math.floor((e.baseTP||0)+(e.op1TP||0)*(e.op1Lvl||0)+(e.op2TP||0)*(e.op2Lvl||0)+(e.op3TP||0)*(e.op3Lvl||0))}function V(e,t){let s=new Map;return[...e,...t].forEach(e=>{e.properties&&e.properties.forEach(e=>{let t="string"==typeof e?e:e.name;t&&(s.has(t)||s.set(t,{name:t,baseTP:0,op1Lvl:0,op1TP:0}))})}),s}function z({title:e,profs:a}){let r=(0,s.useMemo)(()=>{let e=0;return a.forEach(t=>{e+=O(t)}),e},[a]);return(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-100 rounded-t-lg border border-gray-200",children:[(0,t.jsx)("span",{className:"font-semibold text-sm text-gray-700",children:e}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["TP: ",(0,t.jsx)("span",{className:"font-semibold text-primary-600",children:r})]})]}),(0,t.jsx)("div",{className:"border border-t-0 border-gray-200 rounded-b-lg p-3",children:0===a.size?(0,t.jsx)("p",{className:"text-sm text-gray-400 italic text-center py-2",children:"No proficiencies"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:Array.from(a.values()).map((e,s)=>{let a=O(e),r=e.name;return e.damageType&&(r+=` (${e.damageType})`),e.op1Lvl>0&&(r+=` Lvl ${e.op1Lvl}`),(0,t.jsxs)("div",{className:"px-2 py-1 text-xs bg-primary-50 text-primary-700 border border-primary-200 rounded-full",title:e.description||`${r} - TP: ${a}`,children:[r," | ",a," TP"]},s)})})})]})}function H({powers:e,techniques:a,weapons:r,armor:l,level:i,archetypeAbility:n}){let o=(0,s.useMemo)(()=>{let t;return t=new Map,e.forEach(e=>{e.parts&&e.parts.forEach(e=>{if("string"==typeof e){t.has(e)||t.set(e,{name:e,baseTP:0,op1Lvl:0,op1TP:0});return}if(!e.name)return;let s=e.op_1_lvl||0,a=e.op_2_lvl||0,r=e.op_3_lvl||0,l=e.base_tp||0,i=e.op_1_tp||0,n=e.op_2_tp||0,o=e.op_3_tp||0;if(0>=Math.floor(l+i*s+n*a+o*r))return;let c=e.name;if(t.has(c)){let e=t.get(c);e.op1Lvl=Math.max(e.op1Lvl,s),e.op2Lvl=Math.max(e.op2Lvl||0,a),e.op3Lvl=Math.max(e.op3Lvl||0,r)}else t.set(c,{name:e.name,baseTP:l,op1Lvl:s,op1TP:i,op2Lvl:a,op2TP:n,op3Lvl:r,op3TP:o})})}),t},[e]),c=(0,s.useMemo)(()=>{let e;return e=new Map,a.forEach(t=>{t.parts&&t.parts.forEach(t=>{if("string"==typeof t){e.has(t)||e.set(t,{name:t,baseTP:0,op1Lvl:0,op1TP:0});return}if(!t.name)return;let s=t.op_1_lvl||0,a=t.op_2_lvl||0,r=t.op_3_lvl||0,l=t.base_tp||0,i=t.op_1_tp||0,n=t.op_2_tp||0,o=t.op_3_tp||0;if(0>=Math.floor(l+i*s+n*a+o*r))return;let c=t.name;if(e.has(c)){let t=e.get(c);t.op1Lvl=Math.max(t.op1Lvl,s),t.op2Lvl=Math.max(t.op2Lvl||0,a),t.op3Lvl=Math.max(t.op3Lvl||0,r)}else e.set(c,{name:t.name,baseTP:l,op1Lvl:s,op1TP:i,op2Lvl:a,op2TP:n,op3Lvl:r,op3TP:o})})}),e},[a]),d=(0,s.useMemo)(()=>V(r,[]),[r]),m=(0,s.useMemo)(()=>V([],l),[l]),x=(0,s.useMemo)(()=>{let e=0;return[o,c,d,m].forEach(t=>{t.forEach(t=>{e+=O(t)})}),e},[o,c,d,m]),p=22+n*i+2*(i-1)-x;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex justify-center mb-6",children:(0,t.jsxs)("div",{className:"px-8 py-4 bg-gray-50 border border-gray-200 rounded-xl shadow-sm",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"text-lg font-semibold text-gray-600",children:"Training Points: "}),(0,t.jsx)("span",{className:`text-2xl font-bold ${p>=0?"text-primary-600":"text-red-600"}`,children:p})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 text-center mt-1",children:[22," base + (",n," Ã— ",i,") + ",2*(i-1)," bonus - ",x," spent"]})]})}),(0,t.jsx)(z,{title:"Power Proficiencies",profs:o}),(0,t.jsx)(z,{title:"Technique Proficiencies",profs:c}),(0,t.jsx)(z,{title:"Weapon Proficiencies",profs:d}),(0,t.jsx)(z,{title:"Armor Proficiencies",profs:m})]})}function B({power:e,innateEnergy:a,isEditMode:r,onRemove:l}){let[i,n]=(0,s.useState)(!1),o=void 0!==e.cost&&void 0!==a&&e.cost<=a;return(0,t.jsxs)("div",{className:(0,m.cn)("border rounded-lg overflow-hidden",o?"border-purple-300 bg-purple-50":"border-gray-200 bg-white"),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("button",{onClick:()=>n(!i),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,t.jsx)(D.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,t.jsx)(F.ChevronDown,{className:"w-4 h-4 text-gray-400"}),(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),o&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-purple-200 text-purple-700",children:"Innate"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[void 0!==e.cost&&(0,t.jsxs)("span",{className:"text-blue-600 font-medium",children:[e.cost," EP"]}),e.level&&(0,t.jsxs)("span",{children:["Lvl ",e.level]})]})]}),r&&l&&(0,t.jsx)("button",{onClick:l,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove power",children:(0,t.jsx)(R.X,{className:"w-4 h-4"})})]}),i&&e.description&&(0,t.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description})})]})}function X({technique:e,isEditMode:a,onRemove:r}){let[l,i]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("button",{onClick:()=>i(!l),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[l?(0,t.jsx)(D.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,t.jsx)(F.ChevronDown,{className:"w-4 h-4 text-gray-400"}),(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name})]}),void 0!==e.cost&&(0,t.jsxs)("span",{className:"text-sm text-red-600 font-medium",children:[e.cost," SP"]})]}),a&&r&&(0,t.jsx)("button",{onClick:r,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove technique",children:(0,t.jsx)(R.X,{className:"w-4 h-4"})})]}),l&&e.description&&(0,t.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description})})]})}function W({item:e,type:a,isEditMode:r,onRemove:l,onToggleEquip:i,onRollAttack:n,onRollDamage:o}){let[c,d]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:(0,m.cn)("border rounded-lg overflow-hidden",e.equipped?"border-green-300 bg-green-50":"border-gray-200 bg-white"),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[r&&i&&("weapon"===a||"armor"===a)&&(0,t.jsx)("button",{onClick:i,className:(0,m.cn)("px-2 py-2 transition-colors",e.equipped?"text-green-600 bg-green-100 hover:bg-green-200":"text-gray-400 hover:bg-gray-100"),title:e.equipped?"Unequip":"Equip",children:e.equipped?"âœ“":"â—‹"}),(0,t.jsxs)("button",{onClick:()=>d(!c),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!r&&e.equipped&&(0,t.jsx)("span",{className:"text-green-600",children:"âœ“"}),(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),e.quantity&&e.quantity>1&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Ã—",e.quantity]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:["weapon"===a&&e.damage&&(0,t.jsx)("span",{className:"text-red-600 font-medium",children:e.damage}),"armor"===a&&e.armor&&(0,t.jsxs)("span",{className:"text-blue-600 font-medium",children:["+",e.armor," AR"]})]})]}),"weapon"===a&&!r&&(0,t.jsxs)("div",{className:"flex items-center gap-1 pr-2",children:[n&&(0,t.jsx)("button",{onClick:n,className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"Roll attack",children:"âš”ï¸ Atk"}),o&&e.damage&&(0,t.jsx)("button",{onClick:o,className:"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded hover:bg-orange-200 transition-colors",title:"Roll damage",children:"ðŸ’¥ Dmg"})]}),r&&l&&(0,t.jsx)("button",{onClick:l,className:"p-2 text-red-500 hover:bg-red-50 transition-colors",title:"Remove item",children:(0,t.jsx)(R.X,{className:"w-4 h-4"})})]}),c&&(0,t.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.description}),e.properties&&e.properties.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.properties.map((e,s)=>(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-gray-200 rounded",children:"string"==typeof e?e:e.name},s))})]})]})}function K({powers:e,techniques:a,weapons:r,armor:l,equipment:i,currency:n=0,innateEnergy:o=0,isEditMode:c=!1,onAddPower:d,onRemovePower:x,onAddTechnique:p,onRemoveTechnique:u,onAddWeapon:h,onRemoveWeapon:g,onToggleEquipWeapon:b,onAddArmor:y,onRemoveArmor:f,onToggleEquipArmor:j,onAddEquipment:v,onRemoveEquipment:w,onCurrencyChange:k,weight:C=70,height:S=170,appearance:q="",archetypeDesc:_="",notes:A="",abilities:M,onWeightChange:E,onHeightChange:P,onAppearanceChange:$,onArchetypeDescChange:I,onNotesChange:T,level:R=1,archetypeAbility:F=0}){let[D,O]=(0,s.useState)("powers"),[V,z]=(0,s.useState)(n.toString()),K=N(),Y=[{id:"powers",label:"Powers",count:e.length,onAdd:d},{id:"techniques",label:"Techniques",count:a.length,onAdd:p},{id:"weapons",label:"Weapons",count:r.length,onAdd:h},{id:"armor",label:"Armor",count:l.length,onAdd:y},{id:"equipment",label:"Equipment",count:i.length,onAdd:v},{id:"proficiencies",label:"Proficiencies"},{id:"notes",label:"Notes"}],J=Y.find(e=>e.id===D);return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mb-4 border-b border-gray-200 pb-2",children:Y.map(e=>(0,t.jsxs)("button",{onClick:()=>O(e.id),className:(0,m.cn)("px-3 py-1.5 rounded-t-lg text-sm font-medium transition-colors",D===e.id?"bg-primary-100 text-primary-700 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[e.label,void 0!==e.count&&(0,t.jsxs)("span",{className:"ml-1 text-xs opacity-70",children:["(",e.count,")"]})]},e.id))}),["powers","techniques","weapons","armor","equipment"].includes(D)&&(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"ðŸ’°"}),c&&k?(0,t.jsx)("input",{type:"number",value:V,onChange:e=>z(e.target.value),onBlur:()=>{let e=parseInt(V)||0;e!==n&&k&&k(e)},className:"w-24 px-2 py-1 text-sm font-bold text-amber-600 border border-amber-300 rounded focus:ring-2 focus:ring-amber-500"}):(0,t.jsx)("span",{className:"font-bold text-amber-600",children:n.toLocaleString()}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"gold"})]}),c&&J?.onAdd&&(0,t.jsxs)("button",{onClick:J.onAdd,className:"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded-lg transition-colors",children:[(0,t.jsx)(L.Plus,{className:"w-4 h-4"}),"Add"]})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:["powers"===D&&(e.length>0?e.map((e,s)=>(0,t.jsx)(B,{power:e,innateEnergy:o,isEditMode:c,onRemove:x?()=>x(e.id||String(s)):void 0},e.id||s)):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No powers learned"})),"techniques"===D&&(a.length>0?a.map((e,s)=>(0,t.jsx)(X,{technique:e,isEditMode:c,onRemove:u?()=>u(e.id||String(s)):void 0},e.id||s)):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No techniques learned"})),"weapons"===D&&(r.length>0?r.map((e,s)=>{let a=e.attackBonus??0;return(0,t.jsx)(W,{item:e,type:"weapon",isEditMode:c,onRemove:g?()=>g(e.id||String(s)):void 0,onToggleEquip:b?()=>b(e.id||String(s)):void 0,onRollAttack:K?()=>K.rollAttack(e.name,a):void 0,onRollDamage:K&&e.damage?()=>K.rollDamage(e.damage):void 0},e.id||s)}):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No weapons equipped"})),"armor"===D&&(l.length>0?l.map((e,s)=>(0,t.jsx)(W,{item:e,type:"armor",isEditMode:c,onRemove:f?()=>f(e.id||String(s)):void 0,onToggleEquip:j?()=>j(e.id||String(s)):void 0},e.id||s)):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No armor equipped"})),"equipment"===D&&(i.length>0?i.map((e,s)=>(0,t.jsx)(W,{item:e,type:"equipment",isEditMode:c,onRemove:w?()=>w(e.id||String(s)):void 0},e.id||s)):(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"No equipment in inventory"})),"proficiencies"===D&&(0,t.jsx)(H,{powers:e,techniques:a,weapons:r,armor:l,level:R,archetypeAbility:F}),"notes"===D&&M&&(0,t.jsx)(U,{weight:C,height:S,appearance:q,archetypeDesc:_,notes:A,abilities:M,isEditMode:c,onWeightChange:E,onHeightChange:P,onAppearanceChange:$,onArchetypeDescChange:I,onNotesChange:T}),"notes"===D&&!M&&(0,t.jsx)("p",{className:"text-gray-400 text-sm italic text-center py-4",children:"Character abilities not loaded"})]})]})}var Y=e.i(75254);let J=(0,Y.default)("dices",[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]]),Z=(0,Y.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),G={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20},Q={attack:"border-l-red-500",damage:"border-l-orange-500",skill:"border-l-blue-500",ability:"border-l-purple-500",defense:"border-l-teal-500",custom:"border-l-gray-400"},ee={attack:"âš”ï¸",damage:"ðŸ’¥",skill:"ðŸŽ¯",ability:"ðŸ’ª",defense:"ðŸ›¡ï¸",custom:"ðŸŽ²"};function et({className:e}){let a,{rolls:r,addRoll:l,clearHistory:i}=function(){let e=(0,s.useContext)(g);if(!e)throw Error("useRolls must be used within a RollProvider");return e}(),[n,o]=s.useState(!1),[c,d]=s.useState({d4:0,d6:0,d8:0,d10:0,d12:0,d20:0}),[x,p]=s.useState(0),[u,h]=s.useState("custom"),[b,y]=s.useState(""),f=()=>{d({d4:0,d6:0,d8:0,d10:0,d12:0,d20:0}),p(0)},j=Object.values(c).reduce((e,t)=>e+t,0);return(0,t.jsxs)("div",{className:(0,m.cn)("fixed bottom-5 right-5 z-[1000] flex flex-col items-end",e),children:[(0,t.jsxs)("div",{className:(0,m.cn)("absolute bottom-[70px] right-0 w-[360px] max-w-[calc(100vw-40px)]","bg-white rounded-xl shadow-2xl overflow-hidden","flex flex-col transition-all duration-300",n?"h-[70vh] max-h-[600px] opacity-100":"h-0 opacity-0 pointer-events-none"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-primary-dark to-[#053357] text-white",children:[(0,t.jsx)("h3",{className:"font-bold text-base tracking-wide",children:"ðŸŽ² Roll Log"}),(0,t.jsx)("button",{onClick:i,className:"px-3 py-1.5 rounded-md bg-white/15 border border-white/30 text-white text-xs font-semibold hover:bg-white/25 transition-colors",children:"Clear All"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-2 bg-gray-50",children:0===r.length?(0,t.jsx)("p",{className:"text-center text-gray-500 italic py-10",children:"No rolls yet. Build your dice pool below!"}):r.map(e=>(0,t.jsx)(es,{roll:e},e.id))}),(0,t.jsxs)("div",{className:"p-3 bg-gradient-to-r from-primary-dark to-[#053357] border-t-2 border-gray-300",children:[(0,t.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,t.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white text-sm",children:[(0,t.jsx)("option",{value:"custom",className:"text-gray-900",children:"Custom"}),(0,t.jsx)("option",{value:"attack",className:"text-gray-900",children:"Attack"}),(0,t.jsx)("option",{value:"damage",className:"text-gray-900",children:"Damage"}),(0,t.jsx)("option",{value:"skill",className:"text-gray-900",children:"Skill"}),(0,t.jsx)("option",{value:"ability",className:"text-gray-900",children:"Ability"}),(0,t.jsx)("option",{value:"defense",className:"text-gray-900",children:"Defense"})]}),(0,t.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"Roll name...",className:"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white placeholder-white/50 text-sm"})]}),(0,t.jsx)("div",{className:"grid grid-cols-6 gap-1 mb-3",children:["d4","d6","d8","d10","d12","d20"].map(e=>(0,t.jsxs)("button",{onClick:()=>{d(t=>({...t,[e]:Math.min(t[e]+1,20)}))},onContextMenu:t=>{t.preventDefault(),d(t=>({...t,[e]:Math.max(t[e]-1,0)}))},className:(0,m.cn)("flex flex-col items-center justify-center py-2 px-1 rounded","bg-white/10 hover:bg-white/20 transition-colors text-white",c[e]>0&&"ring-2 ring-yellow-400"),children:[(0,t.jsx)("span",{className:"text-xs font-bold",children:e}),c[e]>0&&(0,t.jsx)("span",{className:"text-yellow-400 text-sm font-bold",children:c[e]})]},e))}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>p(e=>e-1),className:"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center",children:(0,t.jsx)(Z,{className:"w-4 h-4"})}),(0,t.jsxs)("span",{className:"text-white font-bold min-w-[40px] text-center",children:[x>=0?"+":"",x]}),(0,t.jsx)("button",{onClick:()=>p(e=>e+1),className:"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center",children:(0,t.jsx)(L.Plus,{className:"w-4 h-4"})})]}),(0,t.jsx)("span",{className:"text-white/70 text-xs flex-1 text-center",children:(a=[],Object.entries(c).forEach(([e,t])=>{t>0&&a.push(`${t}${e}`)}),0!==x&&a.push(x>0?`+${x}`:`${x}`),a.join(" + ")||"No dice selected")}),(0,t.jsx)("button",{onClick:f,className:"text-white/70 hover:text-white text-xs",children:"Clear"})]}),(0,t.jsxs)("button",{onClick:()=>{let e=[],t=0,s=!1,a=0;if(Object.entries(c).forEach(([r,l])=>{for(let i=0;i<l;i++){let l=Math.floor(Math.random()*G[r])+1,i=G[r];e.push({type:r,value:l,isMax:l===i,isMin:1===l}),t+=l,"d20"===r&&(s=!0,a=l)}}),0===e.length)return;t+=x;let r=s&&20===a,i=s&&1===a;l({id:`roll-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:u,title:b||`${u.charAt(0).toUpperCase()+u.slice(1)} Roll`,dice:e,modifier:x,total:t,isCrit:r,isCritFail:i,timestamp:new Date}),f(),y("")},disabled:0===j,className:(0,m.cn)("w-full py-2.5 rounded-lg font-bold text-white transition-all","bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700","disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed"),children:["ðŸŽ² Roll ",j>0?`(${j} dice)`:""]})]})]}),(0,t.jsx)("button",{onClick:()=>o(!n),className:(0,m.cn)("w-14 h-14 rounded-full shadow-lg transition-all duration-300","flex items-center justify-center","bg-gradient-to-br from-primary-light to-primary-dark hover:scale-110",n&&"from-primary-dark to-[#021a2e]"),"aria-label":n?"Close roll log":"Open roll log",children:(0,t.jsx)(J,{className:"w-7 h-7 text-white"})})]})}function es({roll:e}){return(0,t.jsxs)("div",{className:(0,m.cn)("bg-white rounded-lg mb-2 p-3 shadow-sm border-l-4 animate-slide-in-right",Q[e.type],e.isCrit&&"ring-2 ring-green-400",e.isCritFail&&"ring-2 ring-red-400"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm",children:ee[e.type]}),(0,t.jsx)("span",{className:"font-semibold text-sm text-primary-dark",children:e.title})]}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[e.dice.map((e,s)=>(0,t.jsx)("span",{className:(0,m.cn)("inline-flex items-center justify-center min-w-[28px] h-7 px-1.5 rounded text-sm font-bold","d20"===e.type?(0,m.cn)("w-9 h-9 text-base border-2",e.isMax&&"bg-green-100 border-green-500 text-green-800",e.isMin&&"bg-red-100 border-red-500 text-red-800",!e.isMax&&!e.isMin&&"bg-gray-100 border-gray-300 text-gray-800"):(0,m.cn)("bg-amber-100 border border-amber-400 text-amber-800")),children:e.value},s)),0!==e.modifier&&(0,t.jsxs)("span",{className:"text-gray-500 font-semibold",children:[e.modifier>0?"+":"",e.modifier]}),(0,t.jsx)("span",{className:"text-gray-400",children:"="}),(0,t.jsx)("span",{className:(0,m.cn)("font-bold text-lg px-3 py-0.5 rounded border",e.isCrit&&"bg-green-100 border-green-400 text-green-800",e.isCritFail&&"bg-red-100 border-red-400 text-red-800",!e.isCrit&&!e.isCritFail&&"bg-blue-50 border-blue-200 text-primary-dark"),children:e.total})]}),e.isCrit&&(0,t.jsx)("div",{className:"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-green-500 to-teal-500 text-white animate-pulse-dot",children:"Critical Success!"}),e.isCritFail&&(0,t.jsx)("div",{className:"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-red-500 to-red-600 text-white animate-pulse-dot",children:"Critical Fail!"})]})}var ea=e.i(55436),er=e.i(43531),el=e.i(31278);e.i(16787);var ei=e.i(389);function en({isOpen:e,onClose:a,itemType:r,existingIds:l,onAdd:i}){let[n,o]=(0,s.useState)(""),[c,m]=(0,s.useState)(new Set),{data:x=[],isLoading:p}=(0,d.useUserPowers)(),{data:u=[],isLoading:h}=(0,d.useUserTechniques)(),{data:g=[],isLoading:b}=(0,d.useUserItems)();(0,s.useEffect)(()=>{e&&(m(new Set),o(""))},[e]);let{items:y,isLoading:f}=(0,s.useMemo)(()=>{switch(r){case"power":return{items:x,isLoading:p};case"technique":return{items:u,isLoading:h};case"weapon":return{items:g.filter(e=>"weapon"===e.type),isLoading:b};case"armor":return{items:g.filter(e=>"armor"===e.type),isLoading:b};case"equipment":return{items:g.filter(e=>"equipment"===e.type),isLoading:b};default:return{items:[],isLoading:!1}}},[r,x,u,g,p,h,b]),j=(0,s.useMemo)(()=>y.filter(e=>{if(l.has(e.id))return!1;if(n){let t=n.toLowerCase();return e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)}return!0}),[y,l,n]);return(0,t.jsx)(ei.Modal,{isOpen:e,onClose:a,title:(()=>{switch(r){case"power":return"Add Power from Library";case"technique":return"Add Technique from Library";case"weapon":return"Add Weapon from Library";case"armor":return"Add Armor from Library";case"equipment":return"Add Equipment from Library";default:return"Add Item"}})(),children:(0,t.jsxs)("div",{className:"flex flex-col h-[60vh]",children:[(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)(ea.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),placeholder:`Search your ${r}s...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto border border-gray-200 rounded-lg",children:f?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(el.Loader2,{className:"w-8 h-8 animate-spin text-primary-600"})}):0===j.length?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:0===y.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"text-lg font-medium",children:["No ",r,"s in your library"]}),(0,t.jsxs)("p",{className:"text-sm mt-1",children:["Create some in the ","power"===r?"Power":"technique"===r?"Technique":"Item"," Creator first!"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"text-lg font-medium",children:["All ",r,"s already added"]}),(0,t.jsxs)("p",{className:"text-sm mt-1",children:['or no matches for "',n,'"']})]})}):(0,t.jsx)("ul",{className:"divide-y divide-gray-100",children:j.map(e=>{var s,a;return(0,t.jsxs)("li",{onClick:()=>{var t;return t=e.id,void m(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:`
                    flex items-center gap-3 px-4 py-3 cursor-pointer transition-colors
                    ${c.has(e.id)?"bg-primary-50 border-l-4 border-primary-500":"hover:bg-gray-50 border-l-4 border-transparent"}
                  `,children:[(0,t.jsx)("div",{className:`
                    w-5 h-5 rounded border-2 flex items-center justify-center transition-colors
                    ${c.has(e.id)?"bg-primary-600 border-primary-600":"border-gray-300"}
                  `,children:c.has(e.id)&&(0,t.jsx)(er.Check,{className:"w-3 h-3 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.description})]}),(s=e,"power"===(a=r)||"technique"===a?null:"weapon"===a?s.damage?(0,t.jsx)("span",{className:"text-sm text-red-600 font-medium",children:s.damage}):null:"armor"===a&&s.armorValue?(0,t.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["+",s.armorValue," AR"]}):null)]},e.id)})})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 mt-4",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[c.size," selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{let e=y.filter(e=>c.has(e.id));"power"===r?i(e.map(e=>({id:e.id,name:e.name,description:e.description||"",parts:(e.parts||[]).map(e=>({id:String(e.id||""),name:e.name||"",op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl})),cost:0,level:1}))):"technique"===r?i(e.map(e=>({id:e.id,name:e.name,description:e.description||"",parts:(e.parts||[]).map(e=>({id:String(e.id||""),name:e.name||"",op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl})),cost:0}))):i(e.map(e=>({id:e.id,name:e.name,description:e.description||"",properties:e.properties||[],damage:e.damage||"",armor:e.armorValue||0,equipped:!1,quantity:1}))),a()},disabled:0===c.size,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,t.jsx)(L.Plus,{className:"w-4 h-4"}),"Add Selected"]})]})]})]})})}e.i(1465);var eo=e.i(34991);let ec={I:1,II:2,III:3,IV:4,V:5,VI:6,VII:7,VIII:8,IX:9,X:10};function ed(e){if(!e)return{baseName:e,level:1,hasLevel:!1};let t=e.match(/^(.+?)\s+(I{1,3}|IV|VI{0,3}|IX|X)$/i);return t?{baseName:t[1].trim(),level:ec[t[2].toUpperCase()]||1,hasLevel:!0}:{baseName:e,level:1,hasLevel:!1}}function em({feat:e,isSelected:a,onToggle:r,meetsRequirements:l,requirementWarning:i}){let[n,o]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:(0,m.cn)("border rounded-lg overflow-hidden transition-all",a?"border-primary-500 bg-primary-50":"border-gray-200",!l&&"opacity-50"),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("button",{onClick:r,disabled:!l,className:(0,m.cn)("w-8 h-8 flex items-center justify-center border-r",a?"bg-primary-500 text-white":"bg-gray-50 text-gray-400",!l&&"cursor-not-allowed"),children:a?"âœ“":"+"}),(0,t.jsxs)("button",{onClick:()=>o(!n),className:"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),e.category&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 text-gray-600",children:e.category})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.lvl_req&&e.lvl_req>1&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Lvl ",e.lvl_req,"+"]}),n?(0,t.jsx)(D.ChevronUp,{className:"w-4 h-4 text-gray-400"}):(0,t.jsx)(F.ChevronDown,{className:"w-4 h-4 text-gray-400"})]})]})]}),n&&(0,t.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-100",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description||e.effect||"No description available."}),i&&(0,t.jsxs)("p",{className:"text-xs text-amber-600 mt-2",children:["âš ï¸ ",i]})]})]})}function ex({isOpen:e,onClose:a,featType:r,character:l,existingFeatIds:i,onAdd:o}){let[c,d]=(0,s.useState)([]),[x,p]=(0,s.useState)(!0),[u,h]=(0,s.useState)(null),[g,b]=(0,s.useState)(""),[y,f]=(0,s.useState)(""),[j,v]=(0,s.useState)([]);(0,s.useEffect)(()=>{e&&(async()=>{p(!0),h(null);try{let e=await (0,eo.get)((0,eo.ref)(n.rtdb,"feats"));if(e.exists()){let t=e.val(),s=Object.entries(t).map(([e,t])=>({id:e,...t}));d(s)}}catch(e){h(`Failed to load feats: ${e instanceof Error?e.message:"Unknown error"}`)}finally{p(!1)}})()},[e]),(0,s.useEffect)(()=>{e&&(v([]),b(""),f(""))},[e]);let N=(0,s.useMemo)(()=>{let e=new Set;return c.forEach(t=>{t.category&&e.add(t.category)}),Array.from(e).sort()},[c]),w=(0,s.useMemo)(()=>c.filter(e=>{if("character"===r&&!e.char_feat||"archetype"===r&&e.char_feat||i.includes(e.id)||i.includes(e.name))return!1;if(g){let t=g.toLowerCase();if(!e.name.toLowerCase().includes(t)&&!e.description?.toLowerCase().includes(t))return!1}return!y||e.category===y}).sort((e,t)=>e.name.localeCompare(t.name)),[c,r,i,g,y]);return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-gray-900",children:["Add ","archetype"===r?"Archetype":"Character"," Feat"]}),(0,t.jsx)("button",{onClick:a,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,t.jsx)(R.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 space-y-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ea.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:g,onChange:e=>b(e.target.value),placeholder:"Search feats...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>f(""),className:(0,m.cn)("px-3 py-1 rounded-full text-sm transition-colors",y?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-primary-600 text-white"),children:"All"}),N.map(e=>(0,t.jsx)("button",{onClick:()=>f(e),className:(0,m.cn)("px-3 py-1 rounded-full text-sm transition-colors",y===e?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e},e))]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[x&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading feats..."})]}),u&&(0,t.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,t.jsx)("p",{children:u})}),!x&&!u&&0===w.length&&(0,t.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No feats available"}),!x&&!u&&w.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:w.map(e=>{let{meets:s,warning:a}=(e=>{let t=[];if(e.lvl_req&&l.level<e.lvl_req&&t.push(`Requires level ${e.lvl_req}`),e.ability_req&&e.abil_req_val){let s=l.abilities||{};e.ability_req.forEach((a,r)=>{let l=e.abil_req_val?.[r]??0;(s[a.toLowerCase()]??0)<l&&t.push(`Requires ${a} ${l}+`)})}let{baseName:s,level:a}=ed(e.name);if(a>1&&![...l.archetypeFeats||[],...l.feats||[]].some(e=>{let t=ed(e.name);return t.baseName===s&&t.level===a-1})){let e=["I","II","III","IV","V","VI","VII","VIII","IX"][a-2]||"I";t.push(`Requires ${s} ${e}`)}return{meets:0===t.length,warning:t.join(", ")}})(e);return(0,t.jsx)(em,{feat:e,isSelected:j.some(t=>t.id===e.id),onToggle:()=>{v(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},meetsRequirements:s,requirementWarning:a},e.id)})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[j.length," feat",1!==j.length?"s":""," selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{j.length>0&&(o(j),a())},disabled:0===j.length,className:(0,m.cn)("px-4 py-2 rounded-lg font-medium transition-colors",j.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",j.length>0?`(${j.length})`:""]})]})]})]})}):null}function ep({skill:e,isSelected:s,onToggle:a}){let r=Array.isArray(e.ability)?e.ability.join(", "):"";return(0,t.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between px-3 py-2 border rounded-lg transition-all",s?"border-primary-500 bg-primary-50":"border-gray-200 hover:bg-gray-50"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:a,className:(0,m.cn)("w-6 h-6 rounded-full flex items-center justify-center transition-colors",s?"bg-primary-500 text-white":"bg-gray-100 text-gray-400 hover:bg-gray-200"),children:s?"âœ“":"+"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),r&&(0,t.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",r,")"]})]})]}),e.category&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600",children:e.category})]})}function eu({isOpen:e,onClose:a,existingSkillNames:r,onAdd:l}){let[i,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[x,p]=(0,s.useState)(null),[u,h]=(0,s.useState)(""),[g,b]=(0,s.useState)([]);(0,s.useEffect)(()=>{e&&(async()=>{d(!0),p(null);try{let e=await (0,eo.get)((0,eo.ref)(n.rtdb,"skills"));if(e.exists()){let t=e.val(),s=Object.entries(t).map(([e,t])=>({id:e,...t})).filter(e=>!e.base_skill);o(s)}}catch(e){p(`Failed to load skills: ${e instanceof Error?e.message:"Unknown error"}`)}finally{d(!1)}})()},[e]),(0,s.useEffect)(()=>{e&&(b([]),h(""))},[e]);let y=(0,s.useMemo)(()=>{let e=r.map(e=>e.toLowerCase());return i.filter(t=>{if(e.includes(t.name.toLowerCase()))return!1;if(u){let e=u.toLowerCase();if(!t.name.toLowerCase().includes(e))return!1}return!0}).sort((e,t)=>e.name.localeCompare(t.name))},[i,r,u]);return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Add Skill"}),(0,t.jsx)("button",{onClick:a,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,t.jsx)(R.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ea.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"Search skills...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[c&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading skills..."})]}),x&&(0,t.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,t.jsx)("p",{children:x})}),!c&&!x&&0===y.length&&(0,t.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No skills available to add"}),!c&&!x&&y.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,t.jsx)(ep,{skill:e,isSelected:g.some(t=>t.id===e.id),onToggle:()=>{b(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])}},e.id))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[g.length," skill",1!==g.length?"s":""," selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{g.length>0&&(l(g),a())},disabled:0===g.length,className:(0,m.cn)("px-4 py-2 rounded-lg font-medium transition-colors",g.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",g.length>0?`(${g.length})`:""]})]})]})]})}):null}function eh({skill:e,isSelected:s,onToggle:a}){let r=Array.isArray(e.ability)?e.ability.join(", "):"";return(0,t.jsx)("div",{className:(0,m.cn)("flex items-center justify-between px-3 py-2 border rounded-lg transition-all",s?"border-primary-500 bg-primary-50":"border-gray-200 hover:bg-gray-50"),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:a,className:(0,m.cn)("w-6 h-6 rounded-full flex items-center justify-center transition-colors",s?"bg-primary-500 text-white":"bg-gray-100 text-gray-400 hover:bg-gray-200"),children:s?"âœ“":"+"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),(0,t.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.base_skill,")"]}),r&&(0,t.jsx)("span",{className:"ml-1 text-xs text-gray-400",children:r})]})]})})}function eg({isOpen:e,onClose:a,characterSkills:r,existingSkillNames:l,onAdd:i}){let[o,c]=(0,s.useState)([]),[d,x]=(0,s.useState)(!0),[p,u]=(0,s.useState)(null),[h,g]=(0,s.useState)(""),[b,y]=(0,s.useState)([]),f=(0,s.useMemo)(()=>r.filter(e=>e.prof).map(e=>e.name),[r]);(0,s.useEffect)(()=>{e&&(async()=>{x(!0),u(null);try{let e=await (0,eo.get)((0,eo.ref)(n.rtdb,"skills"));if(e.exists()){let t=e.val(),s=Object.entries(t).map(([e,t])=>({id:e,...t})).filter(e=>e.base_skill&&f.includes(e.base_skill));c(s)}}catch(e){u(`Failed to load sub-skills: ${e instanceof Error?e.message:"Unknown error"}`)}finally{x(!1)}})()},[e,f]),(0,s.useEffect)(()=>{e&&(y([]),g(""))},[e]);let j=(0,s.useMemo)(()=>{let e=l.map(e=>e.toLowerCase());return o.filter(t=>{if(e.includes(t.name.toLowerCase()))return!1;if(h){let e=h.toLowerCase();if(!t.name.toLowerCase().includes(e)&&!t.base_skill.toLowerCase().includes(e))return!1}return!0}).sort((e,t)=>e.name.localeCompare(t.name))},[o,l,h]);return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Add Sub-Skill"}),(0,t.jsx)("button",{onClick:a,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:(0,t.jsx)(R.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,t.jsx)("div",{className:"px-4 py-2 bg-blue-50 border-b border-blue-100",children:(0,t.jsx)("p",{className:"text-sm text-blue-700",children:"Sub-skills are available for skills you are proficient in."})}),(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ea.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"Search sub-skills...",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[d&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading sub-skills..."})]}),p&&(0,t.jsx)("div",{className:"text-center py-8 text-red-600",children:(0,t.jsx)("p",{children:p})}),!d&&!p&&0===f.length&&(0,t.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"You need at least one proficient skill to add sub-skills."}),!d&&!p&&f.length>0&&0===j.length&&(0,t.jsx)("p",{className:"text-center py-8 text-gray-500 italic",children:"No sub-skills available to add"}),!d&&!p&&j.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,t.jsx)(eh,{skill:e,isSelected:b.some(t=>t.id===e.id),onToggle:()=>{y(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])}},e.id))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[b.length," sub-skill",1!==b.length?"s":""," selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{b.length>0&&(i(b),a())},disabled:0===b.length,className:(0,m.cn)("px-4 py-2 rounded-lg font-medium transition-colors",b.length>0?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Add ",b.length>0?`(${b.length})`:""]})]})]})]})}):null}let eb=(0,Y.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),ey=(0,Y.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var ef=e.i(90597),ej=e.i(98919),ev=e.i(7559),eN=e.i(40437);function ew({isOpen:e,onClose:a,character:r,onConfirm:l}){let i,[n,o]=(0,s.useState)((r.level||1)+1),c=r.level||1,d=(0,s.useMemo)(()=>{let e=r.abilities||{};return Math.max(...[r.archetype?.ability?.toLowerCase(),r.mart_abil?.toLowerCase(),r.pow_abil?.toLowerCase()].filter(Boolean).map(t=>e[t]||0),0)},[r]),m=(0,s.useMemo)(()=>(function(e,t,s=0){let a=(0,eN.calculateHealthEnergyPool)(e,"PLAYER"),r=(0,eN.calculateHealthEnergyPool)(t,"PLAYER"),l=(0,eN.calculateAbilityPoints)(e),i=(0,eN.calculateAbilityPoints)(t),n=(0,eN.calculateSkillPoints)(e),o=(0,eN.calculateSkillPoints)(t),c=(0,eN.calculateTrainingPoints)(e,s),d=(0,eN.calculateTrainingPoints)(t,s),m=(0,eN.calculateProficiency)(e);return{healthEnergy:r-a,abilityPoints:i-l,skillPoints:o-n,trainingPoints:d-c,proficiency:(0,eN.calculateProficiency)(t)-m,archetypeFeats:t-e,characterFeats:t-e}})(c,n,d),[c,n,d]),x=(i=[],m.abilityPoints>0&&i.push(`+${m.abilityPoints} Ability Point${m.abilityPoints>1?"s":""}`),m.proficiency>0&&i.push(`+${m.proficiency} Proficiency`),i);return(0,t.jsx)(ei.Modal,{isOpen:e,onClose:a,title:"Level Up!",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("p",{className:"text-gray-600 mb-2",children:[r.name," â€¢ Level ",c]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>o(Math.max(c+1,n-1)),disabled:n<=c+1,className:"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:"-"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-5xl font-bold text-primary-600",children:n}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"New Level"})]}),(0,t.jsx)("button",{onClick:()=>o(Math.min(20,n+1)),disabled:n>=20,className:"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:"+"})]})]}),x.length>0&&(0,t.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700 font-medium mb-2",children:[(0,t.jsx)(ey,{className:"w-5 h-5"}),"Milestone Bonuses!"]}),(0,t.jsx)("ul",{className:"text-sm text-yellow-600 space-y-1",children:x.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)(er.Check,{className:"w-4 h-4"}),e]},s))})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsx)(ek,{icon:(0,t.jsx)(ef.Heart,{className:"w-5 h-5 text-red-500"}),label:"Health & Energy",value:`+${m.healthEnergy}`,description:"Hit points"}),(0,t.jsx)(ek,{icon:(0,t.jsx)(ev.Sword,{className:"w-5 h-5 text-orange-500"}),label:"Training Points",value:`+${m.trainingPoints}`,description:"For powers/techniques"}),(0,t.jsx)(ek,{icon:(0,t.jsx)(ej.Shield,{className:"w-5 h-5 text-blue-500"}),label:"Skill Points",value:`+${m.skillPoints}`,description:"For skills"}),(0,t.jsx)(ek,{icon:(0,t.jsx)(ey,{className:"w-5 h-5 text-purple-500"}),label:"Feats",value:`+${m.archetypeFeats}`,description:"Archetype & Character"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:a,className:"flex-1 px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{l(n),a()},className:"flex-1 px-4 py-3 rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors flex items-center justify-center gap-2 font-medium",children:[(0,t.jsx)(eb,{className:"w-5 h-5"}),"Level Up to ",n,"!"]})]})]})})}function ek({icon:e,label:s,value:a,description:r}){return(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e,(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:s})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:a}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:r})]})}var eC=e.i(97819);function eS({params:e}){let{id:h}=(0,s.use)(e),g=(0,a.useRouter)(),{user:b,loading:y}=(0,o.useAuth)(),[f,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(!0),[k,C]=(0,s.useState)(null),[q,_]=(0,s.useState)(!1),[L,M]=(0,s.useState)(!1),[E,$]=(0,s.useState)(!1),[I,R]=(0,s.useState)(null),[F,D]=(0,s.useState)(null),[U,O]=(0,s.useState)(null),[V,z]=(0,s.useState)(!1),{data:H=[]}=(0,d.useUserPowers)(),{data:B=[]}=(0,d.useUserTechniques)(),{data:X=[]}=(0,d.useUserItems)(),W=(0,s.useMemo)(()=>{var e,t;let s,a,r;return f?(s=X.filter(e=>"weapon"===e.type),a=X.filter(e=>"armor"===e.type),r=X.filter(e=>"equipment"===e.type),{powers:(e=f.powers,e&&0!==e.length?e.map(e=>{let t="string"==typeof e?e:e.name,s="object"==typeof e&&!!e.innate,a=x(H,e);return a?{id:a.id,name:a.name,description:a.description||"",parts:(a.parts||[]).map(e=>({id:String(e.id||""),name:e.name||"",op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl})),innate:s,libraryItem:a}:{id:"object"==typeof e?String(e.id||""):t,name:t,description:"Power not found in your library",innate:s,notInLibrary:!0}}):[]),techniques:(t=f.techniques,t&&0!==t.length?t.map(e=>{let t="string"==typeof e?e:e.name,s=x(B,e);return s?{id:s.id,name:s.name,description:s.description||"",parts:(s.parts||[]).map(e=>({id:String(e.id||""),name:e.name||"",op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl})),libraryItem:s}:{id:"object"==typeof e?String(e.id||""):t,name:t,description:"Technique not found in your library",notInLibrary:!0}}):[]),weapons:p(u(f.equipment?.weapons),s,"weapon"),armor:p(u(f.equipment?.armor),a,"armor"),equipment:p(u(f.equipment?.items),r,"equipment")}):null},[f,H,B,X]);(0,s.useEffect)(()=>{!async function(){if(b&&!y)try{w(!0);let e=(0,l.doc)(n.db,"users",b.uid,"character",h),t=await (0,l.getDoc)(e);if(!t.exists())return void C("Character not found");let s=t.data();j({id:t.id,...s})}catch(e){console.error("Error loading character:",e),C("Failed to load character")}finally{w(!1)}}()},[h,b,y]);let Y=(0,s.useMemo)(()=>{let e,t,s,a,r,l,i,n,o,c,d,m,x,p,u;return f?(e=f.abilities||{strength:0,vitality:0,agility:0,acuity:0,intelligence:0,charisma:0},t=f.defenseSkills?{...eC.DEFAULT_DEFENSE_SKILLS,...f.defenseSkills}:eC.DEFAULT_DEFENSE_SKILLS,a=Object.entries(s={might:(e.strength||0)+(t.might||0),fortitude:(e.vitality||0)+(t.fortitude||0),reflex:(e.agility||0)+(t.reflex||0),discernment:(e.acuity||0)+(t.discernment||0),mentalFortitude:(e.intelligence||0)+(t.mentalFortitude||0),resolve:(e.charisma||0)+(t.resolve||0)}).reduce((e,[t,s])=>(e[t]=10+s,e),{}),r=(f.speedBase??6)+Math.ceil((e.agility||0)/2),l=(f.evasionBase??10)+(e.agility||0),i=(f.equipment?.armor||[]).filter(e=>e.equipped).reduce((e,t)=>e+(t.armor||0),0),n=f.level||1,o=e.vitality||0,c=f.healthPoints||0,d=o<0?8+o+c:8+o*n+c,x=(m=f.pow_abil?.toLowerCase())&&e[m]||0,p=f.energyPoints||0,u=Math.ceil(d/4),{maxHealth:d,maxEnergy:x*n+p,terminal:u,speed:r,evasion:l,armor:i,defenseBonuses:s,defenseScores:a}):null},[f]),J=(0,s.useMemo)(()=>{if(!f)return!1;let e=f.level||1,t=f.experience??0,s=f.abilities||{},a=Object.values(s).reduce((e,t)=>e+(t||0),0),r=s.vitality||0,l=(f.healthPoints||0)+(f.energyPoints||0),i=(f.skills||[]).reduce((e,t)=>{let s=t.skill_val||0;return t.prof&&!t.baseSkill&&(s+=1),e+s},0),n=Object.values(f.defenseSkills||{}).reduce((e,t)=>e+2*t,0),o=Math.floor(e/4)+1,c=Math.floor(e/4)+1,d=(f.archetypeFeats||[]).length,m=(f.feats||[]).length;return t>=4*e||6+e-a>0||r+e-l>0||12+4*e-i-n>0||o-d>0||c-m>0},[f]),{hasUnsavedChanges:Z,isSaving:G,lastSaved:Q,saveNow:ee}=(0,c.useAutoSave)({data:f,onSave:async e=>{if(b&&e){M(!0);try{let t=(0,l.doc)(n.db,"users",b.uid,"character",h);await (0,l.updateDoc)(t,{...e,updatedAt:l.Timestamp.now()})}finally{M(!1)}}},delay:2e3,enabled:q,onSaveStart:()=>M(!0),onSaveComplete:()=>M(!1),onSaveError:e=>{console.error("Auto-save failed:",e),M(!1)}}),es=(0,s.useCallback)(async()=>{q&&Z&&await ee(),_(!q)},[q,Z,ee]),ea=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,health:{...t.health,current:e,max:t.health?.max||0}}:null)},[f]),er=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,energy:{...t.energy,current:e,max:t.energy?.max||0}}:null)},[f]),el=(0,s.useCallback)(async e=>{if(f&&b&&n.storage){if(!e.type.startsWith("image/"))return void C("Please select an image file");if(e.size>5242880)return void C("Image must be less than 5MB");try{z(!0),C(null);let t=e.name.split(".").pop(),s=`portraits/${b.uid}/${f.id}.${t}`,a=(0,i.ref)(n.storage,s);await (0,i.uploadBytes)(a,e,{contentType:e.type});let r=await (0,i.getDownloadURL)(a);j(e=>e?{...e,portrait:r}:null);let o=(0,l.doc)(n.db,"users",b.uid,"characters",f.id);await (0,l.updateDoc)(o,{portrait:r,updatedAt:l.Timestamp.now()})}catch(e){console.error("Portrait upload error:",e),C("Failed to upload portrait")}finally{z(!1)}}},[f,b]),ei=(0,s.useCallback)((e,t)=>{f&&j(s=>s?{...s,abilities:{...s.abilities,[e]:t}}:null)},[f]),eo=(0,s.useCallback)(()=>{f&&Y&&confirm("Take a long rest? This will restore all health and energy to maximum.")&&j(e=>e?{...e,health:{current:Y.maxHealth,max:Y.maxHealth},energy:{current:Y.maxEnergy,max:Y.maxEnergy}}:null)},[f,Y]),ec=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,level:e}:null)},[f]),ed=(0,s.useMemo)(()=>{if(!f)return new Set;let e=new Set;return f.powers?.forEach(t=>e.add(String(t.id||""))),f.techniques?.forEach(t=>e.add(String(t.id||""))),(f.equipment?.weapons||[]).forEach(t=>e.add(String(t.id||""))),(f.equipment?.armor||[]).forEach(t=>e.add(String(t.id||""))),(f.equipment?.items||[]).forEach(t=>e.add(String(t.id||""))),e},[f]),em=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,powers:[...t.powers||[],...e]}:null)},[f]),ep=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,powers:(t.powers||[]).filter(t=>t.id!==e&&String(t.id)!==String(e))}:null)},[f]),eh=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,techniques:[...t.techniques||[],...e]}:null)},[f]),eb=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,techniques:(t.techniques||[]).filter(t=>t.id!==e&&String(t.id)!==String(e))}:null)},[f]),ey=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,weapons:[...t.equipment?.weapons||[],...e]}}:null)},[f]),ef=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,weapons:(t.equipment?.weapons||[]).filter(t=>t.id!==e&&String(t.id)!==String(e))}}:null)},[f]),ej=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,weapons:(t.equipment?.weapons||[]).map(t=>t.id===e||String(t.id)===String(e)?{...t,equipped:!t.equipped}:t)}}:null)},[f]),ev=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,armor:[...t.equipment?.armor||[],...e]}}:null)},[f]),eN=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,armor:(t.equipment?.armor||[]).filter(t=>t.id!==e&&String(t.id)!==String(e))}}:null)},[f]),ek=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,armor:(t.equipment?.armor||[]).map(t=>t.id===e||String(t.id)===String(e)?{...t,equipped:!t.equipped}:t)}}:null)},[f]),eS=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,items:[...t.equipment?.items||[],...e]}}:null)},[f]),eq=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,equipment:{...t.equipment,items:(t.equipment?.items||[]).filter(t=>t.id!==e&&String(t.id)!==String(e))}}:null)},[f]),e_=(0,s.useCallback)(e=>{f&&j(t=>t?{...t,currency:e}:null)},[f]),eA=(0,s.useCallback)((e,t)=>{if(!f)return;let s=e.map(e=>({id:e.id,name:e.name,description:e.description||e.effect||"",maxUses:e.max_uses,currentUses:e.max_uses}));"archetype"===t?j(e=>e?{...e,archetypeFeats:[...e.archetypeFeats||[],...s]}:null):j(e=>e?{...e,feats:[...e.feats||[],...s]}:null),D(null)},[f]),eL=(0,s.useCallback)(e=>{if(!f)return;let t=e.map(e=>({id:e.id,name:e.name,category:e.ability?.[0]||"other",skill_val:0,prof:!1,baseSkill:e.base_skill||void 0}));j(e=>{if(!e)return null;let s=e.skills||[];return{...e,skills:[...s,...t]}}),O(null)},[f]),eM=(0,s.useCallback)(e=>{if(I)switch(I){case"power":em(e);break;case"technique":eh(e);break;case"weapon":ey(e);break;case"armor":ev(e);break;case"equipment":eS(e)}},[I,em,eh,ey,ev,eS]);if((0,s.useEffect)(()=>{y||b||g.push("/login")},[y,b,g]),y||N)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading character..."})]})});if(k||!f)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:k||"Character not found"}),(0,t.jsx)(r.default,{href:"/characters",className:"text-primary-600 hover:text-primary-700",children:"â† Back to Characters"})]})});let eE=f.skills||[];return(0,t.jsx)(v,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-8",children:[(0,t.jsx)("div",{className:"sticky top-20 z-40 bg-white border-b border-gray-200 shadow-sm",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between",children:[(0,t.jsx)(r.default,{href:"/characters",className:"text-gray-600 hover:text-gray-900 flex items-center gap-1",children:"â† Characters"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(L||G)&&(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"Saving..."}),Z&&!L&&!G&&(0,t.jsx)("span",{className:"text-sm text-amber-600",children:"Unsaved changes"}),Q&&!Z&&!L&&(0,t.jsx)("span",{className:"text-sm text-green-600",children:"Saved"}),(0,t.jsx)("button",{onClick:()=>$(!0),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors",children:"â¬†ï¸ Level Up"}),(0,t.jsx)("button",{onClick:eo,className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors",children:"ðŸ˜´ Recover"}),(0,t.jsxs)("button",{onClick:es,className:(0,m.cn)("relative px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",q?"bg-green-600 text-white hover:bg-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[q?"âœ“ Done":"ðŸ–‰ Edit",J&&!q&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse",title:"You have unspent points!"})]})]})]})}),(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 pt-4",children:Y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S,{character:f,calculatedStats:Y,isEditMode:q,onHealthChange:ea,onEnergyChange:er,onPortraitChange:el,isUploadingPortrait:V}),(0,t.jsx)(A,{abilities:f.abilities,archetypeAbility:f.archetype?.ability,martialAbility:f.mart_abil,powerAbility:f.pow_abil,isEditMode:q,onAbilityChange:ei}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsx)(P,{skills:eE,abilities:f.abilities,isEditMode:q,onAddSkill:()=>O("skill"),onAddSubSkill:()=>O("subskill")})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsx)(T,{character:f,isEditMode:q,onAddArchetypeFeat:()=>D("archetype"),onAddCharacterFeat:()=>D("character")})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsx)(K,{powers:W?.powers||f.powers||[],techniques:W?.techniques||f.techniques||[],weapons:W?.weapons||f.equipment?.weapons||[],armor:W?.armor||f.equipment?.armor||[],equipment:W?.equipment||f.equipment?.items||[],currency:f.currency,innateEnergy:f.innateEnergy,isEditMode:q,onAddPower:()=>R("power"),onRemovePower:ep,onAddTechnique:()=>R("technique"),onRemoveTechnique:eb,onAddWeapon:()=>R("weapon"),onRemoveWeapon:ef,onToggleEquipWeapon:ej,onAddArmor:()=>R("armor"),onRemoveArmor:eN,onToggleEquipArmor:ek,onAddEquipment:()=>R("equipment"),onRemoveEquipment:eq,onCurrencyChange:e_,weight:f.weight,height:f.height,appearance:f.appearance,archetypeDesc:f.archetypeDesc,notes:f.notes,abilities:f.abilities,onWeightChange:e=>j(t=>t?{...t,weight:e}:null),onHeightChange:e=>j(t=>t?{...t,height:e}:null),onAppearanceChange:e=>j(t=>t?{...t,appearance:e}:null),onArchetypeDescChange:e=>j(t=>t?{...t,archetypeDesc:e}:null),onNotesChange:e=>j(t=>t?{...t,notes:e}:null),level:f.level,archetypeAbility:f.abilities?.[f.pow_abil]||0})})]})]})}),(0,t.jsx)(et,{}),I&&(0,t.jsx)(en,{isOpen:!!I,onClose:()=>R(null),itemType:I,existingIds:ed,onAdd:eM}),f&&F&&(0,t.jsx)(ex,{isOpen:!!F,onClose:()=>D(null),featType:F,character:f,existingFeatIds:[...(f.archetypeFeats||[]).map(e=>e.id||e.name),...(f.feats||[]).map(e=>e.id||e.name)],onAdd:e=>eA(e,F)}),f&&"skill"===U&&(0,t.jsx)(eu,{isOpen:!0,onClose:()=>O(null),existingSkillNames:eE.map(e=>e.name),onAdd:eL}),f&&"subskill"===U&&(0,t.jsx)(eg,{isOpen:!0,onClose:()=>O(null),characterSkills:eE.map(e=>({name:e.name,prof:e.prof||!1})),existingSkillNames:eE.map(e=>e.name),onAdd:eL}),f&&(0,t.jsx)(ew,{isOpen:E,onClose:()=>$(!1),character:f,onConfirm:ec})]})})}e.s(["default",()=>eS],28509)}]);