{"version":3,"sources":["../../../../src/app/%28main%29/characters/%5Bid%5D/page.tsx","../../../../src/components/character-sheet/sheet-header.tsx","../../../../src/components/character-sheet/abilities-section.tsx","../../../../src/components/character-sheet/skills-section.tsx","../../../../src/components/character-sheet/archetype-section.tsx","../../../../src/components/character-sheet/notes-tab.tsx","../../../../src/components/character-sheet/proficiencies-tab.tsx","../../../../src/components/character-sheet/library-section.tsx","../../../../src/components/character-sheet/dice-roller.tsx","../../../../src/components/character-sheet/roll-context.tsx","../../../../src/components/character-sheet/roll-log.tsx","../../../../src/components/character-sheet/add-library-item-modal.tsx","../../../../src/components/character-sheet/add-feat-modal.tsx","../../../../src/components/character-sheet/add-skill-modal.tsx","../../../../src/components/character-sheet/add-sub-skill-modal.tsx","../../../../src/components/character-sheet/level-up-modal.tsx","../../../../node_modules/lucide-react/src/icons/minus.ts","../../../../node_modules/lucide-react/src/icons/star.ts","../../../../node_modules/lucide-react/src/icons/arrow-up.ts","../../../../node_modules/lucide-react/src/icons/dices.ts","../../../../src/lib/data-enrichment.ts"],"sourcesContent":["/**\r\n * Character Sheet Page\r\n * ====================\r\n * Dynamic route for viewing/editing individual characters\r\n */\r\n\r\n'use client';\r\n\r\nimport { use, useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { doc, getDoc, updateDoc, Timestamp } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { db, storage } from '@/lib/firebase/client';\r\nimport { useAuth, useAutoSave, useUserPowers, useUserTechniques, useUserItems } from '@/hooks';\r\nimport { cn } from '@/lib/utils';\r\nimport { enrichCharacterData } from '@/lib/data-enrichment';\r\nimport {\r\n  SheetHeader,\r\n  AbilitiesSection,\r\n  SkillsSection,\r\n  ArchetypeSection,\r\n  LibrarySection,\r\n  RollLog,\r\n  RollProvider,\r\n  AddLibraryItemModal,\r\n  AddFeatModal,\r\n  AddSkillModal,\r\n  AddSubSkillModal,\r\n  LevelUpModal,\r\n} from '@/components/character-sheet';\r\nimport type { Character, Abilities, AbilityName, Item, DefenseSkills, CharacterPower, CharacterTechnique, CharacterFeat } from '@/types';\r\nimport { DEFAULT_DEFENSE_SKILLS } from '@/types/skills';\r\n\r\ntype AddModalType = 'power' | 'technique' | 'weapon' | 'armor' | 'equipment' | null;\r\ntype FeatModalType = 'archetype' | 'character' | null;\r\ntype SkillModalType = 'skill' | 'subskill' | null;\r\n\r\ninterface PageParams {\r\n  params: Promise<{ id: string }>;\r\n}\r\n\r\n// Calculate stats from character data\r\nfunction calculateStats(character: Character) {\r\n  const abilities = character.abilities || {\r\n    strength: 0,\r\n    vitality: 0,\r\n    agility: 0,\r\n    acuity: 0,\r\n    intelligence: 0,\r\n    charisma: 0,\r\n  };\r\n  \r\n  const defenseVals: DefenseSkills = character.defenseSkills \r\n    ? { ...DEFAULT_DEFENSE_SKILLS, ...character.defenseSkills }\r\n    : DEFAULT_DEFENSE_SKILLS;\r\n  \r\n  // Calculate defenses\r\n  const defenseBonuses = {\r\n    might: (abilities.strength || 0) + (defenseVals.might || 0),\r\n    fortitude: (abilities.vitality || 0) + (defenseVals.fortitude || 0),\r\n    reflex: (abilities.agility || 0) + (defenseVals.reflex || 0),\r\n    discernment: (abilities.acuity || 0) + (defenseVals.discernment || 0),\r\n    mentalFortitude: (abilities.intelligence || 0) + (defenseVals.mentalFortitude || 0),\r\n    resolve: (abilities.charisma || 0) + (defenseVals.resolve || 0),\r\n  };\r\n  \r\n  const defenseScores = Object.entries(defenseBonuses).reduce((acc, [key, val]) => {\r\n    acc[key] = 10 + val;\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n  \r\n  // Speed = 6 + ceil(agility / 2)\r\n  const speedBase = character.speedBase ?? 6;\r\n  const speed = speedBase + Math.ceil((abilities.agility || 0) / 2);\r\n  \r\n  // Evasion = 10 + agility\r\n  const evasionBase = character.evasionBase ?? 10;\r\n  const evasion = evasionBase + (abilities.agility || 0);\r\n  \r\n  // Calculate armor from equipped armor items\r\n  const armorItems = (character.equipment?.armor || []) as Item[];\r\n  const armor = armorItems\r\n    .filter(item => item.equipped)\r\n    .reduce((sum, item) => sum + (item.armor || 0), 0);\r\n  \r\n  // Max Health = 8 + (vitality * level) + healthPoints\r\n  const level = character.level || 1;\r\n  const vitality = abilities.vitality || 0;\r\n  const healthPoints = character.healthPoints || 0;\r\n  const maxHealth = vitality < 0 \r\n    ? 8 + vitality + healthPoints \r\n    : 8 + (vitality * level) + healthPoints;\r\n  \r\n  // Max Energy = (powerAbility * level) + energyPoints\r\n  const powerAbil = character.pow_abil?.toLowerCase() as AbilityName | undefined;\r\n  const powerAbilityValue = powerAbil ? (abilities[powerAbil] || 0) : 0;\r\n  const energyPoints = character.energyPoints || 0;\r\n  const maxEnergy = (powerAbilityValue * level) + energyPoints;\r\n  \r\n  // Terminal = maxHealth / 4 rounded up\r\n  const terminal = Math.ceil(maxHealth / 4);\r\n  \r\n  return {\r\n    maxHealth,\r\n    maxEnergy,\r\n    terminal,\r\n    speed,\r\n    evasion,\r\n    armor,\r\n    defenseBonuses,\r\n    defenseScores,\r\n  };\r\n}\r\n\r\nexport default function CharacterSheetPage({ params }: PageParams) {\r\n  const { id } = use(params);\r\n  const router = useRouter();\r\n  const { user, loading: authLoading } = useAuth();\r\n  \r\n  const [character, setCharacter] = useState<Character | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isEditMode, setIsEditMode] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [showLevelUpModal, setShowLevelUpModal] = useState(false);\r\n  const [addModalType, setAddModalType] = useState<AddModalType>(null);\r\n  const [featModalType, setFeatModalType] = useState<FeatModalType>(null);\r\n  const [skillModalType, setSkillModalType] = useState<SkillModalType>(null);\r\n  const [uploadingPortrait, setUploadingPortrait] = useState(false);\r\n  \r\n  // Fetch user's library for data enrichment\r\n  const { data: userPowers = [] } = useUserPowers();\r\n  const { data: userTechniques = [] } = useUserTechniques();\r\n  const { data: userItems = [] } = useUserItems();\r\n  \r\n  // Enrich character data with full library objects\r\n  const enrichedData = useMemo(() => {\r\n    if (!character) return null;\r\n    return enrichCharacterData(character, userPowers, userTechniques, userItems);\r\n  }, [character, userPowers, userTechniques, userItems]);\r\n  \r\n  // Load character data\r\n  useEffect(() => {\r\n    async function loadCharacter() {\r\n      if (!user || authLoading) return;\r\n      \r\n      try {\r\n        setLoading(true);\r\n        const docRef = doc(db, 'users', user.uid, 'character', id);\r\n        const snapshot = await getDoc(docRef);\r\n        \r\n        if (!snapshot.exists()) {\r\n          setError('Character not found');\r\n          return;\r\n        }\r\n        \r\n        const data = snapshot.data() as Omit<Character, 'id'>;\r\n        setCharacter({ id: snapshot.id, ...data });\r\n      } catch (err) {\r\n        console.error('Error loading character:', err);\r\n        setError('Failed to load character');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    \r\n    loadCharacter();\r\n  }, [id, user, authLoading]);\r\n  \r\n  // Calculate stats\r\n  const calculatedStats = useMemo(() => {\r\n    if (!character) return null;\r\n    return calculateStats(character);\r\n  }, [character]);\r\n  \r\n  // Calculate if character has unapplied points (for notification dot)\r\n  const hasUnappliedPoints = useMemo(() => {\r\n    if (!character) return false;\r\n    \r\n    const level = character.level || 1;\r\n    const xp = character.experience ?? 0;\r\n    const canLevelUp = xp >= (level * 4);\r\n    \r\n    // Calculate ability points: 6 base + level\r\n    const totalAbilityPoints = 6 + level;\r\n    const currentAbilities = character.abilities || {};\r\n    const spentAbilityPoints = Object.values(currentAbilities).reduce((sum, val) => sum + (val || 0), 0);\r\n    const abilityPointsRemaining = totalAbilityPoints - spentAbilityPoints;\r\n    \r\n    // Calculate health/energy points: vitality + level\r\n    const vitality = currentAbilities.vitality || 0;\r\n    const totalHEPoints = vitality + level;\r\n    const spentHEPoints = (character.healthPoints || 0) + (character.energyPoints || 0);\r\n    const hePointsRemaining = totalHEPoints - spentHEPoints;\r\n    \r\n    // Calculate skill points: 12 + (4 * level)\r\n    const totalSkillPoints = 12 + (4 * level);\r\n    const skills = (character.skills || []) as Array<{ skill_val?: number; prof?: boolean; baseSkill?: string }>;\r\n    const spentSkillPoints = skills.reduce((sum, skill) => {\r\n      let cost = skill.skill_val || 0;\r\n      if (skill.prof && !skill.baseSkill) cost += 1;\r\n      return sum + cost;\r\n    }, 0);\r\n    // Defense skills cost 2 per point\r\n    const defenseSkills = character.defenseSkills || {};\r\n    const spentDefensePoints = Object.values(defenseSkills).reduce((sum: number, val) => sum + ((val as number) * 2), 0);\r\n    const skillPointsRemaining = totalSkillPoints - spentSkillPoints - spentDefensePoints;\r\n    \r\n    // Calculate feat slots: 1 archetype feat per 4 levels, 1 character feat per 4 levels\r\n    const archetypeFeatSlots = Math.floor(level / 4) + 1;\r\n    const characterFeatSlots = Math.floor(level / 4) + 1;\r\n    const usedArchetypeFeats = (character.archetypeFeats || []).length;\r\n    const usedCharacterFeats = (character.feats || []).length;\r\n    const archetypeFeatsRemaining = archetypeFeatSlots - usedArchetypeFeats;\r\n    const characterFeatsRemaining = characterFeatSlots - usedCharacterFeats;\r\n    \r\n    return (\r\n      canLevelUp ||\r\n      abilityPointsRemaining > 0 ||\r\n      hePointsRemaining > 0 ||\r\n      skillPointsRemaining > 0 ||\r\n      archetypeFeatsRemaining > 0 ||\r\n      characterFeatsRemaining > 0\r\n    );\r\n  }, [character]);\r\n  \r\n  // Auto-save with debounce\r\n  const { hasUnsavedChanges, isSaving, lastSaved, saveNow } = useAutoSave({\r\n    data: character,\r\n    onSave: async (data) => {\r\n      if (!user || !data) return;\r\n      setSaving(true);\r\n      try {\r\n        const docRef = doc(db, 'users', user.uid, 'character', id);\r\n        await updateDoc(docRef, {\r\n          ...data,\r\n          updatedAt: Timestamp.now(),\r\n        });\r\n      } finally {\r\n        setSaving(false);\r\n      }\r\n    },\r\n    delay: 2000,\r\n    enabled: isEditMode,\r\n    onSaveStart: () => setSaving(true),\r\n    onSaveComplete: () => setSaving(false),\r\n    onSaveError: (err) => {\r\n      console.error('Auto-save failed:', err);\r\n      setSaving(false);\r\n    },\r\n  });\r\n  \r\n  // Save when leaving edit mode\r\n  const handleToggleEditMode = useCallback(async () => {\r\n    if (isEditMode && hasUnsavedChanges) {\r\n      await saveNow();\r\n    }\r\n    setIsEditMode(!isEditMode);\r\n  }, [isEditMode, hasUnsavedChanges, saveNow]);\r\n  \r\n  // Update handlers\r\n  const handleHealthChange = useCallback((value: number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      health: { ...prev.health, current: value, max: prev.health?.max || 0 }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  const handleEnergyChange = useCallback((value: number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      energy: { ...prev.energy, current: value, max: prev.energy?.max || 0 }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Portrait upload handler\r\n  const handlePortraitChange = useCallback(async (file: File) => {\r\n    if (!character || !user || !storage) return;\r\n    \r\n    // Validate file type\r\n    if (!file.type.startsWith('image/')) {\r\n      setError('Please select an image file');\r\n      return;\r\n    }\r\n    \r\n    // Validate file size (max 5MB)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setError('Image must be less than 5MB');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setUploadingPortrait(true);\r\n      setError(null);\r\n      \r\n      // Create a unique filename\r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `portraits/${user.uid}/${character.id}.${fileExt}`;\r\n      const storageRef = ref(storage, fileName);\r\n      \r\n      // Upload the file\r\n      await uploadBytes(storageRef, file, {\r\n        contentType: file.type,\r\n      });\r\n      \r\n      // Get the download URL\r\n      const downloadUrl = await getDownloadURL(storageRef);\r\n      \r\n      // Update the character with the new portrait URL\r\n      setCharacter(prev => prev ? { ...prev, portrait: downloadUrl } : null);\r\n      \r\n      // Also update in Firestore immediately\r\n      const charRef = doc(db, 'users', user.uid, 'characters', character.id);\r\n      await updateDoc(charRef, { portrait: downloadUrl, updatedAt: Timestamp.now() });\r\n      \r\n    } catch (err) {\r\n      console.error('Portrait upload error:', err);\r\n      setError('Failed to upload portrait');\r\n    } finally {\r\n      setUploadingPortrait(false);\r\n    }\r\n  }, [character, user]);\r\n  \r\n  const handleAbilityChange = useCallback((ability: AbilityName, value: number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      abilities: { ...prev.abilities, [ability]: value }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Long rest handler\r\n  const handleLongRest = useCallback(() => {\r\n    if (!character || !calculatedStats) return;\r\n    \r\n    if (confirm('Take a long rest? This will restore all health and energy to maximum.')) {\r\n      setCharacter(prev => prev ? {\r\n        ...prev,\r\n        health: { current: calculatedStats.maxHealth, max: calculatedStats.maxHealth },\r\n        energy: { current: calculatedStats.maxEnergy, max: calculatedStats.maxEnergy }\r\n      } : null);\r\n    }\r\n  }, [character, calculatedStats]);\r\n  \r\n  // Level up handler\r\n  const handleLevelUp = useCallback((newLevel: number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      level: newLevel\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Get existing item IDs for the modal\r\n  const existingIds = useMemo(() => {\r\n    if (!character) return new Set<string>();\r\n    const ids = new Set<string>();\r\n    \r\n    character.powers?.forEach(p => ids.add(String(p.id || '')));\r\n    character.techniques?.forEach(t => ids.add(String(t.id || '')));\r\n    (character.equipment?.weapons as Item[] || []).forEach(w => ids.add(String(w.id || '')));\r\n    (character.equipment?.armor as Item[] || []).forEach(a => ids.add(String(a.id || '')));\r\n    (character.equipment?.items as Item[] || []).forEach(e => ids.add(String(e.id || '')));\r\n    \r\n    return ids;\r\n  }, [character]);\r\n  \r\n  // Add power handler\r\n  const handleAddPowers = useCallback((powers: CharacterPower[]) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      powers: [...(prev.powers || []), ...powers]\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Remove power handler\r\n  const handleRemovePower = useCallback((powerId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      powers: (prev.powers || []).filter(p => p.id !== powerId && String(p.id) !== String(powerId))\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Add technique handler\r\n  const handleAddTechniques = useCallback((techniques: CharacterTechnique[]) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      techniques: [...(prev.techniques || []), ...techniques]\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Remove technique handler\r\n  const handleRemoveTechnique = useCallback((techId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      techniques: (prev.techniques || []).filter(t => t.id !== techId && String(t.id) !== String(techId))\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Add weapon handler\r\n  const handleAddWeapons = useCallback((items: Item[]) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        weapons: [...((prev.equipment?.weapons as Item[]) || []), ...items]\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Remove weapon handler\r\n  const handleRemoveWeapon = useCallback((itemId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        weapons: ((prev.equipment?.weapons as Item[]) || []).filter(w => w.id !== itemId && String(w.id) !== String(itemId))\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Toggle equip weapon handler\r\n  const handleToggleEquipWeapon = useCallback((itemId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        weapons: ((prev.equipment?.weapons as Item[]) || []).map(w => \r\n          (w.id === itemId || String(w.id) === String(itemId)) ? { ...w, equipped: !w.equipped } : w\r\n        )\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Add armor handler\r\n  const handleAddArmor = useCallback((items: Item[]) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        armor: [...((prev.equipment?.armor as Item[]) || []), ...items]\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Remove armor handler\r\n  const handleRemoveArmor = useCallback((itemId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        armor: ((prev.equipment?.armor as Item[]) || []).filter(a => a.id !== itemId && String(a.id) !== String(itemId))\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Toggle equip armor handler\r\n  const handleToggleEquipArmor = useCallback((itemId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        armor: ((prev.equipment?.armor as Item[]) || []).map(a => \r\n          (a.id === itemId || String(a.id) === String(itemId)) ? { ...a, equipped: !a.equipped } : a\r\n        )\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Add equipment handler\r\n  const handleAddEquipment = useCallback((items: Item[]) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        items: [...((prev.equipment?.items as Item[]) || []), ...items]\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Remove equipment handler\r\n  const handleRemoveEquipment = useCallback((itemId: string | number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      equipment: {\r\n        ...prev.equipment,\r\n        items: ((prev.equipment?.items as Item[]) || []).filter(e => e.id !== itemId && String(e.id) !== String(itemId))\r\n      }\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Currency change handler\r\n  const handleCurrencyChange = useCallback((value: number) => {\r\n    if (!character) return;\r\n    setCharacter(prev => prev ? {\r\n      ...prev,\r\n      currency: value\r\n    } : null);\r\n  }, [character]);\r\n  \r\n  // Add feats handler\r\n  const handleAddFeats = useCallback((feats: { id: string; name: string; description?: string; effect?: string; max_uses?: number }[], type: 'archetype' | 'character') => {\r\n    if (!character) return;\r\n    const newFeats: CharacterFeat[] = feats.map(f => ({\r\n      id: f.id,\r\n      name: f.name,\r\n      description: f.description || f.effect || '',\r\n      maxUses: f.max_uses,\r\n      currentUses: f.max_uses,\r\n    }));\r\n    \r\n    if (type === 'archetype') {\r\n      setCharacter(prev => prev ? {\r\n        ...prev,\r\n        archetypeFeats: [...(prev.archetypeFeats || []), ...newFeats]\r\n      } : null);\r\n    } else {\r\n      setCharacter(prev => prev ? {\r\n        ...prev,\r\n        feats: [...(prev.feats || []), ...newFeats]\r\n      } : null);\r\n    }\r\n    setFeatModalType(null);\r\n  }, [character]);\r\n  \r\n  // Add skills handler\r\n  const handleAddSkills = useCallback((newSkills: { id: string; name: string; ability?: string[]; base_skill?: string | null }[]) => {\r\n    if (!character) return;\r\n    const skillsToAdd = newSkills.map(s => ({\r\n      id: s.id,\r\n      name: s.name,\r\n      category: s.ability?.[0] || 'other',\r\n      skill_val: 0,\r\n      prof: false,\r\n      baseSkill: s.base_skill || undefined,\r\n    }));\r\n    \r\n    // Skills are stored as array of objects at runtime, but typed as Record\r\n    // Cast to handle the type mismatch\r\n    setCharacter(prev => {\r\n      if (!prev) return null;\r\n      const currentSkills = (prev.skills || []) as unknown as typeof skillsToAdd;\r\n      return {\r\n        ...prev,\r\n        skills: [...currentSkills, ...skillsToAdd] as unknown as typeof prev.skills\r\n      };\r\n    });\r\n    setSkillModalType(null);\r\n  }, [character]);\r\n  \r\n  // Handle modal item add based on type\r\n  const handleModalAdd = useCallback((items: CharacterPower[] | CharacterTechnique[] | Item[]) => {\r\n    if (!addModalType) return;\r\n    \r\n    switch (addModalType) {\r\n      case 'power':\r\n        handleAddPowers(items as CharacterPower[]);\r\n        break;\r\n      case 'technique':\r\n        handleAddTechniques(items as CharacterTechnique[]);\r\n        break;\r\n      case 'weapon':\r\n        handleAddWeapons(items as Item[]);\r\n        break;\r\n      case 'armor':\r\n        handleAddArmor(items as Item[]);\r\n        break;\r\n      case 'equipment':\r\n        handleAddEquipment(items as Item[]);\r\n        break;\r\n    }\r\n  }, [addModalType, handleAddPowers, handleAddTechniques, handleAddWeapons, handleAddArmor, handleAddEquipment]);\r\n  \r\n  // Redirect if not authenticated\r\n  useEffect(() => {\r\n    if (!authLoading && !user) {\r\n      router.push('/login');\r\n    }\r\n  }, [authLoading, user, router]);\r\n  \r\n  if (authLoading || loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">Loading character...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (error || !character) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n            {error || 'Character not found'}\r\n          </h1>\r\n          <Link\r\n            href=\"/characters\"\r\n            className=\"text-primary-600 hover:text-primary-700\"\r\n          >\r\n            ‚Üê Back to Characters\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  const skills = (character.skills || []) as Array<{\r\n    id: string;\r\n    name: string;\r\n    category?: string;\r\n    skill_val: number;\r\n    prof?: boolean;\r\n    baseSkill?: string;\r\n  }>;\r\n  \r\n  return (\r\n    <RollProvider>\r\n      <div className=\"min-h-screen bg-gray-50 pb-8\">\r\n        {/* Action Bar */}\r\n        <div className=\"sticky top-20 z-40 bg-white border-b border-gray-200 shadow-sm\">\r\n          <div className=\"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between\">\r\n            <Link\r\n              href=\"/characters\"\r\n              className=\"text-gray-600 hover:text-gray-900 flex items-center gap-1\"\r\n            >\r\n              ‚Üê Characters\r\n            </Link>\r\n            \r\n            <div className=\"flex items-center gap-2\">\r\n              {(saving || isSaving) && (\r\n                <span className=\"text-sm text-gray-500\">Saving...</span>\r\n              )}\r\n              {hasUnsavedChanges && !saving && !isSaving && (\r\n                <span className=\"text-sm text-amber-600\">Unsaved changes</span>\r\n              )}\r\n              {lastSaved && !hasUnsavedChanges && !saving && (\r\n                <span className=\"text-sm text-green-600\">Saved</span>\r\n              )}\r\n              \r\n              <button\r\n                onClick={() => setShowLevelUpModal(true)}\r\n                className=\"px-3 py-1.5 rounded-lg text-sm font-medium bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors\"\r\n              >\r\n                ‚¨ÜÔ∏è Level Up\r\n              </button>\r\n              \r\n              <button\r\n                onClick={handleLongRest}\r\n                className=\"px-3 py-1.5 rounded-lg text-sm font-medium bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors\"\r\n              >\r\n                üò¥ Recover\r\n              </button>\r\n              \r\n              <button\r\n                onClick={handleToggleEditMode}\r\n                className={cn(\r\n                  'relative px-3 py-1.5 rounded-lg text-sm font-medium transition-colors',\r\n                  isEditMode\r\n                    ? 'bg-green-600 text-white hover:bg-green-700'\r\n                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                )}\r\n              >\r\n                {isEditMode ? '‚úì Done' : 'üñâ Edit'}\r\n                {/* Notification dot for unapplied points */}\r\n                {hasUnappliedPoints && !isEditMode && (\r\n                  <span \r\n                    className=\"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse\"\r\n                    title=\"You have unspent points!\"\r\n                  />\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Character Sheet Content */}\r\n        <div className=\"max-w-7xl mx-auto px-4 pt-4\">\r\n          {calculatedStats && (\r\n            <>\r\n              <SheetHeader\r\n                character={character}\r\n                calculatedStats={calculatedStats}\r\n                isEditMode={isEditMode}\r\n                onHealthChange={handleHealthChange}\r\n                onEnergyChange={handleEnergyChange}\r\n                onPortraitChange={handlePortraitChange}\r\n                isUploadingPortrait={uploadingPortrait}\r\n              />\r\n              \r\n              <AbilitiesSection\r\n              abilities={character.abilities}\r\n              archetypeAbility={character.archetype?.ability as AbilityName}\r\n              martialAbility={character.mart_abil}\r\n              powerAbility={character.pow_abil}\r\n              isEditMode={isEditMode}\r\n              onAbilityChange={handleAbilityChange}\r\n            />\r\n            \r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\r\n              <div className=\"lg:col-span-1\">\r\n                <SkillsSection\r\n                  skills={skills}\r\n                  abilities={character.abilities}\r\n                  isEditMode={isEditMode}\r\n                  onAddSkill={() => setSkillModalType('skill')}\r\n                  onAddSubSkill={() => setSkillModalType('subskill')}\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"lg:col-span-1\">\r\n                <ArchetypeSection\r\n                  character={character}\r\n                  isEditMode={isEditMode}\r\n                  onAddArchetypeFeat={() => setFeatModalType('archetype')}\r\n                  onAddCharacterFeat={() => setFeatModalType('character')}\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"lg:col-span-1\">\r\n                <LibrarySection\r\n                  powers={enrichedData?.powers || character.powers || []}\r\n                  techniques={enrichedData?.techniques || character.techniques || []}\r\n                  weapons={enrichedData?.weapons || (character.equipment?.weapons || []) as Item[]}\r\n                  armor={enrichedData?.armor || (character.equipment?.armor || []) as Item[]}\r\n                  equipment={enrichedData?.equipment || (character.equipment?.items || []) as Item[]}\r\n                  currency={character.currency}\r\n                  innateEnergy={character.innateEnergy}\r\n                  isEditMode={isEditMode}\r\n                  onAddPower={() => setAddModalType('power')}\r\n                  onRemovePower={handleRemovePower}\r\n                  onAddTechnique={() => setAddModalType('technique')}\r\n                  onRemoveTechnique={handleRemoveTechnique}\r\n                  onAddWeapon={() => setAddModalType('weapon')}\r\n                  onRemoveWeapon={handleRemoveWeapon}\r\n                  onToggleEquipWeapon={handleToggleEquipWeapon}\r\n                  onAddArmor={() => setAddModalType('armor')}\r\n                  onRemoveArmor={handleRemoveArmor}\r\n                  onToggleEquipArmor={handleToggleEquipArmor}\r\n                  onAddEquipment={() => setAddModalType('equipment')}\r\n                  onRemoveEquipment={handleRemoveEquipment}\r\n                  onCurrencyChange={handleCurrencyChange}\r\n                  // Notes tab props\r\n                  weight={character.weight}\r\n                  height={character.height}\r\n                  appearance={character.appearance}\r\n                  archetypeDesc={character.archetypeDesc}\r\n                  notes={character.notes}\r\n                  abilities={character.abilities}\r\n                  onWeightChange={(v) => setCharacter(prev => prev ? { ...prev, weight: v } : null)}\r\n                  onHeightChange={(v) => setCharacter(prev => prev ? { ...prev, height: v } : null)}\r\n                  onAppearanceChange={(v) => setCharacter(prev => prev ? { ...prev, appearance: v } : null)}\r\n                  onArchetypeDescChange={(v) => setCharacter(prev => prev ? { ...prev, archetypeDesc: v } : null)}\r\n                  onNotesChange={(v) => setCharacter(prev => prev ? { ...prev, notes: v } : null)}\r\n                  // Proficiencies tab props\r\n                  level={character.level}\r\n                  archetypeAbility={character.abilities?.[character.pow_abil as keyof typeof character.abilities] || 0}\r\n                />\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Fixed Roll Log */}\r\n      <RollLog />\r\n      \r\n      {/* Add Item Modal */}\r\n      {addModalType && (\r\n        <AddLibraryItemModal\r\n          isOpen={!!addModalType}\r\n          onClose={() => setAddModalType(null)}\r\n          itemType={addModalType}\r\n          existingIds={existingIds}\r\n          onAdd={handleModalAdd}\r\n        />\r\n      )}\r\n      \r\n      {/* Add Feat Modal */}\r\n      {character && featModalType && (\r\n        <AddFeatModal\r\n          isOpen={!!featModalType}\r\n          onClose={() => setFeatModalType(null)}\r\n          featType={featModalType}\r\n          character={character}\r\n          existingFeatIds={[\r\n            ...(character.archetypeFeats || []).map(f => f.id || f.name),\r\n            ...(character.feats || []).map(f => f.id || f.name),\r\n          ]}\r\n          onAdd={(feats) => handleAddFeats(feats, featModalType)}\r\n        />\r\n      )}\r\n      \r\n      {/* Add Skill Modal */}\r\n      {character && skillModalType === 'skill' && (\r\n        <AddSkillModal\r\n          isOpen={true}\r\n          onClose={() => setSkillModalType(null)}\r\n          existingSkillNames={skills.map(s => s.name)}\r\n          onAdd={handleAddSkills}\r\n        />\r\n      )}\r\n      \r\n      {/* Add Sub-Skill Modal */}\r\n      {character && skillModalType === 'subskill' && (\r\n        <AddSubSkillModal\r\n          isOpen={true}\r\n          onClose={() => setSkillModalType(null)}\r\n          characterSkills={skills.map(s => ({ name: s.name, prof: s.prof || false }))}\r\n          existingSkillNames={skills.map(s => s.name)}\r\n          onAdd={handleAddSkills}\r\n        />\r\n      )}\r\n      \r\n      {/* Level Up Modal */}\r\n      {character && (\r\n        <LevelUpModal\r\n          isOpen={showLevelUpModal}\r\n          onClose={() => setShowLevelUpModal(false)}\r\n          character={character}\r\n          onConfirm={handleLevelUp}\r\n        />\r\n      )}\r\n    </div>\r\n    </RollProvider>\r\n  );\r\n}\r\n","/**\r\n * Character Sheet Header\r\n * ======================\r\n * Displays character identity, portrait, and vital stats\r\n * Defense blocks are clickable to roll saving throws\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport Image from 'next/image';\r\nimport { cn } from '@/lib/utils';\r\nimport { useRollsOptional } from './roll-context';\r\nimport type { Character } from '@/types';\r\n\r\ninterface CalculatedStats {\r\n  maxHealth: number;\r\n  maxEnergy: number;\r\n  terminal: number;\r\n  speed: number;\r\n  evasion: number;\r\n  armor: number;\r\n  defenseBonuses: Record<string, number>;\r\n  defenseScores: Record<string, number>;\r\n}\r\n\r\ninterface SheetHeaderProps {\r\n  character: Character;\r\n  calculatedStats: CalculatedStats;\r\n  isEditMode?: boolean;\r\n  onHealthChange?: (value: number) => void;\r\n  onEnergyChange?: (value: number) => void;\r\n  onPortraitChange?: (file: File) => void;\r\n  isUploadingPortrait?: boolean;\r\n}\r\n\r\nfunction ResourceBar({\r\n  label,\r\n  current,\r\n  max,\r\n  color,\r\n  terminalThreshold,\r\n  showControls,\r\n  onChange,\r\n}: {\r\n  label: string;\r\n  current: number;\r\n  max: number;\r\n  color: 'red' | 'blue';\r\n  terminalThreshold?: number;\r\n  showControls?: boolean;\r\n  onChange?: (value: number) => void;\r\n}) {\r\n  const percentage = Math.max(0, Math.min(100, (current / max) * 100));\r\n  const isTerminal = terminalThreshold && current <= terminalThreshold && current > 0;\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-1\">\r\n      <div className=\"flex justify-between text-sm font-medium\">\r\n        <span className=\"text-gray-700\">{label}</span>\r\n        <span className={cn(\r\n          'font-bold',\r\n          isTerminal && 'text-yellow-600',\r\n          current <= 0 && 'text-red-600'\r\n        )}>\r\n          {current} / {max}\r\n        </span>\r\n      </div>\r\n      <div className=\"relative h-6 bg-gray-200 rounded-full overflow-hidden\">\r\n        <div\r\n          className={cn(\r\n            'absolute inset-y-0 left-0 transition-all duration-300',\r\n            color === 'red' ? 'bg-red-500' : 'bg-blue-500',\r\n            isTerminal && 'bg-yellow-500 animate-pulse'\r\n          )}\r\n          style={{ width: `${percentage}%` }}\r\n        />\r\n        {terminalThreshold && (\r\n          <div\r\n            className=\"absolute inset-y-0 w-0.5 bg-yellow-600 opacity-50\"\r\n            style={{ left: `${(terminalThreshold / max) * 100}%` }}\r\n            title={`Terminal: ${terminalThreshold}`}\r\n          />\r\n        )}\r\n      </div>\r\n      {showControls && onChange && (\r\n        <div className=\"flex gap-2 mt-1 items-center justify-center\">\r\n          <button\r\n            onClick={() => onChange(Math.max(0, current - 1))}\r\n            className=\"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold\"\r\n            disabled={current <= 0}\r\n          >\r\n            ‚àí\r\n          </button>\r\n          <input\r\n            type=\"number\"\r\n            value={current}\r\n            onChange={(e) => onChange(Math.max(0, Math.min(max, parseInt(e.target.value) || 0)))}\r\n            className=\"w-16 text-center border rounded px-2 py-1 text-sm\"\r\n            min={0}\r\n            max={max}\r\n          />\r\n          <button\r\n            onClick={() => onChange(Math.min(max, current + 1))}\r\n            className=\"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm font-bold\"\r\n            disabled={current >= max}\r\n          >\r\n            +\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StatBlock({ label, value, subValue }: { label: string; value: number | string; subValue?: string }) {\r\n  return (\r\n    <div className=\"flex flex-col items-center p-2 bg-gray-100 rounded-lg min-w-[60px]\">\r\n      <span className=\"text-xs text-gray-500 uppercase tracking-wide\">{label}</span>\r\n      <span className=\"text-xl font-bold text-gray-800\">{value}</span>\r\n      {subValue && <span className=\"text-xs text-gray-500\">{subValue}</span>}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction DefenseBlock({ name, bonus, score, onRoll }: { name: string; bonus: number; score: number; onRoll?: () => void }) {\r\n  const formattedBonus = bonus >= 0 ? `+${bonus}` : `${bonus}`;\r\n  \r\n  return (\r\n    <div \r\n      onClick={onRoll}\r\n      className={cn(\r\n        \"flex flex-col items-center p-2 bg-white border border-gray-200 rounded-lg min-w-[70px] transition-all\",\r\n        onRoll && \"cursor-pointer hover:bg-teal-50 hover:border-teal-300 active:scale-95\"\r\n      )}\r\n      role={onRoll ? 'button' : undefined}\r\n      title={onRoll ? `Click to roll ${name} save` : undefined}\r\n    >\r\n      <span className=\"text-[10px] text-gray-500 uppercase tracking-wide\">{name}</span>\r\n      <span className=\"text-lg font-bold text-gray-800\">{score}</span>\r\n      <span className=\"text-xs text-gray-500\">{formattedBonus}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SheetHeader({\r\n  character,\r\n  calculatedStats,\r\n  isEditMode = false,\r\n  onHealthChange,\r\n  onEnergyChange,\r\n  onPortraitChange,\r\n  isUploadingPortrait = false,\r\n}: SheetHeaderProps) {\r\n  const currentHealth = character.health?.current ?? calculatedStats.maxHealth;\r\n  const currentEnergy = character.energy?.current ?? calculatedStats.maxEnergy;\r\n  const rollContext = useRollsOptional();\r\n  \r\n  const genderSymbol = character.description?.includes('female') ? '‚ôÄ' : \r\n                       character.description?.includes('male') ? '‚ôÇ' : '';\r\n\r\n  // Check if character can level up (XP >= level * 4)\r\n  const xp = character.experience ?? 0;\r\n  const level = character.level || 1;\r\n  const canLevelUp = xp >= (level * 4);\r\n\r\n  // Handle portrait file selection\r\n  const handlePortraitClick = () => {\r\n    if (!isEditMode || !onPortraitChange) return;\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    input.accept = 'image/*';\r\n    input.onchange = (e) => {\r\n      const file = (e.target as HTMLInputElement).files?.[0];\r\n      if (file) {\r\n        onPortraitChange(file);\r\n      }\r\n    };\r\n    input.click();\r\n  };\r\n\r\n  // Defense names mapping\r\n  const defenseLabels: Record<string, string> = {\r\n    might: 'Might',\r\n    fortitude: 'Fortitude',\r\n    reflex: 'Reflex',\r\n    discernment: 'Discernment',\r\n    mentalFortitude: 'Mental Fort',\r\n    resolve: 'Resolve',\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4\">\r\n      <div className=\"flex flex-col lg:flex-row gap-6\">\r\n        {/* Portrait and Identity */}\r\n        <div className=\"flex gap-4\">\r\n          <div \r\n            className={cn(\r\n              \"relative w-24 h-24 md:w-32 md:h-32 rounded-lg overflow-hidden bg-gray-200 flex-shrink-0\",\r\n              isEditMode && onPortraitChange && \"cursor-pointer group\"\r\n            )}\r\n            onClick={handlePortraitClick}\r\n            title={isEditMode && onPortraitChange ? \"Click to change portrait\" : undefined}\r\n          >\r\n            <Image\r\n              src={character.portrait || '/images/placeholder-portrait.png'}\r\n              alt={character.name}\r\n              fill\r\n              className={cn(\r\n                \"object-cover transition-opacity\",\r\n                isUploadingPortrait && \"opacity-50\"\r\n              )}\r\n              sizes=\"(max-width: 768px) 96px, 128px\"\r\n            />\r\n            {/* Upload overlay in edit mode */}\r\n            {isEditMode && onPortraitChange && (\r\n              <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center\">\r\n                <span className=\"text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl\">\r\n                  üì∑\r\n                </span>\r\n              </div>\r\n            )}\r\n            {/* Loading spinner */}\r\n            {isUploadingPortrait && (\r\n              <div className=\"absolute inset-0 flex items-center justify-center bg-black/30\">\r\n                <div className=\"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n          \r\n          <div className=\"flex flex-col justify-center\">\r\n            <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">\r\n              {character.name}\r\n              {genderSymbol && <span className=\"ml-2 text-gray-400\">{genderSymbol}</span>}\r\n            </h1>\r\n            <p className=\"text-gray-600\">\r\n              Level {character.level} {character.ancestry?.name || 'Unknown Ancestry'}\r\n            </p>\r\n            <p className=\"text-gray-500 text-sm\">\r\n              {character.archetype?.name || 'No Archetype'}\r\n            </p>\r\n            {/* XP Display with Level Up indicator */}\r\n            <p className=\"text-gray-500 text-sm flex items-center gap-1\">\r\n              <span>XP: {character.experience ?? 0}</span>\r\n              {canLevelUp && (\r\n                <span \r\n                  className=\"text-green-600 animate-pulse\" \r\n                  title=\"Ready to level up!\"\r\n                >\r\n                  ‚¨Ü\r\n                </span>\r\n              )}\r\n              {canLevelUp && (\r\n                <span className=\"text-xs text-green-600\">(Level up available!)</span>\r\n              )}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Core Stats */}\r\n        <div className=\"flex flex-wrap gap-2 items-start\">\r\n          <StatBlock label=\"Speed\" value={calculatedStats.speed} />\r\n          <StatBlock label=\"Evasion\" value={calculatedStats.evasion} />\r\n          <StatBlock label=\"Armor\" value={calculatedStats.armor} />\r\n          {character.innateEnergy !== undefined && character.innateEnergy > 0 && (\r\n            <StatBlock label=\"Innate\" value={character.innateEnergy} />\r\n          )}\r\n        </div>\r\n\r\n        {/* Resources - always show +/- controls */}\r\n        <div className=\"flex-1 space-y-3 min-w-[200px]\">\r\n          <ResourceBar\r\n            label=\"Health\"\r\n            current={currentHealth}\r\n            max={calculatedStats.maxHealth}\r\n            color=\"red\"\r\n            terminalThreshold={calculatedStats.terminal}\r\n            showControls={true}\r\n            onChange={onHealthChange}\r\n          />\r\n          <ResourceBar\r\n            label=\"Energy\"\r\n            current={currentEnergy}\r\n            max={calculatedStats.maxEnergy}\r\n            color=\"blue\"\r\n            showControls={true}\r\n            onChange={onEnergyChange}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Defenses */}\r\n      <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n        <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2\">\r\n          Defenses\r\n        </h3>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {Object.entries(defenseLabels).map(([key, label]) => {\r\n            const bonus = calculatedStats.defenseBonuses[key] ?? 0;\r\n            return (\r\n              <DefenseBlock\r\n                key={key}\r\n                name={label}\r\n                bonus={bonus}\r\n                score={calculatedStats.defenseScores[key] ?? 10}\r\n                onRoll={rollContext ? () => rollContext.rollDefense(label, bonus) : undefined}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Abilities Section\r\n * =================\r\n * Displays and manages the six core ability scores\r\n * Clicking an ability in view mode rolls a d20 + modifier\r\n */\r\n\r\n'use client';\r\n\r\nimport { cn } from '@/lib/utils';\r\nimport { useRollsOptional } from './roll-context';\r\nimport type { Abilities, AbilityName } from '@/types';\r\n\r\ninterface AbilitiesSectionProps {\r\n  abilities: Abilities;\r\n  archetypeAbility?: AbilityName;\r\n  martialAbility?: AbilityName;\r\n  powerAbility?: AbilityName;\r\n  isEditMode?: boolean;\r\n  availablePoints?: number;\r\n  onAbilityChange?: (ability: AbilityName, value: number) => void;\r\n}\r\n\r\nconst ABILITY_INFO: Record<AbilityName, { name: string; description: string; defenseLink: string }> = {\r\n  strength: { \r\n    name: 'Strength', \r\n    description: 'Physical power and melee attacks',\r\n    defenseLink: 'Might'\r\n  },\r\n  vitality: { \r\n    name: 'Vitality', \r\n    description: 'Health and endurance',\r\n    defenseLink: 'Fortitude'\r\n  },\r\n  agility: { \r\n    name: 'Agility', \r\n    description: 'Speed, dexterity, and finesse',\r\n    defenseLink: 'Reflex'\r\n  },\r\n  acuity: { \r\n    name: 'Acuity', \r\n    description: 'Perception and awareness',\r\n    defenseLink: 'Discernment'\r\n  },\r\n  intelligence: { \r\n    name: 'Intelligence', \r\n    description: 'Knowledge and reasoning',\r\n    defenseLink: 'Mental Fortitude'\r\n  },\r\n  charisma: { \r\n    name: 'Charisma', \r\n    description: 'Force of personality',\r\n    defenseLink: 'Resolve'\r\n  },\r\n};\r\n\r\nfunction AbilityCard({\r\n  ability,\r\n  value,\r\n  info,\r\n  isArchetypeAbility,\r\n  isMartialAbility,\r\n  isPowerAbility,\r\n  isEditMode,\r\n  onIncrease,\r\n  onDecrease,\r\n  onRoll,\r\n}: {\r\n  ability: AbilityName;\r\n  value: number;\r\n  info: typeof ABILITY_INFO[AbilityName];\r\n  isArchetypeAbility?: boolean;\r\n  isMartialAbility?: boolean;\r\n  isPowerAbility?: boolean;\r\n  isEditMode?: boolean;\r\n  onIncrease?: () => void;\r\n  onDecrease?: () => void;\r\n  onRoll?: () => void;\r\n}) {\r\n  const formattedValue = value >= 0 ? `+${value}` : `${value}`;\r\n  \r\n  // Determine border color based on ability role\r\n  let borderClass = 'border-gray-200';\r\n  let badgeClass = '';\r\n  \r\n  if (isArchetypeAbility) {\r\n    borderClass = 'border-amber-400 border-2';\r\n    badgeClass = 'bg-amber-100 text-amber-700';\r\n  } else if (isPowerAbility) {\r\n    borderClass = 'border-purple-400 border-2';\r\n    badgeClass = 'bg-purple-100 text-purple-700';\r\n  } else if (isMartialAbility) {\r\n    borderClass = 'border-red-400 border-2';\r\n    badgeClass = 'bg-red-100 text-red-700';\r\n  }\r\n\r\n  // Handle click - roll dice when not in edit mode\r\n  const handleClick = () => {\r\n    if (!isEditMode && onRoll) {\r\n      onRoll();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      onClick={handleClick}\r\n      className={cn(\r\n        'relative flex flex-col items-center p-4 bg-white rounded-xl shadow-sm border transition-all',\r\n        borderClass,\r\n        isEditMode && 'hover:shadow-md',\r\n        !isEditMode && onRoll && 'cursor-pointer hover:bg-gray-50 hover:shadow-md active:scale-95'\r\n      )}\r\n      role={!isEditMode && onRoll ? 'button' : undefined}\r\n      title={!isEditMode && onRoll ? `Click to roll ${info.name} check` : undefined}\r\n    >\r\n      {/* Role badge */}\r\n      {(isArchetypeAbility || isMartialAbility || isPowerAbility) && (\r\n        <div className={cn('absolute -top-2 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase', badgeClass)}>\r\n          {isArchetypeAbility ? 'Archetype' : isPowerAbility ? 'Power' : 'Martial'}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Ability name */}\r\n      <span className=\"text-xs text-gray-500 uppercase tracking-wider mt-1\">\r\n        {info.name}\r\n      </span>\r\n      \r\n      {/* Value */}\r\n      <div className=\"flex items-center gap-2 my-2\">\r\n        {isEditMode && (\r\n          <button\r\n            onClick={onDecrease}\r\n            className=\"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600\"\r\n          >\r\n            ‚àí\r\n          </button>\r\n        )}\r\n        <span className={cn(\r\n          'text-3xl font-bold',\r\n          value > 0 ? 'text-green-600' : value < 0 ? 'text-red-600' : 'text-gray-700'\r\n        )}>\r\n          {formattedValue}\r\n        </span>\r\n        {isEditMode && (\r\n          <button\r\n            onClick={onIncrease}\r\n            className=\"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-lg font-bold text-gray-600\"\r\n          >\r\n            +\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Defense link */}\r\n      <span className=\"text-[10px] text-gray-400\">\r\n        ‚Üí {info.defenseLink}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function AbilitiesSection({\r\n  abilities,\r\n  archetypeAbility,\r\n  martialAbility,\r\n  powerAbility,\r\n  isEditMode = false,\r\n  availablePoints,\r\n  onAbilityChange,\r\n}: AbilitiesSectionProps) {\r\n  const abilityOrder: AbilityName[] = ['strength', 'vitality', 'agility', 'acuity', 'intelligence', 'charisma'];\r\n  const rollContext = useRollsOptional();\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-md p-4 md:p-6 mb-4\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-lg font-bold text-gray-800\">Abilities</h2>\r\n        {isEditMode && availablePoints !== undefined && (\r\n          <span className={cn(\r\n            'px-3 py-1 rounded-full text-sm font-medium',\r\n            availablePoints > 0 ? 'bg-green-100 text-green-700' : \r\n            availablePoints < 0 ? 'bg-red-100 text-red-700' : \r\n            'bg-gray-100 text-gray-600'\r\n          )}>\r\n            {availablePoints} points\r\n          </span>\r\n        )}\r\n      </div>\r\n      \r\n      <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3\">\r\n        {abilityOrder.map((ability) => (\r\n          <AbilityCard\r\n            key={ability}\r\n            ability={ability}\r\n            value={abilities[ability] ?? 0}\r\n            info={ABILITY_INFO[ability]}\r\n            isArchetypeAbility={archetypeAbility?.toLowerCase() === ability}\r\n            isMartialAbility={martialAbility?.toLowerCase() === ability}\r\n            isPowerAbility={powerAbility?.toLowerCase() === ability}\r\n            isEditMode={isEditMode}\r\n            onIncrease={() => onAbilityChange?.(ability, (abilities[ability] ?? 0) + 1)}\r\n            onDecrease={() => onAbilityChange?.(ability, (abilities[ability] ?? 0) - 1)}\r\n            onRoll={rollContext ? () => rollContext.rollAbility(ability, abilities[ability] ?? 0) : undefined}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Skills Section\r\n * ==============\r\n * Displays character skills organized by category\r\n * Clicking a skill in view mode rolls a d20 + skill bonus\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Plus } from 'lucide-react';\r\nimport { useRollsOptional } from './roll-context';\r\nimport type { Abilities } from '@/types';\r\n\r\ninterface Skill {\r\n  id: string;\r\n  name: string;\r\n  category?: string;\r\n  skill_val: number;\r\n  prof?: boolean;\r\n  baseSkill?: string;\r\n}\r\n\r\ninterface SkillsSectionProps {\r\n  skills: Skill[];\r\n  abilities: Abilities;\r\n  isEditMode?: boolean;\r\n  onSkillChange?: (skillId: string, updates: Partial<Skill>) => void;\r\n  onAddSkill?: () => void;\r\n  onAddSubSkill?: () => void;\r\n}\r\n\r\nconst SKILL_CATEGORIES = [\r\n  { id: 'combat', name: 'Combat', icon: '‚öîÔ∏è' },\r\n  { id: 'physical', name: 'Physical', icon: 'üèÉ' },\r\n  { id: 'knowledge', name: 'Knowledge', icon: 'üìö' },\r\n  { id: 'social', name: 'Social', icon: 'üí¨' },\r\n  { id: 'other', name: 'Other', icon: '‚≠ê' },\r\n];\r\n\r\nfunction SkillRow({\r\n  skill,\r\n  isEditMode,\r\n  onToggleProf,\r\n  onValueChange,\r\n  onRoll,\r\n}: {\r\n  skill: Skill;\r\n  isEditMode?: boolean;\r\n  onToggleProf?: () => void;\r\n  onValueChange?: (value: number) => void;\r\n  onRoll?: () => void;\r\n}) {\r\n  const isSubSkill = Boolean(skill.baseSkill);\r\n  const totalBonus = skill.skill_val + (skill.prof ? 1 : 0);\r\n  const formattedBonus = totalBonus >= 0 ? `+${totalBonus}` : `${totalBonus}`;\r\n\r\n  // Handle row click for rolling\r\n  const handleRowClick = (e: React.MouseEvent) => {\r\n    // Don't roll if clicking on proficiency toggle or value buttons\r\n    if (isEditMode) return;\r\n    if ((e.target as HTMLElement).closest('button')) return;\r\n    onRoll?.();\r\n  };\r\n\r\n  return (\r\n    <div\r\n      onClick={handleRowClick}\r\n      className={cn(\r\n        'flex items-center justify-between py-2 px-3 rounded-lg transition-colors',\r\n        isSubSkill ? 'ml-4 bg-gray-50' : 'bg-white',\r\n        isEditMode && 'hover:bg-gray-100',\r\n        !isEditMode && onRoll && 'cursor-pointer hover:bg-blue-50 active:bg-blue-100'\r\n      )}\r\n      role={!isEditMode && onRoll ? 'button' : undefined}\r\n      title={!isEditMode && onRoll ? `Click to roll ${skill.name}` : undefined}\r\n    >\r\n      <div className=\"flex items-center gap-2\">\r\n        {!isSubSkill && (\r\n          <button\r\n            onClick={onToggleProf}\r\n            disabled={!isEditMode}\r\n            className={cn(\r\n              'w-4 h-4 rounded-full border-2 transition-colors',\r\n              skill.prof \r\n                ? 'bg-primary-600 border-primary-600' \r\n                : 'bg-white border-gray-300',\r\n              isEditMode && 'cursor-pointer hover:border-primary-400'\r\n            )}\r\n            title={skill.prof ? 'Proficient' : 'Not proficient'}\r\n          />\r\n        )}\r\n        <span className={cn(\r\n          'text-sm',\r\n          isSubSkill ? 'text-gray-500 italic' : 'text-gray-700 font-medium'\r\n        )}>\r\n          {isSubSkill && '‚îî '}\r\n          {skill.name}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-2\">\r\n        {isEditMode ? (\r\n          <div className=\"flex items-center gap-1\">\r\n            <button\r\n              onClick={() => onValueChange?.(skill.skill_val - 1)}\r\n              className=\"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm\"\r\n              disabled={skill.skill_val <= 0}\r\n            >\r\n              ‚àí\r\n            </button>\r\n            <span className=\"w-8 text-center font-mono\">{skill.skill_val}</span>\r\n            <button\r\n              onClick={() => onValueChange?.(skill.skill_val + 1)}\r\n              className=\"w-6 h-6 rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-sm\"\r\n            >\r\n              +\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <span className={cn(\r\n            'font-bold min-w-[40px] text-right',\r\n            totalBonus > 0 ? 'text-green-600' : totalBonus < 0 ? 'text-red-600' : 'text-gray-600'\r\n          )}>\r\n            {formattedBonus}\r\n          </span>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SkillsSection({\r\n  skills,\r\n  abilities,\r\n  isEditMode = false,\r\n  onSkillChange,\r\n  onAddSkill,\r\n  onAddSubSkill,\r\n}: SkillsSectionProps) {\r\n  const [expandedCategory, setExpandedCategory] = useState<string | null>(null);\r\n  const rollContext = useRollsOptional();\r\n\r\n  // Group skills by category\r\n  const skillsByCategory = SKILL_CATEGORIES.reduce((acc, cat) => {\r\n    acc[cat.id] = skills.filter(s => \r\n      (s.category?.toLowerCase() || 'other') === cat.id\r\n    );\r\n    return acc;\r\n  }, {} as Record<string, Skill[]>);\r\n\r\n  // Calculate total skill points spent\r\n  const totalSpent = skills.reduce((sum, skill) => {\r\n    return sum + skill.skill_val + (skill.prof ? 1 : 0);\r\n  }, 0);\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-md p-4 md:p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-lg font-bold text-gray-800\">Skills</h2>\r\n        <div className=\"flex items-center gap-2\">\r\n          {isEditMode && (\r\n            <>\r\n              <button\r\n                onClick={onAddSkill}\r\n                className=\"flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-100 hover:bg-emerald-200 text-emerald-700 text-sm font-medium transition-colors\"\r\n                title=\"Add Skill\"\r\n              >\r\n                <Plus size={14} />\r\n                Skill\r\n              </button>\r\n              <button\r\n                onClick={onAddSubSkill}\r\n                className=\"flex items-center gap-1 px-2 py-1 rounded-md bg-teal-100 hover:bg-teal-200 text-teal-700 text-sm font-medium transition-colors\"\r\n                title=\"Add Sub-Skill\"\r\n              >\r\n                <Plus size={14} />\r\n                Sub-Skill\r\n              </button>\r\n              <span className=\"px-3 py-1 rounded-full bg-gray-100 text-gray-600 text-sm\">\r\n                {totalSpent} points spent\r\n              </span>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        {SKILL_CATEGORIES.map((category) => {\r\n          const categorySkills = skillsByCategory[category.id] || [];\r\n          if (categorySkills.length === 0) return null;\r\n\r\n          const isExpanded = expandedCategory === category.id || expandedCategory === null;\r\n\r\n          return (\r\n            <div key={category.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n              <button\r\n                onClick={() => setExpandedCategory(\r\n                  expandedCategory === category.id ? null : category.id\r\n                )}\r\n                className=\"w-full flex items-center justify-between px-4 py-2 bg-gray-50 hover:bg-gray-100 transition-colors\"\r\n              >\r\n                <span className=\"flex items-center gap-2 font-medium text-gray-700\">\r\n                  <span>{category.icon}</span>\r\n                  {category.name}\r\n                  <span className=\"text-xs text-gray-400\">({categorySkills.length})</span>\r\n                </span>\r\n                <span className={cn(\r\n                  'transition-transform',\r\n                  isExpanded ? 'rotate-180' : ''\r\n                )}>\r\n                  ‚ñº\r\n                </span>\r\n              </button>\r\n\r\n              {isExpanded && (\r\n                <div className=\"divide-y divide-gray-100\">\r\n                  {categorySkills.map((skill) => {\r\n                    const totalBonus = skill.skill_val + (skill.prof ? 1 : 0);\r\n                    return (\r\n                      <SkillRow\r\n                        key={skill.id}\r\n                        skill={skill}\r\n                        isEditMode={isEditMode}\r\n                        onToggleProf={() => onSkillChange?.(skill.id, { prof: !skill.prof })}\r\n                        onValueChange={(val) => onSkillChange?.(skill.id, { skill_val: val })}\r\n                        onRoll={rollContext ? () => rollContext.rollSkill(skill.name, totalBonus) : undefined}\r\n                      />\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Archetype Section\r\n * =================\r\n * Displays character archetype, proficiencies, and feats\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Plus } from 'lucide-react';\r\nimport type { Character, CharacterFeat } from '@/types';\r\n\r\ninterface ArchetypeSectionProps {\r\n  character: Character;\r\n  isEditMode?: boolean;\r\n  onFeatUse?: (featId: string, currentUses: number) => void;\r\n  onAddArchetypeFeat?: () => void;\r\n  onAddCharacterFeat?: () => void;\r\n}\r\n\r\nfunction ProficiencyMeter({ \r\n  label, \r\n  value, \r\n  maxValue = 6,\r\n  color = 'blue' \r\n}: { \r\n  label: string; \r\n  value: number; \r\n  maxValue?: number;\r\n  color?: 'blue' | 'purple' | 'red';\r\n}) {\r\n  const colorClasses = {\r\n    blue: 'bg-blue-500',\r\n    purple: 'bg-purple-500',\r\n    red: 'bg-red-500',\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-1\">\r\n      <div className=\"flex justify-between text-sm\">\r\n        <span className=\"text-gray-600\">{label}</span>\r\n        <span className=\"font-bold\">{value}</span>\r\n      </div>\r\n      <div className=\"flex gap-1\">\r\n        {Array.from({ length: maxValue }).map((_, i) => (\r\n          <div\r\n            key={i}\r\n            className={cn(\r\n              'h-2 flex-1 rounded-full',\r\n              i < value ? colorClasses[color] : 'bg-gray-200'\r\n            )}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FeatCard({ \r\n  feat, \r\n  isEditMode,\r\n  onUse \r\n}: { \r\n  feat: CharacterFeat; \r\n  isEditMode?: boolean;\r\n  onUse?: () => void;\r\n}) {\r\n  const [expanded, setExpanded] = useState(false);\r\n  const hasUsesRemaining = feat.maxUses && (feat.currentUses ?? feat.maxUses) > 0;\r\n\r\n  return (\r\n    <div \r\n      className={cn(\r\n        'border border-gray-200 rounded-lg overflow-hidden transition-all',\r\n        expanded && 'shadow-md'\r\n      )}\r\n    >\r\n      <button\r\n        onClick={() => setExpanded(!expanded)}\r\n        className=\"w-full flex items-center justify-between px-3 py-2 bg-white hover:bg-gray-50 text-left\"\r\n      >\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"font-medium text-gray-800\">{feat.name}</span>\r\n          {feat.type && (\r\n            <span className={cn(\r\n              'text-xs px-1.5 py-0.5 rounded',\r\n              feat.type === 'archetype' ? 'bg-amber-100 text-amber-700' : 'bg-gray-100 text-gray-600'\r\n            )}>\r\n              {feat.type}\r\n            </span>\r\n          )}\r\n        </div>\r\n        {feat.maxUses && (\r\n          <span className={cn(\r\n            'text-sm font-medium',\r\n            hasUsesRemaining ? 'text-green-600' : 'text-gray-400'\r\n          )}>\r\n            {feat.currentUses ?? feat.maxUses}/{feat.maxUses}\r\n          </span>\r\n        )}\r\n      </button>\r\n\r\n      {expanded && (\r\n        <div className=\"px-3 py-2 bg-gray-50 border-t border-gray-100\">\r\n          <p className=\"text-sm text-gray-600 mb-2\">\r\n            {feat.description || 'No description available.'}\r\n          </p>\r\n          \r\n          {feat.maxUses && isEditMode && (\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onUse?.();\r\n              }}\r\n              disabled={!hasUsesRemaining}\r\n              className={cn(\r\n                'px-3 py-1 rounded text-sm font-medium transition-colors',\r\n                hasUsesRemaining \r\n                  ? 'bg-primary-600 text-white hover:bg-primary-700'\r\n                  : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n              )}\r\n            >\r\n              Use Ability\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function ArchetypeSection({\r\n  character,\r\n  isEditMode = false,\r\n  onFeatUse,\r\n  onAddArchetypeFeat,\r\n  onAddCharacterFeat,\r\n}: ArchetypeSectionProps) {\r\n  const martialProf = character.martialProficiency ?? 0;\r\n  const powerProf = character.powerProficiency ?? 0;\r\n  \r\n  // Combine archetype and character feats\r\n  const allFeats = [\r\n    ...(character.archetypeFeats || []).map(f => ({ ...f, type: 'archetype' as const })),\r\n    ...(character.feats || []).map(f => ({ ...f, type: 'character' as const })),\r\n  ];\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-md p-4 md:p-6\">\r\n      {/* Archetype Header */}\r\n      <div className=\"mb-4\">\r\n        <h2 className=\"text-lg font-bold text-gray-800\">\r\n          {character.archetype?.name || 'No Archetype'}\r\n        </h2>\r\n        {character.archetype?.description && (\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            {character.archetype.description}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Proficiencies */}\r\n      <div className=\"grid grid-cols-2 gap-4 mb-6\">\r\n        <ProficiencyMeter \r\n          label=\"Martial\" \r\n          value={martialProf}\r\n          color=\"red\"\r\n        />\r\n        <ProficiencyMeter \r\n          label=\"Power\" \r\n          value={powerProf}\r\n          color=\"purple\"\r\n        />\r\n      </div>\r\n\r\n      {/* Abilities used */}\r\n      <div className=\"flex flex-wrap gap-2 mb-4\">\r\n        {character.mart_abil && (\r\n          <span className=\"px-2 py-1 bg-red-100 text-red-700 rounded text-sm\">\r\n            Martial: {character.mart_abil}\r\n          </span>\r\n        )}\r\n        {character.pow_abil && (\r\n          <span className=\"px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm\">\r\n            Power: {character.pow_abil}\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Feats */}\r\n      <div className=\"border-t border-gray-200 pt-4\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide\">\r\n            Feats ({allFeats.length})\r\n          </h3>\r\n          {isEditMode && (\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={onAddArchetypeFeat}\r\n                className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded hover:bg-amber-200 transition-colors\"\r\n              >\r\n                <Plus className=\"w-3 h-3\" />\r\n                Archetype\r\n              </button>\r\n              <button\r\n                onClick={onAddCharacterFeat}\r\n                className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors\"\r\n              >\r\n                <Plus className=\"w-3 h-3\" />\r\n                Character\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {allFeats.length > 0 ? (\r\n          <div className=\"space-y-2\">\r\n            {allFeats.map((feat, index) => (\r\n              <FeatCard\r\n                key={feat.id || index}\r\n                feat={feat}\r\n                isEditMode={isEditMode}\r\n                onUse={() => onFeatUse?.(String(feat.id), (feat.currentUses ?? feat.maxUses ?? 1) - 1)}\r\n              />\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-gray-400 text-sm italic\">No feats selected</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Notes Tab\r\n * =========\r\n * Physical attributes, movement calculations, and character notes\r\n * Matches vanilla site's notes functionality\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useRollsOptional } from './roll-context';\r\nimport type { Abilities } from '@/types';\r\n\r\ninterface NotesTabProps {\r\n  weight: number;\r\n  height: number;\r\n  appearance: string;\r\n  archetypeDesc: string;\r\n  notes: string;\r\n  abilities: Abilities;\r\n  isEditMode?: boolean;\r\n  onWeightChange?: (value: number) => void;\r\n  onHeightChange?: (value: number) => void;\r\n  onAppearanceChange?: (value: string) => void;\r\n  onArchetypeDescChange?: (value: string) => void;\r\n  onNotesChange?: (value: string) => void;\r\n}\r\n\r\nexport function NotesTab({\r\n  weight = 70,\r\n  height = 170,\r\n  appearance = '',\r\n  archetypeDesc = '',\r\n  notes = '',\r\n  abilities,\r\n  isEditMode = false,\r\n  onWeightChange,\r\n  onHeightChange,\r\n  onAppearanceChange,\r\n  onArchetypeDescChange,\r\n  onNotesChange,\r\n}: NotesTabProps) {\r\n  const rollContext = useRollsOptional();\r\n  \r\n  // Local state for editing\r\n  const [weightInput, setWeightInput] = useState(weight.toString());\r\n  const [heightInput, setHeightInput] = useState(height.toString());\r\n\r\n  // Get abilities for movement calculations\r\n  const strength = abilities.strength || 0;\r\n  const agility = abilities.agility || 0;\r\n  const vitality = abilities.vitality || 0;\r\n\r\n  // Helpers\r\n  const pluralize = (n: number, s: string, p: string) => (n === 1 ? `${n} ${s}` : `${n} ${p}`);\r\n  const upMin1 = (v: number) => Math.max(1, Math.ceil(v));\r\n\r\n  // Calculate movement values (round up, minimum 1)\r\n  const jumpHorizontal = upMin1(Math.max(strength, agility));\r\n  const jumpVertical = upMin1(Math.max(strength, agility) / 2);\r\n  const climbSpeed = upMin1(strength / 2);\r\n  const swimSpeed = upMin1(Math.max(strength, vitality) / 2);\r\n\r\n  // Calculate fall damage\r\n  const weightCategory = Math.max(200, Math.ceil(weight / 200) * 200);\r\n  const fallDiceCount = Math.min(Math.ceil(weight / 200) || 1, 4); // 1..4\r\n  const fallDice = `${fallDiceCount}d4`;\r\n\r\n  const handleRollFallDamage = useCallback(() => {\r\n    if (rollContext) {\r\n      rollContext.rollDamage(fallDice);\r\n    }\r\n  }, [rollContext, fallDice]);\r\n\r\n  const handleWeightBlur = () => {\r\n    const value = parseInt(weightInput) || 70;\r\n    if (value !== weight && onWeightChange) {\r\n      onWeightChange(value);\r\n    }\r\n  };\r\n\r\n  const handleHeightBlur = () => {\r\n    const value = parseInt(heightInput) || 170;\r\n    if (value !== height && onHeightChange) {\r\n      onHeightChange(value);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Physical Attributes & Movement */}\r\n      <div>\r\n        <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2\">\r\n          Physical Attributes & Movement\r\n        </h3>\r\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n            {/* Weight */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Weight</span>\r\n              {isEditMode && onWeightChange ? (\r\n                <div className=\"flex items-center gap-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    value={weightInput}\r\n                    onChange={(e) => setWeightInput(e.target.value)}\r\n                    onBlur={handleWeightBlur}\r\n                    className=\"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-500\">kg</span>\r\n                </div>\r\n              ) : (\r\n                <span className=\"text-sm text-gray-600\">{weight} kg</span>\r\n              )}\r\n            </div>\r\n\r\n            {/* Height */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Height</span>\r\n              {isEditMode && onHeightChange ? (\r\n                <div className=\"flex items-center gap-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    value={heightInput}\r\n                    onChange={(e) => setHeightInput(e.target.value)}\r\n                    onBlur={handleHeightBlur}\r\n                    className=\"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-primary-500\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-500\">cm</span>\r\n                </div>\r\n              ) : (\r\n                <span className=\"text-sm text-gray-600\">{height} cm</span>\r\n              )}\r\n            </div>\r\n\r\n            {/* Jump - Horizontal */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Jump - Horizontal</span>\r\n              <span className=\"text-sm text-gray-600\">{pluralize(jumpHorizontal, 'space', 'spaces')}</span>\r\n            </div>\r\n\r\n            {/* Jump - Vertical */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Jump - Vertical</span>\r\n              <span className=\"text-sm text-gray-600\">{pluralize(jumpVertical, 'space', 'spaces')}</span>\r\n            </div>\r\n\r\n            {/* Climb Speed */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Climb Speed</span>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"text-sm text-gray-600\">{pluralize(climbSpeed, 'space', 'spaces')}</span>\r\n                <span className=\"text-xs text-gray-400\">Requires successful Athletics roll</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Swim Speed */}\r\n            <div className=\"flex flex-col gap-1\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Swim Speed</span>\r\n              <div className=\"flex flex-col\">\r\n                <span className=\"text-sm text-gray-600\">{pluralize(swimSpeed, 'space', 'spaces')}</span>\r\n                <span className=\"text-xs text-gray-400\">DC 10 Acrobatics or Athletics (Vitality)</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Fall Damage */}\r\n            <div className=\"flex flex-col gap-1 col-span-2 md:col-span-3\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">Fall Damage</span>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  onClick={handleRollFallDamage}\r\n                  disabled={!rollContext}\r\n                  className=\"px-2 py-1 text-sm font-bold bg-gradient-to-b from-gray-50 to-indigo-50 border border-indigo-200 rounded-lg hover:shadow-sm transition-all disabled:opacity-50\"\r\n                  title={rollContext ? 'Click to roll' : 'Roll log not available'}\r\n                >\r\n                  {fallDice}\r\n                </button>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  bludgeoning per 2 spaces fallen ({weightCategory}kg weight category)\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Appearance */}\r\n      <div>\r\n        <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2\">\r\n          Appearance\r\n        </h3>\r\n        <textarea\r\n          value={appearance}\r\n          onChange={(e) => onAppearanceChange?.(e.target.value)}\r\n          readOnly={!isEditMode}\r\n          placeholder=\"Describe your character's appearance...\"\r\n          className=\"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50\"\r\n          disabled={!isEditMode}\r\n        />\r\n      </div>\r\n\r\n      {/* Archetype Description */}\r\n      <div>\r\n        <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2\">\r\n          Archetype Description\r\n        </h3>\r\n        <textarea\r\n          value={archetypeDesc}\r\n          onChange={(e) => onArchetypeDescChange?.(e.target.value)}\r\n          readOnly={!isEditMode}\r\n          placeholder=\"Describe your character's archetype background...\"\r\n          className=\"w-full min-h-[80px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50\"\r\n          disabled={!isEditMode}\r\n        />\r\n      </div>\r\n\r\n      {/* Notes */}\r\n      <div>\r\n        <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2\">\r\n          Notes\r\n        </h3>\r\n        <textarea\r\n          value={notes}\r\n          onChange={(e) => onNotesChange?.(e.target.value)}\r\n          readOnly={!isEditMode}\r\n          placeholder=\"Additional notes, backstory, goals...\"\r\n          className=\"w-full min-h-[120px] px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 resize-y disabled:bg-gray-50\"\r\n          disabled={!isEditMode}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Proficiencies Tab\r\n * =================\r\n * Shows training points and proficiencies extracted from powers, techniques, and equipment\r\n * Matches vanilla site's proficiencies functionality\r\n */\r\n\r\n'use client';\r\n\r\nimport { useMemo } from 'react';\r\nimport type { CharacterPower, CharacterTechnique, Item } from '@/types';\r\n\r\ninterface ProficiencyData {\r\n  name: string;\r\n  description?: string;\r\n  baseTP: number;\r\n  op1Lvl: number;\r\n  op1TP: number;\r\n  op2Lvl?: number;\r\n  op2TP?: number;\r\n  op3Lvl?: number;\r\n  op3TP?: number;\r\n  damageType?: string | null;\r\n}\r\n\r\ninterface ProficienciesTabProps {\r\n  powers: CharacterPower[];\r\n  techniques: CharacterTechnique[];\r\n  weapons: Item[];\r\n  armor: Item[];\r\n  level: number;\r\n  archetypeAbility: number; // The archetype's key ability score value\r\n}\r\n\r\n// Calculate TP for a proficiency\r\nfunction calculateProfTP(prof: ProficiencyData): number {\r\n  const rawTP = (prof.baseTP || 0) +\r\n    (prof.op1TP || 0) * (prof.op1Lvl || 0) +\r\n    (prof.op2TP || 0) * (prof.op2Lvl || 0) +\r\n    (prof.op3TP || 0) * (prof.op3Lvl || 0);\r\n  return Math.floor(rawTP);\r\n}\r\n\r\n// Extract proficiencies from powers (simplified - real version loads from RTDB)\r\nfunction extractPowerProficiencies(powers: CharacterPower[]): Map<string, ProficiencyData> {\r\n  const profs = new Map<string, ProficiencyData>();\r\n  \r\n  powers.forEach(power => {\r\n    if (!power.parts) return;\r\n    \r\n    power.parts.forEach((part) => {\r\n      // Parts can be strings (just names) or objects with full data\r\n      if (typeof part === 'string') {\r\n        // String parts don't have TP data - would need to load from RTDB\r\n        // For now, just list them with 0 TP\r\n        if (!profs.has(part)) {\r\n          profs.set(part, {\r\n            name: part,\r\n            baseTP: 0,\r\n            op1Lvl: 0,\r\n            op1TP: 0,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      \r\n      const partData = part;\r\n      if (!partData.name) return;\r\n      \r\n      const lvl1 = partData.op_1_lvl || 0;\r\n      const lvl2 = partData.op_2_lvl || 0;\r\n      const lvl3 = partData.op_3_lvl || 0;\r\n      const baseTP = partData.base_tp || 0;\r\n      const op1TP = partData.op_1_tp || 0;\r\n      const op2TP = partData.op_2_tp || 0;\r\n      const op3TP = partData.op_3_tp || 0;\r\n      \r\n      const rawTP = baseTP + op1TP * lvl1 + op2TP * lvl2 + op3TP * lvl3;\r\n      if (Math.floor(rawTP) <= 0) return;\r\n      \r\n      const key = partData.name;\r\n      if (profs.has(key)) {\r\n        const ex = profs.get(key)!;\r\n        ex.op1Lvl = Math.max(ex.op1Lvl, lvl1);\r\n        ex.op2Lvl = Math.max(ex.op2Lvl || 0, lvl2);\r\n        ex.op3Lvl = Math.max(ex.op3Lvl || 0, lvl3);\r\n      } else {\r\n        profs.set(key, {\r\n          name: partData.name,\r\n          baseTP,\r\n          op1Lvl: lvl1,\r\n          op1TP,\r\n          op2Lvl: lvl2,\r\n          op2TP,\r\n          op3Lvl: lvl3,\r\n          op3TP,\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return profs;\r\n}\r\n\r\n// Extract proficiencies from techniques\r\nfunction extractTechniqueProficiencies(techniques: CharacterTechnique[]): Map<string, ProficiencyData> {\r\n  const profs = new Map<string, ProficiencyData>();\r\n  \r\n  techniques.forEach(tech => {\r\n    if (!tech.parts) return;\r\n    \r\n    tech.parts.forEach((part) => {\r\n      // Parts can be strings (just names) or objects with full data\r\n      if (typeof part === 'string') {\r\n        // String parts don't have TP data - would need to load from RTDB\r\n        if (!profs.has(part)) {\r\n          profs.set(part, {\r\n            name: part,\r\n            baseTP: 0,\r\n            op1Lvl: 0,\r\n            op1TP: 0,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      \r\n      const partData = part;\r\n      if (!partData.name) return;\r\n      \r\n      const lvl1 = partData.op_1_lvl || 0;\r\n      const lvl2 = partData.op_2_lvl || 0;\r\n      const lvl3 = partData.op_3_lvl || 0;\r\n      const baseTP = partData.base_tp || 0;\r\n      const op1TP = partData.op_1_tp || 0;\r\n      const op2TP = partData.op_2_tp || 0;\r\n      const op3TP = partData.op_3_tp || 0;\r\n      \r\n      const rawTP = baseTP + op1TP * lvl1 + op2TP * lvl2 + op3TP * lvl3;\r\n      if (Math.floor(rawTP) <= 0) return;\r\n      \r\n      const key = partData.name;\r\n      if (profs.has(key)) {\r\n        const ex = profs.get(key)!;\r\n        ex.op1Lvl = Math.max(ex.op1Lvl, lvl1);\r\n        ex.op2Lvl = Math.max(ex.op2Lvl || 0, lvl2);\r\n        ex.op3Lvl = Math.max(ex.op3Lvl || 0, lvl3);\r\n      } else {\r\n        profs.set(key, {\r\n          name: partData.name,\r\n          baseTP,\r\n          op1Lvl: lvl1,\r\n          op1TP,\r\n          op2Lvl: lvl2,\r\n          op2TP,\r\n          op3Lvl: lvl3,\r\n          op3TP,\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return profs;\r\n}\r\n\r\n// Extract proficiencies from weapons/armor properties\r\n// Note: Full TP calculation requires loading property data from RTDB\r\n// For now, just list the property names\r\nfunction extractEquipmentProficiencies(weapons: Item[], armor: Item[]): Map<string, ProficiencyData> {\r\n  const profs = new Map<string, ProficiencyData>();\r\n  const items = [...weapons, ...armor];\r\n  \r\n  items.forEach(item => {\r\n    if (!item.properties) return;\r\n    \r\n    item.properties.forEach((propRef) => {\r\n      // Properties can be strings or objects with name\r\n      const propName = typeof propRef === 'string' \r\n        ? propRef \r\n        : (propRef as { name?: string }).name;\r\n      \r\n      if (!propName) return;\r\n      \r\n      // For now, just list properties without TP data\r\n      // Full TP calculation would require loading from RTDB\r\n      if (!profs.has(propName)) {\r\n        profs.set(propName, {\r\n          name: propName,\r\n          baseTP: 0,\r\n          op1Lvl: 0,\r\n          op1TP: 0,\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return profs;\r\n}\r\n\r\ninterface ProficiencySectionProps {\r\n  title: string;\r\n  profs: Map<string, ProficiencyData>;\r\n}\r\n\r\nfunction ProficiencySection({ title, profs }: ProficiencySectionProps) {\r\n  const totalTP = useMemo(() => {\r\n    let sum = 0;\r\n    profs.forEach(prof => {\r\n      sum += calculateProfTP(prof);\r\n    });\r\n    return sum;\r\n  }, [profs]);\r\n\r\n  return (\r\n    <div className=\"mb-4\">\r\n      <div className=\"flex items-center justify-between px-3 py-2 bg-gray-100 rounded-t-lg border border-gray-200\">\r\n        <span className=\"font-semibold text-sm text-gray-700\">{title}</span>\r\n        <span className=\"text-sm text-gray-500\">\r\n          TP: <span className=\"font-semibold text-primary-600\">{totalTP}</span>\r\n        </span>\r\n      </div>\r\n      \r\n      <div className=\"border border-t-0 border-gray-200 rounded-b-lg p-3\">\r\n        {profs.size === 0 ? (\r\n          <p className=\"text-sm text-gray-400 italic text-center py-2\">No proficiencies</p>\r\n        ) : (\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {Array.from(profs.values()).map((prof, index) => {\r\n              const tp = calculateProfTP(prof);\r\n              let label = prof.name;\r\n              if (prof.damageType) label += ` (${prof.damageType})`;\r\n              if (prof.op1Lvl > 0) label += ` Lvl ${prof.op1Lvl}`;\r\n              \r\n              return (\r\n                <div\r\n                  key={index}\r\n                  className=\"px-2 py-1 text-xs bg-primary-50 text-primary-700 border border-primary-200 rounded-full\"\r\n                  title={prof.description || `${label} - TP: ${tp}`}\r\n                >\r\n                  {label} | {tp} TP\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function ProficienciesTab({\r\n  powers,\r\n  techniques,\r\n  weapons,\r\n  armor,\r\n  level,\r\n  archetypeAbility,\r\n}: ProficienciesTabProps) {\r\n  // Extract all proficiencies\r\n  const powerProfs = useMemo(() => extractPowerProficiencies(powers), [powers]);\r\n  const techniqueProfs = useMemo(() => extractTechniqueProficiencies(techniques), [techniques]);\r\n  const weaponProfs = useMemo(() => extractEquipmentProficiencies(weapons, []), [weapons]);\r\n  const armorProfs = useMemo(() => extractEquipmentProficiencies([], armor), [armor]);\r\n\r\n  // Calculate total TP spent\r\n  const totalSpent = useMemo(() => {\r\n    let sum = 0;\r\n    [powerProfs, techniqueProfs, weaponProfs, armorProfs].forEach(profs => {\r\n      profs.forEach(prof => {\r\n        sum += calculateProfTP(prof);\r\n      });\r\n    });\r\n    return sum;\r\n  }, [powerProfs, techniqueProfs, weaponProfs, armorProfs]);\r\n\r\n  // Calculate available training points\r\n  // Formula: 22 + (archetype_ability * level) + (2 * (level - 1)) - total_spent\r\n  const baseTP = 22;\r\n  const trainingPoints = baseTP + (archetypeAbility * level) + (2 * (level - 1)) - totalSpent;\r\n\r\n  return (\r\n    <div>\r\n      {/* Training Points Box */}\r\n      <div className=\"flex justify-center mb-6\">\r\n        <div className=\"px-8 py-4 bg-gray-50 border border-gray-200 rounded-xl shadow-sm\">\r\n          <div className=\"text-center\">\r\n            <span className=\"text-lg font-semibold text-gray-600\">Training Points: </span>\r\n            <span className={`text-2xl font-bold ${trainingPoints >= 0 ? 'text-primary-600' : 'text-red-600'}`}>\r\n              {trainingPoints}\r\n            </span>\r\n          </div>\r\n          <div className=\"text-xs text-gray-400 text-center mt-1\">\r\n            {baseTP} base + ({archetypeAbility} √ó {level}) + {2 * (level - 1)} bonus - {totalSpent} spent\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Proficiency Sections */}\r\n      <ProficiencySection title=\"Power Proficiencies\" profs={powerProfs} />\r\n      <ProficiencySection title=\"Technique Proficiencies\" profs={techniqueProfs} />\r\n      <ProficiencySection title=\"Weapon Proficiencies\" profs={weaponProfs} />\r\n      <ProficiencySection title=\"Armor Proficiencies\" profs={armorProfs} />\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Library Section\r\n * ===============\r\n * Displays character's powers, techniques, equipment, proficiencies, and notes\r\n * Supports edit mode for adding/removing items\r\n * Weapons have clickable attack/damage rolls\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Plus, X, ChevronDown, ChevronUp } from 'lucide-react';\r\nimport { useRollsOptional } from './roll-context';\r\nimport { NotesTab } from './notes-tab';\r\nimport { ProficienciesTab } from './proficiencies-tab';\r\nimport type { CharacterPower, CharacterTechnique, Item, Abilities } from '@/types';\r\n\r\ninterface LibrarySectionProps {\r\n  powers: CharacterPower[];\r\n  techniques: CharacterTechnique[];\r\n  weapons: Item[];\r\n  armor: Item[];\r\n  equipment: Item[];\r\n  currency?: number;\r\n  innateEnergy?: number;\r\n  isEditMode?: boolean;\r\n  // Power/Technique/Equipment callbacks\r\n  onAddPower?: () => void;\r\n  onRemovePower?: (id: string | number) => void;\r\n  onAddTechnique?: () => void;\r\n  onRemoveTechnique?: (id: string | number) => void;\r\n  onAddWeapon?: () => void;\r\n  onRemoveWeapon?: (id: string | number) => void;\r\n  onToggleEquipWeapon?: (id: string | number) => void;\r\n  onAddArmor?: () => void;\r\n  onRemoveArmor?: (id: string | number) => void;\r\n  onToggleEquipArmor?: (id: string | number) => void;\r\n  onAddEquipment?: () => void;\r\n  onRemoveEquipment?: (id: string | number) => void;\r\n  onCurrencyChange?: (value: number) => void;\r\n  // Notes tab props\r\n  weight?: number;\r\n  height?: number;\r\n  appearance?: string;\r\n  archetypeDesc?: string;\r\n  notes?: string;\r\n  abilities?: Abilities;\r\n  onWeightChange?: (value: number) => void;\r\n  onHeightChange?: (value: number) => void;\r\n  onAppearanceChange?: (value: string) => void;\r\n  onArchetypeDescChange?: (value: string) => void;\r\n  onNotesChange?: (value: string) => void;\r\n  // Proficiencies tab props\r\n  level?: number;\r\n  archetypeAbility?: number;\r\n}\r\n\r\ntype TabType = 'powers' | 'techniques' | 'weapons' | 'armor' | 'equipment' | 'proficiencies' | 'notes';\r\n\r\ninterface PowerCardProps {\r\n  power: CharacterPower;\r\n  innateEnergy?: number;\r\n  isEditMode?: boolean;\r\n  onRemove?: () => void;\r\n}\r\n\r\nfunction PowerCard({ power, innateEnergy, isEditMode, onRemove }: PowerCardProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n  const isInnate = power.cost !== undefined && innateEnergy !== undefined && power.cost <= innateEnergy;\r\n\r\n  return (\r\n    <div className={cn(\r\n      'border rounded-lg overflow-hidden',\r\n      isInnate ? 'border-purple-300 bg-purple-50' : 'border-gray-200 bg-white'\r\n    )}>\r\n      <div className=\"flex items-center\">\r\n        <button\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            {expanded ? <ChevronUp className=\"w-4 h-4 text-gray-400\" /> : <ChevronDown className=\"w-4 h-4 text-gray-400\" />}\r\n            <span className=\"font-medium text-gray-800\">{power.name}</span>\r\n            {isInnate && (\r\n              <span className=\"text-xs px-1.5 py-0.5 rounded bg-purple-200 text-purple-700\">\r\n                Innate\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n            {power.cost !== undefined && (\r\n              <span className=\"text-blue-600 font-medium\">{power.cost} EP</span>\r\n            )}\r\n            {power.level && (\r\n              <span>Lvl {power.level}</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n        {isEditMode && onRemove && (\r\n          <button\r\n            onClick={onRemove}\r\n            className=\"p-2 text-red-500 hover:bg-red-50 transition-colors\"\r\n            title=\"Remove power\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {expanded && power.description && (\r\n        <div className=\"px-3 py-2 bg-gray-50 border-t border-gray-100\">\r\n          <p className=\"text-sm text-gray-600\">{power.description}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface TechniqueCardProps {\r\n  technique: CharacterTechnique;\r\n  isEditMode?: boolean;\r\n  onRemove?: () => void;\r\n}\r\n\r\nfunction TechniqueCard({ technique, isEditMode, onRemove }: TechniqueCardProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  return (\r\n    <div className=\"border border-gray-200 rounded-lg overflow-hidden bg-white\">\r\n      <div className=\"flex items-center\">\r\n        <button\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            {expanded ? <ChevronUp className=\"w-4 h-4 text-gray-400\" /> : <ChevronDown className=\"w-4 h-4 text-gray-400\" />}\r\n            <span className=\"font-medium text-gray-800\">{technique.name}</span>\r\n          </div>\r\n          {technique.cost !== undefined && (\r\n            <span className=\"text-sm text-red-600 font-medium\">{technique.cost} SP</span>\r\n          )}\r\n        </button>\r\n        {isEditMode && onRemove && (\r\n          <button\r\n            onClick={onRemove}\r\n            className=\"p-2 text-red-500 hover:bg-red-50 transition-colors\"\r\n            title=\"Remove technique\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {expanded && technique.description && (\r\n        <div className=\"px-3 py-2 bg-gray-50 border-t border-gray-100\">\r\n          <p className=\"text-sm text-gray-600\">{technique.description}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ItemCardProps {\r\n  item: Item;\r\n  type: 'weapon' | 'armor' | 'equipment';\r\n  isEditMode?: boolean;\r\n  onRemove?: () => void;\r\n  onToggleEquip?: () => void;\r\n  onRollAttack?: () => void;\r\n  onRollDamage?: () => void;\r\n}\r\n\r\nfunction ItemCard({ item, type, isEditMode, onRemove, onToggleEquip, onRollAttack, onRollDamage }: ItemCardProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  return (\r\n    <div className={cn(\r\n      'border rounded-lg overflow-hidden',\r\n      item.equipped ? 'border-green-300 bg-green-50' : 'border-gray-200 bg-white'\r\n    )}>\r\n      <div className=\"flex items-center\">\r\n        {isEditMode && onToggleEquip && (type === 'weapon' || type === 'armor') && (\r\n          <button\r\n            onClick={onToggleEquip}\r\n            className={cn(\r\n              'px-2 py-2 transition-colors',\r\n              item.equipped \r\n                ? 'text-green-600 bg-green-100 hover:bg-green-200' \r\n                : 'text-gray-400 hover:bg-gray-100'\r\n            )}\r\n            title={item.equipped ? 'Unequip' : 'Equip'}\r\n          >\r\n            {item.equipped ? '‚úì' : '‚óã'}\r\n          </button>\r\n        )}\r\n        <button\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            {!isEditMode && item.equipped && (\r\n              <span className=\"text-green-600\">‚úì</span>\r\n            )}\r\n            <span className=\"font-medium text-gray-800\">{item.name}</span>\r\n            {item.quantity && item.quantity > 1 && (\r\n              <span className=\"text-xs text-gray-500\">√ó{item.quantity}</span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n            {type === 'weapon' && item.damage && (\r\n              <span className=\"text-red-600 font-medium\">{item.damage}</span>\r\n            )}\r\n            {type === 'armor' && item.armor && (\r\n              <span className=\"text-blue-600 font-medium\">+{item.armor} AR</span>\r\n            )}\r\n          </div>\r\n        </button>\r\n        \r\n        {/* Attack/Damage roll buttons for weapons */}\r\n        {type === 'weapon' && !isEditMode && (\r\n          <div className=\"flex items-center gap-1 pr-2\">\r\n            {onRollAttack && (\r\n              <button\r\n                onClick={onRollAttack}\r\n                className=\"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors\"\r\n                title=\"Roll attack\"\r\n              >\r\n                ‚öîÔ∏è Atk\r\n              </button>\r\n            )}\r\n            {onRollDamage && item.damage && (\r\n              <button\r\n                onClick={onRollDamage}\r\n                className=\"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded hover:bg-orange-200 transition-colors\"\r\n                title=\"Roll damage\"\r\n              >\r\n                üí• Dmg\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {isEditMode && onRemove && (\r\n          <button\r\n            onClick={onRemove}\r\n            className=\"p-2 text-red-500 hover:bg-red-50 transition-colors\"\r\n            title=\"Remove item\"\r\n          >\r\n            <X className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {expanded && (\r\n        <div className=\"px-3 py-2 bg-gray-50 border-t border-gray-100\">\r\n          {item.description && (\r\n            <p className=\"text-sm text-gray-600 mb-1\">{item.description}</p>\r\n          )}\r\n          {item.properties && item.properties.length > 0 && (\r\n            <div className=\"flex flex-wrap gap-1 mt-1\">\r\n              {item.properties.map((prop, i) => (\r\n                <span key={i} className=\"text-xs px-1.5 py-0.5 bg-gray-200 rounded\">\r\n                  {typeof prop === 'string' ? prop : prop.name}\r\n                </span>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function LibrarySection({\r\n  powers,\r\n  techniques,\r\n  weapons,\r\n  armor,\r\n  equipment,\r\n  currency = 0,\r\n  innateEnergy = 0,\r\n  isEditMode = false,\r\n  onAddPower,\r\n  onRemovePower,\r\n  onAddTechnique,\r\n  onRemoveTechnique,\r\n  onAddWeapon,\r\n  onRemoveWeapon,\r\n  onToggleEquipWeapon,\r\n  onAddArmor,\r\n  onRemoveArmor,\r\n  onToggleEquipArmor,\r\n  onAddEquipment,\r\n  onRemoveEquipment,\r\n  onCurrencyChange,\r\n  // Notes props\r\n  weight = 70,\r\n  height = 170,\r\n  appearance = '',\r\n  archetypeDesc = '',\r\n  notes = '',\r\n  abilities,\r\n  onWeightChange,\r\n  onHeightChange,\r\n  onAppearanceChange,\r\n  onArchetypeDescChange,\r\n  onNotesChange,\r\n  // Proficiencies props\r\n  level = 1,\r\n  archetypeAbility = 0,\r\n}: LibrarySectionProps) {\r\n  const [activeTab, setActiveTab] = useState<TabType>('powers');\r\n  const [currencyInput, setCurrencyInput] = useState(currency.toString());\r\n  const rollContext = useRollsOptional();\r\n\r\n  const tabs: { id: TabType; label: string; count?: number; onAdd?: () => void }[] = [\r\n    { id: 'powers', label: 'Powers', count: powers.length, onAdd: onAddPower },\r\n    { id: 'techniques', label: 'Techniques', count: techniques.length, onAdd: onAddTechnique },\r\n    { id: 'weapons', label: 'Weapons', count: weapons.length, onAdd: onAddWeapon },\r\n    { id: 'armor', label: 'Armor', count: armor.length, onAdd: onAddArmor },\r\n    { id: 'equipment', label: 'Equipment', count: equipment.length, onAdd: onAddEquipment },\r\n    { id: 'proficiencies', label: 'Proficiencies' },\r\n    { id: 'notes', label: 'Notes' },\r\n  ];\r\n\r\n  const activeTabData = tabs.find(t => t.id === activeTab);\r\n\r\n  const handleCurrencyBlur = () => {\r\n    const value = parseInt(currencyInput) || 0;\r\n    if (value !== currency && onCurrencyChange) {\r\n      onCurrencyChange(value);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-md p-4 md:p-6\">\r\n      {/* Tabs */}\r\n      <div className=\"flex flex-wrap gap-1 mb-4 border-b border-gray-200 pb-2\">\r\n        {tabs.map((tab) => (\r\n          <button\r\n            key={tab.id}\r\n            onClick={() => setActiveTab(tab.id)}\r\n            className={cn(\r\n              'px-3 py-1.5 rounded-t-lg text-sm font-medium transition-colors',\r\n              activeTab === tab.id\r\n                ? 'bg-primary-100 text-primary-700 border-b-2 border-primary-600'\r\n                : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'\r\n            )}\r\n          >\r\n            {tab.label}\r\n            {tab.count !== undefined && (\r\n              <span className=\"ml-1 text-xs opacity-70\">({tab.count})</span>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Currency + Add Button Row - only show for inventory-related tabs */}\r\n      {['powers', 'techniques', 'weapons', 'armor', 'equipment'].includes(activeTab) && (\r\n        <div className=\"flex justify-between items-center mb-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-sm text-gray-600\">üí∞</span>\r\n            {isEditMode && onCurrencyChange ? (\r\n              <input\r\n                type=\"number\"\r\n                value={currencyInput}\r\n                onChange={(e) => setCurrencyInput(e.target.value)}\r\n                onBlur={handleCurrencyBlur}\r\n                className=\"w-24 px-2 py-1 text-sm font-bold text-amber-600 border border-amber-300 rounded focus:ring-2 focus:ring-amber-500\"\r\n              />\r\n            ) : (\r\n              <span className=\"font-bold text-amber-600\">{currency.toLocaleString()}</span>\r\n            )}\r\n            <span className=\"text-sm text-gray-600\">gold</span>\r\n          </div>\r\n          \r\n          {isEditMode && activeTabData?.onAdd && (\r\n            <button\r\n              onClick={activeTabData.onAdd}\r\n              className=\"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded-lg transition-colors\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n            Add\r\n          </button>\r\n        )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content */}\r\n      <div className=\"space-y-2 max-h-[400px] overflow-y-auto\">\r\n        {activeTab === 'powers' && (\r\n          powers.length > 0 ? (\r\n            powers.map((power, i) => (\r\n              <PowerCard \r\n                key={power.id || i} \r\n                power={power} \r\n                innateEnergy={innateEnergy}\r\n                isEditMode={isEditMode}\r\n                onRemove={onRemovePower ? () => onRemovePower(power.id || String(i)) : undefined}\r\n              />\r\n            ))\r\n          ) : (\r\n            <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n              No powers learned\r\n            </p>\r\n          )\r\n        )}\r\n\r\n        {activeTab === 'techniques' && (\r\n          techniques.length > 0 ? (\r\n            techniques.map((tech, i) => (\r\n              <TechniqueCard \r\n                key={tech.id || i} \r\n                technique={tech}\r\n                isEditMode={isEditMode}\r\n                onRemove={onRemoveTechnique ? () => onRemoveTechnique(tech.id || String(i)) : undefined}\r\n              />\r\n            ))\r\n          ) : (\r\n            <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n              No techniques learned\r\n            </p>\r\n          )\r\n        )}\r\n\r\n        {activeTab === 'weapons' && (\r\n          weapons.length > 0 ? (\r\n            weapons.map((item, i) => {\r\n              // Calculate attack bonus - typically martial ability + proficiency\r\n              // For now we'll use 0 as a baseline (character sheet page should calculate this)\r\n              const attackBonus = (item as Item & { attackBonus?: number }).attackBonus ?? 0;\r\n              return (\r\n                <ItemCard \r\n                  key={item.id || i} \r\n                  item={item} \r\n                  type=\"weapon\"\r\n                  isEditMode={isEditMode}\r\n                  onRemove={onRemoveWeapon ? () => onRemoveWeapon(item.id || String(i)) : undefined}\r\n                  onToggleEquip={onToggleEquipWeapon ? () => onToggleEquipWeapon(item.id || String(i)) : undefined}\r\n                  onRollAttack={rollContext ? () => rollContext.rollAttack(item.name, attackBonus) : undefined}\r\n                  onRollDamage={rollContext && item.damage ? () => rollContext.rollDamage(item.damage as string) : undefined}\r\n                />\r\n              );\r\n            })\r\n          ) : (\r\n            <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n              No weapons equipped\r\n            </p>\r\n          )\r\n        )}\r\n\r\n        {activeTab === 'armor' && (\r\n          armor.length > 0 ? (\r\n            armor.map((item, i) => (\r\n              <ItemCard \r\n                key={item.id || i} \r\n                item={item} \r\n                type=\"armor\"\r\n                isEditMode={isEditMode}\r\n                onRemove={onRemoveArmor ? () => onRemoveArmor(item.id || String(i)) : undefined}\r\n                onToggleEquip={onToggleEquipArmor ? () => onToggleEquipArmor(item.id || String(i)) : undefined}\r\n              />\r\n            ))\r\n          ) : (\r\n            <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n              No armor equipped\r\n            </p>\r\n          )\r\n        )}\r\n\r\n        {activeTab === 'equipment' && (\r\n          equipment.length > 0 ? (\r\n            equipment.map((item, i) => (\r\n              <ItemCard \r\n                key={item.id || i} \r\n                item={item} \r\n                type=\"equipment\"\r\n                isEditMode={isEditMode}\r\n                onRemove={onRemoveEquipment ? () => onRemoveEquipment(item.id || String(i)) : undefined}\r\n              />\r\n            ))\r\n          ) : (\r\n            <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n              No equipment in inventory\r\n            </p>\r\n          )\r\n        )}\r\n\r\n        {activeTab === 'proficiencies' && (\r\n          <ProficienciesTab\r\n            powers={powers}\r\n            techniques={techniques}\r\n            weapons={weapons}\r\n            armor={armor}\r\n            level={level}\r\n            archetypeAbility={archetypeAbility}\r\n          />\r\n        )}\r\n\r\n        {activeTab === 'notes' && abilities && (\r\n          <NotesTab\r\n            weight={weight}\r\n            height={height}\r\n            appearance={appearance}\r\n            archetypeDesc={archetypeDesc}\r\n            notes={notes}\r\n            abilities={abilities}\r\n            isEditMode={isEditMode}\r\n            onWeightChange={onWeightChange}\r\n            onHeightChange={onHeightChange}\r\n            onAppearanceChange={onAppearanceChange}\r\n            onArchetypeDescChange={onArchetypeDescChange}\r\n            onNotesChange={onNotesChange}\r\n          />\r\n        )}\r\n\r\n        {activeTab === 'notes' && !abilities && (\r\n          <p className=\"text-gray-400 text-sm italic text-center py-4\">\r\n            Character abilities not loaded\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Dice Roller Component\r\n * =====================\r\n * A component for rolling dice with modifiers.\r\n * Displays roll history and supports various die types.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Dice1, Dice2, Dice3, Dice4, Dice5, Dice6, X, History, Trash2 } from 'lucide-react';\r\n\r\ninterface DieRoll {\r\n  id: string;\r\n  dieType: number;\r\n  count: number;\r\n  modifier: number;\r\n  results: number[];\r\n  total: number;\r\n  label?: string;\r\n  timestamp: Date;\r\n}\r\n\r\ninterface DiceRollerProps {\r\n  className?: string;\r\n  onRoll?: (roll: DieRoll) => void;\r\n}\r\n\r\n// Generate random die roll\r\nfunction rollDie(sides: number): number {\r\n  return Math.floor(Math.random() * sides) + 1;\r\n}\r\n\r\n// Die type buttons\r\nconst DIE_TYPES = [4, 6, 8, 10, 12, 20] as const;\r\n\r\n// Get appropriate icon for display\r\nfunction DieIcon({ value, className }: { value: number; className?: string }) {\r\n  const icons = [Dice1, Dice2, Dice3, Dice4, Dice5, Dice6];\r\n  const Icon = icons[Math.min(value - 1, 5)] || Dice6;\r\n  return <Icon className={className} />;\r\n}\r\n\r\nexport function DiceRoller({ className, onRoll }: DiceRollerProps) {\r\n  const [dieType, setDieType] = useState<number>(20);\r\n  const [dieCount, setDieCount] = useState<number>(1);\r\n  const [modifier, setModifier] = useState<number>(0);\r\n  const [rollHistory, setRollHistory] = useState<DieRoll[]>([]);\r\n  const [showHistory, setShowHistory] = useState(false);\r\n\r\n  const performRoll = useCallback((label?: string) => {\r\n    const results: number[] = [];\r\n    for (let i = 0; i < dieCount; i++) {\r\n      results.push(rollDie(dieType));\r\n    }\r\n    const total = results.reduce((sum, r) => sum + r, 0) + modifier;\r\n\r\n    const roll: DieRoll = {\r\n      id: Date.now().toString(),\r\n      dieType,\r\n      count: dieCount,\r\n      modifier,\r\n      results,\r\n      total,\r\n      label,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    setRollHistory(prev => [roll, ...prev.slice(0, 49)]); // Keep last 50 rolls\r\n    onRoll?.(roll);\r\n    \r\n    return roll;\r\n  }, [dieType, dieCount, modifier, onRoll]);\r\n\r\n  const clearHistory = () => {\r\n    setRollHistory([]);\r\n  };\r\n\r\n  const formatModifier = (mod: number) => {\r\n    if (mod === 0) return '';\r\n    return mod > 0 ? `+${mod}` : `${mod}`;\r\n  };\r\n\r\n  const formatRollFormula = () => {\r\n    const formula = `${dieCount}d${dieType}`;\r\n    const mod = formatModifier(modifier);\r\n    return mod ? `${formula}${mod}` : formula;\r\n  };\r\n\r\n  const lastRoll = rollHistory[0];\r\n\r\n  return (\r\n    <div className={cn('bg-white rounded-xl shadow-md p-4', className)}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-bold text-gray-900\">üé≤ Dice Roller</h3>\r\n        <button\r\n          onClick={() => setShowHistory(!showHistory)}\r\n          className={cn(\r\n            'p-2 rounded-lg transition-colors',\r\n            showHistory ? 'bg-primary-100 text-primary-700' : 'text-gray-500 hover:bg-gray-100'\r\n          )}\r\n          title=\"Roll history\"\r\n        >\r\n          <History className=\"w-5 h-5\" />\r\n        </button>\r\n      </div>\r\n\r\n      {!showHistory ? (\r\n        <>\r\n          {/* Die Type Selection */}\r\n          <div className=\"grid grid-cols-6 gap-1 mb-4\">\r\n            {DIE_TYPES.map((die) => (\r\n              <button\r\n                key={die}\r\n                onClick={() => setDieType(die)}\r\n                className={cn(\r\n                  'py-2 px-1 rounded-lg text-sm font-bold transition-colors',\r\n                  dieType === die\r\n                    ? 'bg-primary-600 text-white'\r\n                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                )}\r\n              >\r\n                d{die}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Count and Modifier */}\r\n          <div className=\"flex items-center justify-center gap-4 mb-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setDieCount(Math.max(1, dieCount - 1))}\r\n                className=\"w-8 h-8 rounded bg-gray-200 hover:bg-gray-300 font-bold\"\r\n              >\r\n                ‚àí\r\n              </button>\r\n              <span className=\"w-8 text-center font-bold\">{dieCount}</span>\r\n              <button\r\n                onClick={() => setDieCount(Math.min(10, dieCount + 1))}\r\n                className=\"w-8 h-8 rounded bg-amber-600 text-white hover:bg-amber-700 font-bold\"\r\n              >\r\n                +\r\n              </button>\r\n              <span className=\"text-sm text-gray-600\">dice</span>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setModifier(modifier - 1)}\r\n                className=\"w-8 h-8 rounded bg-gray-200 hover:bg-gray-300 font-bold\"\r\n              >\r\n                ‚àí\r\n              </button>\r\n              <span className={cn(\r\n                'w-10 text-center font-bold',\r\n                modifier > 0 ? 'text-green-600' : modifier < 0 ? 'text-red-600' : 'text-gray-600'\r\n              )}>\r\n                {formatModifier(modifier) || '¬±0'}\r\n              </span>\r\n              <button\r\n                onClick={() => setModifier(modifier + 1)}\r\n                className=\"w-8 h-8 rounded bg-amber-600 text-white hover:bg-amber-700 font-bold\"\r\n              >\r\n                +\r\n              </button>\r\n              <span className=\"text-sm text-gray-600\">mod</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Roll Button */}\r\n          <button\r\n            onClick={() => performRoll()}\r\n            className=\"w-full py-3 bg-gradient-to-b from-primary-500 to-primary-700 text-white font-bold rounded-xl hover:from-primary-600 hover:to-primary-800 transition-all shadow-md hover:shadow-lg\"\r\n          >\r\n            Roll {formatRollFormula()}\r\n          </button>\r\n\r\n          {/* Last Roll Result */}\r\n          {lastRoll && (\r\n            <div className=\"mt-4 p-4 bg-gray-50 rounded-xl text-center\">\r\n              <div className=\"text-sm text-gray-600 mb-1\">\r\n                {lastRoll.count}d{lastRoll.dieType}{formatModifier(lastRoll.modifier)}\r\n              </div>\r\n              <div className=\"text-4xl font-bold text-primary-600 mb-2\">\r\n                {lastRoll.total}\r\n              </div>\r\n              <div className=\"flex items-center justify-center gap-1 text-sm text-gray-500\">\r\n                {lastRoll.results.map((r, i) => (\r\n                  <span key={i} className={cn(\r\n                    'px-2 py-0.5 rounded',\r\n                    r === lastRoll.dieType ? 'bg-green-200 text-green-800' :\r\n                    r === 1 ? 'bg-red-200 text-red-800' : 'bg-gray-200'\r\n                  )}>\r\n                    {r}\r\n                  </span>\r\n                ))}\r\n                {lastRoll.modifier !== 0 && (\r\n                  <span className={cn(\r\n                    'px-2 py-0.5',\r\n                    lastRoll.modifier > 0 ? 'text-green-600' : 'text-red-600'\r\n                  )}>\r\n                    {formatModifier(lastRoll.modifier)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </>\r\n      ) : (\r\n        /* Roll History */\r\n        <div className=\"space-y-2\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <span className=\"text-sm text-gray-600\">Recent Rolls</span>\r\n            <button\r\n              onClick={clearHistory}\r\n              className=\"p-1 text-gray-400 hover:text-red-500 transition-colors\"\r\n              title=\"Clear history\"\r\n            >\r\n              <Trash2 className=\"w-4 h-4\" />\r\n            </button>\r\n          </div>\r\n          \r\n          {rollHistory.length === 0 ? (\r\n            <p className=\"text-center text-gray-400 py-4\">No rolls yet</p>\r\n          ) : (\r\n            <div className=\"max-h-[300px] overflow-y-auto space-y-2\">\r\n              {rollHistory.map((roll) => (\r\n                <div key={roll.id} className=\"flex items-center justify-between p-2 bg-gray-50 rounded-lg\">\r\n                  <div>\r\n                    <span className=\"font-medium text-gray-800\">\r\n                      {roll.count}d{roll.dieType}{formatModifier(roll.modifier)}\r\n                    </span>\r\n                    {roll.label && (\r\n                      <span className=\"ml-2 text-xs text-gray-500\">{roll.label}</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-xs text-gray-400\">\r\n                      [{roll.results.join(', ')}]\r\n                    </span>\r\n                    <span className=\"font-bold text-primary-600\">= {roll.total}</span>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Export types for use elsewhere\r\nexport type { DieRoll };\r\n","/**\r\n * Roll Context\r\n * ============\r\n * Provides dice rolling functions to all character sheet components.\r\n * Components can trigger rolls that appear in the RollLog.\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useCallback, useState } from 'react';\r\n\r\n// Types\r\nexport interface DieResult {\r\n  type: 'd4' | 'd6' | 'd8' | 'd10' | 'd12' | 'd20';\r\n  value: number;\r\n  isMax: boolean;\r\n  isMin: boolean;\r\n}\r\n\r\nexport type RollType = 'attack' | 'damage' | 'skill' | 'ability' | 'defense' | 'custom';\r\n\r\nexport interface RollEntry {\r\n  id: string;\r\n  type: RollType;\r\n  title: string;\r\n  dice: DieResult[];\r\n  modifier: number;\r\n  total: number;\r\n  isCrit?: boolean;\r\n  isCritFail?: boolean;\r\n  critMessage?: string;\r\n  timestamp: Date;\r\n}\r\n\r\ninterface RollContextValue {\r\n  // Roll history\r\n  rolls: RollEntry[];\r\n  \r\n  // Roll functions\r\n  rollAbility: (abilityName: string, bonus: number) => void;\r\n  rollDefense: (defenseName: string, bonus: number) => void;\r\n  rollSkill: (skillName: string, bonus: number) => void;\r\n  rollAttack: (weaponName: string, attackBonus: number) => void;\r\n  rollDamage: (damageStr: string, bonus?: number) => void;\r\n  rollCustom: (title: string, dieType: 'd4' | 'd6' | 'd8' | 'd10' | 'd12' | 'd20', count: number, modifier: number) => void;\r\n  \r\n  // History management\r\n  clearHistory: () => void;\r\n  addRoll: (roll: RollEntry) => void;\r\n}\r\n\r\nconst RollContext = createContext<RollContextValue | null>(null);\r\n\r\n// Helper to generate unique roll IDs\r\nlet rollIdCounter = 0;\r\nfunction generateRollId(): string {\r\n  return `roll-${Date.now()}-${++rollIdCounter}`;\r\n}\r\n\r\n// Roll a single die\r\nfunction rollDie(type: 'd4' | 'd6' | 'd8' | 'd10' | 'd12' | 'd20'): number {\r\n  const max = parseInt(type.substring(1));\r\n  return Math.floor(Math.random() * max) + 1;\r\n}\r\n\r\n// Max values for each die type\r\nconst DIE_MAX: Record<string, number> = {\r\n  d4: 4,\r\n  d6: 6,\r\n  d8: 8,\r\n  d10: 10,\r\n  d12: 12,\r\n  d20: 20,\r\n};\r\n\r\nexport function RollProvider({ \r\n  children, \r\n  maxHistory = 50 \r\n}: { \r\n  children: React.ReactNode;\r\n  maxHistory?: number;\r\n}) {\r\n  const [rolls, setRolls] = useState<RollEntry[]>([]);\r\n\r\n  const addRoll = useCallback((roll: RollEntry) => {\r\n    setRolls(prev => [roll, ...prev].slice(0, maxHistory));\r\n  }, [maxHistory]);\r\n\r\n  const clearHistory = useCallback(() => {\r\n    setRolls([]);\r\n  }, []);\r\n\r\n  // Internal helper for d20 rolls (abilities, defenses, skills, attacks)\r\n  const makeD20Roll = useCallback((\r\n    type: RollType,\r\n    title: string,\r\n    bonus: number\r\n  ) => {\r\n    const roll = rollDie('d20');\r\n    const isCrit = roll === 20;\r\n    const isCritFail = roll === 1;\r\n    \r\n    // Apply natural 20/1 bonuses like vanilla\r\n    let total = roll + bonus;\r\n    let critMessage: string | undefined;\r\n    \r\n    if (isCrit) {\r\n      total += 2; // Natural 20 adds +2\r\n      critMessage = 'Natural 20! +2 to the total!';\r\n    } else if (isCritFail) {\r\n      total -= 2; // Natural 1 subtracts 2\r\n      critMessage = 'Natural 1! -2 from the total!';\r\n    }\r\n\r\n    const newRoll: RollEntry = {\r\n      id: generateRollId(),\r\n      type,\r\n      title,\r\n      dice: [{ type: 'd20', value: roll, isMax: isCrit, isMin: isCritFail }],\r\n      modifier: bonus,\r\n      total,\r\n      isCrit,\r\n      isCritFail,\r\n      critMessage,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    addRoll(newRoll);\r\n    return newRoll;\r\n  }, [addRoll]);\r\n\r\n  // Roll an ability check\r\n  const rollAbility = useCallback((abilityName: string, bonus: number) => {\r\n    const title = abilityName.charAt(0).toUpperCase() + abilityName.slice(1) + ' Check';\r\n    makeD20Roll('ability', title, bonus);\r\n  }, [makeD20Roll]);\r\n\r\n  // Roll a defense/saving throw\r\n  const rollDefense = useCallback((defenseName: string, bonus: number) => {\r\n    makeD20Roll('defense', `${defenseName} Save`, bonus);\r\n  }, [makeD20Roll]);\r\n\r\n  // Roll a skill check\r\n  const rollSkill = useCallback((skillName: string, bonus: number) => {\r\n    makeD20Roll('skill', skillName, bonus);\r\n  }, [makeD20Roll]);\r\n\r\n  // Roll an attack\r\n  const rollAttack = useCallback((weaponName: string, attackBonus: number) => {\r\n    makeD20Roll('attack', `${weaponName} Attack`, attackBonus);\r\n  }, [makeD20Roll]);\r\n\r\n  // Roll damage (parses damage strings like \"2d6\", \"1d8+2\", \"1d6 Slashing\")\r\n  const rollDamage = useCallback((damageStr: string, bonus: number = 0) => {\r\n    const match = damageStr.match(/(\\d+)d(\\d+)([+-]\\d+)?(?:\\s+([a-zA-Z]+))?/);\r\n    if (!match) return;\r\n\r\n    const [, numDice, dieSize, modifier, dmgType] = match;\r\n    const num = parseInt(numDice);\r\n    const size = parseInt(dieSize);\r\n    const mod = modifier ? parseInt(modifier) : 0;\r\n    const totalBonus = mod + bonus;\r\n\r\n    const diceResults: DieResult[] = [];\r\n    let total = totalBonus;\r\n\r\n    for (let i = 0; i < num; i++) {\r\n      const dieType = `d${size}` as DieResult['type'];\r\n      const value = rollDie(dieType);\r\n      diceResults.push({\r\n        type: dieType,\r\n        value,\r\n        isMax: value === size,\r\n        isMin: value === 1,\r\n      });\r\n      total += value;\r\n    }\r\n\r\n    const title = `Damage${dmgType ? ` (${dmgType})` : ''}`;\r\n\r\n    const newRoll: RollEntry = {\r\n      id: generateRollId(),\r\n      type: 'damage',\r\n      title,\r\n      dice: diceResults,\r\n      modifier: totalBonus,\r\n      total,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    addRoll(newRoll);\r\n  }, [addRoll]);\r\n\r\n  // Roll custom dice\r\n  const rollCustom = useCallback((\r\n    title: string, \r\n    dieType: 'd4' | 'd6' | 'd8' | 'd10' | 'd12' | 'd20', \r\n    count: number, \r\n    modifier: number\r\n  ) => {\r\n    const diceResults: DieResult[] = [];\r\n    let total = modifier;\r\n    const max = DIE_MAX[dieType];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n      const value = rollDie(dieType);\r\n      diceResults.push({\r\n        type: dieType,\r\n        value,\r\n        isMax: value === max,\r\n        isMin: value === 1,\r\n      });\r\n      total += value;\r\n    }\r\n\r\n    const isCrit = dieType === 'd20' && count === 1 && diceResults[0]?.value === 20;\r\n    const isCritFail = dieType === 'd20' && count === 1 && diceResults[0]?.value === 1;\r\n\r\n    const newRoll: RollEntry = {\r\n      id: generateRollId(),\r\n      type: 'custom',\r\n      title,\r\n      dice: diceResults,\r\n      modifier,\r\n      total,\r\n      isCrit,\r\n      isCritFail,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    addRoll(newRoll);\r\n  }, [addRoll]);\r\n\r\n  const value: RollContextValue = {\r\n    rolls,\r\n    rollAbility,\r\n    rollDefense,\r\n    rollSkill,\r\n    rollAttack,\r\n    rollDamage,\r\n    rollCustom,\r\n    clearHistory,\r\n    addRoll,\r\n  };\r\n\r\n  return (\r\n    <RollContext.Provider value={value}>\r\n      {children}\r\n    </RollContext.Provider>\r\n  );\r\n}\r\n\r\n// Hook to use roll functions\r\nexport function useRolls() {\r\n  const context = useContext(RollContext);\r\n  if (!context) {\r\n    throw new Error('useRolls must be used within a RollProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n// Optional hook that returns null if not in context (for optional usage)\r\nexport function useRollsOptional() {\r\n  return useContext(RollContext);\r\n}\r\n","/**\r\n * Roll Log Component\r\n * ==================\r\n * Fixed-position dice rolling panel matching vanilla site's roll-log.\r\n * Features: Dice pool builder, roll history, color-coded roll types,\r\n * critical success/fail highlighting, and smooth animations.\r\n * Uses RollContext to share roll state with other components.\r\n */\r\n\r\n'use client';\r\n\r\nimport * as React from 'react';\r\nimport { cn } from '@/lib/utils/cn';\r\nimport { Dices, X, Trash2, Plus, Minus } from 'lucide-react';\r\nimport { useRolls, type RollEntry, type RollType, type DieResult } from './roll-context';\r\n\r\n// Re-export types for convenience\r\nexport type { RollEntry, RollType, DieResult };\r\nexport type DieType = 'd4' | 'd6' | 'd8' | 'd10' | 'd12' | 'd20';\r\n\r\n// Die max values\r\nconst DIE_MAX: Record<DieType, number> = {\r\n  d4: 4, d6: 6, d8: 8, d10: 10, d12: 12, d20: 20,\r\n};\r\n\r\n// Roll type colors\r\nconst ROLL_TYPE_COLORS: Record<RollType, string> = {\r\n  attack: 'border-l-red-500',\r\n  damage: 'border-l-orange-500',\r\n  skill: 'border-l-blue-500',\r\n  ability: 'border-l-purple-500',\r\n  defense: 'border-l-teal-500',\r\n  custom: 'border-l-gray-400',\r\n};\r\n\r\nconst ROLL_TYPE_ICONS: Record<RollType, string> = {\r\n  attack: '‚öîÔ∏è',\r\n  damage: 'üí•',\r\n  skill: 'üéØ',\r\n  ability: 'üí™',\r\n  defense: 'üõ°Ô∏è',\r\n  custom: 'üé≤',\r\n};\r\n\r\n// Dice roller helper\r\nfunction rollDie(type: DieType): number {\r\n  return Math.floor(Math.random() * DIE_MAX[type]) + 1;\r\n}\r\n\r\nfunction generateRollId(): string {\r\n  return `roll-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\ninterface RollLogProps {\r\n  className?: string;\r\n}\r\n\r\nexport function RollLog({ className }: RollLogProps) {\r\n  const { rolls, addRoll, clearHistory } = useRolls();\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  \r\n  // Dice pool state (local to the manual dice builder)\r\n  const [dicePool, setDicePool] = React.useState<Record<DieType, number>>({\r\n    d4: 0, d6: 0, d8: 0, d10: 0, d12: 0, d20: 0,\r\n  });\r\n  const [modifier, setModifier] = React.useState(0);\r\n  const [rollType, setRollType] = React.useState<RollType>('custom');\r\n  const [rollTitle, setRollTitle] = React.useState('');\r\n\r\n  // Add a die to pool\r\n  const addDie = (type: DieType) => {\r\n    setDicePool(prev => ({ ...prev, [type]: Math.min(prev[type] + 1, 20) }));\r\n  };\r\n\r\n  // Remove a die from pool\r\n  const removeDie = (type: DieType) => {\r\n    setDicePool(prev => ({ ...prev, [type]: Math.max(prev[type] - 1, 0) }));\r\n  };\r\n\r\n  // Clear dice pool\r\n  const clearPool = () => {\r\n    setDicePool({ d4: 0, d6: 0, d8: 0, d10: 0, d12: 0, d20: 0 });\r\n    setModifier(0);\r\n  };\r\n\r\n  // Execute roll\r\n  const executeRoll = () => {\r\n    const diceResults: DieResult[] = [];\r\n    let total = 0;\r\n    let hasD20 = false;\r\n    let d20Value = 0;\r\n\r\n    // Roll each die in pool\r\n    Object.entries(dicePool).forEach(([type, count]) => {\r\n      const dieType = type as DieType;\r\n      for (let i = 0; i < count; i++) {\r\n        const value = rollDie(dieType);\r\n        const max = DIE_MAX[dieType];\r\n        diceResults.push({\r\n          type: dieType,\r\n          value,\r\n          isMax: value === max,\r\n          isMin: value === 1,\r\n        });\r\n        total += value;\r\n        \r\n        if (dieType === 'd20') {\r\n          hasD20 = true;\r\n          d20Value = value;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (diceResults.length === 0) return;\r\n\r\n    total += modifier;\r\n\r\n    // Check for critical\r\n    const isCrit = hasD20 && d20Value === 20;\r\n    const isCritFail = hasD20 && d20Value === 1;\r\n\r\n    const newRoll: RollEntry = {\r\n      id: generateRollId(),\r\n      type: rollType,\r\n      title: rollTitle || `${rollType.charAt(0).toUpperCase() + rollType.slice(1)} Roll`,\r\n      dice: diceResults,\r\n      modifier,\r\n      total,\r\n      isCrit,\r\n      isCritFail,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    addRoll(newRoll);\r\n    clearPool();\r\n    setRollTitle('');\r\n  };\r\n\r\n  // Get total dice count in pool\r\n  const totalDice = Object.values(dicePool).reduce((a, b) => a + b, 0);\r\n\r\n  // Format dice formula\r\n  const getDiceFormula = () => {\r\n    const parts: string[] = [];\r\n    Object.entries(dicePool).forEach(([type, count]) => {\r\n      if (count > 0) parts.push(`${count}${type}`);\r\n    });\r\n    if (modifier !== 0) {\r\n      parts.push(modifier > 0 ? `+${modifier}` : `${modifier}`);\r\n    }\r\n    return parts.join(' + ') || 'No dice selected';\r\n  };\r\n\r\n  return (\r\n    <div className={cn('fixed bottom-5 right-5 z-[1000] flex flex-col items-end', className)}>\r\n      {/* Panel */}\r\n      <div\r\n        className={cn(\r\n          'absolute bottom-[70px] right-0 w-[360px] max-w-[calc(100vw-40px)]',\r\n          'bg-white rounded-xl shadow-2xl overflow-hidden',\r\n          'flex flex-col transition-all duration-300',\r\n          isOpen ? 'h-[70vh] max-h-[600px] opacity-100' : 'h-0 opacity-0 pointer-events-none'\r\n        )}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-primary-dark to-[#053357] text-white\">\r\n          <h3 className=\"font-bold text-base tracking-wide\">üé≤ Roll Log</h3>\r\n          <button\r\n            onClick={clearHistory}\r\n            className=\"px-3 py-1.5 rounded-md bg-white/15 border border-white/30 text-white text-xs font-semibold hover:bg-white/25 transition-colors\"\r\n          >\r\n            Clear All\r\n          </button>\r\n        </div>\r\n\r\n        {/* Roll History */}\r\n        <div className=\"flex-1 overflow-y-auto p-2 bg-gray-50\">\r\n          {rolls.length === 0 ? (\r\n            <p className=\"text-center text-gray-500 italic py-10\">No rolls yet. Build your dice pool below!</p>\r\n          ) : (\r\n            rolls.map((roll) => (\r\n              <RollEntryCard key={roll.id} roll={roll} />\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Dice Builder */}\r\n        <div className=\"p-3 bg-gradient-to-r from-primary-dark to-[#053357] border-t-2 border-gray-300\">\r\n          {/* Roll Type & Title */}\r\n          <div className=\"flex gap-2 mb-3\">\r\n            <select\r\n              value={rollType}\r\n              onChange={(e) => setRollType(e.target.value as RollType)}\r\n              className=\"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white text-sm\"\r\n            >\r\n              <option value=\"custom\" className=\"text-gray-900\">Custom</option>\r\n              <option value=\"attack\" className=\"text-gray-900\">Attack</option>\r\n              <option value=\"damage\" className=\"text-gray-900\">Damage</option>\r\n              <option value=\"skill\" className=\"text-gray-900\">Skill</option>\r\n              <option value=\"ability\" className=\"text-gray-900\">Ability</option>\r\n              <option value=\"defense\" className=\"text-gray-900\">Defense</option>\r\n            </select>\r\n            <input\r\n              type=\"text\"\r\n              value={rollTitle}\r\n              onChange={(e) => setRollTitle(e.target.value)}\r\n              placeholder=\"Roll name...\"\r\n              className=\"flex-1 px-2 py-1.5 rounded bg-white/10 border border-white/30 text-white placeholder-white/50 text-sm\"\r\n            />\r\n          </div>\r\n\r\n          {/* Dice Grid */}\r\n          <div className=\"grid grid-cols-6 gap-1 mb-3\">\r\n            {(['d4', 'd6', 'd8', 'd10', 'd12', 'd20'] as DieType[]).map((die) => (\r\n              <button\r\n                key={die}\r\n                onClick={() => addDie(die)}\r\n                onContextMenu={(e) => { e.preventDefault(); removeDie(die); }}\r\n                className={cn(\r\n                  'flex flex-col items-center justify-center py-2 px-1 rounded',\r\n                  'bg-white/10 hover:bg-white/20 transition-colors text-white',\r\n                  dicePool[die] > 0 && 'ring-2 ring-yellow-400'\r\n                )}\r\n              >\r\n                <span className=\"text-xs font-bold\">{die}</span>\r\n                {dicePool[die] > 0 && (\r\n                  <span className=\"text-yellow-400 text-sm font-bold\">{dicePool[die]}</span>\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Modifier */}\r\n          <div className=\"flex items-center justify-between gap-2 mb-3\">\r\n            <div className=\"flex items-center gap-1\">\r\n              <button\r\n                onClick={() => setModifier(m => m - 1)}\r\n                className=\"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center\"\r\n              >\r\n                <Minus className=\"w-4 h-4\" />\r\n              </button>\r\n              <span className=\"text-white font-bold min-w-[40px] text-center\">\r\n                {modifier >= 0 ? '+' : ''}{modifier}\r\n              </span>\r\n              <button\r\n                onClick={() => setModifier(m => m + 1)}\r\n                className=\"w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-white flex items-center justify-center\"\r\n              >\r\n                <Plus className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n            <span className=\"text-white/70 text-xs flex-1 text-center\">\r\n              {getDiceFormula()}\r\n            </span>\r\n            <button\r\n              onClick={clearPool}\r\n              className=\"text-white/70 hover:text-white text-xs\"\r\n            >\r\n              Clear\r\n            </button>\r\n          </div>\r\n\r\n          {/* Roll Button */}\r\n          <button\r\n            onClick={executeRoll}\r\n            disabled={totalDice === 0}\r\n            className={cn(\r\n              'w-full py-2.5 rounded-lg font-bold text-white transition-all',\r\n              'bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700',\r\n              'disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed'\r\n            )}\r\n          >\r\n            üé≤ Roll {totalDice > 0 ? `(${totalDice} dice)` : ''}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toggle Button */}\r\n      <button\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className={cn(\r\n          'w-14 h-14 rounded-full shadow-lg transition-all duration-300',\r\n          'flex items-center justify-center',\r\n          'bg-gradient-to-br from-primary-light to-primary-dark hover:scale-110',\r\n          isOpen && 'from-primary-dark to-[#021a2e]'\r\n        )}\r\n        aria-label={isOpen ? 'Close roll log' : 'Open roll log'}\r\n      >\r\n        <Dices className=\"w-7 h-7 text-white\" />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RollEntryCard({ roll }: { roll: RollEntry }) {\r\n  const formatTime = (date: Date) => {\r\n    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'bg-white rounded-lg mb-2 p-3 shadow-sm border-l-4 animate-slide-in-right',\r\n        ROLL_TYPE_COLORS[roll.type],\r\n        roll.isCrit && 'ring-2 ring-green-400',\r\n        roll.isCritFail && 'ring-2 ring-red-400'\r\n      )}\r\n    >\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-sm\">{ROLL_TYPE_ICONS[roll.type]}</span>\r\n          <span className=\"font-semibold text-sm text-primary-dark\">{roll.title}</span>\r\n        </div>\r\n        <span className=\"text-xs text-gray-400\">{formatTime(roll.timestamp)}</span>\r\n      </div>\r\n\r\n      {/* Dice Results */}\r\n      <div className=\"flex items-center gap-2 flex-wrap\">\r\n        {roll.dice.map((die, i) => (\r\n          <span\r\n            key={i}\r\n            className={cn(\r\n              'inline-flex items-center justify-center min-w-[28px] h-7 px-1.5 rounded text-sm font-bold',\r\n              die.type === 'd20'\r\n                ? cn(\r\n                    'w-9 h-9 text-base border-2',\r\n                    die.isMax && 'bg-green-100 border-green-500 text-green-800',\r\n                    die.isMin && 'bg-red-100 border-red-500 text-red-800',\r\n                    !die.isMax && !die.isMin && 'bg-gray-100 border-gray-300 text-gray-800'\r\n                  )\r\n                : cn(\r\n                    'bg-amber-100 border border-amber-400 text-amber-800'\r\n                  )\r\n            )}\r\n          >\r\n            {die.value}\r\n          </span>\r\n        ))}\r\n        \r\n        {roll.modifier !== 0 && (\r\n          <span className=\"text-gray-500 font-semibold\">\r\n            {roll.modifier > 0 ? '+' : ''}{roll.modifier}\r\n          </span>\r\n        )}\r\n        \r\n        <span className=\"text-gray-400\">=</span>\r\n        \r\n        <span className={cn(\r\n          'font-bold text-lg px-3 py-0.5 rounded border',\r\n          roll.isCrit && 'bg-green-100 border-green-400 text-green-800',\r\n          roll.isCritFail && 'bg-red-100 border-red-400 text-red-800',\r\n          !roll.isCrit && !roll.isCritFail && 'bg-blue-50 border-blue-200 text-primary-dark'\r\n        )}>\r\n          {roll.total}\r\n        </span>\r\n      </div>\r\n\r\n      {/* Crit Indicators */}\r\n      {roll.isCrit && (\r\n        <div className=\"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-green-500 to-teal-500 text-white animate-pulse-dot\">\r\n          Critical Success!\r\n        </div>\r\n      )}\r\n      {roll.isCritFail && (\r\n        <div className=\"mt-2 inline-block px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-red-500 to-red-600 text-white animate-pulse-dot\">\r\n          Critical Fail!\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RollLog;\r\n","/**\r\n * Add Library Item Modal\r\n * =======================\r\n * Modal for adding powers, techniques, or items from the user's library\r\n * to their character sheet.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { X, Search, Plus, Check, Loader2 } from 'lucide-react';\r\nimport { Modal } from '@/components/ui';\r\nimport { useUserPowers, useUserTechniques, useUserItems } from '@/hooks/use-user-library';\r\nimport type { UserPower, UserTechnique, UserItem } from '@/hooks/use-user-library';\r\nimport type { CharacterPower, CharacterTechnique, Item } from '@/types';\r\n\r\ntype ItemType = 'power' | 'technique' | 'weapon' | 'armor' | 'equipment';\r\n\r\ninterface AddLibraryItemModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  itemType: ItemType;\r\n  existingIds: Set<string>;\r\n  onAdd: (items: CharacterPower[] | CharacterTechnique[] | Item[]) => void;\r\n}\r\n\r\nexport function AddLibraryItemModal({\r\n  isOpen,\r\n  onClose,\r\n  itemType,\r\n  existingIds,\r\n  onAdd,\r\n}: AddLibraryItemModalProps) {\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\r\n  \r\n  // Fetch user library based on item type\r\n  const { data: userPowers = [], isLoading: powersLoading } = useUserPowers();\r\n  const { data: userTechniques = [], isLoading: techniquesLoading } = useUserTechniques();\r\n  const { data: userItems = [], isLoading: itemsLoading } = useUserItems();\r\n  \r\n  // Reset selection when modal opens/closes\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedIds(new Set());\r\n      setSearchQuery('');\r\n    }\r\n  }, [isOpen]);\r\n  \r\n  // Get the appropriate items based on type\r\n  const { items, isLoading } = useMemo(() => {\r\n    switch (itemType) {\r\n      case 'power':\r\n        return { items: userPowers, isLoading: powersLoading };\r\n      case 'technique':\r\n        return { items: userTechniques, isLoading: techniquesLoading };\r\n      case 'weapon':\r\n        return { \r\n          items: userItems.filter(i => i.type === 'weapon'), \r\n          isLoading: itemsLoading \r\n        };\r\n      case 'armor':\r\n        return { \r\n          items: userItems.filter(i => i.type === 'armor'), \r\n          isLoading: itemsLoading \r\n        };\r\n      case 'equipment':\r\n        return { \r\n          items: userItems.filter(i => i.type === 'equipment'), \r\n          isLoading: itemsLoading \r\n        };\r\n      default:\r\n        return { items: [], isLoading: false };\r\n    }\r\n  }, [itemType, userPowers, userTechniques, userItems, powersLoading, techniquesLoading, itemsLoading]);\r\n  \r\n  // Filter by search query and exclude already added items\r\n  const filteredItems = useMemo(() => {\r\n    return items.filter(item => {\r\n      // Exclude already added\r\n      if (existingIds.has(item.id)) return false;\r\n      \r\n      // Search filter\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        return item.name.toLowerCase().includes(query) ||\r\n               (item.description?.toLowerCase().includes(query));\r\n      }\r\n      return true;\r\n    });\r\n  }, [items, existingIds, searchQuery]);\r\n  \r\n  // Toggle selection\r\n  const toggleSelection = (id: string) => {\r\n    setSelectedIds(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(id)) {\r\n        newSet.delete(id);\r\n      } else {\r\n        newSet.add(id);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n  \r\n  // Handle confirm\r\n  const handleConfirm = () => {\r\n    const selectedItems = items.filter(item => selectedIds.has(item.id));\r\n    \r\n    // Transform to character format based on type\r\n    if (itemType === 'power') {\r\n      const powers: CharacterPower[] = (selectedItems as UserPower[]).map(p => ({\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        parts: (p.parts || []).map(part => ({\r\n          id: String(part.id || ''),\r\n          name: part.name || '',\r\n          op_1_lvl: part.op_1_lvl,\r\n          op_2_lvl: part.op_2_lvl,\r\n          op_3_lvl: part.op_3_lvl,\r\n        })),\r\n        cost: 0, // Will be calculated\r\n        level: 1,\r\n      }));\r\n      onAdd(powers);\r\n    } else if (itemType === 'technique') {\r\n      const techniques: CharacterTechnique[] = (selectedItems as UserTechnique[]).map(t => ({\r\n        id: t.id,\r\n        name: t.name,\r\n        description: t.description || '',\r\n        parts: (t.parts || []).map(part => ({\r\n          id: String(part.id || ''),\r\n          name: part.name || '',\r\n          op_1_lvl: part.op_1_lvl,\r\n          op_2_lvl: part.op_2_lvl,\r\n          op_3_lvl: part.op_3_lvl,\r\n        })),\r\n        cost: 0, // Will be calculated\r\n      }));\r\n      onAdd(techniques);\r\n    } else {\r\n      const equipmentItems: Item[] = (selectedItems as UserItem[]).map(i => ({\r\n        id: i.id,\r\n        name: i.name,\r\n        description: i.description || '',\r\n        properties: i.properties || [],\r\n        damage: i.damage || '',\r\n        armor: i.armorValue || 0,\r\n        equipped: false,\r\n        quantity: 1,\r\n      }));\r\n      onAdd(equipmentItems);\r\n    }\r\n    \r\n    onClose();\r\n  };\r\n  \r\n  // Get title based on item type\r\n  const getTitle = () => {\r\n    switch (itemType) {\r\n      case 'power': return 'Add Power from Library';\r\n      case 'technique': return 'Add Technique from Library';\r\n      case 'weapon': return 'Add Weapon from Library';\r\n      case 'armor': return 'Add Armor from Library';\r\n      case 'equipment': return 'Add Equipment from Library';\r\n      default: return 'Add Item';\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <Modal isOpen={isOpen} onClose={onClose} title={getTitle()}>\r\n      <div className=\"flex flex-col h-[60vh]\">\r\n        {/* Search */}\r\n        <div className=\"relative mb-4\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            placeholder={`Search your ${itemType}s...`}\r\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n          />\r\n        </div>\r\n        \r\n        {/* Items List */}\r\n        <div className=\"flex-1 overflow-y-auto border border-gray-200 rounded-lg\">\r\n          {isLoading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <Loader2 className=\"w-8 h-8 animate-spin text-primary-600\" />\r\n            </div>\r\n          ) : filteredItems.length === 0 ? (\r\n            <div className=\"flex flex-col items-center justify-center py-8 text-gray-500\">\r\n              {items.length === 0 ? (\r\n                <>\r\n                  <p className=\"text-lg font-medium\">No {itemType}s in your library</p>\r\n                  <p className=\"text-sm mt-1\">Create some in the {itemType === 'power' ? 'Power' : itemType === 'technique' ? 'Technique' : 'Item'} Creator first!</p>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <p className=\"text-lg font-medium\">All {itemType}s already added</p>\r\n                  <p className=\"text-sm mt-1\">or no matches for \"{searchQuery}\"</p>\r\n                </>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <ul className=\"divide-y divide-gray-100\">\r\n              {filteredItems.map((item) => (\r\n                <li \r\n                  key={item.id}\r\n                  onClick={() => toggleSelection(item.id)}\r\n                  className={`\r\n                    flex items-center gap-3 px-4 py-3 cursor-pointer transition-colors\r\n                    ${selectedIds.has(item.id) \r\n                      ? 'bg-primary-50 border-l-4 border-primary-500' \r\n                      : 'hover:bg-gray-50 border-l-4 border-transparent'\r\n                    }\r\n                  `}\r\n                >\r\n                  <div className={`\r\n                    w-5 h-5 rounded border-2 flex items-center justify-center transition-colors\r\n                    ${selectedIds.has(item.id) \r\n                      ? 'bg-primary-600 border-primary-600' \r\n                      : 'border-gray-300'\r\n                    }\r\n                  `}>\r\n                    {selectedIds.has(item.id) && (\r\n                      <Check className=\"w-3 h-3 text-white\" />\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"font-medium text-gray-900 truncate\">{item.name}</p>\r\n                    {item.description && (\r\n                      <p className=\"text-sm text-gray-500 truncate\">{item.description}</p>\r\n                    )}\r\n                  </div>\r\n                  {renderItemMeta(item, itemType)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-200 mt-4\">\r\n          <span className=\"text-sm text-gray-500\">\r\n            {selectedIds.size} selected\r\n          </span>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleConfirm}\r\n              disabled={selectedIds.size === 0}\r\n              className=\"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n              Add Selected\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n\r\n// Helper to render item-specific metadata\r\nfunction renderItemMeta(item: UserPower | UserTechnique | UserItem, itemType: ItemType) {\r\n  if (itemType === 'power') {\r\n    return null; // Could add cost display\r\n  }\r\n  if (itemType === 'technique') {\r\n    return null; // Could add energy display\r\n  }\r\n  if (itemType === 'weapon') {\r\n    const weapon = item as UserItem;\r\n    return weapon.damage ? (\r\n      <span className=\"text-sm text-red-600 font-medium\">{weapon.damage}</span>\r\n    ) : null;\r\n  }\r\n  if (itemType === 'armor') {\r\n    const armor = item as UserItem;\r\n    return armor.armorValue ? (\r\n      <span className=\"text-sm text-blue-600 font-medium\">+{armor.armorValue} AR</span>\r\n    ) : null;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default AddLibraryItemModal;\r\n","/**\r\n * Add Feat Modal\r\n * ==============\r\n * Modal for adding archetype or character feats from RTDB\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { ref, get } from 'firebase/database';\r\nimport { rtdb } from '@/lib/firebase/client';\r\nimport { cn } from '@/lib/utils';\r\nimport { X, Search, ChevronDown, ChevronUp } from 'lucide-react';\r\nimport type { Character } from '@/types';\r\n\r\ninterface Feat {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  effect?: string;\r\n  category?: string;\r\n  lvl_req?: number;\r\n  ability_req?: string[];\r\n  abil_req_val?: number[];\r\n  skill_req?: string[];\r\n  skill_req_val?: number[];\r\n  char_feat?: boolean;\r\n  state_feat?: boolean;\r\n  max_uses?: number;\r\n}\r\n\r\ninterface AddFeatModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  featType: 'archetype' | 'character';\r\n  character: Character;\r\n  existingFeatIds: (string | number)[];\r\n  onAdd: (feats: Feat[]) => void;\r\n}\r\n\r\n// Roman numeral utilities\r\nconst ROMAN_TO_NUM: Record<string, number> = { \r\n  'I': 1, 'II': 2, 'III': 3, 'IV': 4, 'V': 5, \r\n  'VI': 6, 'VII': 7, 'VIII': 8, 'IX': 9, 'X': 10 \r\n};\r\n\r\nfunction parseFeatLevel(name: string): { baseName: string; level: number; hasLevel: boolean } {\r\n  if (!name) return { baseName: name, level: 1, hasLevel: false };\r\n  \r\n  const match = name.match(/^(.+?)\\s+(I{1,3}|IV|VI{0,3}|IX|X)$/i);\r\n  if (match) {\r\n    const baseName = match[1].trim();\r\n    const roman = match[2].toUpperCase();\r\n    const level = ROMAN_TO_NUM[roman] || 1;\r\n    return { baseName, level, hasLevel: true };\r\n  }\r\n  \r\n  return { baseName: name, level: 1, hasLevel: false };\r\n}\r\n\r\nfunction FeatRow({\r\n  feat,\r\n  isSelected,\r\n  onToggle,\r\n  meetsRequirements,\r\n  requirementWarning,\r\n}: {\r\n  feat: Feat;\r\n  isSelected: boolean;\r\n  onToggle: () => void;\r\n  meetsRequirements: boolean;\r\n  requirementWarning?: string;\r\n}) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'border rounded-lg overflow-hidden transition-all',\r\n        isSelected ? 'border-primary-500 bg-primary-50' : 'border-gray-200',\r\n        !meetsRequirements && 'opacity-50'\r\n      )}\r\n    >\r\n      <div className=\"flex items-center\">\r\n        <button\r\n          onClick={onToggle}\r\n          disabled={!meetsRequirements}\r\n          className={cn(\r\n            'w-8 h-8 flex items-center justify-center border-r',\r\n            isSelected ? 'bg-primary-500 text-white' : 'bg-gray-50 text-gray-400',\r\n            !meetsRequirements && 'cursor-not-allowed'\r\n          )}\r\n        >\r\n          {isSelected ? '‚úì' : '+'}\r\n        </button>\r\n        \r\n        <button\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"flex-1 flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-left\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"font-medium text-gray-800\">{feat.name}</span>\r\n            {feat.category && (\r\n              <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-100 text-gray-600\">\r\n                {feat.category}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            {feat.lvl_req && feat.lvl_req > 1 && (\r\n              <span className=\"text-xs text-gray-500\">Lvl {feat.lvl_req}+</span>\r\n            )}\r\n            {expanded ? <ChevronUp className=\"w-4 h-4 text-gray-400\" /> : <ChevronDown className=\"w-4 h-4 text-gray-400\" />}\r\n          </div>\r\n        </button>\r\n      </div>\r\n\r\n      {expanded && (\r\n        <div className=\"px-3 py-2 bg-gray-50 border-t border-gray-100\">\r\n          <p className=\"text-sm text-gray-600\">\r\n            {feat.description || feat.effect || 'No description available.'}\r\n          </p>\r\n          {requirementWarning && (\r\n            <p className=\"text-xs text-amber-600 mt-2\">‚ö†Ô∏è {requirementWarning}</p>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function AddFeatModal({\r\n  isOpen,\r\n  onClose,\r\n  featType,\r\n  character,\r\n  existingFeatIds,\r\n  onAdd,\r\n}: AddFeatModalProps) {\r\n  const [feats, setFeats] = useState<Feat[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState('');\r\n  const [selectedFeats, setSelectedFeats] = useState<Feat[]>([]);\r\n\r\n  // Load feats from RTDB\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const loadFeats = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        const snapshot = await get(ref(rtdb, 'feats'));\r\n        if (snapshot.exists()) {\r\n          const data = snapshot.val();\r\n          const featList = Object.entries(data).map(([id, feat]) => ({\r\n            id,\r\n            ...(feat as Omit<Feat, 'id'>),\r\n          }));\r\n          setFeats(featList);\r\n        }\r\n      } catch (e) {\r\n        setError(`Failed to load feats: ${e instanceof Error ? e.message : 'Unknown error'}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadFeats();\r\n  }, [isOpen]);\r\n\r\n  // Reset selection when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedFeats([]);\r\n      setSearchQuery('');\r\n      setSelectedCategory('');\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Get unique categories\r\n  const categories = useMemo(() => {\r\n    const cats = new Set<string>();\r\n    feats.forEach(f => {\r\n      if (f.category) cats.add(f.category);\r\n    });\r\n    return Array.from(cats).sort();\r\n  }, [feats]);\r\n\r\n  // Filter feats based on type, search, category\r\n  const filteredFeats = useMemo(() => {\r\n    return feats.filter(feat => {\r\n      // Filter by feat type\r\n      if (featType === 'character' && !feat.char_feat) return false;\r\n      if (featType === 'archetype' && feat.char_feat) return false;\r\n      \r\n      // Exclude already owned feats\r\n      if (existingFeatIds.includes(feat.id) || existingFeatIds.includes(feat.name)) return false;\r\n      \r\n      // Search filter\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        if (!feat.name.toLowerCase().includes(query) && \r\n            !feat.description?.toLowerCase().includes(query)) {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      // Category filter\r\n      if (selectedCategory && feat.category !== selectedCategory) return false;\r\n      \r\n      return true;\r\n    }).sort((a, b) => a.name.localeCompare(b.name));\r\n  }, [feats, featType, existingFeatIds, searchQuery, selectedCategory]);\r\n\r\n  // Check if feat requirements are met\r\n  const checkRequirements = (feat: Feat): { meets: boolean; warning?: string } => {\r\n    const warnings: string[] = [];\r\n    \r\n    // Level requirement\r\n    if (feat.lvl_req && character.level < feat.lvl_req) {\r\n      warnings.push(`Requires level ${feat.lvl_req}`);\r\n    }\r\n    \r\n    // Ability requirements\r\n    if (feat.ability_req && feat.abil_req_val) {\r\n      const abilities = character.abilities || {};\r\n      feat.ability_req.forEach((abil, idx) => {\r\n        const required = feat.abil_req_val?.[idx] ?? 0;\r\n        const current = abilities[abil.toLowerCase() as keyof typeof abilities] ?? 0;\r\n        if (current < required) {\r\n          warnings.push(`Requires ${abil} ${required}+`);\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Check for leveled feat prerequisites\r\n    const { baseName, level } = parseFeatLevel(feat.name);\r\n    if (level > 1) {\r\n      // Check if character has the prerequisite level feat\r\n      const allCharFeats = [...(character.archetypeFeats || []), ...(character.feats || [])];\r\n      const hasPrereq = allCharFeats.some(f => {\r\n        const parsed = parseFeatLevel(f.name);\r\n        return parsed.baseName === baseName && parsed.level === level - 1;\r\n      });\r\n      if (!hasPrereq) {\r\n        const prevRoman = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX'][level - 2] || 'I';\r\n        warnings.push(`Requires ${baseName} ${prevRoman}`);\r\n      }\r\n    }\r\n    \r\n    return {\r\n      meets: warnings.length === 0,\r\n      warning: warnings.join(', '),\r\n    };\r\n  };\r\n\r\n  const toggleFeat = (feat: Feat) => {\r\n    setSelectedFeats(prev => {\r\n      const exists = prev.some(f => f.id === feat.id);\r\n      if (exists) {\r\n        return prev.filter(f => f.id !== feat.id);\r\n      } else {\r\n        return [...prev, feat];\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (selectedFeats.length > 0) {\r\n      onAdd(selectedFeats);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200\">\r\n          <h2 className=\"text-lg font-bold text-gray-900\">\r\n            Add {featType === 'archetype' ? 'Archetype' : 'Character'} Feat\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-1 rounded-lg hover:bg-gray-100 transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5 text-gray-500\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"px-4 py-3 border-b border-gray-100 space-y-2\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              placeholder=\"Search feats...\"\r\n              className=\"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2 flex-wrap\">\r\n            <button\r\n              onClick={() => setSelectedCategory('')}\r\n              className={cn(\r\n                'px-3 py-1 rounded-full text-sm transition-colors',\r\n                !selectedCategory\r\n                  ? 'bg-primary-600 text-white'\r\n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n              )}\r\n            >\r\n              All\r\n            </button>\r\n            {categories.map(cat => (\r\n              <button\r\n                key={cat}\r\n                onClick={() => setSelectedCategory(cat)}\r\n                className={cn(\r\n                  'px-3 py-1 rounded-full text-sm transition-colors',\r\n                  selectedCategory === cat\r\n                    ? 'bg-primary-600 text-white'\r\n                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                )}\r\n              >\r\n                {cat}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"flex-1 overflow-y-auto p-4\">\r\n          {loading && (\r\n            <div className=\"text-center py-8\">\r\n              <div className=\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2\" />\r\n              <p className=\"text-gray-500\">Loading feats...</p>\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"text-center py-8 text-red-600\">\r\n              <p>{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && !error && filteredFeats.length === 0 && (\r\n            <p className=\"text-center py-8 text-gray-500 italic\">\r\n              No feats available\r\n            </p>\r\n          )}\r\n\r\n          {!loading && !error && filteredFeats.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              {filteredFeats.map(feat => {\r\n                const { meets, warning } = checkRequirements(feat);\r\n                return (\r\n                  <FeatRow\r\n                    key={feat.id}\r\n                    feat={feat}\r\n                    isSelected={selectedFeats.some(f => f.id === feat.id)}\r\n                    onToggle={() => toggleFeat(feat)}\r\n                    meetsRequirements={meets}\r\n                    requirementWarning={warning}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50\">\r\n          <span className=\"text-sm text-gray-500\">\r\n            {selectedFeats.length} feat{selectedFeats.length !== 1 ? 's' : ''} selected\r\n          </span>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleConfirm}\r\n              disabled={selectedFeats.length === 0}\r\n              className={cn(\r\n                'px-4 py-2 rounded-lg font-medium transition-colors',\r\n                selectedFeats.length > 0\r\n                  ? 'bg-primary-600 text-white hover:bg-primary-700'\r\n                  : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n              )}\r\n            >\r\n              Add {selectedFeats.length > 0 ? `(${selectedFeats.length})` : ''}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Add Skill Modal\r\n * ===============\r\n * Modal for adding base skills from RTDB\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { ref, get } from 'firebase/database';\r\nimport { rtdb } from '@/lib/firebase/client';\r\nimport { cn } from '@/lib/utils';\r\nimport { X, Search } from 'lucide-react';\r\n\r\ninterface Skill {\r\n  id: string;\r\n  name: string;\r\n  ability?: string[];\r\n  description?: string;\r\n  category?: string;\r\n  base_skill?: string | null;\r\n}\r\n\r\ninterface AddSkillModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  existingSkillNames: string[];\r\n  onAdd: (skills: Skill[]) => void;\r\n}\r\n\r\nfunction SkillRow({\r\n  skill,\r\n  isSelected,\r\n  onToggle,\r\n}: {\r\n  skill: Skill;\r\n  isSelected: boolean;\r\n  onToggle: () => void;\r\n}) {\r\n  const abilityStr = Array.isArray(skill.ability) ? skill.ability.join(', ') : '';\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex items-center justify-between px-3 py-2 border rounded-lg transition-all',\r\n        isSelected ? 'border-primary-500 bg-primary-50' : 'border-gray-200 hover:bg-gray-50'\r\n      )}\r\n    >\r\n      <div className=\"flex items-center gap-3\">\r\n        <button\r\n          onClick={onToggle}\r\n          className={cn(\r\n            'w-6 h-6 rounded-full flex items-center justify-center transition-colors',\r\n            isSelected ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-400 hover:bg-gray-200'\r\n          )}\r\n        >\r\n          {isSelected ? '‚úì' : '+'}\r\n        </button>\r\n        <div>\r\n          <span className=\"font-medium text-gray-800\">{skill.name}</span>\r\n          {abilityStr && (\r\n            <span className=\"ml-2 text-xs text-gray-500\">({abilityStr})</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {skill.category && (\r\n        <span className=\"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600\">\r\n          {skill.category}\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function AddSkillModal({\r\n  isOpen,\r\n  onClose,\r\n  existingSkillNames,\r\n  onAdd,\r\n}: AddSkillModalProps) {\r\n  const [skills, setSkills] = useState<Skill[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedSkills, setSelectedSkills] = useState<Skill[]>([]);\r\n\r\n  // Load skills from RTDB\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const loadSkills = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        const snapshot = await get(ref(rtdb, 'skills'));\r\n        if (snapshot.exists()) {\r\n          const data = snapshot.val();\r\n          // Only get base skills (no base_skill property)\r\n          const skillList = Object.entries(data)\r\n            .map(([id, skill]) => ({\r\n              id,\r\n              ...(skill as Omit<Skill, 'id'>),\r\n            }))\r\n            .filter(s => !s.base_skill); // Filter to base skills only\r\n          \r\n          setSkills(skillList);\r\n        }\r\n      } catch (e) {\r\n        setError(`Failed to load skills: ${e instanceof Error ? e.message : 'Unknown error'}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadSkills();\r\n  }, [isOpen]);\r\n\r\n  // Reset selection when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedSkills([]);\r\n      setSearchQuery('');\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Filter skills\r\n  const filteredSkills = useMemo(() => {\r\n    const existingLower = existingSkillNames.map(n => n.toLowerCase());\r\n    \r\n    return skills.filter(skill => {\r\n      // Exclude already owned skills\r\n      if (existingLower.includes(skill.name.toLowerCase())) return false;\r\n      \r\n      // Search filter\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        if (!skill.name.toLowerCase().includes(query)) return false;\r\n      }\r\n      \r\n      return true;\r\n    }).sort((a, b) => a.name.localeCompare(b.name));\r\n  }, [skills, existingSkillNames, searchQuery]);\r\n\r\n  const toggleSkill = (skill: Skill) => {\r\n    setSelectedSkills(prev => {\r\n      const exists = prev.some(s => s.id === skill.id);\r\n      if (exists) {\r\n        return prev.filter(s => s.id !== skill.id);\r\n      } else {\r\n        return [...prev, skill];\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (selectedSkills.length > 0) {\r\n      onAdd(selectedSkills);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200\">\r\n          <h2 className=\"text-lg font-bold text-gray-900\">Add Skill</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-1 rounded-lg hover:bg-gray-100 transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5 text-gray-500\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Search */}\r\n        <div className=\"px-4 py-3 border-b border-gray-100\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              placeholder=\"Search skills...\"\r\n              className=\"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"flex-1 overflow-y-auto p-4\">\r\n          {loading && (\r\n            <div className=\"text-center py-8\">\r\n              <div className=\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2\" />\r\n              <p className=\"text-gray-500\">Loading skills...</p>\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"text-center py-8 text-red-600\">\r\n              <p>{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && !error && filteredSkills.length === 0 && (\r\n            <p className=\"text-center py-8 text-gray-500 italic\">\r\n              No skills available to add\r\n            </p>\r\n          )}\r\n\r\n          {!loading && !error && filteredSkills.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              {filteredSkills.map(skill => (\r\n                <SkillRow\r\n                  key={skill.id}\r\n                  skill={skill}\r\n                  isSelected={selectedSkills.some(s => s.id === skill.id)}\r\n                  onToggle={() => toggleSkill(skill)}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50\">\r\n          <span className=\"text-sm text-gray-500\">\r\n            {selectedSkills.length} skill{selectedSkills.length !== 1 ? 's' : ''} selected\r\n          </span>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleConfirm}\r\n              disabled={selectedSkills.length === 0}\r\n              className={cn(\r\n                'px-4 py-2 rounded-lg font-medium transition-colors',\r\n                selectedSkills.length > 0\r\n                  ? 'bg-primary-600 text-white hover:bg-primary-700'\r\n                  : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n              )}\r\n            >\r\n              Add {selectedSkills.length > 0 ? `(${selectedSkills.length})` : ''}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Add Sub-Skill Modal\r\n * ===================\r\n * Modal for adding sub-skills from RTDB\r\n * Only shows sub-skills where the character has proficiency in the base skill\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { ref, get } from 'firebase/database';\r\nimport { rtdb } from '@/lib/firebase/client';\r\nimport { cn } from '@/lib/utils';\r\nimport { X, Search } from 'lucide-react';\r\n\r\ninterface SubSkill {\r\n  id: string;\r\n  name: string;\r\n  ability?: string[];\r\n  description?: string;\r\n  base_skill: string;\r\n}\r\n\r\ninterface CharacterSkill {\r\n  name: string;\r\n  prof?: boolean;\r\n}\r\n\r\ninterface AddSubSkillModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  characterSkills: CharacterSkill[];\r\n  existingSkillNames: string[];\r\n  onAdd: (skills: SubSkill[]) => void;\r\n}\r\n\r\nfunction SubSkillRow({\r\n  skill,\r\n  isSelected,\r\n  onToggle,\r\n}: {\r\n  skill: SubSkill;\r\n  isSelected: boolean;\r\n  onToggle: () => void;\r\n}) {\r\n  const abilityStr = Array.isArray(skill.ability) ? skill.ability.join(', ') : '';\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex items-center justify-between px-3 py-2 border rounded-lg transition-all',\r\n        isSelected ? 'border-primary-500 bg-primary-50' : 'border-gray-200 hover:bg-gray-50'\r\n      )}\r\n    >\r\n      <div className=\"flex items-center gap-3\">\r\n        <button\r\n          onClick={onToggle}\r\n          className={cn(\r\n            'w-6 h-6 rounded-full flex items-center justify-center transition-colors',\r\n            isSelected ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-400 hover:bg-gray-200'\r\n          )}\r\n        >\r\n          {isSelected ? '‚úì' : '+'}\r\n        </button>\r\n        <div>\r\n          <span className=\"font-medium text-gray-800\">{skill.name}</span>\r\n          <span className=\"ml-2 text-xs text-gray-500\">\r\n            ({skill.base_skill})\r\n          </span>\r\n          {abilityStr && (\r\n            <span className=\"ml-1 text-xs text-gray-400\">{abilityStr}</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function AddSubSkillModal({\r\n  isOpen,\r\n  onClose,\r\n  characterSkills,\r\n  existingSkillNames,\r\n  onAdd,\r\n}: AddSubSkillModalProps) {\r\n  const [subSkills, setSubSkills] = useState<SubSkill[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedSkills, setSelectedSkills] = useState<SubSkill[]>([]);\r\n\r\n  // Get proficient base skill names\r\n  const proficientBaseSkills = useMemo(() => {\r\n    return characterSkills\r\n      .filter(s => s.prof)\r\n      .map(s => s.name);\r\n  }, [characterSkills]);\r\n\r\n  // Load sub-skills from RTDB\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const loadSubSkills = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        const snapshot = await get(ref(rtdb, 'skills'));\r\n        if (snapshot.exists()) {\r\n          const data = snapshot.val();\r\n          // Only get sub-skills (have base_skill property) where base is proficient\r\n          const skillList = Object.entries(data)\r\n            .map(([id, skill]) => ({\r\n              id,\r\n              ...(skill as Omit<SubSkill, 'id'>),\r\n            }))\r\n            .filter(s => s.base_skill && proficientBaseSkills.includes(s.base_skill));\r\n          \r\n          setSubSkills(skillList);\r\n        }\r\n      } catch (e) {\r\n        setError(`Failed to load sub-skills: ${e instanceof Error ? e.message : 'Unknown error'}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadSubSkills();\r\n  }, [isOpen, proficientBaseSkills]);\r\n\r\n  // Reset selection when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedSkills([]);\r\n      setSearchQuery('');\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Filter sub-skills\r\n  const filteredSkills = useMemo(() => {\r\n    const existingLower = existingSkillNames.map(n => n.toLowerCase());\r\n    \r\n    return subSkills.filter(skill => {\r\n      // Exclude already owned skills\r\n      if (existingLower.includes(skill.name.toLowerCase())) return false;\r\n      \r\n      // Search filter\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        if (!skill.name.toLowerCase().includes(query) && \r\n            !skill.base_skill.toLowerCase().includes(query)) {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      return true;\r\n    }).sort((a, b) => a.name.localeCompare(b.name));\r\n  }, [subSkills, existingSkillNames, searchQuery]);\r\n\r\n  const toggleSkill = (skill: SubSkill) => {\r\n    setSelectedSkills(prev => {\r\n      const exists = prev.some(s => s.id === skill.id);\r\n      if (exists) {\r\n        return prev.filter(s => s.id !== skill.id);\r\n      } else {\r\n        return [...prev, skill];\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (selectedSkills.length > 0) {\r\n      onAdd(selectedSkills);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200\">\r\n          <h2 className=\"text-lg font-bold text-gray-900\">Add Sub-Skill</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-1 rounded-lg hover:bg-gray-100 transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5 text-gray-500\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Info */}\r\n        <div className=\"px-4 py-2 bg-blue-50 border-b border-blue-100\">\r\n          <p className=\"text-sm text-blue-700\">\r\n            Sub-skills are available for skills you are proficient in.\r\n          </p>\r\n        </div>\r\n\r\n        {/* Search */}\r\n        <div className=\"px-4 py-3 border-b border-gray-100\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              placeholder=\"Search sub-skills...\"\r\n              className=\"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"flex-1 overflow-y-auto p-4\">\r\n          {loading && (\r\n            <div className=\"text-center py-8\">\r\n              <div className=\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-2\" />\r\n              <p className=\"text-gray-500\">Loading sub-skills...</p>\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"text-center py-8 text-red-600\">\r\n              <p>{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && !error && proficientBaseSkills.length === 0 && (\r\n            <p className=\"text-center py-8 text-gray-500 italic\">\r\n              You need at least one proficient skill to add sub-skills.\r\n            </p>\r\n          )}\r\n\r\n          {!loading && !error && proficientBaseSkills.length > 0 && filteredSkills.length === 0 && (\r\n            <p className=\"text-center py-8 text-gray-500 italic\">\r\n              No sub-skills available to add\r\n            </p>\r\n          )}\r\n\r\n          {!loading && !error && filteredSkills.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              {filteredSkills.map(skill => (\r\n                <SubSkillRow\r\n                  key={skill.id}\r\n                  skill={skill}\r\n                  isSelected={selectedSkills.some(s => s.id === skill.id)}\r\n                  onToggle={() => toggleSkill(skill)}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50\">\r\n          <span className=\"text-sm text-gray-500\">\r\n            {selectedSkills.length} sub-skill{selectedSkills.length !== 1 ? 's' : ''} selected\r\n          </span>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleConfirm}\r\n              disabled={selectedSkills.length === 0}\r\n              className={cn(\r\n                'px-4 py-2 rounded-lg font-medium transition-colors',\r\n                selectedSkills.length > 0\r\n                  ? 'bg-primary-600 text-white hover:bg-primary-700'\r\n                  : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n              )}\r\n            >\r\n              Add {selectedSkills.length > 0 ? `(${selectedSkills.length})` : ''}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Level Up Modal\r\n * ===============\r\n * Modal for leveling up a character, showing gains and allowing allocation.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useMemo } from 'react';\r\nimport { ArrowUp, Star, Heart, Zap, Shield, Sword, Plus, Check } from 'lucide-react';\r\nimport { Modal } from '@/components/ui';\r\nimport {\r\n  calculateAbilityPoints,\r\n  calculateSkillPoints,\r\n  calculateHealthEnergyPool,\r\n  calculateProficiency,\r\n  calculateTrainingPoints,\r\n} from '@/lib/game/formulas';\r\nimport type { Character } from '@/types';\r\n\r\ninterface LevelUpModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  character: Character;\r\n  onConfirm: (newLevel: number) => void;\r\n}\r\n\r\ninterface ProgressionDelta {\r\n  healthEnergy: number;\r\n  abilityPoints: number;\r\n  skillPoints: number;\r\n  trainingPoints: number;\r\n  proficiency: number;\r\n  archetypeFeats: number;\r\n  characterFeats: number;\r\n}\r\n\r\nfunction calculateLevelGains(currentLevel: number, newLevel: number, highestAbility: number = 0): ProgressionDelta {\r\n  const currentHE = calculateHealthEnergyPool(currentLevel, 'PLAYER');\r\n  const newHE = calculateHealthEnergyPool(newLevel, 'PLAYER');\r\n  \r\n  const currentAP = calculateAbilityPoints(currentLevel);\r\n  const newAP = calculateAbilityPoints(newLevel);\r\n  \r\n  const currentSP = calculateSkillPoints(currentLevel);\r\n  const newSP = calculateSkillPoints(newLevel);\r\n  \r\n  const currentTP = calculateTrainingPoints(currentLevel, highestAbility);\r\n  const newTP = calculateTrainingPoints(newLevel, highestAbility);\r\n  \r\n  const currentProf = calculateProficiency(currentLevel);\r\n  const newProf = calculateProficiency(newLevel);\r\n  \r\n  return {\r\n    healthEnergy: newHE - currentHE,\r\n    abilityPoints: newAP - currentAP,\r\n    skillPoints: newSP - currentSP,\r\n    trainingPoints: newTP - currentTP,\r\n    proficiency: newProf - currentProf,\r\n    archetypeFeats: newLevel - currentLevel, // 1 per level\r\n    characterFeats: newLevel - currentLevel, // 1 per level\r\n  };\r\n}\r\n\r\nexport function LevelUpModal({\r\n  isOpen,\r\n  onClose,\r\n  character,\r\n  onConfirm,\r\n}: LevelUpModalProps) {\r\n  const [targetLevel, setTargetLevel] = useState((character.level || 1) + 1);\r\n  \r\n  const currentLevel = character.level || 1;\r\n  const maxLevel = 20; // Max level cap\r\n  \r\n  // Calculate highest archetype ability for training points\r\n  const highestAbility = useMemo(() => {\r\n    const abilities = character.abilities || {};\r\n    const archAbility = character.archetype?.ability?.toLowerCase();\r\n    const martialAbility = character.mart_abil?.toLowerCase();\r\n    const powerAbility = character.pow_abil?.toLowerCase();\r\n    \r\n    const relevantAbilities = [archAbility, martialAbility, powerAbility]\r\n      .filter(Boolean)\r\n      .map(a => abilities[a as keyof typeof abilities] || 0);\r\n    \r\n    return Math.max(...relevantAbilities, 0);\r\n  }, [character]);\r\n  \r\n  // Calculate level gains\r\n  const gains = useMemo(() => {\r\n    return calculateLevelGains(currentLevel, targetLevel, highestAbility);\r\n  }, [currentLevel, targetLevel, highestAbility]);\r\n  \r\n  // Get milestone info\r\n  const getMilestones = () => {\r\n    const milestones = [];\r\n    \r\n    // Check for ability point milestone (every 3 levels starting at 3)\r\n    if (gains.abilityPoints > 0) {\r\n      milestones.push(`+${gains.abilityPoints} Ability Point${gains.abilityPoints > 1 ? 's' : ''}`);\r\n    }\r\n    \r\n    // Check for proficiency milestone (every 5 levels)\r\n    if (gains.proficiency > 0) {\r\n      milestones.push(`+${gains.proficiency} Proficiency`);\r\n    }\r\n    \r\n    return milestones;\r\n  };\r\n  \r\n  const handleConfirm = () => {\r\n    onConfirm(targetLevel);\r\n    onClose();\r\n  };\r\n  \r\n  const milestones = getMilestones();\r\n  \r\n  return (\r\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Level Up!\">\r\n      <div className=\"space-y-6\">\r\n        {/* Level Selector */}\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-600 mb-2\">\r\n            {character.name} ‚Ä¢ Level {currentLevel}\r\n          </p>\r\n          <div className=\"flex items-center justify-center gap-4\">\r\n            <button\r\n              onClick={() => setTargetLevel(Math.max(currentLevel + 1, targetLevel - 1))}\r\n              disabled={targetLevel <= currentLevel + 1}\r\n              className=\"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n            >\r\n              -\r\n            </button>\r\n            <div className=\"text-center\">\r\n              <div className=\"text-5xl font-bold text-primary-600\">{targetLevel}</div>\r\n              <div className=\"text-sm text-gray-500\">New Level</div>\r\n            </div>\r\n            <button\r\n              onClick={() => setTargetLevel(Math.min(maxLevel, targetLevel + 1))}\r\n              disabled={targetLevel >= maxLevel}\r\n              className=\"w-10 h-10 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n            >\r\n              +\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Milestones */}\r\n        {milestones.length > 0 && (\r\n          <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center gap-2 text-yellow-700 font-medium mb-2\">\r\n              <Star className=\"w-5 h-5\" />\r\n              Milestone Bonuses!\r\n            </div>\r\n            <ul className=\"text-sm text-yellow-600 space-y-1\">\r\n              {milestones.map((m, i) => (\r\n                <li key={i} className=\"flex items-center gap-2\">\r\n                  <Check className=\"w-4 h-4\" />\r\n                  {m}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Gains Grid */}\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          <GainCard\r\n            icon={<Heart className=\"w-5 h-5 text-red-500\" />}\r\n            label=\"Health & Energy\"\r\n            value={`+${gains.healthEnergy}`}\r\n            description=\"Hit points\"\r\n          />\r\n          <GainCard\r\n            icon={<Sword className=\"w-5 h-5 text-orange-500\" />}\r\n            label=\"Training Points\"\r\n            value={`+${gains.trainingPoints}`}\r\n            description=\"For powers/techniques\"\r\n          />\r\n          <GainCard\r\n            icon={<Shield className=\"w-5 h-5 text-blue-500\" />}\r\n            label=\"Skill Points\"\r\n            value={`+${gains.skillPoints}`}\r\n            description=\"For skills\"\r\n          />\r\n          <GainCard\r\n            icon={<Star className=\"w-5 h-5 text-purple-500\" />}\r\n            label=\"Feats\"\r\n            value={`+${gains.archetypeFeats}`}\r\n            description=\"Archetype & Character\"\r\n          />\r\n        </div>\r\n        \r\n        {/* Confirm Button */}\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"flex-1 px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleConfirm}\r\n            className=\"flex-1 px-4 py-3 rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors flex items-center justify-center gap-2 font-medium\"\r\n          >\r\n            <ArrowUp className=\"w-5 h-5\" />\r\n            Level Up to {targetLevel}!\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n\r\ninterface GainCardProps {\r\n  icon: React.ReactNode;\r\n  label: string;\r\n  value: string;\r\n  description: string;\r\n}\r\n\r\nfunction GainCard({ icon, label, value, description }: GainCardProps) {\r\n  return (\r\n    <div className=\"bg-gray-50 rounded-lg p-3 border border-gray-100\">\r\n      <div className=\"flex items-center gap-2 mb-1\">\r\n        {icon}\r\n        <span className=\"text-sm font-medium text-gray-700\">{label}</span>\r\n      </div>\r\n      <div className=\"text-2xl font-bold text-gray-900\">{value}</div>\r\n      <div className=\"text-xs text-gray-500\">{description}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LevelUpModal;\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M5 12h14', key: '1ays0h' }]];\n\n/**\n * @component @name Minus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/minus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minus = createLucideIcon('minus', __iconNode);\n\nexport default Minus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z',\n      key: 'r04s7s',\n    },\n  ],\n];\n\n/**\n * @component @name Star\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTEuNTI1IDIuMjk1YS41My41MyAwIDAgMSAuOTUgMGwyLjMxIDQuNjc5YTIuMTIzIDIuMTIzIDAgMCAwIDEuNTk1IDEuMTZsNS4xNjYuNzU2YS41My41MyAwIDAgMSAuMjk0LjkwNGwtMy43MzYgMy42MzhhMi4xMjMgMi4xMjMgMCAwIDAtLjYxMSAxLjg3OGwuODgyIDUuMTRhLjUzLjUzIDAgMCAxLS43NzEuNTZsLTQuNjE4LTIuNDI4YTIuMTIyIDIuMTIyIDAgMCAwLTEuOTczIDBMNi4zOTYgMjEuMDFhLjUzLjUzIDAgMCAxLS43Ny0uNTZsLjg4MS01LjEzOWEyLjEyMiAyLjEyMiAwIDAgMC0uNjExLTEuODc5TDIuMTYgOS43OTVhLjUzLjUzIDAgMCAxIC4yOTQtLjkwNmw1LjE2NS0uNzU1YTIuMTIyIDIuMTIyIDAgMCAwIDEuNTk3LTEuMTZ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/star\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Star = createLucideIcon('star', __iconNode);\n\nexport default Star;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm5 12 7-7 7 7', key: 'hav0vg' }],\n  ['path', { d: 'M12 19V5', key: 'x0mq9r' }],\n];\n\n/**\n * @component @name ArrowUp\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtNSAxMiA3LTcgNyA3IiAvPgogIDxwYXRoIGQ9Ik0xMiAxOVY1IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/arrow-up\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowUp = createLucideIcon('arrow-up', __iconNode);\n\nexport default ArrowUp;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['rect', { width: '12', height: '12', x: '2', y: '10', rx: '2', ry: '2', key: '6agr2n' }],\n  [\n    'path',\n    { d: 'm17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6', key: '1o487t' },\n  ],\n  ['path', { d: 'M6 18h.01', key: 'uhywen' }],\n  ['path', { d: 'M10 14h.01', key: 'ssrbsk' }],\n  ['path', { d: 'M15 6h.01', key: 'cblpky' }],\n  ['path', { d: 'M18 9h.01', key: '2061c0' }],\n];\n\n/**\n * @component @name Dices\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHg9IjIiIHk9IjEwIiByeD0iMiIgcnk9IjIiIC8+CiAgPHBhdGggZD0ibTE3LjkyIDE0IDMuNS0zLjVhMi4yNCAyLjI0IDAgMCAwIDAtM2wtNS00LjkyYTIuMjQgMi4yNCAwIDAgMC0zIDBMMTAgNiIgLz4KICA8cGF0aCBkPSJNNiAxOGguMDEiIC8+CiAgPHBhdGggZD0iTTEwIDE0aC4wMSIgLz4KICA8cGF0aCBkPSJNMTUgNmguMDEiIC8+CiAgPHBhdGggZD0iTTE4IDloLjAxIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/dices\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Dices = createLucideIcon('dices', __iconNode);\n\nexport default Dices;\n","/**\r\n * Data Enrichment Utilities\r\n * ==========================\r\n * Pairs raw character data with full objects from user's library\r\n * Mirrors the vanilla site's data-enrichment.js patterns\r\n */\r\n\r\nimport type { CharacterPower, CharacterTechnique, Character } from '@/types';\r\nimport type { UserPower, UserTechnique, UserItem } from '@/hooks/use-user-library';\r\n\r\n// =============================================================================\r\n// Types for Enriched Data\r\n// =============================================================================\r\n\r\n/** Enriched power with full data from user's library */\r\nexport interface EnrichedPower extends CharacterPower {\r\n  // Display fields from library\r\n  description: string;\r\n  energy?: number;\r\n  actionType?: string;\r\n  area?: string;\r\n  duration?: string;\r\n  damageStr?: string;\r\n  range?: string | number;\r\n  targets?: string;\r\n  // Full parts data for display\r\n  displayParts?: Array<{\r\n    name: string;\r\n    description?: string;\r\n    base_en?: number;\r\n    base_tp?: number;\r\n  }>;\r\n  // Original library item for reference\r\n  libraryItem?: UserPower;\r\n  // Innate power flag\r\n  innate?: boolean;\r\n  // Flag if not found in library\r\n  notInLibrary?: boolean;\r\n}\r\n\r\n/** Enriched technique with full data from user's library */\r\nexport interface EnrichedTechnique extends CharacterTechnique {\r\n  // Display fields from library\r\n  description: string;\r\n  staminaCost?: number;\r\n  actionType?: string;\r\n  weaponName?: string;\r\n  damageStr?: string;\r\n  // Full parts data for display\r\n  displayParts?: Array<{\r\n    name: string;\r\n    description?: string;\r\n    base_tp?: number;\r\n    base_stam?: number;\r\n  }>;\r\n  // Original library item for reference\r\n  libraryItem?: UserTechnique;\r\n  // Flag if not found in library\r\n  notInLibrary?: boolean;\r\n}\r\n\r\n/** Enriched item/armament with full data from user's library */\r\nexport interface EnrichedItem {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  type: 'weapon' | 'armor' | 'equipment';\r\n  equipped?: boolean;\r\n  // Display fields\r\n  damage?: string;\r\n  armorValue?: number;\r\n  properties?: string[];\r\n  displayProperties?: Array<{\r\n    name: string;\r\n    description?: string;\r\n  }>;\r\n  // Original library item for reference\r\n  libraryItem?: UserItem;\r\n  // Flag if not found in library\r\n  notInLibrary?: boolean;\r\n}\r\n\r\n// =============================================================================\r\n// Utility Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Find an item in a library by ID or name (case-insensitive)\r\n */\r\nfunction findInLibrary<T extends { id: string; name: string }>(\r\n  library: T[],\r\n  reference: string | { id?: string | number; name?: string }\r\n): T | undefined {\r\n  if (!library || library.length === 0) return undefined;\r\n  \r\n  // If reference is a string, treat as name\r\n  if (typeof reference === 'string') {\r\n    const searchName = reference.toLowerCase();\r\n    return library.find(item => \r\n      item.name.toLowerCase() === searchName ||\r\n      item.id === reference\r\n    );\r\n  }\r\n  \r\n  // If reference is an object, try ID first, then name\r\n  if (reference.id !== undefined) {\r\n    const found = library.find(item => item.id === String(reference.id));\r\n    if (found) return found;\r\n  }\r\n  \r\n  if (reference.name) {\r\n    const searchName = reference.name.toLowerCase();\r\n    return library.find(item => item.name.toLowerCase() === searchName);\r\n  }\r\n  \r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Get the name from a power/technique reference\r\n */\r\nfunction getReferenceName(ref: string | { name?: string; id?: string | number }): string {\r\n  if (typeof ref === 'string') return ref;\r\n  return ref?.name || String(ref?.id || '');\r\n}\r\n\r\n// =============================================================================\r\n// Enrichment Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Enrich character powers with full data from user's power library\r\n */\r\nexport function enrichPowers(\r\n  characterPowers: CharacterPower[] | undefined,\r\n  userPowerLibrary: UserPower[]\r\n): EnrichedPower[] {\r\n  if (!characterPowers || characterPowers.length === 0) return [];\r\n  \r\n  return characterPowers.map(charPower => {\r\n    const name = typeof charPower === 'string' ? charPower : charPower.name;\r\n    const innate = typeof charPower === 'object' ? !!(charPower as unknown as { innate?: boolean }).innate : false;\r\n    \r\n    const libraryItem = findInLibrary(userPowerLibrary, charPower);\r\n    \r\n    if (libraryItem) {\r\n      return {\r\n        id: libraryItem.id,\r\n        name: libraryItem.name,\r\n        description: libraryItem.description || '',\r\n        parts: (libraryItem.parts || []).map(part => ({\r\n          id: String(part.id || ''),\r\n          name: part.name || '',\r\n          op_1_lvl: part.op_1_lvl,\r\n          op_2_lvl: part.op_2_lvl,\r\n          op_3_lvl: part.op_3_lvl,\r\n        })),\r\n        innate,\r\n        libraryItem,\r\n        // Additional display fields can be calculated/derived here\r\n      };\r\n    }\r\n    \r\n    // Not found in library - return placeholder\r\n    return {\r\n      id: typeof charPower === 'object' ? String(charPower.id || '') : name,\r\n      name,\r\n      description: 'Power not found in your library',\r\n      innate,\r\n      notInLibrary: true,\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Enrich character techniques with full data from user's technique library\r\n */\r\nexport function enrichTechniques(\r\n  characterTechniques: CharacterTechnique[] | undefined,\r\n  userTechniqueLibrary: UserTechnique[]\r\n): EnrichedTechnique[] {\r\n  if (!characterTechniques || characterTechniques.length === 0) return [];\r\n  \r\n  return characterTechniques.map(charTech => {\r\n    const name = typeof charTech === 'string' ? charTech : charTech.name;\r\n    \r\n    const libraryItem = findInLibrary(userTechniqueLibrary, charTech);\r\n    \r\n    if (libraryItem) {\r\n      return {\r\n        id: libraryItem.id,\r\n        name: libraryItem.name,\r\n        description: libraryItem.description || '',\r\n        parts: (libraryItem.parts || []).map(part => ({\r\n          id: String(part.id || ''),\r\n          name: part.name || '',\r\n          op_1_lvl: part.op_1_lvl,\r\n          op_2_lvl: part.op_2_lvl,\r\n          op_3_lvl: part.op_3_lvl,\r\n        })),\r\n        libraryItem,\r\n        // Additional display fields can be calculated/derived here\r\n      };\r\n    }\r\n    \r\n    // Not found in library - return placeholder\r\n    return {\r\n      id: typeof charTech === 'object' ? String(charTech.id || '') : name,\r\n      name,\r\n      description: 'Technique not found in your library',\r\n      notInLibrary: true,\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Enrich character equipment with full data from user's item library\r\n */\r\nexport function enrichItems(\r\n  characterItems: Array<{ name: string; equipped?: boolean; type?: string }> | undefined,\r\n  userItemLibrary: UserItem[],\r\n  itemType: 'weapon' | 'armor' | 'equipment'\r\n): EnrichedItem[] {\r\n  if (!characterItems || characterItems.length === 0) return [];\r\n  \r\n  return characterItems.map(charItem => {\r\n    const name = typeof charItem === 'string' ? charItem : charItem.name;\r\n    const equipped = typeof charItem === 'object' ? !!charItem.equipped : false;\r\n    \r\n    const libraryItem = findInLibrary(userItemLibrary, charItem);\r\n    \r\n    if (libraryItem) {\r\n      return {\r\n        id: libraryItem.id,\r\n        name: libraryItem.name,\r\n        description: libraryItem.description || '',\r\n        type: libraryItem.type || itemType,\r\n        equipped,\r\n        damage: libraryItem.damage,\r\n        armorValue: libraryItem.armorValue,\r\n        properties: libraryItem.properties || [],\r\n        libraryItem,\r\n      };\r\n    }\r\n    \r\n    // Not found in library - return placeholder\r\n    return {\r\n      id: name,\r\n      name,\r\n      description: 'Item not found in your library',\r\n      type: itemType,\r\n      equipped,\r\n      notInLibrary: true,\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Enrich all character data at once\r\n * Returns enriched data alongside the original character\r\n */\r\nexport interface EnrichedCharacterData {\r\n  powers: EnrichedPower[];\r\n  techniques: EnrichedTechnique[];\r\n  weapons: EnrichedItem[];\r\n  armor: EnrichedItem[];\r\n  equipment: EnrichedItem[];\r\n}\r\n\r\n/** Helper to safely convert equipment arrays */\r\nfunction toEquipmentArray(items: unknown): Array<{ name: string; equipped?: boolean }> {\r\n  if (!items) return [];\r\n  if (Array.isArray(items)) {\r\n    return items.map(item => ({\r\n      name: typeof item === 'string' ? item : (item?.name || ''),\r\n      equipped: typeof item === 'object' ? !!item?.equipped : false,\r\n    })).filter(item => item.name);\r\n  }\r\n  // Single item (e.g., Armor object)\r\n  if (typeof items === 'object' && 'name' in items) {\r\n    const obj = items as { name?: string; equipped?: boolean };\r\n    return obj.name ? [{ name: obj.name, equipped: !!obj.equipped }] : [];\r\n  }\r\n  return [];\r\n}\r\n\r\nexport function enrichCharacterData(\r\n  character: Character,\r\n  userPowers: UserPower[],\r\n  userTechniques: UserTechnique[],\r\n  userItems: UserItem[]\r\n): EnrichedCharacterData {\r\n  // Split items by type\r\n  const weaponItems = userItems.filter(i => i.type === 'weapon');\r\n  const armorItems = userItems.filter(i => i.type === 'armor');\r\n  const equipmentItems = userItems.filter(i => i.type === 'equipment');\r\n  \r\n  return {\r\n    powers: enrichPowers(character.powers, userPowers),\r\n    techniques: enrichTechniques(character.techniques, userTechniques),\r\n    weapons: enrichItems(\r\n      toEquipmentArray(character.equipment?.weapons),\r\n      weaponItems,\r\n      'weapon'\r\n    ),\r\n    armor: enrichItems(\r\n      toEquipmentArray(character.equipment?.armor),\r\n      armorItems,\r\n      'armor'\r\n    ),\r\n    equipment: enrichItems(\r\n      toEquipmentArray(character.equipment?.items),\r\n      equipmentItems,\r\n      'equipment'\r\n    ),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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AA,EAAS,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,6BAtBC,CAAA,CAAA,CAAA,EAAM,CAAA,CAAA,CAAA,AAAI,GAAA,CAAA,AAAK,CAAA,EAAI,CAAA,CAAA,CAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAK,AAAL,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,iGAGF,CFA/E,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AEEE,CAAA,AAAE,AFFJ,CAAA,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CEEO,AFFP,CAAA,AEEO,CAAA,AFFP,CEEoB,AAAb,AFFP,CEEoB,AFFpB,CEEoB,AFFpB,CEEoB,AFFpB,CEEoB,AAAK,AFFzB,CEEyB,AFFzB,CEEyB,AFFzB,CEEyB,AFFzB,CEEyB,AFFzB,CAAA,AEEyB,CAAA,AFFzB,CEEyB,AFFzB,CEEyB,AFFzB,CEEmC,AFFnC,CEEmC,AFFnC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CEGE,AFHF,CEGE,AAAE,AFHJ,CAAA,CEGO,AFHP,CEGO,AFHP,CAAA,AEGO,CAAA,AFHP,CAAA,AEGO,CAAA,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AFHP,CEGO,AAAc,AFHrB,CAAA,AEGqB,CAAA,AFHrB,CEGqB,AFHrB,CEGqB,AAAK,AFH1B,CEG0B,AFH1B,CAAA,AEG0B,CFH1B,AEG0B,CFH1B,AEG0B,CAAA,AFH1B,CAAA,AEG0B,CFH1B,AEG0B,CAAA,AFH1B,CEGoC,AFHpC,CEGoC,AFHpC,CEIP,AFJO,CEIN,AFJM,CEIN,AFJM,CEIN,AFJM,CEIN,AFJM,CEIN,AFJM,CEIN,AFJM,CEIN,AFJM,CEIN,AAAQ,AFJF,CEIE,AAAE,AFJJ,CAAA,CAAA,AEIO,CFJP,AEIO,CFJP,AEIO,CAAA,AFJP,CAAA,AEIO,CFJP,AEIO,CFJP,AEIO,CFJP,AEIO,CFJP,AEIO,CFJP,AEIO,CAAA,AFJP,CAAA,AEIO,CFJP,AEIO,AAAa,CFJpB,AEIoB,CAAA,AFJpB,CEIoB,AFJpB,CEIoB,AAAK,AFJzB,CEIyB,AFJzB,CEIyB,AFJzB,CEIyB,AFJzB,CAAA,AEIyB,CFJzB,AEIyB,CFJzB,AEIyB,CAAA,AFJzB,CAAA,AEIyB,CAAU,AFJnC,CAAA,AEImC,CFJnC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CEMT,AFNS,CAAA,CAAA,CAAA,CAAA,ADSK,CCTL,CAAA,CAAA,ADSK,CCTL,CDSK,ACTL,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CDSK,ACTL,CAAA,CAAA,ADSsB,CCTtB,ACHO,AFYe,CCTtB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,ADJ4B,AAaG,CCT/B,ADJ6B,AECA,ACAE,AHYA,CCT/B,ACH6B,AFYE,CCT/B,CAAA,CAAA,CAAA,CDJ6B,ACI7B,CAAA,ADJ6B,AAAQ,CCIrC,ADJqC,AAAE,CCIvC,CAAA,ADJ0C,CCI1C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,ADJ0C,CAAY,AAAZ,ACI1C,CDJsD,ACItD,CDJsD,ACItD,CDJsD,ACItD,CDJsD,AAAK,ACI3D,CDJ2D,ACI3D,CAAA,ADJ2D,CAAA,ACI3D,CDJ2D,ACI3D,CDJ2D,ACI3D,CDJ2D,ACI3D,CDJ2D,ACI3D,CDJ2D,ACI3D,CAAA,ADJqE,CCIrE,ADJsE,CCItE,ADJsE,CCItE,CAAA,APcH,COdG,CAAA,APcgC,CACvC,AOfO,CAAA,CAAA,CAAA,APeH,COfG,CPeA,AOfA,CAAA,CAAA,CAAA,APeI,COfJ,CPeO,AOfP,CAAA,CAAA,CAAA,APeW,COfX,CAAA,APec,COfd,CAAA,CAAA,CAAA,APemB,COfnB,CAAA,CAAA,APeuB,COfvB,CA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","ignoreList":[16,17,18,19]}