(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92953,97427,8070,83877,e=>{"use strict";let t,n,r;var i,s,o=e.i(47167);let a=function(e,t){if(!e)throw l(t)},l=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},h=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},u=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[h],n[u],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(h(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):u(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new d;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class d extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let f=function(e){let t=h(e);return c.encodeByteArray(t,!0)},p=function(e){return f(e).replace(/\./g,"")},g=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function m(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,e)}function _(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let y=()=>{try{return _().__FIREBASE_DEFAULTS__||(()=>{if(void 0===o.default||void 0===o.default.env)return;let e=o.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&g(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},v=e=>y()?.emulatorHosts?.[e],w=e=>{let t=v(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},E=()=>y()?.config,b=e=>y()?.[`_${e}`];class T{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function I(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function C(e){return(await fetch(e,{credentials:"include"})).ok}function S(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[p(JSON.stringify({alg:"none",type:"JWT"})),p(JSON.stringify(s)),""].join(".")}let k={},A=!1;function N(e,t){if("undefined"==typeof window||"undefined"==typeof document||!I(window.location.host)||k[e]===t||k[e]||A)return;function n(e){return`__firebase__banner__${e}`}k[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(k))k[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;A=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}i?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function R(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function P(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(R())}function D(){let t=y()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function x(){return"undefined"!=typeof window||O()}function O(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function L(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function M(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function U(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function F(){let e=R();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function V(){return false}function q(){return!D()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function B(){return!D()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function j(){try{return"object"==typeof indexedDB}catch(e){return!1}}function z(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}class $ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,$.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,H.prototype.create)}}class H{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(W,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new $(s,l,i)}}let W=/\{\$([^}]+)}/g;function K(e){return JSON.parse(e)}function G(e){return JSON.stringify(e)}let Q=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=K(g(s[0])||""),n=K(g(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},Y=function(e){let t=Q(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},X=function(e){let t=Q(e).claims;return"object"==typeof t&&!0===t.admin};function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Z(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ee(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function et(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function en(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(er(n)&&er(s)){if(!en(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function er(e){return null!==e&&"object"==typeof e}function ei(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function es(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function eo(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ea{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+r+i[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function el(e,t){let n=new eh(e,t);return n.subscribe.bind(n)}class eh{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=eu),void 0===r.error&&(r.error=eu),void 0===r.complete&&(r.complete=eu);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eu(){}function ec(e,t){return`${e} failed: ${t} argument `}let ed=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;a(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},ef=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function ep(e){return e&&e._delegate?e._delegate:e}e.s(["Deferred",()=>T,"ErrorFactory",()=>H,"FirebaseError",()=>$,"Sha1",()=>ea,"assert",()=>a,"assertionError",()=>l,"base64",()=>c,"base64Decode",()=>g,"base64Encode",()=>f,"base64urlEncodeWithoutPadding",()=>p,"contains",()=>J,"createMockUserToken",()=>S,"createSubscribe",()=>el,"deepCopy",()=>m,"deepEqual",()=>en,"errorPrefix",()=>ec,"extractQuerystring",()=>eo,"getDefaultAppConfig",()=>E,"getDefaultEmulatorHost",()=>v,"getDefaultEmulatorHostnameAndPort",()=>w,"getExperimentalSetting",()=>b,"getGlobal",()=>_,"getModularInstance",()=>ep,"getUA",()=>R,"isAdmin",()=>X,"isBrowser",()=>x,"isBrowserExtension",()=>M,"isCloudWorkstation",()=>I,"isCloudflareWorker",()=>L,"isEmpty",()=>ee,"isIE",()=>F,"isIndexedDBAvailable",()=>j,"isMobileCordova",()=>P,"isNodeSdk",()=>V,"isReactNative",()=>U,"isSafari",()=>q,"isSafariOrWebkit",()=>B,"isValidFormat",()=>Y,"isWebWorker",()=>O,"jsonEval",()=>K,"map",()=>et,"pingServer",()=>C,"querystring",()=>ei,"querystringDecode",()=>es,"safeGet",()=>Z,"stringLength",()=>ef,"stringToByteArray",()=>ed,"stringify",()=>G,"updateEmulatorBanner",()=>N,"validateIndexedDBOpenable",()=>z],97427);class eg{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let em="[DEFAULT]";class e_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new T;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:em})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=em){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=em){return this.instances.has(e)}getOptions(e=em){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===em?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=em){return this.component?this.component.multipleInstances?e:em:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ey{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new e_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>eg,"ComponentContainer",()=>ey,"Provider",()=>e_],8070);let ev=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let ew={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},eE=s.INFO,eb={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eT=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=eb[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eI{constructor(e){this.name=e,this._logLevel=eE,this._logHandler=eT,this._userLogHandler=null,ev.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ew[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}function eC(e){ev.forEach(t=>{t.setLogLevel(e)})}function eS(e,t){for(let n of ev){let r=null;t&&t.level&&(r=ew[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let o=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:s[n].toLowerCase(),message:o,args:i,type:t.name})}}}e.s(["LogLevel",()=>s,"Logger",()=>eI,"setLogLevel",()=>eC,"setUserLogHandler",()=>eS],83877);let ek=new WeakMap,eA=new WeakMap,eN=new WeakMap,eR=new WeakMap,eP=new WeakMap,eD={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eA.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eN.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ex(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ex(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ex(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ek.set(t,e)}).catch(()=>{}),eP.set(t,e),t}if(eR.has(e))return eR.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eO(this),t),ex(ek.get(this))}:function(...t){return ex(e.apply(eO(this),t))}:function(t,...n){let r=e.call(eO(this),t,...n);return eN.set(r,t.sort?t.sort():[t]),ex(r)};return e instanceof IDBTransaction&&function(e){if(eA.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eA.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eD):e}(e);return r!==e&&(eR.set(e,r),eP.set(r,e)),r}let eO=e=>eP.get(e),eL=["get","getKey","getAll","getAllKeys","count"],eM=["put","add","delete","clear"],eU=new Map;function eF(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eU.get(t))return eU.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eM.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eL.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return eU.set(t,s),s}eD={...r=eD,get:(e,t,n)=>eF(e,t)||r.get(e,t,n),has:(e,t)=>!!eF(e,t)||r.has(e,t)};class eV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eq="@firebase/app",eB="0.14.6",ej=new eI("@firebase/app"),ez="[DEFAULT]",e$={[eq]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eH=new Map,eW=new Map,eK=new Map;function eG(e,t){try{e.container.addComponent(t)}catch(n){ej.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eQ(e,t){e.container.addOrOverwriteComponent(t)}function eY(e){let t=e.name;if(eK.has(t))return ej.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eK.set(t,e),eH.values()))eG(n,e);for(let t of eW.values())eG(t,e);return!0}function eX(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function eJ(e,t,n=ez){eX(e,t).clearInstance(n)}function eZ(e){return void 0!==e.options}function e0(e){return!eZ(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function e1(e){return null!=e&&void 0!==e.settings}function e2(){eK.clear()}let e6=new H("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e3{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e6.create("app-deleted",{appName:this._name})}}function e4(e,t){let n=g(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e5 extends e3{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&e4(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e4(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tn(eq,eB,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tt(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e6.create("server-app-deleted")}}function e8(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:ez,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw e6.create("bad-app-name",{appName:String(i)});if(n||(n=E()),!n)throw e6.create("no-options");let s=eH.get(i);if(s)if(en(n,s.options)&&en(r,s.config))return s;else throw e6.create("duplicate-app",{appName:i});let o=new ey(i);for(let e of eK.values())o.addComponent(e);let a=new e3(n,r,o);return eH.set(i,a),a}function e7(e,t={}){let n;if(x()&&!O())throw e6.create("invalid-server-app-environment");let r=t||{};if(e&&(eZ(e)?n=e.options:e0(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=E()),!n)throw e6.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e6.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=eW.get(s);if(o)return o.incRefCount(r.releaseOnDeref),o;let a=new ey(s);for(let e of eK.values())a.addComponent(e);let l=new e5(n,r,s,a);return eW.set(s,l),l}function e9(e=ez){let t=eH.get(e);if(!t&&e===ez&&E())return e8();if(!t)throw e6.create("no-app",{appName:e});return t}function te(){return Array.from(eH.values())}async function tt(e){let t=!1,n=e.name;eH.has(n)?(t=!0,eH.delete(n)):eW.has(n)&&0>=e.decRefCount()&&(eW.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tn(e,t,n){let r=e$[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ej.warn(e.join(" "));return}eY(new eg(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tr(e,t){if(null!==e&&"function"!=typeof e)throw e6.create("invalid-log-argument");eS(e,t)}function ti(e){eC(e)}let ts="firebase-heartbeat-store",to=null;function ta(){return to||(to=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=ex(o);return r&&o.addEventListener("upgradeneeded",e=>{r(ex(o.result),e.oldVersion,e.newVersion,ex(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ts)}catch(e){console.warn(e)}}}).catch(e=>{throw e6.create("idb-open",{originalErrorMessage:e.message})})),to}async function tl(e){try{let t=(await ta()).transaction(ts),n=await t.objectStore(ts).get(tu(e));return await t.done,n}catch(e){if(e instanceof $)ej.warn(e.message);else{let t=e6.create("idb-get",{originalErrorMessage:e?.message});ej.warn(t.message)}}}async function th(e,t){try{let n=(await ta()).transaction(ts,"readwrite"),r=n.objectStore(ts);await r.put(t,tu(e)),await n.done}catch(e){if(e instanceof $)ej.warn(e.message);else{let t=e6.create("idb-set",{originalErrorMessage:e?.message});ej.warn(t.message)}}}function tu(e){return`${e.name}!${e.options.appId}`}class tc{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tf(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=td();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ej.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=td(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tp(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),tp(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=p(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ej.warn(e),""}}}function td(){return new Date().toISOString().substring(0,10)}class tf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!j()&&z().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tl(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return th(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return th(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tp(e){return p(JSON.stringify({version:2,heartbeats:e})).length}eY(new eg("platform-logger",e=>new eV(e),"PRIVATE")),eY(new eg("heartbeat",e=>new tc(e),"PRIVATE")),tn(eq,eB,""),tn(eq,eB,"esm2020"),tn("fire-js",""),e.s(["SDK_VERSION",()=>"12.6.0","_DEFAULT_ENTRY_NAME",()=>ez,"_addComponent",()=>eG,"_addOrOverwriteComponent",()=>eQ,"_apps",()=>eH,"_clearComponents",()=>e2,"_components",()=>eK,"_getProvider",()=>eX,"_isFirebaseApp",()=>eZ,"_isFirebaseServerApp",()=>e1,"_isFirebaseServerAppSettings",()=>e0,"_registerComponent",()=>eY,"_removeServiceInstance",()=>eJ,"_serverApps",()=>eW,"deleteApp",()=>tt,"getApp",()=>e9,"getApps",()=>te,"initializeApp",()=>e8,"initializeServerApp",()=>e7,"onLog",()=>tr,"registerVersion",()=>tn,"setLogLevel",()=>ti],92953)},51718,18357,e=>{"use strict";var t,n=e.i(92953),r=e.i(97427),i=e.i(83877),s=e.i(8070);function o(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let a=new r.ErrorFactory("auth","Firebase",o()),l=new i.Logger("@firebase/auth");function h(e,...t){l.logLevel<=i.LogLevel.ERROR&&l.error(`Auth (${n.SDK_VERSION}): ${e}`,...t)}function u(e,...t){throw p(e,...t)}function c(e,...t){return p(e,...t)}function d(e,t,n){let i={...o(),[t]:n};return new r.ErrorFactory("auth","Firebase",i).create(t,{appName:e.name})}function f(e){return d(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function p(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return a.create(e,...t)}function g(e,t,...n){if(!e)throw p(t,...n)}function m(e){let t="INTERNAL ASSERTION FAILED: "+e;throw h(t),Error(t)}function _(){return"undefined"!=typeof self&&self.location?.href||""}function y(){return"undefined"!=typeof self&&self.location?.protocol||null}class v{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||m(n),this.isMobile=(0,r.isMobileCordova)()||(0,r.isReactNative)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===y()||"https:"===y()||(0,r.isBrowserExtension)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function w(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||m(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class E{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void m("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void m("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void m("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let b={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},T=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],I=new v(3e4,6e4);function C(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function S(e,t,n,i,s={}){return k(e,s,async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});let a=(0,r.querystring)({key:e.config.apiKey,...o}).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);let h={method:t,headers:l,...s};return(0,r.isCloudflareWorker)()||(h.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,r.isCloudWorkstation)(e.emulatorConfig.host)&&(h.credentials="include"),E.fetch()(await N(e,e.config.apiHost,n,a),h)})}async function k(e,t,n){e._canInitEmulator=!1;let i={...b,...t};try{let t=new R(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw P(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw P(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw P(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw P(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw d(e,o,n);u(e,o)}}catch(t){if(t instanceof r.FirebaseError)throw t;u(e,"network-request-failed",{message:String(t)})}}async function A(e,t,n,r,i={}){let s=await S(e,t,n,r,i);return"mfaPendingCredential"in s&&u(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function N(e,t,n,r){let i=`${t}${n}?${r}`,s=e.config.emulator?w(e.config,i):`${e.config.apiScheme}://${i}`;return T.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class R{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(c(this.auth,"network-request-failed")),I.get())})}}function P(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=c(e,t,r);return i.customData._tokenResponse=n,i}function D(e){return void 0!==e&&void 0!==e.enterprise}class x{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function O(e,t){return S(e,"GET","/v2/recaptchaConfig",C(e,t))}async function L(e,t){return S(e,"POST","/v1/accounts:delete",t)}async function M(e,t){return S(e,"POST","/v1/accounts:lookup",t)}function U(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function F(e,t=!1){let n=(0,r.getModularInstance)(e),i=await n.getIdToken(t),s=q(i);g(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let o="object"==typeof s.firebase?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:i,authTime:U(V(s.auth_time)),issuedAtTime:U(V(s.iat)),expirationTime:U(V(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function V(e){return 1e3*Number(e)}function q(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return h("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,r.base64Decode)(n);if(!e)return h("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return h("Caught error parsing JWT payload as JSON",e?.toString()),null}}function B(e){let t=q(e);return g(t,"internal-error"),g(void 0!==t.exp,"internal-error"),g(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function j(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.FirebaseError&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class z{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ${constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=U(this.lastLoginAt),this.creationTime=U(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function H(e){var t,n;let r=e.auth,i=await e.getIdToken(),s=await j(e,M(r,{idToken:i}));g(s?.users.length,r,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?K(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,u=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new $(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&u})}async function W(e){let t=(0,r.getModularInstance)(e);await H(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function K(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function G(e,t){let n=await k(e,{},async()=>{let n=(0,r.querystring)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=await N(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:a,body:n};return e.emulatorConfig&&(0,r.isCloudWorkstation)(e.emulatorConfig.host)&&(l.credentials="include"),E.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Q(e,t){return S(e,"POST","/v2/accounts:revokeToken",C(e,t))}class Y{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(void 0!==e.idToken,"internal-error"),g(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):B(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){g(0!==e.length,"internal-error");let t=B(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(g(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await G(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Y;return n&&(g("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(g("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(g("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Y,this.toJSON())}_performRefresh(){return m("not implemented")}}function X(e,t){g("string"==typeof e||void 0===e,"internal-error",{appName:t})}class J{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new z(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new $(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await j(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return F(this,e)}reload(){return W(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new J({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await H(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,n._isFirebaseServerApp)(this.auth.app))return Promise.reject(f(this.auth));let e=await this.getIdToken();return await j(this,L(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;g(u&&p,e,"internal-error");let m=Y.fromJSON(this.name,p);g("string"==typeof u,e,"internal-error"),X(n,e.name),X(r,e.name),g("boolean"==typeof c,e,"internal-error"),g("boolean"==typeof d,e,"internal-error"),X(i,e.name),X(s,e.name),X(o,e.name),X(a,e.name),X(l,e.name),X(h,e.name);let _=new J({uid:u,auth:e,email:r,emailVerified:c,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:m,createdAt:l,lastLoginAt:h});return f&&Array.isArray(f)&&(_.providerData=f.map(e=>({...e}))),a&&(_._redirectEventId=a),_}static async _fromIdTokenResponse(e,t,n=!1){let r=new Y;r.updateFromServerResponse(t);let i=new J({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await H(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];g(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?K(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!i?.length,o=new Y;o.updateFromIdToken(n);let a=new J({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new $(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length}),a}}let Z=new Map;function ee(e){var t,n;t="Expected a class definition",e instanceof Function||m(t);let r=Z.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||m(n)):(r=new e,Z.set(e,r)),r}class et{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function en(e,t,n){return`firebase:${e}:${t}:${n}`}et.type="NONE";class er{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=en(this.userKey,r.apiKey,i),this.fullPersistenceKey=en("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await M(this.auth,{idToken:e}).catch(()=>void 0);return t?J._fromGetAccountInfoResponse(this.auth,t,e):null}return J._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new er(ee(et),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||ee(et),s=en(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let r;if("string"==typeof t){let n=await M(e,{idToken:t}).catch(()=>void 0);if(!n)break;r=await J._fromGetAccountInfoResponse(e,n,t)}else r=J._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}let a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length&&(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new er(i,e,n)}}function ei(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(el(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(es(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eu(t))return"Blackberry";if(ec(t))return"Webos";if(eo(t))return"Safari";if((t.includes("chrome/")||ea(t))&&!t.includes("edge/"))return"Chrome";if(eh(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function es(e=(0,r.getUA)()){return/firefox\//i.test(e)}function eo(e=(0,r.getUA)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ea(e=(0,r.getUA)()){return/crios\//i.test(e)}function el(e=(0,r.getUA)()){return/iemobile/i.test(e)}function eh(e=(0,r.getUA)()){return/android/i.test(e)}function eu(e=(0,r.getUA)()){return/blackberry/i.test(e)}function ec(e=(0,r.getUA)()){return/webos/i.test(e)}function ed(e=(0,r.getUA)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ef(e=(0,r.getUA)()){return ed(e)||eh(e)||ec(e)||eu(e)||/windows phone/i.test(e)||el(e)}function ep(e,t=[]){let i;switch(e){case"Browser":i=ei((0,r.getUA)());break;case"Worker":i=`${ei((0,r.getUA)())}-${e}`;break;default:i=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${n.SDK_VERSION}/${s}`}class eg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function em(e,t={}){return S(e,"GET","/v2/passwordPolicy",C(e,t))}class e_{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class ey{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ew(this),this.idTokenSubscription=new ew(this),this.beforeStateQueue=new eg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=a,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ee(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await er.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await M(this,{idToken:e}),n=await J._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,n._isFirebaseServerApp)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,n=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===n)&&s?.user&&(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(g(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await H(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,n._isFirebaseServerApp)(this.app))return Promise.reject(f(this));let t=e?(0,r.getModularInstance)(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,n._isFirebaseServerApp)(this.app)?Promise.reject(f(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,n._isFirebaseServerApp)(this.app)?Promise.reject(f(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ee(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new e_(await em(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new r.ErrorFactory("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await Q(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ee(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=await er.create(this,[ee(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ep(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if((0,n._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){l.logLevel<=i.LogLevel.WARN&&l.warn(`Auth (${n.SDK_VERSION}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ev(e){return(0,r.getModularInstance)(e)}class ew{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.createSubscribe)(e=>this.observer=e)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let eE={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eb(e){return`__${e}${Math.floor(1e6*Math.random())}`}class eT{constructor(){this.enterprise=new eI}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eI{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let eC="NO_RECAPTCHA";class eS{constructor(e){this.type="recaptcha-enterprise",this.auth=ev(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{O(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new x(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;D(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(eC)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eT().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&D(window.grecaptcha))r(n,e,i);else{var s;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=eE.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,eE.loadJS(s)).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function ek(e,t,n,r=!1,i=!1){let s,o=new eS(e);if(i)s=eC;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function eA(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await ek(e,t,n,"getOobCode"===n);return r(e,i)}});else{let i=await ek(e,t,n,"getOobCode"===n);return r(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await ek(e,t,n);return r(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await ek(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await ek(e,t,n,!1,!0);return r(e,i)}}async function eN(e){let t=ev(e),n=new x(await O(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new eS(t).verify()}function eR(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eP(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class eD{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return m("not implemented")}_getIdTokenResponse(e){return m("not implemented")}_linkToIdToken(e,t){return m("not implemented")}_getReauthenticationResolver(e){return m("not implemented")}}async function ex(e,t){return S(e,"POST","/v1/accounts:update",t)}async function eO(e,t){return S(e,"POST","/v1/accounts:signUp",t)}async function eL(e,t){return A(e,"POST","/v1/accounts:signInWithPassword",C(e,t))}async function eM(e,t){return S(e,"POST","/v1/accounts:sendOobCode",C(e,t))}async function eU(e,t){return eM(e,t)}async function eF(e,t){return A(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}async function eV(e,t){return A(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}class eq extends eD{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new eq(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new eq(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eA(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",eL,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eF(e,{email:this._email,oobCode:this._password});default:u(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eA(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eO,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eV(e,{idToken:t,email:this._email,oobCode:this._password});default:u(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eB(e,t){return A(e,"POST","/v1/accounts:signInWithIdp",C(e,t))}class ej extends eD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new ej(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):u("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...r}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let i=new ej(t,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return eB(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,eB(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eB(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.querystring)(t)}return e}}async function ez(e,t){return S(e,"POST","/v1/accounts:sendVerificationCode",C(e,t))}async function e$(e,t){return A(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t))}async function eH(e,t){let n=await A(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t));if(n.temporaryProof)throw P(e,"account-exists-with-different-credential",n);return n}let eW={USER_NOT_FOUND:"user-not-found"};async function eK(e,t){return A(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,{...t,operation:"REAUTH"}),eW)}class eG extends eD{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new eG({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new eG({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return e$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eH(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return eK(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new eG({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class eQ{constructor(e){const t=(0,r.querystringDecode)((0,r.extractQuerystring)(e)),n=t.apiKey??null,i=t.oobCode??null,s=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);g(n&&i&&s,"argument-error"),this.apiKey=n,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,i,s=(n=(t=(0,r.querystringDecode)((0,r.extractQuerystring)(e)).link)?(0,r.querystringDecode)((0,r.extractQuerystring)(t)).deep_link_id:null,((i=(0,r.querystringDecode)((0,r.extractQuerystring)(e)).deep_link_id)?(0,r.querystringDecode)((0,r.extractQuerystring)(i)).link:null)||i||n||t||e);try{return new eQ(s)}catch{return null}}}class eY{constructor(){this.providerId=eY.PROVIDER_ID}static credential(e,t){return eq._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=eQ.parseLink(t);return g(n,"argument-error"),eq._fromEmailAndCode(e,n.code,n.tenantId)}}eY.PROVIDER_ID="password",eY.EMAIL_PASSWORD_SIGN_IN_METHOD="password",eY.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class eX{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class eJ extends eX{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class eZ extends eJ{constructor(){super("facebook.com")}static credential(e){return ej._fromParams({providerId:eZ.PROVIDER_ID,signInMethod:eZ.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eZ.credentialFromTaggedObject(e)}static credentialFromError(e){return eZ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eZ.credential(e.oauthAccessToken)}catch{return null}}}eZ.FACEBOOK_SIGN_IN_METHOD="facebook.com",eZ.PROVIDER_ID="facebook.com";class e0 extends eJ{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ej._fromParams({providerId:e0.PROVIDER_ID,signInMethod:e0.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return e0.credentialFromTaggedObject(e)}static credentialFromError(e){return e0.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return e0.credential(t,n)}catch{return null}}}e0.GOOGLE_SIGN_IN_METHOD="google.com",e0.PROVIDER_ID="google.com";class e1 extends eJ{constructor(){super("github.com")}static credential(e){return ej._fromParams({providerId:e1.PROVIDER_ID,signInMethod:e1.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e1.credentialFromTaggedObject(e)}static credentialFromError(e){return e1.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e1.credential(e.oauthAccessToken)}catch{return null}}}e1.GITHUB_SIGN_IN_METHOD="github.com",e1.PROVIDER_ID="github.com";class e2 extends eJ{constructor(){super("twitter.com")}static credential(e,t){return ej._fromParams({providerId:e2.PROVIDER_ID,signInMethod:e2.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return e2.credentialFromTaggedObject(e)}static credentialFromError(e){return e2.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return e2.credential(t,n)}catch{return null}}}async function e6(e,t){return A(e,"POST","/v1/accounts:signUp",C(e,t))}e2.TWITTER_SIGN_IN_METHOD="twitter.com",e2.PROVIDER_ID="twitter.com";class e3{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new e3({user:await J._fromIdTokenResponse(e,n,r),providerId:e4(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new e3({user:e,providerId:e4(n),_tokenResponse:n,operationType:t})}}function e4(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class e5 extends r.FirebaseError{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,e5.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new e5(e,t,n,r)}}function e8(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw e5._fromErrorAndOperation(e,n,t,r);throw n})}async function e7(e,t,n=!1){let r=await j(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return e3._forOperation(e,"link",r)}async function e9(e,t,r=!1){let{auth:i}=e;if((0,n._isFirebaseServerApp)(i.app))return Promise.reject(f(i));let s="reauthenticate";try{let n=await j(e,e8(i,s,t,e),r);g(n.idToken,i,"internal-error");let o=q(n.idToken);g(o,i,"internal-error");let{sub:a}=o;return g(e.uid===a,i,"user-mismatch"),e3._forOperation(e,s,n)}catch(e){throw e?.code==="auth/user-not-found"&&u(i,"user-mismatch"),e}}async function te(e,t,r=!1){if((0,n._isFirebaseServerApp)(e.app))return Promise.reject(f(e));let i="signIn",s=await e8(e,i,t),o=await e3._fromIdTokenResponse(e,i,s);return r||await e._updateCurrentUser(o.user),o}async function tt(e,t){return te(ev(e),t)}async function tn(e,t){return e9((0,r.getModularInstance)(e),t)}class tr{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ti._fromServerResponse(e,t):"totpInfo"in t?ts._fromServerResponse(e,t):u(e,"internal-error")}}class ti extends tr{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ti(t)}}class ts extends tr{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ts(t)}}async function to(e){let t=ev(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ta(e,t,n){let r=ev(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&(g(n.url?.length>0,r,"invalid-continue-uri"),g(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,r,"invalid-dynamic-link-domain"),g(void 0===n.linkDomain||n.linkDomain.length>0,r,"invalid-hosting-link-domain"),i.continueUrl=n.url,i.dynamicLinkDomain=n.dynamicLinkDomain,i.linkDomain=n.linkDomain,i.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(g(n.iOS.bundleId.length>0,r,"missing-ios-bundle-id"),i.iOSBundleId=n.iOS.bundleId),n.android&&(g(n.android.packageName.length>0,r,"missing-android-pkg-name"),i.androidInstallApp=n.android.installApp,i.androidMinimumVersionCode=n.android.minimumVersion,i.androidPackageName=n.android.packageName)),await eA(r,i,"getOobCode",eU,"EMAIL_PASSWORD_PROVIDER")}async function tl(e,t,r){if((0,n._isFirebaseServerApp)(e.app))return Promise.reject(f(e));let i=ev(e),s=eA(i,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",e6,"EMAIL_PASSWORD_PROVIDER"),o=await s.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&to(e),t}),a=await e3._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(a.user),a}function th(e,t,i){return(0,n._isFirebaseServerApp)(e.app)?Promise.reject(f(e)):tt((0,r.getModularInstance)(e),eY.credential(t,i)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&to(e),t})}async function tu(e,t){return S(e,"POST","/v1/accounts:update",t)}async function tc(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;let i=(0,r.getModularInstance)(e),s=await i.getIdToken(),o=await j(i,tu(i.auth,{idToken:s,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;let a=i.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function td(e,t){let i=(0,r.getModularInstance)(e);return(0,n._isFirebaseServerApp)(i.auth.app)?Promise.reject(f(i.auth)):tp(i,t,null)}function tf(e,t){return tp((0,r.getModularInstance)(e),null,t)}async function tp(e,t,n){let{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);let s=await j(e,ex(r,i));await e._updateTokensIfNecessary(s,!0)}function tg(e,t,n,i){return(0,r.getModularInstance)(e).onAuthStateChanged(t,n,i)}function tm(e){return(0,r.getModularInstance)(e).signOut()}async function t_(e){return(0,r.getModularInstance)(e).delete()}function ty(e,t){return S(e,"POST","/v2/accounts/mfaEnrollment:start",C(e,t))}new WeakMap;let tv="__sak";class tw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(tv,"1"),this.storage.removeItem(tv),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class tE extends tw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ef(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let n=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,r.isIE)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tE.type="LOCAL";class tb extends tw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tb.type="SESSION";class tT{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new tT(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function tI(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}tT.receivers=[];class tC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=tI("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(h),clearTimeout(r),a(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function tS(){return window}function tk(){return void 0!==tS().WorkerGlobalScope&&"function"==typeof tS().importScripts}async function tA(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let tN="firebaseLocalStorageDb",tR="firebaseLocalStorage",tP="fbase_key";class tD{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tx(e,t){return e.transaction([tR],t?"readwrite":"readonly").objectStore(tR)}function tO(){let e=indexedDB.open(tN,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tR,{keyPath:tP})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(tR)?t(n):(n.close(),await new tD(indexedDB.deleteDatabase(tN)).toPromise(),t(await tO()))})})}async function tL(e,t,n){return new tD(tx(e,!0).put({[tP]:t,value:n})).toPromise()}async function tM(e,t){let n=tx(e,!1).get(t),r=await new tD(n).toPromise();return void 0===r?null:r.value}function tU(e,t){return new tD(tx(e,!0).delete(t)).toPromise()}class tF{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await tO()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tk()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tT._getInstance(tk()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await tA(),!this.activeServiceWorker)return;this.sender=new tC(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await tO();return await tL(e,tv,"1"),await tU(e,tv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>tL(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tM(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tU(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new tD(tx(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function tV(e,t){return S(e,"POST","/v2/accounts/mfaSignIn:start",C(e,t))}tF.type="LOCAL",eb("rcb"),new v(3e4,6e4);let tq="recaptcha";async function tB(e,t,n){if(!e._getRecaptchaConfig())try{await eN(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){g("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===eC){g(n?.type===tq,e,"argument-error");let r=await tj(e,t,n);return ty(e,r)}return ty(e,t)},o=eA(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{g("signin"===t.type,e,"internal-error");let i=r.multiFactorHint?.uid||r.multiFactorUid;g(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===eC){g(n?.type===tq,e,"argument-error");let r=await tj(e,t,n);return tV(e,r)}return tV(e,t)},a=eA(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===eC){g(n?.type===tq,e,"argument-error");let r=await tj(e,t,n);return ez(e,r)}return ez(e,t)},s=eA(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function tj(e,t,n){g(n.type===tq,e,"argument-error");let r=await n.verify();g("string"==typeof r,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:r}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}}class tz{constructor(e){this.providerId=tz.PROVIDER_ID,this.auth=ev(e)}verifyPhoneNumber(e,t){return tB(this.auth,e,(0,r.getModularInstance)(t))}static credential(e,t){return eG._fromVerification(e,t)}static credentialFromResult(e){return tz.credentialFromTaggedObject(e)}static credentialFromError(e){return tz.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?eG._fromTokenResponse(t,n):null}}function t$(e,t){return t?ee(t):(g(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}tz.PROVIDER_ID="phone",tz.PHONE_SIGN_IN_METHOD="phone";class tH extends eD{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eB(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eB(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eB(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tW(e){return te(e.auth,new tH(e),e.bypassAuthState)}function tK(e){let{auth:t,user:n}=e;return g(n,t,"internal-error"),e9(n,new tH(e),e.bypassAuthState)}async function tG(e){let{auth:t,user:n}=e;return g(n,t,"internal-error"),e7(n,new tH(e),e.bypassAuthState)}class tQ{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tW;case"linkViaPopup":case"linkViaRedirect":return tG;case"reauthViaPopup":case"reauthViaRedirect":return tK;default:u(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||m(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||m(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let tY=new v(2e3,1e4);async function tX(e,t,r){if((0,n._isFirebaseServerApp)(e.app))return Promise.reject(c(e,"operation-not-supported-in-this-environment"));let i=ev(e);if(!(t instanceof eX))throw eX.name!==t.constructor.name&&u(e,"argument-error"),d(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let s=t$(i,r);return new tJ(i,"signInViaPopup",t,s).executeNotNull()}class tJ extends tQ{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,tJ.currentPopupAction&&tJ.currentPopupAction.cancel(),tJ.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return g(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||m(t);let n=tI();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(c(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(c(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tJ.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(c(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,tY.get())};e()}}tJ.currentPopupAction=null;let tZ=new Map;class t0 extends tQ{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=tZ.get(this.auth._key());if(!e){try{let t=await t1(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}tZ.set(this.auth._key(),e)}return this.bypassAuthState||tZ.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function t1(e,t){var n;let r=en("pendingRedirect",(n=t).config.apiKey,n.name),i=ee(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(r)==="true";return await i._remove(r),s}function t2(e,t){tZ.set(e._key(),t)}async function t6(e,t,r=!1){if((0,n._isFirebaseServerApp)(e.app))return Promise.reject(f(e));let i=ev(e),s=t$(i,t),o=new t0(i,s,r),a=await o.execute();return a&&!r&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class t3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return t5(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!t5(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(c(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(t4(e))}saveEventToCache(e){this.cachedEventUids.add(t4(e)),this.lastProcessedEventTime=Date.now()}}function t4(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function t5({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function t8(e,t={}){return S(e,"GET","/v1/projects",t)}let t7=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,t9=/^https?/;async function ne(e){if(e.config.emulator)return;let{authorizedDomains:t}=await t8(e);for(let e of t)try{if(function(e){let t=_(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!t9.test(n))return!1;if(t7.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch{}u(e,"unauthorized-domain")}let nt=new v(3e4,6e4);function nn(){let e=tS().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let nr=null,ni=new v(5e3,15e3),ns={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},no=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function na(e){let t,i,s,o,a,l=await (nr=nr||new Promise((t,n)=>{function r(){nn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nn(),n(c(e,"network-request-failed"))},timeout:nt.get()})}if(tS().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(tS().gapi?.load)r();else{var i;let t=eb("iframefcb");return tS()[t]=()=>{gapi.load?r():n(c(e,"network-request-failed"))},(i=`${eE.gapiScript}?onload=${t}`,eE.loadJS(i)).catch(e=>n(e))}}).catch(e=>{throw nr=null,e})),h=tS().gapi;return g(h,e,"internal-error"),l.open({where:document.body,url:(g((t=e.config).authDomain,e,"auth-domain-config-required"),i=t.emulator?w(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:n.SDK_VERSION},(o=no.get(e.config.apiHost))&&(s.eid=o),(a=e._getFrameworks()).length&&(s.fw=a.join(",")),`${i}?${(0,r.querystring)(s).slice(1)}`),messageHandlersFilter:h.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ns,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=c(e,"network-request-failed"),s=tS().setTimeout(()=>{r(i)},ni.get());function o(){tS().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}let nl={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nu=encodeURIComponent("fac");async function nc(e,t,i,s,o,a){g(e.config.authDomain,e,"auth-domain-config-required"),g(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:i,redirectUrl:s,v:n.SDK_VERSION,eventId:o};if(t instanceof eX)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,r.isEmpty)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(a||{})))l[n]=i;if(t instanceof eJ){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}for(let t of(e.tenantId&&(l.tid=e.tenantId),Object.keys(l)))void 0===l[t]&&delete l[t];let h=await e._getAppCheckToken(),u=h?`#${nu}=${encodeURIComponent(h)}`:"";return`${function({config:e}){return e.emulator?w(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,r.querystring)(l).slice(1)}${u}`}let nd="webStorageSupport",nf=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tb,this._completeRedirectFn=t6,this._overrideRedirectResult=t2}async _openPopup(e,t,n,i){var s,o;s=this.eventManagers[e._key()]?.manager,o="_initialize() not called before _openPopup()",s||m(o);let a=await nc(e,t,n,_(),i);return function(e,t,n,i=500,s=600){let o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString(),l="",h={...nl,width:i.toString(),height:s.toString(),top:o,left:a},u=(0,r.getUA)().toLowerCase();n&&(l=ea(u)?"_blank":n),es(u)&&(t=t||"http://localhost",h.scrollbars="yes");let c=Object.entries(h).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,r.getUA)()){return ed(e)&&!!window.navigator?.standalone}(u)&&"_self"!==l){var d,f;let e,n;return d=t||"",f=l,(e=document.createElement("a")).href=d,e.target=f,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new nh(null)}let p=window.open(t||"",l,c);g(p,e,"popup-blocked");try{p.focus()}catch(e){}return new nh(p)}(e,a,tI())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await nc(e,t,n,_(),r),tS().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||m(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await na(e),n=new t3(e);return t.register("authEvent",t=>(g(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nd,{type:nd},n=>{let r=n?.[0]?.[nd];void 0!==r&&t(!!r),u(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ne(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ef()||eo()||ed()}};var np="@firebase/auth",ng="1.12.0";class nm{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let n_=(0,r.getExperimentalSetting)("authIdTokenMaxAge")||300,ny=null;function nv(e=(0,n.getApp)()){let t=(0,n._getProvider)(e,"auth");if(t.isInitialized())return t.getImmediate();let i=function(e,t){let i=(0,n._getProvider)(e,"auth");if(i.isInitialized()){let e=i.getImmediate(),n=i.getOptions();if((0,r.deepEqual)(n,t??{}))return e;u(e,"already-initialized")}return i.initialize({options:t})}(e,{popupRedirectResolver:nf,persistence:[tF,tE,tb]}),s=(0,r.getExperimentalSetting)("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){let t,n=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>n_)return;let i=n?.token;ny!==i&&(ny=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});(0,r.getModularInstance)(i).beforeAuthStateChanged(n,()=>n(i.currentUser)),(0,r.getModularInstance)(i).onIdTokenChanged(e=>n(e),void 0,void 0)}}let o=(0,r.getDefaultEmulatorHost)("auth");return o&&function(e,t,n){let i=ev(e);g(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let s=eR(t),{host:o,port:a}=function(e){let t=eR(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:eP(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:eP(t)}}}(t),l=null===a?"":`:${a}`,h={url:`${s}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){g(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),g((0,r.deepEqual)(h,i.config.emulator)&&(0,r.deepEqual)(u,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=h,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,(0,r.isCloudWorkstation)(o)?((0,r.pingServer)(`${s}//${o}${l}`),(0,r.updateEmulatorBanner)("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(i,`http://${o}`),i}eE={loadJS:e=>new Promise((t,n)=>{let r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{let t=c("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},t="Browser",(0,n._registerComponent)(new s.Component("auth",(e,{options:n})=>{let r,i,s=e.getProvider("app").getImmediate(),o=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:l,authDomain:h}=s.options;g(l&&!l.includes(":"),"invalid-api-key",{appName:s.name});let u=new ey(s,o,a,{apiKey:l,authDomain:h,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ep(t)});return i=(Array.isArray(r=n?.persistence||[])?r:[r]).map(ee),n?.errorMap&&u._updateErrorMap(n.errorMap),u._initializeWithPersistence(i,n?.popupRedirectResolver),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,n._registerComponent)(new s.Component("auth-internal",e=>new nm(ev(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,n.registerVersion)(np,ng,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(t)),(0,n.registerVersion)(np,ng,"esm2020"),e.s([],58556),e.s([],51718),e.i(58556),e.s(["EmailAuthProvider",()=>eY,"GoogleAuthProvider",()=>e0,"browserPopupRedirectResolver",()=>nf,"createUserWithEmailAndPassword",()=>tl,"deleteUser",()=>t_,"getAuth",()=>nv,"onAuthStateChanged",()=>tg,"reauthenticateWithCredential",()=>tn,"sendPasswordResetEmail",()=>ta,"signInWithEmailAndPassword",()=>th,"signInWithPopup",()=>tX,"signOut",()=>tm,"updateEmail",()=>td,"updatePassword",()=>tf,"updateProfile",()=>tc],18357)},14539,76510,e=>{"use strict";var t=e.i(92953);(0,t.registerVersion)("firebase","12.7.0","app"),e.s([],14539),e.i(97427),e.s(["getApps",()=>t.getApps,"initializeApp",()=>t.initializeApp],76510)},67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],h=new i((o+a)*3/4-a),u=0,c=a>0?o-4:o;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(function(e,t,r){for(var i,s=[],o=t;o<r;o+=3)i=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=o(s),h=l.write(r,i);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return a.from(u,t,n);var p=function(e){if(a.isBuffer(e)){var t=0|d(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),o(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=o(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return(h(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(e).length;default:if(i)return r?-1:C(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var i,s,o,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=R[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return y(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,o=n,0===s&&o===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return _(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var s,o=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*o}else -1!==u&&(s-=s-u),u=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=a.from(s)),!a.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?y(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(e,t,n,r,i){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,o=n-t,l=Math.min(s,o),h=this.slice(r,i),u=e.slice(t,n),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],o=u[c];break}return s<o?-1:+(o<s)},a.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function y(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,l,h=e[i],u=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=n)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[i+1],o=e[i+2],(192&s)==128&&(192&o)==128&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function w(e,t,n,r,i,s){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function E(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function b(e,t,n,r,s){return t*=1,n>>>=0,s||E(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function T(e,t,n,r,s){return t*=1,n>>>=0,s||E(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,o,a,l,h,u,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a,l=parseInt(t.substr(2*o,2),16);if((a=l)!=a)break;e[n+o]=l}return o}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,A(C(e,this.length-i),this,i,s);case"ascii":return o=t,a=n,A(S(e),this,o,a);case"latin1":case"binary":return function(e,t,n,r){return A(S(t),e,n,r)}(this,e,t,n);case"base64":return l=t,h=n,A(k(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,A(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return b(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return b(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=a.isBuffer(e)?e:a.from(e,r),l=o.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function C(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319||o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function k(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=h}return(f?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,i),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},o=!0;try{r[e](n,n.exports,s),o=!1}finally{o&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,98925,e=>{"use strict";e.i(47167);var t,n,r,i,s,o,a,l,h,u,c,d,f,p,g=e.i(67034),m=e.i(92953),_=e.i(8070),y=e.i(83877),v=e.i(97427),w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,E={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var r=function(){this.blockSize=-1};function i(){}function s(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],o;o=t+(s^n&(i^s))+r[0]+0xd76aa478|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function o(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}i.prototype=r.prototype,e.F=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.D=function(e,t,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return r.prototype[t].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,r=this.C,i=this.h,o=0;for(;o<t;){if(0==i)for(;o<=n;)s(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[i++]=e.charCodeAt(o++),i==this.blockSize){s(this,r),i=0;break}}else for(;o<t;)if(r[i++]=e[o++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var a,l={};function h(e){var t;return -128<=e&&e<128?(t=function(e){return new o([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new o([0|e],e<0?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(u(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new o(t,0)}var c=h(0),d=h(1),f=h(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new o(n,~e.h).add(d)}function _(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(p(t))throw Error("division by zero");if(p(e))return new v(c,c);if(g(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=T(n,1),s=T(r,1);for(r=T(r,2),n=T(n,2);!p(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=T(r,1),n=T(n,1)}return t=_(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),o=(s=u(n)).j(t);g(o)||o.l(e)>0;)n-=r,o=(s=u(n)).j(t);p(s)&&(s=d),i=i.add(s),e=_(e,o)}return new v(i,e)}function b(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new o(n,e.h)}function T(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new o(i,e.h)}(a=o.prototype).m=function(){if(g(this))return-m(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},a.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);let t=u(Math.pow(e,6));var n=this;let r="";for(;;){let i=w(n,t).g,s=(((n=_(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},a.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},a.l=function(e){return g(e=_(this,e))?-1:+!p(e)},a.abs=function(){return g(this)?m(this):this},a.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new o(n,-0x80000000&n[n.length-1]?-1:0)},a.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return u(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=s*a,y(n,2*r+2*t),n[2*r+2*t+1]+=i*a,y(n,2*r+2*t+1),n[2*r+2*t+1]+=s*o,y(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,y(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new o(n,0)},a.B=function(e){return w(this,e).h},a.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new o(n,this.h&e.h)},a.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new o(n,this.h|e.h)},a.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new o(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,n=E.Md5=e,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=u(Math.pow(n,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let o=parseInt(t.substring(e,e+s),n);s<8?(s=u(Math.pow(n,s)),i=i.j(s).add(u(o))):i=(i=i.j(r)).add(u(o))}return i},t=E.Integer=o}).apply(void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,T={};(function(){var e,t,n=Object.defineProperty,c=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof b&&b];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function d(e,t){if(t)e:{var r=c;e=e.split(".");for(var i=0;i<e.length-1;i++){var s=e[i];if(!(s in r))break e;r=r[s]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}d("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var f=f||{},p=this||self;function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function m(e,t,n){return e.call.apply(e.bind,arguments)}function _(e,t,n){return(_=m).apply(null,arguments)}function y(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var w="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new S,e=>e.reset());class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let k,A=!1,N=new class{constructor(){this.h=this.g=null}add(e,t){let n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},R=()=>{let e=Promise.resolve(void 0);k=()=>{e.then(P)}};function P(){let e;for(var t;e=null,N.g&&(e=N.g,N.g=N.g.next,N.g||(N.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){p.setTimeout(()=>{throw e},0)}(e)}C.j(t),C.h<100&&(C.h++,t.next=C.g,C.g=t)}A=!1}function D(){this.u=this.u,this.C=this.C}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.u=!1,D.prototype.dispose=function(){this.u||(this.u=!0,this.N())},D.prototype[Symbol.dispose]=function(){this.dispose()},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};p.addEventListener("test",e,t),p.removeEventListener("test",e,t)}catch(e){}return e}();function L(e){return/^[\s\xa0]*$/.test(e)}function M(e,t){x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(M,x),M.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function j(e){let t={};for(let n in e)t[n]=e[n];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<z.length;t++)n=z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function H(e){this.src=e,this.g={},this.h=0}function W(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function K(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}H.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let o=K(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),Q={};function Y(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let o=g(i)?!!i.capture:!!i,a=ee(e);if(a||(e[G]=a=new H(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return Z.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function X(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])W(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(J(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ee(t))?(W(n,e),0==n.h&&(n.src=null,t[G]=null)):q(e)}}}function J(e){return e in Q?Q[e]:Q[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new M(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&X(e),e=n.call(r,t)}return e}function ee(e){return(e=e[G])instanceof H?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function er(){D.call(this),this.i=new H(this),this.M=this,this.G=null}function ei(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var o=t;$(t=new x(s,e),o)}if(o=!0,i)for(r=i.length-1;r>=0;r--)o=es(n=t.g=i[r],s,!0,t)&&o;if(o=es(n=t.g=e,s,!0,t)&&o,o=es(n,s,!1,t)&&o,i)for(r=0;r<i.length;r++)o=es(n=t.g=i[r],s,!1,t)&&o}function es(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let o=t[s];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&W(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}v(er,D),er.prototype[U]=!0,er.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=g(i)?!!i.capture:!!i,r=en(r),t&&t[U])?(t=t.i,(o=String(n).toString())in t.g&&(r=K(n=t.g[o],r,i,s))>-1&&(q(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[o],t.h--))):t&&(t=ee(t))&&(n=t.g[n.toString()],t=-1,n&&(t=K(n,r,i,s)),(r=t>-1?n[t]:null)&&X(r))}(this,e,t,n,r)},er.prototype.N=function(){if(er.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)q(n[e]);delete e.g[t],e.h--}}this.G=null},er.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},er.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eo extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=_(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:p.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ea(e){D.call(this),this.h=e,this.g={}}v(ea,D);var el=[];function eh(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&X(e)},e),e.g={}}ea.prototype.N=function(){ea.Z.N.call(this),eh(this)},ea.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eu=p.JSON.stringify,ec=p.JSON.parse,ed=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function ef(){}function ep(){}var eg={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function em(){x.call(this,"d")}function e_(){x.call(this,"c")}v(em,x),v(e_,x);var ey={},ev=null;function ew(){return ev=ev||new er}function eE(e){x.call(this,ey.Ia,e)}function eb(e){let t=ew();ei(t,new eE(t))}function eT(e,t){x.call(this,ey.STAT_EVENT,e),this.stat=t}function eI(e){let t=ew();ei(t,new eT(t,e))}function eC(e,t){x.call(this,ey.Ja,e),this.size=t}function eS(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}function ek(){this.g=!0}function eA(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return eu(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ey.Ia="serverreachability",v(eE,x),ey.STAT_EVENT="statevent",v(eT,x),ey.Ja="timingevent",v(eC,x),ek.prototype.ua=function(){this.g=!1},ek.prototype.info=function(){};var eN={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eR={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eP(){}function eD(e){return encodeURIComponent(String(e))}function ex(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ea(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eO}function eO(){this.i=null,this.g="",this.h=!1}v(eP,ef),eP.prototype.g=function(){return new XMLHttpRequest},e=new eP;var eL={},eM={};function eU(e,t,n){e.M=1,e.A=e8(e2(t)),e.u=n,e.R=!0,eF(e,null)}function eF(e,t){e.F=Date.now(),eq(e),e.B=e2(e.A);var n,r,i,s,o,a,l=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tc(l.i,"t",h),e.C=0,l=e.j.L,e.h=new eO,e.g=tX(e.j,l?t:null,!e.u),e.P>0&&(e.O=new eo(_(e.Y,e,e.g),e.P)),t=e.V,l=e.g,h=e.ba;var u="readystatechange";Array.isArray(u)||(u&&(el[0]=u.toString()),u=el);for(let e=0;e<u.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=en(r),t&&t[U]?t.K(n,r,g(i)?!!i.capture:!!i,s):Y(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=en(r),t&&t[U]?t.J(n,r,g(i)?!!i.capture:!!i,s):Y(t,n,r,!1,i,s)}(l,u[e],h||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),n=e.i,r=e.v,i=e.B,s=e.l,o=e.S,a=e.u,n.info(function(){if(n.g)if(a){var e="",t=a.split("&");for(let n=0;n<t.length;n++){var l=t[n].split("=");if(l.length>1){let t=l[0];l=l[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=a;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function eV(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eq(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eS(_(e.aa,e),t)}function ej(e){e.D&&(p.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||tW(e.j,e)}function e$(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eh(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eH(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eY(n.h,e))){if(!e.L&&eY(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tH(n),tL(n);else break e;tj(n),eI(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eS(_(n.Va,n),6e3));1>=eQ(n.h)&&n.ta&&(n.ta=void 0)}else tG(n,11)}else if((e.L||n.g==e)&&tH(n),!L(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let a=i[t],l=a[0];if(!(l<=n.K))if(n.K=l,a=a[1],2==n.I)if("c"==a[0]){n.M=a[1],n.ba=a[2];let t=a[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=a[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=a[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eX(s,s.h),s.h=null))}if(r.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e5(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tY(r,r.L?r.ba:null,r.W),e.L){eJ(r.h,e);var o=r.O;o&&(e.H=o),e.D&&(ej(e),eq(e)),r.g=e}else tB(r);n.i.length>0&&tU(n)}else"stop"!=a[0]&&"close"!=a[0]||tG(n,7);else 3==n.I&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tG(n,7):tO(n):"noop"!=a[0]&&n.l&&n.l.qa(a),n.A=0)}}eb(4)}catch(e){}}ex.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tR(e)?t.j():this.Y(e)},ex.prototype.Y=function(e){try{if(e==this.g)e:{let d=tR(this.g),f=this.g.ya(),g=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tP(this.g)))){this.K||4!=d||7==f||(8==f||g<=0?eb(3):eb(2)),ej(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eV(e))return e.g.la();let t=tP(e.g);if(""===t)return"";let n="",r=t.length,i=4==tR(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return e$(e),ez(e),"";e.h.i=new p.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,o=this.l,a=this.S,r.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+a+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,o,a,l,h=this.g;if((l=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(l)){var u=l;break t}}u=null}if(e=u)eA(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eH(this,e);else{this.o=!1,this.m=3,eI(12),e$(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eM:isNaN(n=Number(t.substring(n,r)))?eL:(r+=1)+n>t.length?eM:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eM){4==d&&(this.m=4,eI(14),e=!1),eA(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eL){this.m=4,eI(15),eA(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eA(this.i,this.l,t,null),eH(this,t);if(eV(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=n.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tz(c),c.P=!0,eI(11))}}else eA(this.i,this.l,n,"[Invalid Chunked Response]"),e$(this),ez(this)}else eA(this.i,this.l,n,null),eH(this,n);4==d&&e$(this),this.o&&!this.K&&(4==d?tW(this.j,this):(this.o=!1,eq(this)))}else(function(e){let t={};e=(e.g&&tR(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(L(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),e$(this),ez(this)}}}catch(e){}finally{}},ex.prototype.cancel=function(){this.K=!0,e$(this)},ex.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eI(17)),e$(this),this.m=2,ez(this)):eB(this,this.T-n)};var eW=class{constructor(e,t){this.g=e,this.map=t}};function eK(e){this.l=e||10,e=p.PerformanceNavigationTiming?(e=p.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(p.chrome&&p.chrome.loadTimes&&p.chrome.loadTimes()&&p.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eG(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eQ(e){return e.h?1:e.g?e.g.size:0}function eY(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eX(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return E(e.i)}eK.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e6(this,e.j),this.o=e.o,this.g=e.g,e3(this,e.u),this.h=e.h,e4(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e6(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e3(this,t[4]),this.h=e7(t[5]||"",!0),e4(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new to(null,this.l))}function e2(e){return new e1(e)}function e6(e,t,n){e.j=n?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e3(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e4(e,t,n){var r,i;t instanceof to?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ta(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(tl(this,t),tc(this,n,e))},r)),r.j=i):(n||(t=e9(t,ti)),e.i=new to(t,e.l))}function e5(e,t,n){e.i.set(t,n)}function e8(e){return e5(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,te),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eD(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e9(n,"/"==n.charAt(0)?tr:tn,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e9(n,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),n=!!e.j;n?e6(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e3(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e4(t,td(e.i)):n=!!e.m,n&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tn=/[#\?:]/g,tr=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function to(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ta(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tl(e,t){ta(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function th(e,t){return ta(e),t=tf(e,t),e.g.has(t)}function tu(e,t){ta(e);let n=[];if("string"==typeof t)th(e,t)&&(n=n.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tc(e,t,n){tl(e,t),n.length>0&&(e.i=null,e.g.set(tf(e,t),E(n)),e.h+=n.length)}function td(e){let t=new to;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tp(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tg(){this.g=new ed}function tm(e){this.i=e.Sb||null,this.h=e.ab||!1}function t_(e,t){er.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function ty(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tw(e)}function tw(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tE(e){let t="";return B(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tb(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tE(n),"string"==typeof e?null!=n&&eD(n):e5(e,t,n))}function tT(e){er.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=to.prototype).add=function(e,t){ta(this),this.i=null,e=tf(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ta(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ta(this),this.i=null,th(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tu(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eD(n);n=tu(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eD(n[t])),e.push(r)}}return this.i=e.join("&")},v(tm,ef),tm.prototype.g=function(){return new t_(this.i,this.h)},v(t_,er),(t=t_.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tw(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||p).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tw(this)),this.g&&(this.readyState=3,tw(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==p.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ty(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tw(this),3==this.readyState&&ty(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(t_.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tT,er);var tI=/^https?$/i,tC=["POST","PUT"];function tS(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tk(e),tN(e)}function tk(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tA(e){if(e.h&&void 0!==f){if(e.v&&4==tR(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tR(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(e0)[1]||null;!t&&p.self&&p.self.location&&(t=p.self.location.protocol.slice(0,-1)),n=!tI.test(t?t.toLowerCase():"")}t=n}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tR(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tk(e)}}finally{tN(e)}}}}function tN(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||ei(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tR(e){return e.g?e.g.readyState:0}function tP(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tD(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tx(e){this.za=0,this.i=[],this.j=new ek,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tD("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tD("baseRetryDelayMs",5e3,e),this.Za=tD("retryDelaySeedMs",1e4,e),this.Ta=tD("forwardChannelMaxRetries",2,e),this.va=tD("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eK(e&&e.concurrentRequestLimit),this.Ba=new tg,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tO(e){if(tM(e),3==e.I){var t=e.V++,n=e2(e.J);if(e5(n,"SID",e.M),e5(n,"RID",t),e5(n,"TYPE","terminate"),tV(e,n),(t=new ex(e,e.j,t)).M=2,t.A=e8(e2(n)),n=!1,p.navigator&&p.navigator.sendBeacon)try{n=p.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&p.Image&&((new Image).src=t.A,n=!0),n||(t.g=tX(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eq(t)}tQ(e)}function tL(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tM(e){tL(e),e.v&&(p.clearTimeout(e.v),e.v=null),tH(e),e.h.cancel(),e.m&&("number"==typeof e.m&&p.clearTimeout(e.m),e.m=null)}function tU(e){if(!eG(e.h)&&!e.m){e.m=!0;var t=e.Ea;k||R(),A||(k(),A=!0),N.add(t,e),e.D=0}}function tF(e,t){var n;n=t?t.l:e.V++;let r=e2(e.J);e5(r,"SID",e.M),e5(r,"RID",n),e5(r,"AID",e.K),tV(e,r),e.u&&e.o&&tb(r,e.u,e.o),n=new ex(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tq(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eX(e.h,n),eU(n,r,t)}function tV(e,t){e.H&&B(e.H,function(e,n){e5(t,n,e)}),e.l&&B({},function(e,n){e5(t,n,e)})}function tq(e,t,n){n=Math.min(e.i.length,n);let r=e.l?_(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let l=0;l<n;l++){var s=i[l].g;let n=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),a=!1;else try{s="req"+s+"_";try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;g(n)&&(r=eu(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(a){o=e.join("&");break e}}o=void 0}return t.G=e=e.i.splice(0,n),o}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;k||R(),A||(k(),A=!0),N.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eS(_(e.Da,e),tK(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(p.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new ex(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e5(t,"RID","rpc"),e5(t,"SID",e.M),e5(t,"AID",e.K),e5(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e5(t,"TO",e.ia),e5(t,"TYPE","xmlhttp"),tV(e,t),e.u&&e.o&&tb(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e8(e2(t)),n.u=null,n.R=!0,eF(n,e)}function tH(e){null!=e.C&&(p.clearTimeout(e.C),e.C=null)}function tW(e,t){var n,r=null;if(e.g==t){tH(e),tz(e),e.g=null;var i=2}else{if(!eY(e.h,t))return;r=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=ew(),new eC(i,r)),tU(e)}else tB(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eQ(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eS(_(e.Ea,e,n),tK(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tG(e,5);break;case 4:tG(e,10);break;case 3:tG(e,6);break;default:tG(e,2)}}}function tK(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tG(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var n,r=_(e.bb,e),i=e.Ua;let a=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||e6(i,"https"),e8(i),a?function(e,t){let n=new ek;if(p.Image){let r=new Image;r.onload=y(tp,n,"TestLoadImage: loaded",!0,t,r),r.onerror=y(tp,n,"TestLoadImage: error",!1,t,r),r.onabort=y(tp,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=y(tp,n,"TestLoadImage: timeout",!1,t,r),p.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new ek,s=new AbortController,o=setTimeout(()=>{s.abort(),tp(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?tp(t,"TestPingServer: ok",!0,r):tp(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(o),tp(t,"TestPingServer: error",!1,r)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tQ(e),tM(e)}function tQ(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function tY(e,t,n){var r=n instanceof e1?e2(n):new e1(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e3(r,r.u);else{var i=p.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);r&&e6(e,r),t&&(e.g=t),i&&e3(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e5(r,n,t),e5(r,"VER",e.ka),tV(e,r),r}function tX(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tT(e.Aa&&!e.ma?new tm({ab:n}):e.ma)).Fa(e.L),t}function tJ(){}function tZ(){}function t0(e,t){er.call(this),this.g=new tx(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!L(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!L(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t6(this)}function t1(e){em.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){e_.call(this),this.status=1}function t6(e){this.g=e}(t=tT.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=w(_(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tS(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=p.FormData&&t instanceof p.FormData,!(Array.prototype.indexOf.call(tC,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tS(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tN(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tN(this,!0)),tT.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tR(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tx.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){eI(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tY(this,null,this.W),tU(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ex(this,this.j,e),s=this.o;if(this.U&&(s?$(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tq(this,i,t),e5(n=e2(this.J),"RID",e),e5(n,"CVER",22),this.G&&e5(n,"X-HTTP-Session-Id",this.G),tV(this,n),s&&(this.R?t="headers="+eD(tE(s))+"&"+t:this.u&&tb(n,this.u,s)),eX(this.h,i),this.Ra&&e5(n,"TYPE","init"),this.S?(e5(n,"$req",t),e5(n,"SID","null"),i.U=!0,eU(i,n,null)):eU(i,n,t),this.I=2}}else 3==this.I&&(e?tF(this,e):0==this.i.length||eG(this.h)||tF(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eS(_(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tL(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tL(this),tj(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,er),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tO(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eu(e),e=n);t.i.push(new eW(t.Ya++,e)),3==t.I&&tU(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tO(this.g),delete this.g,t0.Z.N.call(this)},v(t1,em),v(t2,e_),v(t6,tJ),t6.prototype.ra=function(){ei(this.g,"a")},t6.prototype.qa=function(e){ei(this.g,new t1(e))},t6.prototype.pa=function(e){ei(this.g,new t2)},t6.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,u=T.createWebChannelTransport=function(){return new tZ},h=T.getStatEventTarget=function(){return ew()},l=T.Event=ey,a=T.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eN.NO_ERROR=0,eN.TIMEOUT=8,eN.HTTP_ERROR=6,o=T.ErrorCode=eN,eR.COMPLETE="complete",s=T.EventType=eR,ep.EventType=eg,eg.OPEN="a",eg.CLOSE="b",eg.ERROR="c",eg.MESSAGE="d",er.prototype.listen=er.prototype.J,i=T.WebChannel=ep,T.FetchXmlHttpFactory=tm,tT.prototype.listenOnce=tT.prototype.K,tT.prototype.getLastError=tT.prototype.Ha,tT.prototype.getLastErrorCode=tT.prototype.ya,tT.prototype.getStatus=tT.prototype.ca,tT.prototype.getResponseJson=tT.prototype.La,tT.prototype.getResponseText=tT.prototype.la,tT.prototype.send=tT.prototype.ea,tT.prototype.setWithCredentials=tT.prototype.Fa,r=T.XhrIo=tT}).apply(void 0!==b?b:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let I="@firebase/firestore",C="4.9.3";class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let k="12.7.0",A=new y.Logger("@firebase/firestore");function N(){return A.logLevel}function R(e,...t){if(A.logLevel<=y.LogLevel.DEBUG){let n=t.map(x);A.debug(`Firestore (${k}): ${e}`,...n)}}function P(e,...t){if(A.logLevel<=y.LogLevel.ERROR){let n=t.map(x);A.error(`Firestore (${k}): ${e}`,...n)}}function D(e,...t){if(A.logLevel<=y.LogLevel.WARN){let n=t.map(x);A.warn(`Firestore (${k}): ${e}`,...n)}}function x(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function O(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,L(e,r,n)}function L(e,t,n){let r=`FIRESTORE (${k}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw P(r),Error(r)}function M(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||L(t,i,r)}let U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends v.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class V{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class q{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class B{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(S.UNAUTHENTICATED))}shutdown(){}}class j{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class z{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){M(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new V;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new V,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new V)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(M("string"==typeof t.accessToken,31837,{l:t}),new q(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return M(null===e||"string"==typeof e,2055,{h:e}),new S(e)}}class ${constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=S.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class H{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new $(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,m._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){M(void 0===this.o,3512);let n=e=>{null!=e.error&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,R("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new W(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(M("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new W(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class G{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Q(e,t){return e<t?-1:+(e>t)}function Y(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return X(n)===X(i)?Q(n,i):X(n)?1:-1}return Q(e.length,t.length)}function X(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function J(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let Z="__name__";class ee{constructor(e,t,n){void 0===t?t=0:t>e.length&&O(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&O(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ee.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ee?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=ee.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Q(e.length,t.length)}static compareSegments(e,t){let n=ee.isNumericId(e),r=ee.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ee.extractNumericId(e).compare(ee.extractNumericId(t)):Y(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class et extends ee{construct(e,t,n){return new et(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new F(U.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new et(t)}static emptyPath(){return new et([])}}let en=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class er extends ee{construct(e,t,n){return new er(e,t,n)}static isValidIdentifier(e){return en.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),er.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Z}static keyField(){return new er([Z])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new F(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new F(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new F(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new F(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new er(t)}static emptyPath(){return new er([])}}class ei{constructor(e){this.path=e}static fromPath(e){return new ei(et.fromString(e))}static fromName(e){return new ei(et.fromString(e).popFirst(5))}static empty(){return new ei(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===et.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ei(new et(e.slice()))}}function es(e,t,n){if(!n)throw new F(U.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function eo(e){if(!ei.isDocumentKey(e))throw new F(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ea(e){if(ei.isDocumentKey(e))throw new F(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function el(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function eh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":O(12329,{type:typeof e})}function eu(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new F(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=eh(e);throw new F(U.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ec(e,t){let n={typeString:e};return t&&(n.value=t),n}function ed(e,t){let n;if(!el(e))throw new F(U.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new F(U.INVALID_ARGUMENT,n);return!0}class ef{static now(){return ef.fromMillis(Date.now())}static fromDate(e){return ef.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ef(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new F(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new F(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ef._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ed(e,ef._jsonSchema))return new ef(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ef._jsonSchemaVersion="firestore/timestamp/1.0",ef._jsonSchema={type:ec("string",ef._jsonSchemaVersion),seconds:ec("number"),nanoseconds:ec("number")};class ep{static fromTimestamp(e){return new ep(e)}static min(){return new ep(new ef(0,0))}static max(){return new ep(new ef(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class eg{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new eg(ep.min(),ei.empty(),-1)}static max(){return new eg(ep.max(),ei.empty(),-1)}}class em{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function e_(e){if(e.code!==U.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;R("LocalStore","Unexpectedly lost primary lease")}class ey{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ey((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof ey?t:ey.resolve(t)}catch(e){return ey.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ey.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ey.reject(t)}static resolve(e){return new ey((t,n)=>{t(e)})}static reject(e){return new ey((t,n)=>{n(e)})}static waitFor(e){return new ey((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ey.resolve(!1);for(let n of e)t=t.next(e=>e?ey.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ey((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ey((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function ev(e){return"IndexedDbTransactionError"===e.name}class ew{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}ew.ce=-1;function eE(e){return 0===e&&1/e==-1/0}function eb(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function eT(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function eI(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class eC{constructor(e,t){this.comparator=e,this.root=t||ek.EMPTY}insert(e,t){return new eC(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ek.BLACK,null,null))}remove(e){return new eC(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ek.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new eS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new eS(this.root,e,this.comparator,!1)}getReverseIterator(){return new eS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new eS(this.root,e,this.comparator,!0)}}class eS{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ek{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ek.RED,this.left=null!=r?r:ek.EMPTY,this.right=null!=i?i:ek.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ek(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return ek.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ek.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,ek.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,ek.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw O(27949);return e+ +!this.isRed()}}ek.EMPTY=null,ek.RED=!0,ek.BLACK=!1,ek.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new ek(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class eA{constructor(e){this.comparator=e,this.data=new eC(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eN(this.data.getIterator())}getIteratorFrom(e){return new eN(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof eA)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new eA(this.comparator);return t.data=e,t}}class eN{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class eR{constructor(e){this.fields=e,e.sort(er.comparator)}static empty(){return new eR([])}unionWith(e){let t=new eA(er.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new eR(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return J(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class eP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class eD{constructor(e){this.binaryString=e}static fromBase64String(e){return new eD(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new eP("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new eD(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}eD.EMPTY_BYTE_STRING=new eD("");let ex=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function eO(e){if(M(!!e,39018),"string"==typeof e){let t=0,n=ex.exec(e);if(M(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:eL(e.seconds),nanos:eL(e.nanos)}}function eL(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function eM(e){return"string"==typeof e?eD.fromBase64String(e):eD.fromUint8Array(e)}let eU="server_timestamp",eF="__type__",eV="__previous_value__",eq="__local_write_time__";function eB(e){return(e?.mapValue?.fields||{})[eF]?.stringValue===eU}function ej(e){let t=e.mapValue.fields[eV];return eB(t)?ej(t):t}function ez(e){let t=eO(e.mapValue.fields[eq].timestampValue);return new ef(t.seconds,t.nanos)}class e${constructor(e,t,n,r,i,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}let eH="(default)";class eW{constructor(e,t){this.projectId=e,this.database=t||eH}static empty(){return new eW("","")}get isDefaultDatabase(){return this.database===eH}isEqual(e){return e instanceof eW&&e.projectId===this.projectId&&e.database===this.database}}let eK="__type__",eG="__max__",eQ={},eY="__vector__",eX="value";function eJ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?eB(e)?4:tr(e)?0x1fffffffffffff:tt(e)?10:11:O(28295,{value:e})}function eZ(e,t){if(e===t)return!0;let n=eJ(e);if(n!==eJ(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ez(e).isEqual(ez(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=eO(e.timestampValue),i=eO(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return eM(e.bytesValue).isEqual(eM(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return eL(e.geoPointValue.latitude)===eL(t.geoPointValue.latitude)&&eL(e.geoPointValue.longitude)===eL(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return eL(e.integerValue)===eL(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=eL(e.doubleValue),r=eL(t.doubleValue);return n===r?eE(n)===eE(r):isNaN(n)&&isNaN(r)}return!1;case 9:return J(e.arrayValue.values||[],t.arrayValue.values||[],eZ);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(eb(s)!==eb(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!eZ(s[e],o[e])))return!1;return!0;default:return O(52216,{left:e})}}function e0(e,t){return void 0!==(e.values||[]).find(e=>eZ(e,t))}function e1(e,t){var n,r,i,s,o,a;if(e===t)return 0;let l=eJ(e),h=eJ(t);if(l!==h)return Q(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return Q(e.booleanValue,t.booleanValue);case 2:let u,c;return u=eL(e.integerValue||e.doubleValue),u<(c=eL(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return e2(e.timestampValue,t.timestampValue);case 4:return e2(ez(e),ez(t));case 5:return Y(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=eM(n),f=eM(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=Q(n[e],r[e]);if(0!==t)return t}return Q(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=Q(eL(i.latitude),eL(s.latitude)))?p:Q(eL(i.longitude),eL(s.longitude));case 9:return e6(e.arrayValue,t.arrayValue);case 10:let g,m,_,y,v;return o=e.mapValue,a=t.mapValue,g=o.fields||{},m=a.fields||{},_=g[eX]?.arrayValue,y=m[eX]?.arrayValue,0!==(v=Q(_?.values?.length||0,y?.values?.length||0))?v:e6(_,y);case 11:return function(e,t){if(e===eQ&&t===eQ)return 0;if(e===eQ)return 1;if(t===eQ)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=Y(r[e],s[e]);if(0!==t)return t;let o=e1(n[r[e]],i[s[e]]);if(0!==o)return o}return Q(r.length,s.length)}(e.mapValue,t.mapValue);default:throw O(23264,{he:l})}}function e2(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Q(e,t);let n=eO(e),r=eO(t),i=Q(n.seconds,r.seconds);return 0!==i?i:Q(n.nanos,r.nanos)}function e6(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=e1(n[e],r[e]);if(t)return t}return Q(n.length,r.length)}function e3(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=eO(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?eM(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ei.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=e3(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${e3(e.fields[i])}`;return n+"}"}(e.mapValue):O(61005,{value:e})}function e4(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function e5(e){return!!e&&"integerValue"in e}function e8(e){return!!e&&"arrayValue"in e}function e7(e){return!!e&&"nullValue"in e}function e9(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function te(e){return!!e&&"mapValue"in e}function tt(e){return(e?.mapValue?.fields||{})[eK]?.stringValue===eY}function tn(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return eT(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=tn(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=tn(e.arrayValue.values[n]);return t}return{...e}}function tr(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===eG}class ti{constructor(e){this.value=e}static empty(){return new ti({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!te(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=tn(t)}setAll(e){let t=er.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=tn(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());te(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return eZ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];te(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(eT(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new ti(tn(this.value))}}class ts{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ts(e,0,ep.min(),ep.min(),ep.min(),ti.empty(),0)}static newFoundDocument(e,t,n,r){return new ts(e,1,t,ep.min(),n,r,0)}static newNoDocument(e,t){return new ts(e,2,t,ep.min(),ep.min(),ti.empty(),0)}static newUnknownDocument(e,t){return new ts(e,3,t,ep.min(),ep.min(),ti.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ep.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ti.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ti.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ep.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ts&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ts(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class to{constructor(e,t){this.position=e,this.inclusive=t}}function ta(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ei.comparator(ei.fromName(o.referenceValue),n.key):e1(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function tl(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!eZ(e.position[n],t.position[n]))return!1;return!0}class th{constructor(e,t="asc"){this.field=e,this.dir=t}}class tu{}class tc extends tu{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new tg(e,t,n):"array-contains"===t?new tv(e,n):"in"===t?new tw(e,n):"not-in"===t?new tE(e,n):"array-contains-any"===t?new tb(e,n):new tc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new tm(e,n):new t_(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(e1(t,this.value)):null!==t&&eJ(this.value)===eJ(t)&&this.matchesComparison(e1(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class td extends tu{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new td(e,t)}matches(e){return tf(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tf(e){return"and"===e.op}function tp(e){for(let t of e.filters)if(t instanceof td)return!1;return!0}class tg extends tc{constructor(e,t,n){super(e,t,n),this.key=ei.fromName(n.referenceValue)}matches(e){let t=ei.comparator(e.key,this.key);return this.matchesComparison(t)}}class tm extends tc{constructor(e,t){super(e,"in",t),this.keys=ty("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class t_ extends tc{constructor(e,t){super(e,"not-in",t),this.keys=ty("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ty(e,t){return(t.arrayValue?.values||[]).map(e=>ei.fromName(e.referenceValue))}class tv extends tc{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return e8(t)&&e0(t.arrayValue,this.value)}}class tw extends tc{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&e0(this.value.arrayValue,t)}}class tE extends tc{constructor(e,t){super(e,"not-in",t)}matches(e){if(e0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!e0(this.value.arrayValue,t)}}class tb extends tc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!e8(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>e0(this.value.arrayValue,e))}}class tT{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function tI(e,t=null,n=[],r=[],i=null,s=null,o=null){return new tT(e,t,n,r,i,s,o)}function tC(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof tc)return t.field.canonicalString()+t.op.toString()+e3(t.value);if(tp(t)&&tf(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>e3(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>e3(e)).join(",")),e.Te=t}return e.Te}function tS(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof tc?n instanceof tc&&t.op===n.op&&t.field.isEqual(n.field)&&eZ(t.value,n.value):t instanceof td?n instanceof td&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void O(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!tl(e.startAt,t.startAt)&&tl(e.endAt,t.endAt)}function tk(e){return ei.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class tA{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tN(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function tR(e){return null!==e.collectionGroup}function tP(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new eA(er.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new th(t,r))}),n.has(er.keyField().canonicalString())||e.Ie.push(new th(er.keyField(),r))}return e.Ie}function tD(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return tI(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new th(e.field,t)});let n=e.endAt?new to(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new to(e.startAt.position,e.startAt.inclusive):null;return tI(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,tP(e))),e.Ee}function tx(e,t){let n=e.filters.concat([t]);return new tA(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function tO(e,t,n){return new tA(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function tL(e,t){return tS(tD(e),tD(t))&&e.limitType===t.limitType}function tM(e){return`${tC(tD(e))}|lt:${e.limitType}`}function tU(e){var t;let n;return`Query(target=${n=(t=tD(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof tc?`${t.field.canonicalString()} ${t.op} ${e3(t.value)}`:t instanceof td?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>e3(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>e3(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function tF(e,t){var n,r,i,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):ei.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of tP(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,a=ta(i,tP(n),r),i.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=ta(s,tP(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function tV(e){return(t,n)=>{let r=!1;for(let i of tP(e)){let e=function(e,t,n){var r;let i,s,o=e.field.isKeyField()?ei.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?e1(i,s):O(42886));switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return O(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class tq{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){eT(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return eI(this.inner)}size(){return this.innerSize}}let tB=new eC(ei.comparator),tj=new eC(ei.comparator);function tz(...e){let t=tj;for(let n of e)t=t.insert(n.key,n);return t}function t$(e){let t=tj;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function tH(){return new tq(e=>e.toString(),(e,t)=>e.isEqual(t))}let tW=new eC(ei.comparator),tK=new eA(ei.comparator);function tG(...e){let t=tK;for(let n of e)t=t.add(n);return t}let tQ=new eA(Q);function tY(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eE(t)?"-0":t}}function tX(e){return{integerValue:""+e}}class tJ{constructor(){this._=void 0}}function tZ(e,t){return e instanceof t4?e5(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class t0 extends tJ{}class t1 extends tJ{constructor(e){super(),this.elements=e}}function t2(e,t){let n=t8(t);for(let t of e.elements)n.some(e=>eZ(e,t))||n.push(t);return{arrayValue:{values:n}}}class t6 extends tJ{constructor(e){super(),this.elements=e}}function t3(e,t){let n=t8(t);for(let t of e.elements)n=n.filter(e=>!eZ(e,t));return{arrayValue:{values:n}}}class t4 extends tJ{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function t5(e){return eL(e.integerValue||e.doubleValue)}function t8(e){return e8(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class t7{constructor(e,t){this.version=e,this.transformResults=t}}class t9{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new t9}static exists(e){return new t9(void 0,e)}static updateTime(e){return new t9(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ne(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nt{}function nn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new nu(e.key,t9.none()):new ns(e.key,e.data,t9.none());{let n=e.data,r=ti.empty(),i=new eA(er.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new no(e.key,r,new eR(i.toArray()),t9.none())}}function nr(e,t,n,r){return e instanceof ns?function(e,t,n,r){if(!ne(e.precondition,t))return n;let i=e.value.clone(),s=nh(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof no?function(e,t,n,r){if(!ne(e.precondition,t))return n;let i=nh(e.fieldTransforms,r,t),s=t.data;return(s.setAll(na(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):ne(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ni(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&J(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof t1&&r instanceof t1||n instanceof t6&&r instanceof t6?J(n.elements,r.elements,eZ):n instanceof t4&&r instanceof t4?eZ(n.Ae,r.Ae):n instanceof t0&&r instanceof t0)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ns extends nt{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class no extends nt{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function na(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function nl(e,t,n){let r=new Map;M(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof t1?t2(a,l):a instanceof t6?t3(a,l):i))}return r}function nh(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,o;return e instanceof t0?(r=t,i={fields:{[eF]:{stringValue:eU},[eq]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&eB(r)&&(r=ej(r)),r&&(i.fields[eV]=r),{mapValue:i}):e instanceof t1?t2(e,t):e instanceof t6?t3(e,t):(o=t5(s=tZ(e,t))+t5(e.Ae),e5(s)&&e5(e.Ae)?tX(o):tY(e.serializer,o))}(e,s,t))}return r}class nu extends nt{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nc extends nt{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class nd{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof ns?(r=e.value.clone(),i=nl(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof no?function(e,t,n){if(!ne(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=nl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(na(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=nr(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=nr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=tH();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=nn(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ep.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),tG())}isEqual(e){return this.batchId===e.batchId&&J(this.mutations,e.mutations,(e,t)=>ni(e,t))&&J(this.baseMutations,e.baseMutations,(e,t)=>ni(e,t))}}class nf{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){M(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=tW,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new nf(e,t,n,r)}}class np{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ng{constructor(e,t){this.count=e,this.unchangedNames=t}}function nm(e){if(void 0===e)return P("GRPC error has no .code"),U.UNKNOWN;switch(e){case c.OK:return U.OK;case c.CANCELLED:return U.CANCELLED;case c.UNKNOWN:return U.UNKNOWN;case c.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case c.INTERNAL:return U.INTERNAL;case c.UNAVAILABLE:return U.UNAVAILABLE;case c.UNAUTHENTICATED:return U.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case c.NOT_FOUND:return U.NOT_FOUND;case c.ALREADY_EXISTS:return U.ALREADY_EXISTS;case c.PERMISSION_DENIED:return U.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case c.ABORTED:return U.ABORTED;case c.OUT_OF_RANGE:return U.OUT_OF_RANGE;case c.UNIMPLEMENTED:return U.UNIMPLEMENTED;case c.DATA_LOSS:return U.DATA_LOSS;default:return O(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let n_=new t([0xffffffff,0xffffffff],0);function ny(e){let t=(new TextEncoder).encode(e),r=new n;return r.update(t),new Uint8Array(r.digest())}function nv(e){let n=new DataView(e.buffer),r=n.getUint32(0,!0),i=n.getUint32(4,!0),s=n.getUint32(8,!0),o=n.getUint32(12,!0);return[new t([r,i],0),new t([s,o],0)]}class nw{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new nE(`Invalid padding: ${n}`);if(r<0||e.length>0&&0===this.hashCount)throw new nE(`Invalid hash count: ${r}`);if(0===e.length&&0!==n)throw new nE(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=t.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(t.fromNumber(r)));return 1===i.compare(n_)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=nv(ny(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new nw(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=nv(ny(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class nE extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class nb{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,nT.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new nb(ep.min(),r,new eC(Q),tB,tG())}}class nT{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new nT(n,t,tG(),tG(),tG())}}class nI{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class nC{constructor(e,t){this.targetId=e,this.Ce=t}}class nS{constructor(e,t,n=eD.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class nk{constructor(){this.ve=0,this.Fe=nR(),this.Me=eD.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=tG(),t=tG(),n=tG();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:O(38017,{changeType:i})}}),new nT(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=nR()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,M(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class nA{constructor(e){this.Ge=e,this.ze=new Map,this.je=tB,this.Je=nN(),this.He=nN(),this.Ye=new eC(Q)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:O(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(tk(i))if(0===n){let e=new ei(i.path);this.et(t,e,ts.newNoDocument(e,ep.min()))}else M(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=r;try{t=eM(i).toUint8Array()}catch(e){if(e instanceof eP)return D("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new nw(t,s,o)}catch(e){return D(e instanceof nE?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&tk(i.target)){let t=new ei(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,ts.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=tG();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new nb(e,t,this.Ye,this.je,n);return this.je=tB,this.Je=nN(),this.He=nN(),this.Ye=new eC(Q),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new nk,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new eA(Q),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new eA(Q),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||R("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new nk),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function nN(){return new eC(ei.comparator)}function nR(){return new eC(ei.comparator)}let nP={asc:"ASCENDING",desc:"DESCENDING"},nD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},nx={and:"AND",or:"OR"};class nO{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function nL(e,t){return e.useProto3Json||null==t?t:{value:t}}function nM(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function nU(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function nF(e){let t;return M(!!e,49232),ep.fromTimestamp(new ef((t=eO(e)).seconds,t.nanos))}function nV(e,t){return nq(e,t).canonicalString()}function nq(e,t){let n=new et(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function nB(e){let t=et.fromString(e);return M(nY(t),10190,{key:t.toString()}),t}function nj(e,t){return nV(e.databaseId,t.path)}function nz(e,t){let n=nB(t);if(n.get(1)!==e.databaseId.projectId)throw new F(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new F(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ei(nW(n))}function n$(e,t){return nV(e.databaseId,t)}function nH(e){return new et(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function nW(e){return M(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function nK(e,t,n){return{name:nj(e,t),fields:n.value.mapValue.fields}}function nG(e){return{fieldPath:e.canonicalString()}}function nQ(e){return er.fromServerFormat(e.fieldPath)}function nY(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class nX{constructor(e,t,n,r,i=ep.min(),s=ep.min(),o=eD.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new nX(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nX(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nX(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nX(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class nJ{constructor(e){this.yt=e}}class nZ{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(eL(e.integerValue));else if("doubleValue"in e){let n=eL(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),eE(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=eO(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(eM(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?tr(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):tt(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):O(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[eX].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(eL(r)),this.Ot(eX,t),this.Ct(n[eX],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),ei.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}nZ.Kt=new nZ;class n0{constructor(){this.Cn=new n1}addToCollectionParentIndex(e,t){return this.Cn.add(t),ey.resolve()}getCollectionParents(e,t){return ey.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ey.resolve()}deleteFieldIndex(e,t){return ey.resolve()}deleteAllFieldIndexes(e){return ey.resolve()}createTargetIndexes(e,t){return ey.resolve()}getDocumentsMatchingTarget(e,t){return ey.resolve(null)}getIndexType(e,t){return ey.resolve(0)}getFieldIndexes(e,t){return ey.resolve([])}getNextCollectionGroupToUpdate(e){return ey.resolve(null)}getMinOffset(e,t){return ey.resolve(eg.min())}getMinOffsetFromCollectionGroup(e,t){return ey.resolve(eg.min())}updateCollectionGroup(e,t,n){return ey.resolve()}updateIndexEntries(e,t){return ey.resolve()}}class n1{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new eA(et.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new eA(et.comparator)).toArray()}}new Uint8Array(0);let n2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class n6{static withCacheSize(e){return new n6(e,n6.DEFAULT_COLLECTION_PERCENTILE,n6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}n6.DEFAULT_COLLECTION_PERCENTILE=10,n6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,n6.DEFAULT=new n6(0x2800000,n6.DEFAULT_COLLECTION_PERCENTILE,n6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),n6.DISABLED=new n6(-1,0,0);class n3{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n3(0)}static cr(){return new n3(-1)}}let n4="LruGarbageCollector";function n5([e,t],[n,r]){let i=Q(e,n);return 0===i?Q(t,r):i}class n8{constructor(e){this.Ir=e,this.buffer=new eA(n5),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>n5(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class n7{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){R(n4,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ev(e)?R(n4,"Ignoring IndexedDB error during garbage collection: ",e):await e_(e)}await this.Vr(3e5)})}}class n9{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ey.resolve(ew.ce);let n=new n8(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector","Garbage collection skipped; disabled"),ey.resolve(n2)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),n2):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),N()<=y.LogLevel.DEBUG&&R("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),ey.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class re{constructor(){this.changes=new tq(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ts.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ey.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class rt{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class rn{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&nr(n.mutation,e,eR.empty(),ef.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,tG()).next(()=>t))}getLocalViewOfDocuments(e,t,n=tG()){let r=tH();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=tz();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=tH();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,tG()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=tB,s=tH(),o=tH();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof no)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),nr(o.mutation,t,o.mutation.getFieldMask(),ef.now())):s.set(t.key,eR.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>o.set(e,new rt(t,s.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){let n=tH(),r=new eC((e,t)=>e-t),i=tG();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||eR.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||tG()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,h=tH();l.forEach(e=>{if(!i.has(e)){let r=nn(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return ey.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return ei.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):tR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ey.resolve(tH()),o=-1,a=i;return s.next(t=>ey.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ey.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,tG())).next(e=>({batchId:o,changes:t$(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ei(t)).next(e=>{let t=tz();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=tz();return this.indexManager.getCollectionParents(e,i).next(o=>ey.forEach(o,o=>{let a=new tA(o.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,ts.newInvalidDocument(r)))});let n=tz();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&nr(s.mutation,r,eR.empty(),ef.now()),tF(t,r)&&(n=n.insert(e,r))}),n})}}class rr{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ey.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:nF(t.createTime)}),ey.resolve()}getNamedQuery(e,t){return ey.resolve(this.kr.get(t))}saveNamedQuery(e,t){var n;let r;return this.kr.set(t.name,{name:t.name,query:(r=function(e){var t,n,r,i;let s,o,a,l,h,u=4===(s=nB(e.parent)).length?et.emptyPath():nW(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){M(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(o=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=nQ(e.unaryFilter.field);return tc.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=nQ(e.unaryFilter.field);return tc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=nQ(e.unaryFilter.field);return tc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=nQ(e.unaryFilter.field);return tc.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}}(t):void 0!==t.fieldFilter?tc.create(nQ(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?td.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return O(1026)}}(t.compositeFilter.op)):O(30097,{filter:t})}(c.where))instanceof td&&tp(t=o)&&tf(t)?o.getFilters():[o]);let g=[];c.orderBy&&(g=c.orderBy.map(e=>new th(nQ(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(a="object"==typeof(n=c.limit)?n.value:n)?null:a);let _=null;c.startAt&&(l=!!(r=c.startAt).before,_=new to(r.values||[],l));let y=null;return c.endAt&&(h=!(i=c.endAt).before,y=new to(i.values||[],h)),new tA(u,f,g,p,m,"F",_,y)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?tO(r,r.limit,"L"):r),readTime:nF(t.readTime)}),ey.resolve()}}class ri{constructor(){this.overlays=new eC(ei.comparator),this.qr=new Map}getOverlay(e,t){return ey.resolve(this.overlays.get(t))}getOverlays(e,t){let n=tH();return ey.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),ey.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ey.resolve()}getOverlaysForCollection(e,t,n){let r=tH(),i=t.length+1,s=new ei(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ey.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new eC((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=tH(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=tH(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return ey.resolve(o)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new np(t,n));let i=this.qr.get(t);void 0===i&&(i=tG(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class rs{constructor(){this.sessionToken=eD.EMPTY_BYTE_STRING}getSessionToken(e){return ey.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ey.resolve()}}class ro{constructor(){this.Qr=new eA(ra.$r),this.Ur=new eA(ra.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new ra(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ra(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new ei(new et([])),n=new ra(t,e),r=new ra(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new ei(new et([])),n=new ra(t,e),r=new ra(t,e+1),i=tG();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new ra(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ra{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ei.comparator(e.key,t.key)||Q(e.Yr,t.Yr)}static Kr(e,t){return Q(e.Yr,t.Yr)||ei.comparator(e.key,t.key)}}class rl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new eA(ra.$r)}checkEmpty(e){return ey.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new nd(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new ra(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ey.resolve(s)}lookupMutationBatch(e,t){return ey.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return ey.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ey.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return ey.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ra(t,0),r=new ra(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),ey.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new eA(Q);return t.forEach(e=>{let t=new ra(e,0),r=new ra(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),ey.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;ei.isDocumentKey(i)||(i=i.child(""));let s=new ra(new ei(i),0),o=new eA(Q);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},s),ey.resolve(this.ti(o))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){M(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ey.forEach(t.mutations,r=>{let i=new ra(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new ra(t,0),r=this.Zr.firstAfterOrEqual(n);return ey.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ey.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rh{constructor(e){this.ri=e,this.docs=new eC(ei.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ey.resolve(n?n.document.mutableCopy():ts.newInvalidDocument(t))}getEntries(e,t){let n=tB;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ts.newInvalidDocument(e))}),ey.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=tB,s=t.path,o=new ei(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=ei.comparator(e.documentKey,t.documentKey))?n:Q(e.largestBatchId,t.largestBatchId)}(new eg(o.readTime,o.key,-1),n)||(r.has(o.key)||tF(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ey.resolve(i)}getAllFromCollectionGroup(e,t,n,r){O(9500)}ii(e,t){return ey.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ru(this)}getSize(e){return ey.resolve(this.size)}}class ru extends re{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),ey.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class rc{constructor(e){this.persistence=e,this.si=new tq(e=>tC(e),tS),this.lastRemoteSnapshotVersion=ep.min(),this.highestTargetId=0,this.oi=0,this._i=new ro,this.targetCount=0,this.ai=n3.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ey.resolve()}getLastRemoteSnapshotVersion(e){return ey.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ey.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ey.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ey.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new n3(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ey.resolve()}updateTargetData(e,t){return this.Pr(t),ey.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ey.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ey.waitFor(i).next(()=>r)}getTargetCount(e){return ey.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return ey.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ey.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ey.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ey.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return ey.resolve(n)}containsKey(e,t){return ey.resolve(this._i.containsKey(t))}}class rd{constructor(e,t){this.ui={},this.overlays={},this.ci=new ew(0),this.li=!1,this.li=!0,this.hi=new rs,this.referenceDelegate=e(this),this.Pi=new rc(this),this.indexManager=new n0,this.remoteDocumentCache=new rh(e=>this.referenceDelegate.Ti(e)),this.serializer=new nJ(t),this.Ii=new rr(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ri,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new rl(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){R("MemoryPersistence","Starting transaction:",e);let r=new rf(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return ey.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class rf extends em{constructor(e){super(),this.currentSequenceNumber=e}}class rp{constructor(e){this.persistence=e,this.Ri=new ro,this.Vi=null}static mi(e){return new rp(e)}get fi(){if(this.Vi)return this.Vi;throw O(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ey.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ey.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ey.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ey.forEach(this.fi,n=>{let r=ei.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,ep.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ey.or([()=>ey.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class rg{constructor(e,t){this.persistence=e,this.pi=new tq(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new n9(this,t)}static mi(e,t){return new rg(e,t)}Ei(){}di(e){return ey.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ey.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?ey.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ep.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ey.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ey.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ey.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ey.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(eJ(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=ej(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return eM(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,eT(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw O(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return ey.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return ey.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class rm{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=tG(),r=tG();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new rm(e,t.fromCache,n,r)}}class r_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ry{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let e;return(0,v.isSafari)()?8:Number((e=(0,v.getUA)().match(/Android ([\d.]+)/i))?e[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new r_;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(N()<=y.LogLevel.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",tU(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ey.resolve()):(N()<=y.LogLevel.DEBUG&&R("QueryEngine","Query:",tU(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(N()<=y.LogLevel.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",tU(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tD(t))):ey.resolve())}ys(e,t){if(tN(t))return ey.resolve(null);let n=tD(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=tD(t=tO(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=tG(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,tO(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return tN(t)||r.isEqual(ep.min())?ey.resolve(null):this.ps.getDocuments(e,n).next(i=>{let s,o,a=this.Ds(t,i);return this.Cs(t,a,n,r)?ey.resolve(null):(N()<=y.LogLevel.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),tU(t)),this.vs(e,a,t,(s=r.toTimestamp().seconds,o=r.toTimestamp().nanoseconds+1,new eg(ep.fromTimestamp(1e9===o?new ef(s+1,0):new ef(s,o)),ei.empty(),-1))).next(e=>e))})}Ds(e,t){let n=new eA(tV(e));return t.forEach((t,r)=>{tF(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return N()<=y.LogLevel.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",tU(t)),this.ps.getDocumentsMatchingQuery(e,t,eg.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let rv="LocalStore";class rw{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new eC(Q),this.xs=new tq(e=>tC(e),tS),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rn(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function rE(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=tG();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function rb(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function rT(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!ev(e))throw e;R(rv,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function rI(e,t,n){let r=ep.min(),i=tG();return e.persistence.runTransaction("Execute query","readwrite",s=>{var o;let a;return(o=tD(t),void 0!==(a=e.xs.get(o))?ey.resolve(e.Ms.get(a)):e.Pi.getTargetData(s,o)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:ep.min(),n?i:tG())).next(n=>{var r,s,o;let a;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=r.Os.get(s)||ep.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),r.Os.set(s,a),{documents:n,Qs:i}})})}class rC{constructor(){this.activeTargetIds=tQ}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class rS{constructor(){this.Mo=new rC,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new rC,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class rk{Oo(e){}shutdown(){}}let rA="ConnectivityMonitor";class rN{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(R(rA,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(R(rA,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let rR=null;function rP(){return null===rR?rR=0x10000000+Math.round(0x80000000*Math.random()):rR++,"0x"+rR.toString(16)}let rD="RestConnection",rx={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rO{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===eH?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=rP(),o=this.zo(e,t.toUriEncodedString());R(rD,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);let{host:l}=new URL(o),h=(0,v.isCloudWorkstation)(l);return this.Jo(e,o,a,n,h).then(t=>(R(rD,`Received RPC '${e}' ${s}: `,t),t),t=>{throw D(rD,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+k,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=rx[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class rL{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let rM="WebChannelConnection";class rU extends rO{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,a){let l=rP();return new Promise((a,h)=>{let u=new r;u.setWithCredentials(!0),u.listenOnce(s.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case o.NO_ERROR:let t=u.getResponseJson();R(rM,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),a(t);break;case o.TIMEOUT:R(rM,`RPC '${e}' ${l} timed out`),h(new F(U.DEADLINE_EXCEEDED,"Request time out"));break;case o.HTTP_ERROR:let n=u.getStatus();if(R(rM,`RPC '${e}' ${l} failed with status:`,n,"response text:",u.getResponseText()),n>0){let e=u.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(U).indexOf(e)>=0?e:U.UNKNOWN);h(new F(n,t.message))}else h(new F(U.UNKNOWN,"Server responded with status "+u.getStatus()))}else h(new F(U.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:e,streamId:l,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{R(rM,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);R(rM,`RPC '${e}' ${l} sending request:`,i),u.send(t,"POST",c,n,15)})}T_(e,t,n){let r=rP(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=u(),d=h(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(f.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;let g=s.join("");R(rM,`Creating RPC '${e}' stream ${r}: ${g}`,f);let m=o.createWebChannel(g,f);this.I_(m);let _=!1,y=!1,v=new rL({Yo:t=>{y?R(rM,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(_||(R(rM,`Opening RPC '${e}' stream ${r} transport.`),m.open(),_=!0),R(rM,`RPC '${e}' stream ${r} sending:`,t),m.send(t))},Zo:()=>m.close()}),w=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(m,i.EventType.OPEN,()=>{y||(R(rM,`RPC '${e}' stream ${r} transport opened.`),v.o_())}),w(m,i.EventType.CLOSE,()=>{y||(y=!0,R(rM,`RPC '${e}' stream ${r} transport closed`),v.a_(),this.E_(m))}),w(m,i.EventType.ERROR,t=>{y||(y=!0,D(rM,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),v.a_(new F(U.UNAVAILABLE,"The operation could not be completed")))}),w(m,i.EventType.MESSAGE,t=>{if(!y){let n=t.data[0];M(!!n,16349);let i=n?.error||n[0]?.error;if(i){R(rM,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=c[e];if(void 0!==t)return nm(t)}(t),s=i.message;void 0===n&&(n=U.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),y=!0,v.a_(new F(n,s)),m.close()}else R(rM,`RPC '${e}' stream ${r} received:`,n),v.u_(n)}}),w(d,l.STAT_EVENT,t=>{t.stat===a.PROXY?R(rM,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===a.NOPROXY&&R(rM,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.__()},0),v}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function rF(){return"undefined"!=typeof document?document:null}function rV(e){return new nO(e,!0)}class rq{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&R("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let rB="PersistentStream";class rj{constructor(e,t,n,r,i,s,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rq(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===U.RESOURCE_EXHAUSTED?(P(t.toString()),P("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===U.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new F(U.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return R(rB,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(R(rB,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class rz extends rj{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:O(39313,{state:r}),o=t.targetChange.targetIds||[],a=(i=t.targetChange.resumeToken,e.useProto3Json?(M(void 0===i||"string"==typeof i,58123),eD.fromBase64String(i||"")):(M(void 0===i||i instanceof g.Buffer||i instanceof Uint8Array,16193),eD.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new nS(s,o,a,l&&new F(void 0===l.code?U.UNKNOWN:nm(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=nz(e,r.document.name),s=nF(r.document.updateTime),o=r.document.createTime?nF(r.document.createTime):ep.min(),a=new ti({mapValue:{fields:r.document.fields}}),l=ts.newFoundDocument(i,s,o,a);n=new nI(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=nz(e,r.document),s=r.readTime?nF(r.readTime):ep.min(),o=ts.newNoDocument(i,s);n=new nI([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=nz(e,r.document);n=new nI([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return O(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ng(r,i);n=new nC(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ep.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ep.min():t.readTime?nF(t.readTime):ep.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=nH(this.serializer),n.addTarget=function(e,t){var n,r;let i,s,o,a,l,h,u,c=t.target;if((i=tk(c)?{documents:{documents:[n$(e,c.path)]}}:{query:(o={structuredQuery:{}},a=c.path,null!==c.collectionGroup?(s=a,o.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=n$(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof tc?function(e){if("=="===e.op){if(e9(e.value))return{unaryFilter:{field:nG(e.field),op:"IS_NAN"}};if(e7(e.value))return{unaryFilter:{field:nG(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(e9(e.value))return{unaryFilter:{field:nG(e.field),op:"IS_NOT_NAN"}};if(e7(e.value))return{unaryFilter:{field:nG(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nG(e.field),op:nD[e.op],value:e.value}}}(t):t instanceof td?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:nx[n.op],filters:r}}:O(54877,{filter:t})}(td.create(e,"and"))}(c.filters))&&(o.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:nG(e.field),direction:nP[e.dir]}))}(c.orderBy))&&(o.structuredQuery.orderBy=h),null!==(u=nL(e,c.limit))&&(o.structuredQuery.limit=u),c.startAt&&(o.structuredQuery.startAt={before:(n=c.startAt).inclusive,values:n.position}),c.endAt&&(o.structuredQuery.endAt={before:!(r=c.endAt).inclusive,values:r.position}),{ft:o,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=nU(e,t.resumeToken);let n=nL(e,t.expectedCount);null!==n&&(i.expectedCount=n)}else if(t.snapshotVersion.compareTo(ep.min())>0){i.readTime=nM(e,t.snapshotVersion.toTimestamp());let n=nL(e,t.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.q_(n)}Z_(e){let t={};t.database=nH(this.serializer),t.removeTarget=e,this.q_(t)}}class r$ extends rj{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return M(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,M(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;M(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(M(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?nF(e.updateTime):nF(n)).isEqual(ep.min())&&(t=nF(n)),new t7(t,e.transformResults||[])})):[]),i=nF(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=nH(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,r;let i;if(t instanceof ns)i={update:nK(e,t.key,t.value)};else if(t instanceof nu)i={delete:nj(e,t.key)};else if(t instanceof no){let n;i={update:nK(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof nc))return O(16599,{Vt:t.type});i={verify:nj(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof t0)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof t1)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof t6)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof t4)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw O(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:nM(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:O(27497)),i})(this.serializer,e))};this.q_(t)}}class rH{}class rW extends rH{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new F(U.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,nq(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new F(U.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(e,nq(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new F(U.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class rK{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(P(t),this.aa=!1):R("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let rG="RemoteStore";class rQ{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{r3(this)&&(R(rG,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await rX(e),e.Ra.set("Unknown"),e.Ea.delete(4),await rY(e)}(this))})}),this.Ra=new rK(n,r)}}async function rY(e){if(r3(e))for(let t of e.da)await t(!0)}async function rX(e){for(let t of e.da)await t(!1)}function rJ(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),r6(e)?r2(e):ic(e).O_()&&r0(e,t))}function rZ(e,t){let n=ic(e);e.Ia.delete(t),n.O_()&&r1(e,t),0===e.Ia.size&&(n.O_()?n.L_():r3(e)&&e.Ra.set("Unknown"))}function r0(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ep.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ic(e).Y_(t)}function r1(e,t){e.Va.Ue(t),ic(e).Z_(t)}function r2(e){e.Va=new nA({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),ic(e).start(),e.Ra.ua()}function r6(e){return r3(e)&&!ic(e).x_()&&e.Ia.size>0}function r3(e){return 0===e.Ea.size}async function r4(e){e.Ra.set("Online")}async function r5(e){e.Ia.forEach((t,n)=>{r0(e,t)})}async function r8(e,t){e.Va=void 0,r6(e)?(e.Ra.ha(t),r2(e)):e.Ra.set("Unknown")}async function r7(e,t,n){if(e.Ra.set("Online"),t instanceof nS&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){R(rG,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await r9(e,n)}else if(t instanceof nI?e.Va.Ze(t):t instanceof nC?e.Va.st(t):e.Va.tt(t),!n.isEqual(ep.min()))try{let t,r=await rb(e.localStore);n.compareTo(r)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(eD.EMPTY_BYTE_STRING,r.snapshotVersion)),r1(e,t);let i=new nX(r.target,t,n,r.sequenceNumber);r0(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){R(rG,"Failed to raise snapshot:",t),await r9(e,t)}}async function r9(e,t,n){if(!ev(t))throw t;e.Ea.add(1),await rX(e),e.Ra.set("Offline"),n||(n=()=>rb(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{R(rG,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await rY(e)})}function ie(e,t){return t().catch(n=>r9(e,n,t))}async function it(e){var t;let n=id(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;r3(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=id(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await r9(e,t)}ir(e)&&ii(e)}function ir(e){return r3(e)&&!id(e).x_()&&e.Ta.length>0}function ii(e){id(e).start()}async function is(e){id(e).ra()}async function io(e){let t=id(e);for(let n of e.Ta)t.ea(n.mutations)}async function ia(e,t,n){let r=e.Ta.shift(),i=nf.from(r,t,n);await ie(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await it(e)}async function il(e,t){t&&id(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case U.OK:return O(64938);case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0;default:return O(15467,{code:e})}}(n=t.code)&&n!==U.ABORTED){let n=e.Ta.shift();id(e).B_(),await ie(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await it(e)}}(e,t),ir(e)&&ii(e)}async function ih(e,t){e.asyncQueue.verifyOperationInProgress(),R(rG,"RemoteStore received new credentials");let n=r3(e);e.Ea.add(3),await rX(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await rY(e)}async function iu(e,t){t?(e.Ea.delete(2),await rY(e)):t||(e.Ea.add(2),await rX(e),e.Ra.set("Unknown"))}function ic(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:r4.bind(null,e),t_:r5.bind(null,e),r_:r8.bind(null,e),H_:r7.bind(null,e)},t.sa(),e.ma=new rz(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),r6(e)?r2(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function id(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:is.bind(null,e),r_:il.bind(null,e),ta:io.bind(null,e),na:ia.bind(null,e)},t.sa(),e.fa=new r$(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await it(e)):(await e.fa.stop(),e.Ta.length>0&&(R(rG,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ip{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new V,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ip(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new F(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ig(e,t){if(P("AsyncQueue",`${t}: ${e}`),ev(e))return new F(U.UNAVAILABLE,`${t}: ${e}`);throw e}class im{static emptySet(e){return new im(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ei.comparator(t.key,n.key):(e,t)=>ei.comparator(e.key,t.key),this.keyedMap=tz(),this.sortedSet=new eC(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof im)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new im;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class i_{constructor(){this.ga=new eC(ei.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):O(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class iy{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new iy(e,t,im.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tL(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class iv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class iw{constructor(){this.queries=iE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new F(U.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=iE(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function iE(){return new tq(e=>tM(e),tL)}async function ib(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new iv,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ig(n,`Initialization of query '${tU(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&iS(e)}async function iT(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function iI(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&iS(e)}function iC(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function iS(e){e.Ca.forEach(e=>{e.next()})}(p=f||(f={})).Ma="default",p.Cache="cache";class ik{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new iy(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=iy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f.Cache}}class iA{constructor(e){this.key=e}}class iN{constructor(e){this.key=e}}class iR{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=tG(),this.mutatedKeys=tG(),this.eu=tV(e),this.tu=new im(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new i_,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let h=r.get(e),u=tF(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&0>this.eu(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Rt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,l=a!==this.Za;return(this.Za=a,0!==s.length||l)?{snapshot:new iy(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new i_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=tG(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new iN(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new iA(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=tG();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return iy.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let iP="SyncEngine";class iD{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ix{constructor(e){this.key=e,this.hu=!1}}class iO{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new tq(e=>tM(e),tL),this.Iu=new Map,this.Eu=new Set,this.du=new eC(ei.comparator),this.Au=new Map,this.Ru=new ro,this.Vu={},this.mu=new Map,this.fu=n3.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function iL(e,t,n=!0){let r,i=i2(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await iU(i,t,n,!0),r}async function iM(e,t){let n=i2(e);await iU(n,t,!0,!1)}async function iU(e,t,n,r){var i,s;let o,a=await (i=e.localStore,s=tD(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(n=>n?(t=n,ey.resolve(t)):i.Pi.allocateTargetId(e).next(n=>(t=new nX(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=a.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(o=await iF(e,t,l,"current"===h,a.resumeToken)),e.isPrimaryClient&&n&&rJ(e.remoteStore,a),o}async function iF(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await rI(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return iX(e,t.targetId,a.au),a.snapshot})(e,t,n,r);let s=await rI(e.localStore,t,!0),o=new iR(t,s.Qs),a=o.ru(s.documents),l=nT.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),h=o.applyChanges(a,e.isPrimaryClient,l);iX(e,n,h.au);let u=new iD(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function iV(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!tL(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await rT(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&rZ(e.remoteStore,r.targetId),iQ(e,r.targetId)}).catch(e_)):(iQ(e,r.targetId),await rT(e.localStore,r.targetId,!0))}async function iq(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),rZ(e.remoteStore,n.targetId))}async function iB(e,t,n){var r,i,s;let o=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=iH.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=iW.bind(null,r),r);try{let e,r,a,l,h,u=await (i=o.localStore,a=ef.now(),l=t.reduce((e,t)=>e.add(t.key),tG()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=tB,o=tG();return i.Ns.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(o=o.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,s)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=tZ(r.transform,e||null);null!=i&&(null===n&&(n=ti.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new no(n.key,t,function e(t){let n=[];return eT(t.fields,(t,r)=>{let i=new er([t]);if(te(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new eR(n)}(t.value.mapValue),t9.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,s,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(e,o);return i.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:t$(e)})));o.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=o.Vu[o.currentUser.toKey()])||(h=new eC(Q)),h=h.insert(s,n),o.Vu[o.currentUser.toKey()]=h,await iZ(o,u.changes),await it(o.remoteStore)}catch(t){let e=ig(t,"Failed to persist write");n.reject(e)}}async function ij(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,o,a;let l,h,u=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=i.get(o);if(!l)return;c.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(eD.EMPTY_BYTE_STRING,ep.min()).withLastLimboFreeSnapshotVersion(ep.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.Pi.updateTargetData(e,h))});let d=tB,f=tG();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),c.push((s=e,o=u,a=t.documentUpdates,l=tG(),h=tG(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=tB;return a.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(h=h.add(n)),r.isNoDocument()&&r.version.isEqual(ep.min())?(o.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(o.addEntry(r),t=t.insert(n,r)):R(rv,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{ks:t,qs:h}})).next(e=>{d=e.ks,f=e.qs})),!r.isEqual(ep.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));c.push(t)}return ey.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ms=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(M(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?M(r.hu,14607):t.removedDocuments.size>0&&(M(r.hu,42227),r.hu=!1))}),await iZ(e,s,t)}catch(e){await e_(e)}}function iz(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&iS(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function i$(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new eC(ei.comparator);n=n.insert(i,ts.newNoDocument(i,ep.min()));let r=tG().add(i),s=new nb(ep.min(),new Map,new eC(Q),n,r);await ij(e,s),e.du=e.du.remove(i),e.Au.delete(t),iJ(e)}else await rT(e.localStore,t,!1).then(()=>iQ(e,t,n)).catch(e_)}async function iH(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,o=t.batch.keys(),a=n.Ns.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=ey.resolve(),i.forEach(n=>{s=s.next(()=>a.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);M(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),a.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>a.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,o,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=tG();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,o))}));iG(e,r,null),iK(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await iZ(e,i)}catch(e){await e_(e)}}async function iW(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(M(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));iG(e,t,n),iK(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await iZ(e,i)}catch(e){await e_(e)}}function iK(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function iG(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function iQ(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||iY(e,t)})}function iY(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(rZ(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),iJ(e))}function iX(e,t,n){for(let r of n)r instanceof iA?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(R(iP,"New document in limbo: "+n),e.Eu.add(r),iJ(e))}(e,r)):r instanceof iN?(R(iP,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||iY(e,r.key)):O(19791,{wu:r})}function iJ(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new ei(et.fromString(t)),r=e.fu.next();e.Au.set(r,new ix(n)),e.du=e.du.insert(n,r),rJ(e.remoteStore,new nX(tD(new tA(n.path)),r,"TargetPurposeLimboResolution",ew.ce))}}async function iZ(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((o,a)=>{s.push(e.pu(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;e.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(t){r.push(t);let e=rm.As(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ey.forEach(t,t=>ey.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>ey.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!ev(e))throw e;R(rv,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function i0(e,t){if(!e.currentUser.isEqual(t)){R(iP,"User change. New user:",t.toKey());let n=await rE(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new F(U.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await iZ(e,n.Ls)}}function i1(e,t){let n=e.Au.get(t);if(n&&n.hu)return tG().add(n.key);{let n=tG(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}function i2(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=ij.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=i$.bind(null,e),e.Pu.H_=iI.bind(null,e.eventManager),e.Pu.yu=iC.bind(null,e.eventManager),e}class i6{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=rV(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new ry,new rw(t,n,e.initialUser,this.serializer)}Cu(e){return new rd(rp.mi,this.serializer)}Du(e){return new rS}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}i6.provider={build:()=>new i6};class i3 extends i6{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return M(this.persistence.referenceDelegate instanceof rg,46915),new n7(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?n6.withCacheSize(this.cacheSizeBytes):n6.DEFAULT;return new rd(e=>rg.mi(e,t),this.serializer)}}class i4{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>iz(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=i0.bind(null,this.syncEngine),await iu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new iw}createDatastore(e){var t;let n=rV(e.databaseInfo.databaseId),r=new rU(e.databaseInfo);return t=e.authCredentials,new rW(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new rQ(t,n,e.asyncQueue,e=>iz(this.syncEngine,e,0),rN.v()?new rN:new rk)}createSyncEngine(e,t){var n,r,i,s,o,a;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new iO(n,r,i,s,o,a),t&&(l.gu=!0),l}async terminate(){await async function(e){R(rG,"RemoteStore shutting down."),e.Ea.add(5),await rX(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}i4.provider={build:()=>new i4};class i5{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):P("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let i8="FirestoreClient";class i7{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=S.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{R(i8,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(R(i8,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new V;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ig(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function i9(e,t){e.asyncQueue.verifyOperationInProgress(),R(i8,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await rE(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function se(e,t){e.asyncQueue.verifyOperationInProgress();let n=await st(e);R(i8,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ih(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ih(t.remoteStore,n)),e._onlineComponents=t}async function st(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){R(i8,"Using user provided OfflineComponentProvider");try{await i9(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===U.FAILED_PRECONDITION||t.code===U.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;D("Error using user provided cache. Falling back to memory cache: "+t),await i9(e,new i6)}}else R(i8,"Using default OfflineComponentProvider"),await i9(e,new i3(void 0));return e._offlineComponents}async function sn(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(R(i8,"Using user provided OnlineComponentProvider"),await se(e,e._uninitializedComponentsProvider._online)):(R(i8,"Using default OnlineComponentProvider"),await se(e,new i4))),e._onlineComponents}async function sr(e){let t=await sn(e),n=t.eventManager;return n.onListen=iL.bind(null,t.syncEngine),n.onUnlisten=iV.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=iM.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=iq.bind(null,t.syncEngine),n}function si(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ss=new Map,so="firestore.googleapis.com";class sa{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new F(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=so,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new F(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new F(U.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=si(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new F(U.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new F(U.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new F(U.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sl{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sa({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new F(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sa(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new B;switch(e.type){case"firstParty":return new H(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new F(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=ss.get(this))&&(R("ComponentProvider","Removing Datastore"),ss.delete(this),e.terminate()),Promise.resolve()}}class sh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new sh(this.firestore,e,this._query)}}class su{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new su(this.firestore,e,this._key)}toJSON(){return{type:su._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ed(t,su._jsonSchema))return new su(e,n||null,new ei(et.fromString(t.referencePath)))}}su._jsonSchemaVersion="firestore/documentReference/1.0",su._jsonSchema={type:ec("string",su._jsonSchemaVersion),referencePath:ec("string")};class sc extends sh{constructor(e,t,n){super(e,t,new tA(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new su(this.firestore,null,new ei(e))}withConverter(e){return new sc(this.firestore,e,this._path)}}function sd(e,t,...n){if(e=(0,v.getModularInstance)(e),es("collection","path",t),e instanceof sl){let r=et.fromString(t,...n);return ea(r),new sc(e,null,r)}{if(!(e instanceof su||e instanceof sc))throw new F(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(et.fromString(t,...n));return ea(r),new sc(e.firestore,null,r)}}function sf(e,t,...n){if(e=(0,v.getModularInstance)(e),1==arguments.length&&(t=G.newId()),es("doc","path",t),e instanceof sl){let r=et.fromString(t,...n);return eo(r),new su(e,null,new ei(r))}{if(!(e instanceof su||e instanceof sc))throw new F(U.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(et.fromString(t,...n));return eo(r),new su(e.firestore,e instanceof sc?e.converter:null,new ei(r))}}let sp="AsyncQueue";class sg{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rq(this,"async_queue_retry"),this._c=()=>{let e=rF();e&&R(sp,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=rF();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=rF();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new V;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ev(e))throw e;R(sp,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,P("INTERNAL UNHANDLED ERROR: ",sm(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=ip.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&O(47125,{Pc:sm(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function sm(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class s_ extends sl{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new sg,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new sg(e),this._firestoreClient=void 0,await e}}}function sy(e,t){let n="object"==typeof e?e:(0,m.getApp)(),r=(0,m._getProvider)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||eH});if(!r._initialized){let e=(0,v.getDefaultEmulatorHostnameAndPort)("firestore");e&&function(e,t,n,r={}){e=eu(e,sl);let i=(0,v.isCloudWorkstation)(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;i&&((0,v.pingServer)(`https://${a}`),(0,v.updateEmulatorBanner)("Firestore",!0)),s.host!==so&&s.host!==a&&D("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:a,ssl:i,emulatorOptions:r};if(!(0,v.deepEqual)(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=S.MOCK_USER;else{t=(0,v.createMockUserToken)(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new F(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new S(i)}e._authCredentials=new j(new q(t,n))}}(r,...e)}return r}function sv(e){if(e._terminated)throw new F(U.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;let i,s=e._freezeSettings(),o=(t=e._databaseId,n=e._app?.options.appId||"",new e$(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,si(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new i7(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(r=e._componentsProvider,i=r?._online.build(),{_offline:r?._offline.build(i),_online:i}))}(e),e._firestoreClient}class sw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sw(eD.fromBase64String(e))}catch(e){throw new F(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new sw(eD.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:sw._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ed(e,sw._jsonSchema))return sw.fromBase64String(e.bytes)}}sw._jsonSchemaVersion="firestore/bytes/1.0",sw._jsonSchema={type:ec("string",sw._jsonSchemaVersion),bytes:ec("string")};class sE{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new F(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new er(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class sb{constructor(e){this._methodName=e}}class sT{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:sT._jsonSchemaVersion}}static fromJSON(e){if(ed(e,sT._jsonSchema))return new sT(e.latitude,e.longitude)}}sT._jsonSchemaVersion="firestore/geoPoint/1.0",sT._jsonSchema={type:ec("string",sT._jsonSchemaVersion),latitude:ec("number"),longitude:ec("number")};class sI{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:sI._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ed(e,sI._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new sI(e.vectorValues);throw new F(U.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}sI._jsonSchemaVersion="firestore/vectorValue/1.0",sI._jsonSchema={type:ec("string",sI._jsonSchemaVersion),vectorValues:ec("object")};let sC=/^__.*__$/;class sS{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new no(e,this.data,this.fieldMask,t,this.fieldTransforms):new ns(e,this.data,t,this.fieldTransforms)}}class sk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new no(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function sA(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{Ac:e})}}class sN{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new sN({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return sB(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(sA(this.Ac)&&sC.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class sR{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||rV(e)}Cc(e,t,n,r=!1){return new sN({Ac:e,methodName:t,Dc:n,path:er.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sP(e){let t=e._freezeSettings(),n=rV(e._databaseId);return new sR(e._databaseId,!!t.ignoreUndefinedProperties,n)}function sD(e,t,n,r,i,s={}){let o,a,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);sU("Data must be an object, but it was:",l,r);let h=sL(r,l);if(s.merge)o=new eR(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=sF(t,r,n);if(!l.contains(i))throw new F(U.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);sj(e,i)||e.push(i)}o=new eR(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new sS(new ti(h),o,a)}class sx extends sb{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof sx}}function sO(e,t){if(sM(e=(0,v.getModularInstance)(e)))return sU("Unsupported field value:",t,e),sL(e,t);if(e instanceof sb)return function(e,t){if(!sA(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=sO(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=(0,v.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!eE(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?tX(r):tY(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ef.fromDate(e);return{timestampValue:nM(t.serializer,n)}}if(e instanceof ef){let n=new ef(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:nM(t.serializer,n)}}if(e instanceof sT)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof sw)return{bytesValue:nU(t.serializer,e._byteString)};if(e instanceof su){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:nV(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof sI)return{mapValue:{fields:{[eK]:{stringValue:eY},[eX]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return tY(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${eh(e)}`)}(e,t)}function sL(e,t){let n={};return eI(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):eT(e,(e,r)=>{let i=sO(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function sM(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ef||e instanceof sT||e instanceof sw||e instanceof su||e instanceof sb||e instanceof sI)}function sU(e,t,n){if(!sM(n)||!el(n)){let r=eh(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function sF(e,t,n){if((t=(0,v.getModularInstance)(t))instanceof sE)return t._internalPath;if("string"==typeof t)return sq(e,t);throw sB("Field path arguments must be of type string or ",e,!1,void 0,n)}let sV=RegExp("[~\\*/\\[\\]]");function sq(e,t,n){if(t.search(sV)>=0)throw sB(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new sE(...t.split("."))._internalPath}catch(r){throw sB(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function sB(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new F(U.INVALID_ARGUMENT,a+e+l)}function sj(e,t){return e.some(e=>e.isEqual(t))}class sz{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new su(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new s$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(sH("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class s$ extends sz{data(){return super.data()}}function sH(e,t){return"string"==typeof t?sq(e,t):t instanceof sE?t._internalPath:t._delegate._internalPath}class sW{}class sK extends sW{}function sG(e,t,...n){let r=[];for(let i of(t instanceof sW&&r.push(t),function(e){let t=e.filter(e=>e instanceof sX).length,n=e.filter(e=>e instanceof sQ).length;if(t>1||t>0&&n>0)throw new F(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class sQ extends sK{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sQ(e,t,n)}_apply(e){let t=this._parse(e);return s2(e._query,t),new sh(e.firestore,e.converter,tx(e._query,t))}_parse(e){let t=sP(e.firestore);return function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new F(U.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){s1(o,s);let t=[];for(let n of o)t.push(s0(r,e,n));a={arrayValue:{values:t}}}else a=s0(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||s1(o,s),a=function(e,t,n,r=!1){return sO(n,e.Cc(r?4:3,t))}(n,t,o,"in"===s||"not-in"===s);return tc.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function sY(e,t,n){let r=sH("where",e);return sQ._create(r,t,n)}class sX extends sW{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new sX(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:td.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())s2(n,e),n=tx(n,e)}(e._query,t),new sh(e.firestore,e.converter,tx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class sJ extends sK{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new sJ(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new F(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new F(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new th(t,n)}(e._query,this._field,this._direction);return new sh(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new tA(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function sZ(e,t="asc"){let n=sH("orderBy",e);return sJ._create(n,t)}function s0(e,t,n){if("string"==typeof(n=(0,v.getModularInstance)(n))){if(""===n)throw new F(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tR(t)&&-1!==n.indexOf("/"))throw new F(U.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(et.fromString(n));if(!ei.isDocumentKey(r))throw new F(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return e4(e,new ei(r))}if(n instanceof su)return e4(e,n._key);throw new F(U.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eh(n)}.`)}function s1(e,t){if(!Array.isArray(e)||0===e.length)throw new F(U.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function s2(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new F(U.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new F(U.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class s6{convertValue(e,t="none"){switch(eJ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return eL(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(eM(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return eT(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new sI(e.fields?.[eX].arrayValue?.values?.map(e=>eL(e.doubleValue)))}convertGeoPoint(e){return new sT(eL(e.latitude),eL(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ej(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ez(e));default:return null}}convertTimestamp(e){let t=eO(e);return new ef(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=et.fromString(e);M(nY(n),9688,{name:e});let r=new eW(n.get(1),n.get(3)),i=new ei(n.popFirst(5));return r.isEqual(t)||P(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function s3(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class s4{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class s5 extends sz{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new s8(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(sH("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(U.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=s5._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}s5._jsonSchemaVersion="firestore/documentSnapshot/1.0",s5._jsonSchema={type:ec("string",s5._jsonSchemaVersion),bundleSource:ec("string","DocumentSnapshot"),bundleName:ec("string"),bundle:ec("string")};class s8 extends s5{data(e={}){return super.data(e)}}class s7{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new s4(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new s8(this._firestore,this._userDataWriter,n.key,n,new s4(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new s8(e._firestore,e._userDataWriter,n.doc.key,n.doc,new s4(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new s8(e._firestore,e._userDataWriter,t.doc.key,t.doc,new s4(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(U.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=s7._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=G.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function s9(e){e=eu(e,su);let t=eu(e.firestore,s_);return(function(e,t,n={}){let r=new V;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await sr(e),s=e.asyncQueue,o=new i5({next:e=>{o.Nu(),s.enqueueAndForget(()=>iT(i,a));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new F(U.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new F(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),ib(i,a=new ik(new tA(t.path),o,{includeMetadataChanges:!0,qa:!0}))}),r.promise})(sv(t),e._key).then(n=>{var r,i,s;let o,a;return r=t,i=e,o=(s=n).docs.get(i._key),a=new oe(r),new s5(r,a,i._key,o,new s4(s.hasPendingWrites,s.fromCache),i.converter)})}s7._jsonSchemaVersion="firestore/querySnapshot/1.0",s7._jsonSchema={type:ec("string",s7._jsonSchemaVersion),bundleSource:ec("string","QuerySnapshot"),bundleName:ec("string"),bundle:ec("string")};class oe extends s6{constructor(e){super(),this.firestore=e}convertBytes(e){return new sw(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new su(this.firestore,null,t)}}function ot(e){e=eu(e,sh);let t=eu(e.firestore,s_),n=sv(t),r=new oe(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new F(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let r=new V;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await sr(e),s=e.asyncQueue,a=new ik(t,o=new i5({next:e=>{o.Nu(),s.enqueueAndForget(()=>iT(i,a)),e.fromCache&&"server"===n.source?r.reject(new F(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,qa:!0}),ib(i,a)}),r.promise})(n,e._query).then(n=>new s7(t,r,e,n))}function on(e,t,n){e=eu(e,su);let r=eu(e.firestore,s_),i=s3(e.converter,t,n);return oo(r,[sD(sP(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,t9.none())])}function or(e,t,n,...r){var i,s,o;let a,l,h;e=eu(e,su);let u=eu(e.firestore,s_),c=sP(u);return oo(u,[("string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof sE?function(e,t,n,r,i,s){let o=e.Cc(1,t,n),a=[sF(t,r,n)],l=[i];if(s.length%2!=0)throw new F(U.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(sF(t,s[e])),l.push(s[e+1]);let h=[],u=ti.empty();for(let e=a.length-1;e>=0;--e)if(!sj(h,a[e])){let t=a[e],n=l[e];n=(0,v.getModularInstance)(n);let r=o.yc(t);if(n instanceof sx)h.push(t);else{let e=sO(n,r);null!=e&&(h.push(t),u.set(t,e))}}return new sk(u,new eR(h),o.fieldTransforms)}(c,"updateDoc",e._key,t,n,r):(i="updateDoc",s=e._key,o=t,sU("Data must be an object, but it was:",a=c.Cc(1,i,s),o),l=[],h=ti.empty(),eT(o,(e,t)=>{let n=sq(i,e,s);t=(0,v.getModularInstance)(t);let r=a.yc(n);if(t instanceof sx)l.push(n);else{let e=sO(t,r);null!=e&&(l.push(n),h.set(n,e))}}),new sk(h,new eR(l),a.fieldTransforms))).toMutation(e._key,t9.exists(!0))])}function oi(e){return oo(eu(e.firestore,s_),[new nu(e._key,t9.none())])}function os(e,t){let n=eu(e.firestore,s_),r=sf(e),i=s3(e.converter,t);return oo(n,[sD(sP(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,t9.exists(!1))]).then(()=>r)}function oo(e,t){var n;let r;return n=sv(e),r=new V,n.asyncQueue.enqueueAndForget(async()=>iB(await sn(n).then(e=>e.syncEngine),t,r)),r.promise}new WeakMap,function(e=!0){k=m.SDK_VERSION,(0,m._registerComponent)(new _.Component("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new s_(new z(t.getProvider("auth-internal")),new K(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new F(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eW(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,m.registerVersion)(I,C,void 0),(0,m.registerVersion)(I,C,"esm2020")}(),e.s(["Timestamp",()=>ef,"addDoc",()=>os,"collection",()=>sd,"deleteDoc",()=>oi,"doc",()=>sf,"getDoc",()=>s9,"getDocs",()=>ot,"getFirestore",()=>sy,"orderBy",()=>sZ,"query",()=>sG,"setDoc",()=>on,"updateDoc",()=>or,"where",()=>sY],98925),e.s([],36180)},1465,34991,e=>{"use strict";let t,n,r,i,s,o,a,l,h,u,c;var d,f,p=e.i(47167),g=e.i(92953),m=e.i(8070),_=e.i(97427),y=e.i(83877);let v="@firebase/database",w="1.1.0",E="";class b{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,_.stringify)(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,_.jsonEval)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class T{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,_.contains)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let I=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new b(t)}}catch(e){}return new T},C=I("localStorage"),S=I("sessionStorage"),k=new y.Logger("@firebase/database"),A=(c=1,function(){return c++}),N=function(e){let t=(0,_.stringToByteArray)(e),n=new _.Sha1;n.update(t);let r=n.digest();return _.base64.encodeByteArray(r)},R=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=R.apply(null,r):"object"==typeof r?t+=(0,_.stringify)(r):t+=r,t+=" "}return t},P=null,D=!0,x=function(e,t){(0,_.assert)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(k.logLevel=y.LogLevel.VERBOSE,P=k.log.bind(k),t&&S.set("logging_enabled",!0)):"function"==typeof e?P=e:(P=null,S.remove("logging_enabled"))},O=function(...e){if(!0===D&&(D=!1,null===P&&!0===S.get("logging_enabled")&&x(!0)),P){let t=R.apply(null,e);P(t)}},L=function(e){return function(...t){O(e,...t)}},M=function(...e){let t="FIREBASE INTERNAL ERROR: "+R(...e);k.error(t)},U=function(...e){let t=`FIREBASE FATAL ERROR: ${R(...e)}`;throw k.error(t),Error(t)},F=function(...e){let t="FIREBASE WARNING: "+R(...e);k.warn(t)},V=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},q=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},B=function(e){if((0,_.isNodeSdk)()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},j="[MIN_NAME]",z="[MAX_NAME]",$=function(e,t){if(e===t)return 0;{if(e===j||t===z)return -1;if(t===j||e===z)return 1;let n=J(e),r=J(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},H=function(e,t){return e===t?0:e<t?-1:1},W=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,_.stringify)(t))},K=function(e){if("object"!=typeof e||null===e)return(0,_.stringify)(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=(0,_.stringify)(t[r]),n+=":",n+=K(e[t[r]]);return n+"}"},G=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Q(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let Y=function(e){let t,n,r,i,s;(0,_.assert)(!q(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},X=RegExp("^-?(0*)\\d{1,10}$"),J=function(e){if(X.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},Z=function(e){try{e()}catch(e){setTimeout(()=>{throw F("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},ee=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class et{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,(0,g._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){F(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class en{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(O("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}}class er{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}er.OWNER="owner";let ei=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,es="websocket",eo="long_polling";class ea{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=C.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&C.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function el(e,t,n){let r;if((0,_.assert)("string"==typeof t,"typeof type must == string"),(0,_.assert)("object"==typeof n,"typeof params must == object"),t===es)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===eo)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return Q(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class eh{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,_.contains)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,_.deepCopy)(this.counters_)}}let eu={},ec={};function ed(e){let t=e.toString();return eu[t]||(eu[t]=new eh),eu[t]}class ef{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Z(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let ep="start";class eg{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=L(e),this.stats_=ed(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),el(t,eo,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ef(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),B(()=>{if(this.isClosed_)return;this.scriptTagHolder=new em((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ep)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[ep]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ei.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){eg.forceAllow_=!0}static forceDisallow(){eg.forceDisallow_=!0}static isAvailable(){return!(0,_.isNodeSdk)()&&(!!eg.forceAllow_||!eg.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=(0,_.stringify)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=G((0,_.base64Encode)(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,_.isNodeSdk)())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=(0,_.stringify)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class em{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,_.isNodeSdk)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=A(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=em.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){O("frame writing exception"),e.stack&&O(e.stack),O(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||O("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){(0,_.isNodeSdk)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{O("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let e_=null;"undefined"!=typeof MozWebSocket?e_=MozWebSocket:"undefined"!=typeof WebSocket&&(e_=WebSocket);class ey{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=L(this.connId),this.stats_=ed(t),this.connURL=ey.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!(0,_.isNodeSdk)()&&"undefined"!=typeof location&&location.hostname&&ei.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),el(e,es,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,C.set("previous_websocket_failure",!0);try{let e;if((0,_.isNodeSdk)()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${E}/${p.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=p.default.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new e_(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ey.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==e_&&!ey.forceDisallow_}static previouslyFailed(){return C.isInMemoryStorage||!0===C.get("previous_websocket_failure")}markConnectionHealthy(){C.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=(0,_.jsonEval)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,_.assert)(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=(0,_.stringify)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=G(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ey.responsesRequiredToBeHealthy=2,ey.healthyTimeout=3e4;class ev{static get ALL_TRANSPORTS(){return[eg,ey]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=ey&&ey.isAvailable(),n=t&&!ey.previouslyFailed();if(e.webSocketOnly&&(t||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ey];else{let e=this.transports_=[];for(let t of ev.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ev.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ev.globalTransportInitialized_=!1;class ew{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=L("c:"+this.id+":"),this.transportManager_=new ev(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ee(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=W("t",e),n=W("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=W("t",e),n=W("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=W("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?M("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):M("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ee(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ee(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(C.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class eE{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class eb{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,_.assert)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){(0,_.assert)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class eT extends eb{static getInstance(){return new eT}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,_.isMobileCordova)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return(0,_.assert)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class eI{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function eC(){return new eI("")}function eS(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ek(e){return e.pieces_.length-e.pieceNum_}function eA(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new eI(e.pieces_,t)}function eN(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function eR(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function eP(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new eI(t,0)}function eD(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof eI)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new eI(n,0)}function ex(e){return e.pieceNum_>=e.pieces_.length}function eO(e,t){let n=eS(e),r=eS(t);if(null===n)return t;if(n===r)return eO(eA(e),eA(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function eL(e,t){if(ek(e)!==ek(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function eM(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(ek(e)>ek(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class eU{constructor(e,t){this.errorPrefix_=t,this.parts_=eR(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,_.stringLength)(this.parts_[e]);eF(this)}}function eF(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+eV(e))}function eV(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class eq extends eb{static getInstance(){return new eq}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return(0,_.assert)("visible"===e,"Unknown event type: "+e),[this.visible_]}}class eB extends eE{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=eB.nextPersistentConnectionId_++,this.log_=L("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!(0,_.isNodeSdk)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");eq.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&eT.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,_.stringify)(i)),(0,_.assert)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new _.Deferred,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,_.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,_.assert)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;eB.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,_.contains)(e,"w")){let n=(0,_.safeGet)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();F(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,_.isAdmin)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=(0,_.isValidFormat)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,_.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,_.stringify)(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):M("Unrecognized action received from server: "+(0,_.stringify)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,_.assert)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+eB.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){(0,_.assert)(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?O("getToken() completed but was canceled"):(O("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new ew(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{F(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&F(e),a())}}}interrupt(e){O("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){O("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,_.isEmpty)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>K(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new eI(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){O("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){O("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";(0,_.isNodeSdk)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+E.replace(/\./g,"-")]=1,(0,_.isMobileCordova)()?e["framework.cordova"]=1:(0,_.isReactNative)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=eT.getInstance().currentlyOnline();return(0,_.isEmpty)(this.interruptReasons_)&&e}}eB.nextPersistentConnectionId_=0,eB.nextConnectionId_=0;class ej{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ej(e,t)}}class ez{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new ej(j,e),r=new ej(j,t);return 0!==this.compare(n,r)}minPost(){return ej.MIN}}class e$ extends ez{static get __EMPTY_NODE(){return t}static set __EMPTY_NODE(e){t=e}compare(e,t){return $(e.name,t.name)}isDefinedOn(e){throw(0,_.assertionError)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ej.MIN}maxPost(){return new ej(z,t)}makePost(e,n){return(0,_.assert)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ej(e,t)}toString(){return".key"}}let eH=new e$;class eW{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class eK{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:eK.RED,this.left=null!=r?r:eG.EMPTY_NODE,this.right=null!=i?i:eG.EMPTY_NODE}copy(e,t,n,r,i){return new eK(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return eG.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return eG.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,eK.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,eK.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}eK.RED=!0,eK.BLACK=!1;class eG{constructor(e,t=eG.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new eG(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,eK.BLACK,null,null))}remove(e){return new eG(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,eK.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new eW(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new eW(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new eW(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new eW(this.root_,null,this.comparator_,!0,e)}}function eQ(e,t){return $(e.name,t.name)}function eY(e,t){return $(e,t)}eG.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new eK(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let eX=function(e){return"number"==typeof e?"number:"+Y(e):"string:"+e},eJ=function(e){if(e.isLeafNode()){let t=e.val();(0,_.assert)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,_.contains)(t,".sv"),"Priority must be a string or number.")}else(0,_.assert)(e===n||e.isEmpty(),"priority of unexpected type.");(0,_.assert)(e===n||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class eZ{static set __childrenNodeConstructor(e){r=e}static get __childrenNodeConstructor(){return r}constructor(e,t=eZ.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,_.assert)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),eJ(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new eZ(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:eZ.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ex(e)?this:".priority"===eS(e)?this.priorityNode_:eZ.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:eZ.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=eS(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,_.assert)(".priority"!==n||1===ek(e),".priority must be the last token in a path"),this.updateImmediateChild(n,eZ.__childrenNodeConstructor.EMPTY_NODE.updateChild(eA(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+eX(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=Y(this.value_):e+=this.value_,this.lazyHash_=N(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===eZ.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof eZ.__childrenNodeConstructor?-1:((0,_.assert)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=eZ.VALUE_TYPE_ORDER.indexOf(t),i=eZ.VALUE_TYPE_ORDER.indexOf(n);return((0,_.assert)(r>=0,"Unknown leaf type: "+t),(0,_.assert)(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}eZ.VALUE_TYPE_ORDER=["object","boolean","number","string"];let e0=new class extends ez{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?$(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ej.MIN}maxPost(){return new ej(z,new eZ("[PRIORITY-POST]",s))}makePost(e,t){return new ej(t,new eZ("[PRIORITY-POST]",i(e)))}toString(){return".priority"}},e1=Math.log(2);class e2{constructor(e){this.count=parseInt(Math.log(e+1)/e1,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let e6=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o=r-t;if(0===o)return null;if(1===o)return s=e[t],new eK(n?n(s):s,s.node,eK.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=i(t,a),h=i(a+1,r);return s=e[a],new eK(n?n(s):s,s.node,eK.BLACK,l,h)}};return new eG(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let h=i(s+1,a),u=e[s];l(new eK(n?n(u):u,u.node,r,null,h))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,eK.BLACK):(a(r,eK.BLACK),a(r,eK.RED))}return s}(new e2(e.length)))},e3={};class e4{static get Default(){return(0,_.assert)(e3&&e0,"ChildrenNode.ts has not been loaded"),o=o||new e4({".priority":e3},{".priority":e0})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=(0,_.safeGet)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof eG?t:null}hasIndex(e){return(0,_.contains)(this.indexSet_,e.toString())}addIndex(e,t){let n;(0,_.assert)(e!==eH,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(ej.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?e6(r,e.getCompare()):e3;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new e4(h,l)}addToIndexes(e,t){return new e4((0,_.map)(this.indexes_,(n,r)=>{let i=(0,_.safeGet)(this.indexSet_,r);if((0,_.assert)(i,"Missing index implementation for "+r),n===e3)if(!i.isDefinedOn(e.node))return e3;else{let n=[],r=t.getIterator(ej.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),e6(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new ej(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new e4((0,_.map)(this.indexes_,n=>{if(n===e3)return n;{let r=t.get(e.name);return r?n.remove(new ej(e.name,r)):n}}),this.indexSet_)}}class e5{static get EMPTY_NODE(){return a||(a=new e5(new eG(eY),null,e4.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&eJ(this.priorityNode_),this.children_.isEmpty()&&(0,_.assert)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||a}updatePriority(e){return this.children_.isEmpty()?this:new e5(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?a:t}}getChild(e){let t=eS(e);return null===t?this:this.getImmediateChild(t).getChild(eA(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,_.assert)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new ej(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?a:this.priorityNode_;return new e5(n,s,r)}}updateChild(e,t){let n=eS(e);if(null===n)return t;{(0,_.assert)(".priority"!==eS(e)||1===ek(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(eA(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(e0,(s,o)=>{t[s]=o.val(e),n++,i&&e5.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+eX(this.getPriority().val())+":"),this.forEachChild(e0,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":N(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new ej(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new ej(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new ej(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,ej.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,ej.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===e8?-1:0}withIndex(e){if(e===eH||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new e5(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===eH||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(e0),n=e.getIterator(e0),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===eH?null:this.indexMap_.get(e.toString())}}e5.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let e8=new class extends e5{constructor(){super(new eG(eY),e5.EMPTY_NODE,e4.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return e5.EMPTY_NODE}isEmpty(){return!1}};function e7(e,t=null){if(null===e)return e5.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,_.assert)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new eZ(e,e7(t));if(e instanceof Array){let n=e5.EMPTY_NODE;return Q(e,(t,r)=>{if((0,_.contains)(e,t)&&"."!==t.substring(0,1)){let e=e7(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(e7(t))}{let n=[],r=!1;if(Q(e,(e,t)=>{if("."!==e.substring(0,1)){let i=e7(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new ej(e,i)))}}),0===n.length)return e5.EMPTY_NODE;let i=e6(n,eQ,e=>e.name,eY);if(!r)return new e5(i,e7(t),e4.Default);{let e=e6(n,e0.getCompare());return new e5(i,e7(t),new e4({".priority":e},{".priority":e0}))}}}Object.defineProperties(ej,{MIN:{value:new ej(j,e5.EMPTY_NODE)},MAX:{value:new ej(z,e8)}}),e$.__EMPTY_NODE=e5.EMPTY_NODE,eZ.__childrenNodeConstructor=e5,n=e8,s=e8,i=e7;class e9 extends ez{constructor(e){super(),this.indexPath_=e,(0,_.assert)(!ex(e)&&".priority"!==eS(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?$(e.name,t.name):i}makePost(e,t){let n=e7(e);return new ej(t,e5.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new ej(z,e5.EMPTY_NODE.updateChild(this.indexPath_,e8))}toString(){return eR(this.indexPath_,0).join("/")}}let te=new class extends ez{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?$(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ej.MIN}maxPost(){return ej.MAX}makePost(e,t){return new ej(t,e7(e))}toString(){return".value"}};function tt(e){return{type:"value",snapshotNode:e}}function tn(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function tr(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function ti(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ts{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){(0,_.assert)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(tr(t,o)):(0,_.assert)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(tn(t,n)):s.trackChildChange(ti(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(e0,(e,r)=>{t.hasChild(e)||n.trackChildChange(tr(e,r))}),t.isLeafNode()||t.forEachChild(e0,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(ti(t,r,i))}else n.trackChildChange(tn(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?e5.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class to{constructor(e){this.indexedFilter_=new ts(e.getIndex()),this.index_=e.getIndex(),this.startPost_=to.getStartPost_(e),this.endPost_=to.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new ej(t,n))||(n=e5.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=e5.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(e5.EMPTY_NODE);let i=this;return t.forEachChild(e0,(e,t)=>{i.matches(new ej(e,t))||(r=r.updateImmediateChild(e,e5.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class ta{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new to(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new ej(t,n))||(n=e5.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=e5.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=e5.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(e5.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,e5.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();(0,_.assert)(e.numChildren()===this.limit_,"");let o=new ej(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=r.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=i&&i.trackChildChange(ti(t,n,h)),e.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(tr(t,h));let n=e.updateImmediateChild(t,e5.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(tn(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=i&&(i.trackChildChange(tr(a.name,a.node)),i.trackChildChange(tn(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,e5.EMPTY_NODE)):e:e}}class tl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=e0}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,_.assert)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,_.assert)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:j}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,_.assert)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,_.assert)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:z}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,_.assert)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===e0}copy(){let e=new tl;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function th(e){let t,n={};if(e.isDefault())return n;if(e.index_===e0?t="$priority":e.index_===te?t="$value":e.index_===eH?t="$key":((0,_.assert)(e.index_ instanceof e9,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,_.stringify)(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=(0,_.stringify)(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+(0,_.stringify)(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=(0,_.stringify)(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+(0,_.stringify)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function tu(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==e0&&(t.i=e.index_.toString()),t}class tc extends eE{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,_.assert)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=L("p:rest:"),this.listens_={}}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=tc.getListenId_(e,n),o={};this.listens_[s]=o;let a=th(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),(0,_.safeGet)(this.listens_,s)===o)&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=tc.getListenId_(e,t);delete this.listens_[n]}get(e){let t=th(e._queryParams),n=e._path.toString(),r=new _.Deferred;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,_.querystring)(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=(0,_.jsonEval)(o.responseText)}catch(e){F("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&F("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class td{constructor(){this.rootNode_=e5.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function tf(){return{value:null,children:new Map}}function tp(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{tp(r,new eI(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class tg{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&Q(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class tm{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new tg(e);const n=1e4+2e4*Math.random();ee(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;Q(e,(e,r)=>{r>0&&(0,_.contains)(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),ee(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function t_(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ty(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tv(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(d=f||(f={}))[d.OVERWRITE=0]="OVERWRITE",d[d.MERGE=1]="MERGE",d[d.ACK_USER_WRITE=2]="ACK_USER_WRITE",d[d.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class tw{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=f.ACK_USER_WRITE,this.source=t_()}operationForChild(e){if(!ex(this.path))return(0,_.assert)(eS(this.path)===e,"operationForChild called for unrelated child."),new tw(eA(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,_.assert)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new eI(e));return new tw(eC(),t,this.revert)}}}class tE{constructor(e,t){this.source=e,this.path=t,this.type=f.LISTEN_COMPLETE}operationForChild(e){return ex(this.path)?new tE(this.source,eC()):new tE(this.source,eA(this.path))}}class tb{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=f.OVERWRITE}operationForChild(e){return ex(this.path)?new tb(this.source,eC(),this.snap.getImmediateChild(e)):new tb(this.source,eA(this.path),this.snap)}}class tT{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=f.MERGE}operationForChild(e){if(!ex(this.path))return(0,_.assert)(eS(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new tT(this.source,eA(this.path),this.children);{let t=this.children.subtree(new eI(e));return t.isEmpty()?null:t.value?new tb(this.source,eC(),t.value):new tT(this.source,eC(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class tI{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ex(e))return this.isFullyInitialized()&&!this.filtered_;let t=eS(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class tC{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function tS(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw(0,_.assertionError)("Should only compare child_ events.");let r=new ej(t.childName,t.snapshotNode),i=new ej(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function tk(e,t){return{eventCache:e,serverCache:t}}function tA(e,t,n,r){return tk(new tI(t,n,r),e.serverCache)}function tN(e,t,n,r){return tk(e.eventCache,new tI(t,n,r))}function tR(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function tP(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class tD{static fromObject(e){let t=new tD(null);return Q(e,(e,n)=>{t=t.set(new eI(e),n)}),t}constructor(e,t=(!l&&(l=new eG(H)),l)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:eC(),value:this.value};{if(ex(e))return null;let n=eS(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(eA(e),t);return null!=i?{path:eD(new eI(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ex(e))return this;{let t=eS(e),n=this.children.get(t);return null!==n?n.subtree(eA(e)):new tD(null)}}set(e,t){if(ex(e))return new tD(t,this.children);{let n=eS(e),r=(this.children.get(n)||new tD(null)).set(eA(e),t),i=this.children.insert(n,r);return new tD(this.value,i)}}remove(e){if(ex(e))if(this.children.isEmpty())return new tD(null);else return new tD(null,this.children);{let t=eS(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(eA(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new tD(null):new tD(this.value,r)}}}get(e){if(ex(e))return this.value;{let t=eS(e),n=this.children.get(t);return n?n.get(eA(e)):null}}setTree(e,t){if(ex(e))return t;{let n,r=eS(e),i=(this.children.get(r)||new tD(null)).setTree(eA(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new tD(this.value,n)}}fold(e){return this.fold_(eC(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(eD(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,eC(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(ex(e))return null;let r=eS(e),i=this.children.get(r);return i?i.findOnPath_(eA(e),eD(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,eC(),t)}foreachOnPath_(e,t,n){if(ex(e))return this;{this.value&&n(t,this.value);let r=eS(e),i=this.children.get(r);return i?i.foreachOnPath_(eA(e),eD(t,r),n):new tD(null)}}foreach(e){this.foreach_(eC(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(eD(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class tx{constructor(e){this.writeTree_=e}static empty(){return new tx(new tD(null))}}function tO(e,t,n){if(ex(t))return new tx(new tD(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=eO(i,t);return s=s.updateChild(o,n),new tx(e.writeTree_.set(i,s))}{let r=new tD(n);return new tx(e.writeTree_.setTree(t,r))}}}function tL(e,t,n){let r=e;return Q(n,(e,n)=>{r=tO(r,eD(t,e),n)}),r}function tM(e,t){return ex(t)?tx.empty():new tx(e.writeTree_.setTree(t,new tD(null)))}function tU(e,t){return null!=tF(e,t)}function tF(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eO(n.path,t)):null}function tV(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(e0,(e,n)=>{t.push(new ej(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new ej(e,n.value))}),t}function tq(e,t){if(ex(t))return e;{let n=tF(e,t);return new tx(null!=n?new tD(n):e.writeTree_.subtree(t))}}function tB(e){return e.writeTree_.isEmpty()}function tj(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?((0,_.assert)(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(eD(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(eD(t,".priority"),i)),r}}(eC(),e.writeTree_,t)}function tz(e){return e.visible}function t$(e,t,n){let r=tx.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)eM(n,t)?r=tO(r,e=eO(n,t),s.snap):eM(t,n)&&(e=eO(t,n),r=tO(r,eC(),s.snap.getChild(e)));else if(s.children){if(eM(n,t))r=tL(r,e=eO(n,t),s.children);else if(eM(t,n))if(ex(e=eO(t,n)))r=tL(r,eC(),s.children);else{let t=(0,_.safeGet)(s.children,eS(e));if(t){let n=t.getChild(eA(e));r=tO(r,eC(),n)}}}else throw(0,_.assertionError)("WriteRecord should have .snap or .children")}}return r}function tH(e,t,n,r,i){if(r||i){let s=tq(e.visibleWrites,t);return!i&&tB(s)?n:i||null!=n||tU(s,eC())?tj(t$(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(eM(e.path,t)||eM(t,e.path))},t),n||e5.EMPTY_NODE):null}{let r=tF(e.visibleWrites,t);if(null!=r)return r;{let r=tq(e.visibleWrites,t);return tB(r)?n:null!=n||tU(r,eC())?tj(r,n||e5.EMPTY_NODE):null}}}function tW(e,t,n,r){return tH(e.writeTree,e.treePath,t,n,r)}function tK(e,t){return function(e,t,n){let r=e5.EMPTY_NODE,i=tF(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(e0,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return tV(tq(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=tq(e.visibleWrites,t);return n.forEachChild(e0,(e,t)=>{let n=tj(tq(i,new eI(e)),t);r=r.updateImmediateChild(e,n)}),tV(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function tG(e,t,n,r){return function(e,t,n,r,i){(0,_.assert)(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=eD(t,n);if(tU(e.visibleWrites,s))return null;{let t=tq(e.visibleWrites,s);return tB(t)?i.getChild(n):tj(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function tQ(e,t){var n,r;return n=e.writeTree,r=eD(e.treePath,t),tF(n.visibleWrites,r)}function tY(e,t,n){var r,i;let s,o;return r=e.writeTree,i=e.treePath,s=eD(i,t),null!=(o=tF(r.visibleWrites,s))?o:n.isCompleteForChild(t)?tj(tq(r.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function tX(e,t){return tJ(eD(e.treePath,t),e.writeTree)}function tJ(e,t){return{treePath:e,writeTree:t}}class tZ{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;(0,_.assert)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,_.assert)(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,ti(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,tr(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,tn(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,ti(n,e.snapshotNode,r.oldSnap));else throw(0,_.assertionError)("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let t0=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class t1{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new tI(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return tY(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:tP(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=tq(e.visibleWrites,t),h=tF(l,eC());if(null!=h)a=h;else{if(null==n)return[];a=tj(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function t2(e,t,n,r,i,s){let o=t.eventCache;if(null!=tQ(r,n))return t;{let a,l;if(ex(n))if((0,_.assert)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=tP(t),i=tK(r,n instanceof e5?n:e5.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=tW(r,tP(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=eS(n);if(".priority"===h){(0,_.assert)(1===ek(n),"Can't have a priority with additional path components");let i=o.getNode(),s=tG(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u,c=eA(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=tG(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=tY(r,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,i,s):o.getNode()}}return tA(t,a,o.isFullyInitialized()||ex(n),e.filter.filtersNodes())}}function t6(e,t,n,r,i,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(ex(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),e,null)}else{let e=eS(n);if(!h.isCompleteForPath(n)&&ek(n)>1)return t;let i=eA(n),s=h.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,i,t0,null)}let c=tN(t,l,h.isFullyInitialized()||ex(n),u.filtersNodes()),d=new t1(i,c,s);return t2(e,c,n,i,d,a)}function t3(e,t,n,r,i,s,o){let a,l,h=t.eventCache,u=new t1(i,t,s);if(ex(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=tA(t,l,!0,e.filter.filtersNodes());else{let i=eS(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=tA(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=eA(n),c=h.getNode().getImmediateChild(i);if(ex(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===eN(l)&&e.getChild(eP(l)).isEmpty()?e:e.updateChild(l,r):e5.EMPTY_NODE}a=c.equals(s)?t:tA(t,e.filter.updateChild(h.getNode(),i,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function t4(e,t){return e.eventCache.isCompleteForChild(t)}function t5(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function t8(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=ex(n)?r:new tD(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=t5(e,t.serverCache.getNode().getImmediateChild(n),r);h=t6(e,h,new eI(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=t5(e,t.serverCache.getNode().getImmediateChild(n),r);h=t6(e,h,new eI(n),l,i,s,o,a)}}),h}class t7{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new ts(n.getIndex()),i=function(e){return e.loadsAllData()?new ts(e.getIndex()):e.hasLimit()?new ta(e):new to(e)}(n);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache,a=r.updateFullNode(e5.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(e5.EMPTY_NODE,o.getNode(),null),h=new tI(a,s.isFullyInitialized(),r.filtersNodes()),u=new tI(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=tk(u,h),this.eventGenerator_=new tC(this.query_)}get query(){return this.query_}}function t9(e){return 0===e.eventRegistrations_.length}function ne(e,t,n){let r=[];if(n){(0,_.assert)(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function nt(e,t,n,r){var i,s;t.type===f.MERGE&&null!==t.source.queryId&&((0,_.assert)(tP(e.viewCache_),"We should always have a full cache before handling merges"),(0,_.assert)(tR(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){var s,o,a,l,h,u,c,d,p,g,m,y;let v,w,E=new tZ;if(n.type===f.OVERWRITE)n.source.fromUser?v=t3(e,t,n.path,n.snap,r,i,E):((0,_.assert)(n.source.fromServer,"Unknown source."),w=n.source.tagged||t.serverCache.isFiltered()&&!ex(n.path),v=t6(e,t,n.path,n.snap,r,i,w,E));else if(n.type===f.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=r,u=i,c=E,d=o,l.foreach((e,t)=>{let n=eD(a,e);t4(o,eS(n))&&(d=t3(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=eD(a,e);t4(o,eS(n))||(d=t3(s,d,n,t,h,u,c))}),v=d):((0,_.assert)(n.source.fromServer,"Unknown source."),w=n.source.tagged||t.serverCache.isFiltered(),v=t8(e,t,n.path,n.children,r,i,w,E))}else if(n.type===f.ACK_USER_WRITE)v=n.revert?function(e,t,n,r,i,s){let o;if(null!=tQ(r,n))return t;{let a,l=new t1(r,t,i),h=t.eventCache.getNode();if(ex(n)||".priority"===eS(n)){let n;if(t.serverCache.isFullyInitialized())n=tW(r,tP(t));else{let e=t.serverCache.getNode();(0,_.assert)(e instanceof e5,"serverChildren would be complete if leaf node"),n=tK(r,e)}a=e.filter.updateFullNode(h,n,s)}else{let i=eS(n),u=tY(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(h,i,u,eA(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(h,i,e5.EMPTY_NODE,eA(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=tW(r,tP(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=tQ(r,eC()),tA(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,E):function(e,t,n,r,i,s,o){if(null!=tQ(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(ex(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return t6(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!ex(n))return t;let r=new tD(null);return l.getNode().forEachChild(eH,(e,t)=>{r=r.set(new eI(e),t)}),t8(e,t,n,r,i,s,a,o)}{let h=new tD(null);return r.foreach((e,t)=>{let r=eD(n,e);l.isCompleteForPath(r)&&(h=h.set(e,l.getNode().getChild(r)))}),t8(e,t,n,h,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,E);else if(n.type===f.LISTEN_COMPLETE){let i;d=e,p=t,g=n.path,m=r,y=E,i=p.serverCache,v=t2(d,tN(p,i.getNode(),i.isFullyInitialized()||ex(g),i.isFiltered()),g,m,t0,y)}else throw(0,_.assertionError)("Unknown operation type: "+n.type);let b=E.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=tR(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(tt(tR(t)))}}(t,v,b),{viewCache:v,changes:b}}(e.processor_,o,t,n,r);return i=e.processor_,s=a.viewCache,(0,_.assert)(s.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,_.assert)(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,_.assert)(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,nn(e,a.changes,a.viewCache.eventCache.getNode(),null)}function nn(e,t,n,r){var i;let s,o,a=r?[r]:e.eventRegistrations_;return i=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),tS(i,s,"child_removed",t,a,n),tS(i,s,"child_added",t,a,n),tS(i,s,"child_moved",o,a,n),tS(i,s,"child_changed",t,a,n),tS(i,s,"value",t,a,n),s}class nr{constructor(){this.views=new Map}}function ni(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return(0,_.assert)(null!=s,"SyncTree gave us an op for an invalid query."),nt(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(nt(s,t,n,r));return i}}function ns(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=tW(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof e5?tK(n,r):e5.EMPTY_NODE,s=!1),new t7(t,tk(new tI(e,s,!1),new tI(r,i,!1)))}return o}function no(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function na(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=tP(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ex(t)&&!n.getImmediateChild(eS(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function nl(e,t){if(t._queryParams.loadsAllData())return nu(e);{let n=t._queryIdentifier;return e.views.get(n)}}function nh(e){return null!=nu(e)}function nu(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let nc=1;class nd{constructor(e){this.listenProvider_=e,this.syncPointTree_=new tD(null),this.pendingWriteTree_={visibleWrites:tx.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function nf(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);(0,_.assert)(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return eM(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&eM(eD(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:eM(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=t$(n.allWrites,tz,eC()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=tM(e.visibleWrites,i.path):Q(i.children,t=>{e.visibleWrites=tM(e.visibleWrites,eD(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new tD(null);return null!=r.snap?t=t.set(eC(),!0):Q(r.children,e=>{t=t.set(new eI(e),!0)}),ny(e,new tw(r.path,t,n))}}function np(e,t,n){return ny(e,new tb(ty(),t,n))}function ng(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=nl(o,t))){let c=function(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=nh(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(ne(i,n,r)),t9(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(ne(t,n,r)),t9(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!nh(e)&&s.push(new((0,_.assert)(h,"Reference.ts has not been loaded"),h)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=c.removed;if(a=c.events,!i){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>nh(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&nh(t))return[nu(t)];{let e=[];return t&&(e=no(t)),Q(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=nv(e,r);e.listenProvider_.startListening(nC(i),nw(e,i),s.hashFn,s.onComplete)}}}i||!(d.length>0)||r||(n?e.listenProvider_.stopListening(nC(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(nE(t));e.listenProvider_.stopListening(nC(t),n)}))}var l=e,u=d;for(let e=0;e<u.length;++e){let t=u[e];if(!t._queryParams.loadsAllData()){let e=nE(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function nm(e,t,n,r){let i=nb(e,r);if(null==i)return[];{let r=nT(i),s=r.path,o=r.queryId,a=eO(s,t);return nI(e,s,new tb(tv(o),a,n))}}function n_(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=na(n,eO(e,t));if(r)return r});return tH(r,t,i,n,!0)}function ny(e,t){var n;return function e(t,n,r,i){if(ex(t.path))return function e(t,n,r,i){let s=n.get(eC());null==r&&null!=s&&(r=na(s,eC()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=tX(i,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(ni(s,t,i,r))),o}(t,n,r,i);{let s=n.get(eC());null==r&&null!=s&&(r=na(s,eC()));let o=[],a=eS(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=r?r.getImmediateChild(a):null,n=tX(i,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(ni(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,tJ(eC(),n)))}function nv(e,t){let n=t.query,r=nw(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||e5.EMPTY_NODE).hash(),onComplete:t=>{var i;if("ok"===t)if(r)return function(e,t,n){let r=nb(e,n);if(!r)return[];{let n=nT(r),i=n.path,s=n.queryId,o=eO(i,t);return nI(e,i,new tE(tv(s),o))}}(e,n._path,r);else return i=n._path,ny(e,new tE(ty(),i));{let r,i,s=(r="Unknown Error","too_big"===t?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?r="Client doesn't have permission to access the desired data.":"unavailable"===t&&(r="The service is unavailable"),(i=Error(t+" at "+n._path.toString()+": "+r)).code=t.toUpperCase(),i);return ng(e,n,null,s)}}}}function nw(e,t){let n=nE(t);return e.queryToTagMap.get(n)}function nE(e){return e._path.toString()+"$"+e._queryIdentifier}function nb(e,t){return e.tagToQueryMap.get(t)}function nT(e){let t=e.indexOf("$");return(0,_.assert)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new eI(e.substr(0,t))}}function nI(e,t,n){let r=e.syncPointTree_.get(t);return(0,_.assert)(r,"Missing sync point for query tag that we're tracking"),ni(r,n,tJ(t,e.pendingWriteTree_),null)}function nC(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,_.assert)(u,"Reference.ts has not been loaded"),u)(e._repo,e._path):e}class nS{constructor(e){this.node_=e}getImmediateChild(e){return new nS(this.node_.getImmediateChild(e))}node(){return this.node_}}class nk{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=eD(this.path_,e);return new nk(this.syncTree_,t)}node(){return n_(this.syncTree_,this.path_)}}let nA=function(e,t,n){return e&&"object"==typeof e?((0,_.assert)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?nN(e[".sv"],t,n):"object"==typeof e[".sv"]?nR(e[".sv"],t):void(0,_.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},nN=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,_.assert)(!1,"Unexpected server value: "+e)},nR=function(e,t,n){e.hasOwnProperty("increment")||(0,_.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&(0,_.assert)(!1,"Unexpected increment value: "+r);let i=t.node();if((0,_.assert)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r};function nP(e,t,n){let r,i=nA(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new eZ(i))),e.forEachChild(e0,(e,i)=>{let s=nP(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=nA(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new eZ(r,e7(i)):e}}class nD{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function nx(e,t){let n=t instanceof eI?t:new eI(t),r=e,i=eS(n);for(;null!==i;){let e=(0,_.safeGet)(r.node.children,i)||{children:{},childCount:0};r=new nD(i,r,e),i=eS(n=eA(n))}return r}function nO(e){return e.node.value}function nL(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===nO(r)&&!nM(r),s=(0,_.contains)(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function nM(e){return e.node.childCount>0}function nU(e,t){Q(e.node.children,(n,r)=>{t(new nD(n,e,r))})}function nF(e){return new eI(null===e.parent?e.name:nF(e.parent)+"/"+e.name)}let nV=/[\[\].#$\/\u0000-\u001F\u007F]/,nq=/[\[\].#$\u0000-\u001F\u007F]/,nB=function(e){return"string"==typeof e&&0!==e.length&&!nV.test(e)},nj=function(e){return"string"==typeof e&&0!==e.length&&!nq.test(e)},nz=function(e,t,n){let r=n instanceof eI?new eU(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+eV(r));if("function"==typeof t)throw Error(e+"contains a function "+eV(r)+" with contents = "+t.toString());if(q(t))throw Error(e+"contains "+t.toString()+" "+eV(r));if("string"==typeof t&&t.length>3495253.3333333335&&(0,_.stringLength)(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+eV(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(Q(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!nB(t)))throw Error(e+" contains an invalid key ("+t+") "+eV(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=(0,_.stringLength)(t),eF(r),nz(e,s,r),o=r.parts_.pop(),r.byteLength_-=(0,_.stringLength)(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+eV(r)+" in addition to actual children.")}},n$=function(e,t,n,r){if((!r||void 0!==n)&&!nj(n))throw Error((0,_.errorPrefix)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},nH=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),n$(e,t,n,r)},nW=function(e,t){var n;let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!nB(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!nj(n)))throw Error((0,_.errorPrefix)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class nK{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function nG(e,t,n){let r=null;for(let t=0;t<n.length;t++){let i=n[t],s=i.getPath();null===r||eL(s,r.path)||(e.eventLists_.push(r),r=null),null===r&&(r={events:[],path:s}),r.events.push(i)}r&&e.eventLists_.push(r),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();P&&O("event: "+n.toString()),Z(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>eM(e,t)||eM(t,e))}class nQ{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new nK,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tf(),this.transactionQueueTree_=new nD,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function nY(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new eI(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function nX(e,t,n,r,i){e.dataUpdateCount++;let s=new eI(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=(0,_.map)(n,e=>e7(e));o=function(e,t,n,r){let i=nb(e,r);if(!i)return[];{let r=nT(i),s=r.path,o=r.queryId,a=eO(s,t),l=tD.fromObject(n);return nI(e,s,new tT(tv(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=e7(n);o=nm(e.serverSyncTree_,s,t,i)}else if(r){var a;let t,r=(0,_.map)(n,e=>e7(e));a=e.serverSyncTree_,t=tD.fromObject(r),o=ny(a,new tT(ty(),s,t))}else{let t=e7(n);o=np(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=n2(e,s)),nG(e.eventQueue_,l,o)}function nJ(e,t){var n;let r,i,s;nZ(e,"connected",t),!1===t&&(n0(n=e,"onDisconnectEvents"),r=nY(n),i=tf(),tp(n.onDisconnect_,eC(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,nP(t,new nk(s,e),r));!function e(t,n,r){if(ex(n))t.value=r,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,r);else{let i=eS(n);t.children.has(i)||t.children.set(i,tf()),e(t.children.get(i),n=eA(n),r)}}(i,e,o)}),s=[],tp(i,eC(),(e,t)=>{var r,i;let o,a;s=s.concat(np(n.serverSyncTree_,e,t));let l=(o=nF(n6(r=n,i=e)),!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(a=nx(r.transactionQueueTree_,i),e=>{n5(r,e)}),n5(r,a),!function e(t,n,r,i){r&&!i&&n(t),nU(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(a,e=>{n5(r,e)}),o);n2(n,l)}),n.onDisconnect_=tf(),nG(n.eventQueue_,eC(),s))}function nZ(e,t,n){let r=new eI("/.info/"+t),i=e7(n);e.infoData_.updateSnapshot(r,i);let s=np(e.infoSyncTree_,r,i);nG(e.eventQueue_,r,s)}function n0(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),O(n,...t)}function n1(e,t,n){return n_(e.serverSyncTree_,t,n)||e5.EMPTY_NODE}function n2(e,t){let n=n6(e,t),r=nF(n),i=n3(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=eO(n,a.path),h=!1,u;if((0,_.assert)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,i=i.concat(nf(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",i=i.concat(nf(e.serverSyncTree_,a.currentWriteId,!0));else{let n=n1(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){nz("transaction failed: Data returned ",r,a.path);let t=e7(r);"object"==typeof r&&null!=r&&(0,_.contains)(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=nY(e),h=nP(t,new nS(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),i=(i=i.concat(function(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,(0,_.assert)(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=tO(s.visibleWrites,t,n)),s.lastWriteId=r,i)?ny(e,new tb(t_(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(nf(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",i=i.concat(nf(e.serverSyncTree_,a.currentWriteId,!0))}nG(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}n4(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)Z(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||n4(t,n),nO(n)){let r=n3(t,n);(0,_.assert)(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=n1(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];(0,_.assert)(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=eO(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{n0(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(nf(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();n4(t,nx(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),nG(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)Z(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{F("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}n2(t,n)}},o)}(t,nF(n),r)}else nM(n)&&nU(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function n6(e,t){let n,r=e.transactionQueueTree_;for(n=eS(t);null!==n&&void 0===nO(r);)r=nx(r,n),n=eS(t=eA(t));return r}function n3(e,t){let n=[];return function e(t,n,r){let i=nO(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);nU(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function n4(e,t){let n=nO(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,nL(t,n.length>0?n:void 0)}nU(t,t=>{n4(e,t)})}function n5(e,t){let n=nO(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,_.assert)(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):((0,_.assert)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(nf(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?nL(t,void 0):n.length=s+1,nG(e.eventQueue_,nF(t),i);for(let e=0;e<r.length;e++)Z(r[e])}}let n8=function(e,t){let n=n7(e),r=n.namespace;"firebase.com"===n.domain&&U(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||U("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||V();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ea(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new eI(n.pathString)}},n7=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):F(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class n9{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,_.stringify)(this.snapshot.exportVal())}}class re{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class rt{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,_.assert)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class rn{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return ex(this._path)?null:eN(this._path)}get ref(){return new rr(this._repo,this._path)}get _queryIdentifier(){let e=K(tu(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return tu(this._queryParams)}isEqual(e){if(!((e=(0,_.getModularInstance)(e))instanceof rn))return!1;let t=this._repo===e._repo,n=eL(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class rr extends rn{constructor(e,t){super(e,t,new tl,!1)}get parent(){let e=eP(this._path);return null===e?null:new rr(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ri{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new eI(e),n=ro(this.ref,e);return new ri(this._node.getChild(t),n,e0)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new ri(n,ro(this.ref,t),e0)))}hasChild(e){let t=new eI(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function rs(e,t){return(e=(0,_.getModularInstance)(e))._checkNotDeleted("ref"),void 0!==t?ro(e._root,t):e._root}function ro(e,t){return null===eS((e=(0,_.getModularInstance)(e))._path)?nH("child","path",t,!1):n$("child","path",t,!1),new rr(e._repo,eD(e._path,t))}function ra(e){var t,n,r,i,s;let o,a,l,h,u,c,d;e=(0,_.getModularInstance)(e);let f=new rl(new rt(()=>{}));return(t=e._repo,n=e,r=t.serverSyncTree_,a=(i=n)._path,l=null,r.syncPointTree_.foreachOnPath(a,(e,t)=>{let n=eO(e,a);l=l||na(t,n)}),(h=r.syncPointTree_.get(a))?l=l||na(h,eC()):(h=new nr,r.syncPointTree_=r.syncPointTree_.set(a,h)),c=(u=null!=l)?new tI(l,!0,!1):null,d=(s=r.pendingWriteTree_,tJ(i._path,s)),null!=(o=tR(ns(h,i,d,u?c.getNode():e5.EMPTY_NODE,u).viewCache_))?Promise.resolve(o):t.server_.get(n).then(e=>{let r,i=e7(e).withIndex(n._queryParams.getIndex());if(!function(e,t,n,r=!1){var i;let s,o,a,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=eO(e,h);u=u||na(t,n),c=c||nh(t)});let d=e.syncPointTree_.get(h);d?(c=c||nh(d),u=u||na(d,eC())):(d=new nr,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=e5.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=na(t,eC());n&&(u=u.updateImmediateChild(e,n))}));let f=null!=nl(d,t);if(!f&&!t._queryParams.loadsAllData()){let n=nE(t);(0,_.assert)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=nc++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let p=tJ(h,e.pendingWriteTree_),g=(o=ns(i=d,t,p,u,s),i.views.has(t._queryIdentifier)||i.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(e0,(e,t)=>{l.push(tn(e,t))}),a.isFullyInitialized()&&l.push(tt(a.getNode())),nn(o,l,a.getNode(),n));if(!f&&!c&&!r){let n=nl(d,t);g=g.concat(function(e,t,n){let r=t._path,i=nw(e,t),s=nv(e,n),o=e.listenProvider_.startListening(nC(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)(0,_.assert)(!nh(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!ex(e)&&t&&nh(t))return[nu(t).query];{let e=[];return t&&(e=e.concat(no(t).map(e=>e.query))),Q(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(nC(r),nw(e,r))}}return o}(e,t,n))}}(t.serverSyncTree_,n,f,!0),n._queryParams.loadsAllData())r=np(t.serverSyncTree_,n._path,i);else{let e=nw(t.serverSyncTree_,n);r=nm(t.serverSyncTree_,n._path,i,e)}return nG(t.eventQueue_,n._path,r),ng(t.serverSyncTree_,n,f,null,!0),i},e=>(n0(t,"get for query "+(0,_.stringify)(n)+" failed: "+e),Promise.reject(Error(e))))).then(t=>new ri(t,new rr(e._repo,e._path),e._queryParams.getIndex()))}class rl{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new n9("value",this,new ri(e.snapshotNode,new rr(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new re(this,e,t):null}matches(e){return e instanceof rl&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}(0,_.assert)(!h,"__referenceConstructor has already been defined"),h=rr,(0,_.assert)(!u,"__referenceConstructor has already been defined"),u=rr;let rh={};class ru{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var r;let i;if(e.stats_=ed(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new tc(e.repoInfo_,(t,n,r,i)=>{nX(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>nJ(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,_.stringify)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new eB(e.repoInfo_,t,(t,n,r,i)=>{nX(e,t,n,r,i)},t=>{nJ(e,t)},t=>{var n;n=e,Q(t,(e,t)=>{nZ(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),r=e.repoInfo_,ec[i=r.toString()]||(ec[i]=(()=>new tm(e.stats_,e.server_))()),e.statsReporter_=ec[i],e.infoData_=new td,e.infoSyncTree_=new nd({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=np(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),nZ(e,"connected",!1),e.serverSyncTree_=new nd({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);nG(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rr(this._repo,eC())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=rh[t=this.app.name])&&n[e.key]===e||U(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&U("Cannot call "+e+" on a deleted database.")}}function rc(e=(0,g.getApp)(),t){let n=(0,g._getProvider)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=(0,_.getDefaultEmulatorHostnameAndPort)("database");e&&function(e,t,n,r={}){var i;let s,o,a;(e=(0,_.getModularInstance)(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&(0,_.deepEqual)(r,h.repoInfo_.emulatorOptions))return;U("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(r.mockUserToken&&U('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new er(er.OWNER)):r.mockUserToken&&(s=new er("string"==typeof r.mockUserToken?r.mockUserToken:(0,_.createMockUserToken)(r.mockUserToken,e.app.options.projectId))),(0,_.isCloudWorkstation)(t)&&((0,_.pingServer)(t),(0,_.updateEmulatorBanner)("Database",!0)),i=s,o=l.lastIndexOf(":"),a=l.substring(0,o),h.repoInfo_=new ea(l,(0,_.isCloudWorkstation)(a),h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,r),i&&(h.authTokenProvider_=i)}(n,...e)}return n}eB.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},eB.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},E=g.SDK_VERSION,(0,g._registerComponent)(new m.Component("database",(e,{instanceIdentifier:t})=>{var n,r,i,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),g=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||U("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),O("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=n8(l,void 0)).repoInfo,void 0!==p.default&&p.default.env&&(c=p.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=n8(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new en(f.name,f.options,g),nW("Invalid Firebase Database URL",h),ex(h.path)||U("Database URL must point to the root of a Firebase Database (not including a child path)."),new ru((n=u,r=f,i=d,s=new et(f,m),(o=rh[r.name])||(o={},rh[r.name]=o),(a=o[n.toURLString()])&&U("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new nQ(n,!1,i,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),(0,g.registerVersion)(v,w,void 0),(0,g.registerVersion)(v,w,"esm2020"),e.s(["get",()=>ra,"getDatabase",()=>rc,"ref",()=>rs],34991),e.s([],1465)},61086,27215,e=>{"use strict";var t,n,r,i,s=e.i(92953),o=e.i(97427),a=e.i(8070);let l="firebasestorage.googleapis.com",h="storageBucket";class u extends o.FirebaseError{constructor(e,t,n=0){super(c(e),`Firebase Storage: ${t} (${c(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,u.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return c(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function c(e){return"storage/"+e}function d(){return new u(r.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function f(e){return new u(r.INVALID_ARGUMENT,e)}function p(){return new u(r.APP_DELETED,"The Firebase app was deleted.")}function g(e,t){return new u(r.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function m(e){throw new u(r.INTERNAL_ERROR,"Internal error: "+e)}(t=r||(r={})).UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class _{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=_.makeFromUrl(e,t)}catch(t){return new _(e,"")}if(""===n.path)return n;throw new u(r.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,i="([A-Za-z0-9.\\-_]+)",s=RegExp("^gs://"+i+"(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),h=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),c=t===l?"(?:storage.googleapis.com|storage.cloud.google.com)":t,d=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:h,indices:{bucket:1,path:3},postModify:o},{regex:RegExp(`^https?://${c}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let t=0;t<d.length;t++){let r=d[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new _(e,t),r.postModify(n);break}}if(null==n)throw new u(r.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class y{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function v(e){return"string"==typeof e||e instanceof String}function w(e){return E()&&e instanceof Blob}function E(){return"undefined"!=typeof Blob}function b(e,t,n,r){if(r<t)throw f(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw f(`Invalid value for '${e}'. Expected ${n} or less.`)}function T(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function I(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(n=i||(i={}))[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT";class C{constructor(e,t,n,r,i,s,o,a,l,h,u,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new S(!1,null,!0));let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let s,o,a;null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let l=n.getErrorCode()===i.NO_ERROR,h=n.getStatus();!l||(t=this.additionalRetryCodes_,s=h>=500&&h<600,o=-1!==[408,429].indexOf(h),a=-1!==t.indexOf(h),(s||o||a)&&this.retry)?e(!1,new S(!1,null,n.getErrorCode()===i.ABORT)):e(!0,new S(-1!==this.successCodes_.indexOf(h),n))})},t=(e,t)=>{let n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(s,s.getResponse());void 0!==e?n(e):n()}catch(e){i(e)}else if(null!==s){let e=d();e.serverResponse=s.getErrorText(),i(this.errorCallback_?this.errorCallback_(s,e):e)}else i(t.canceled?this.appDelete_?p():new u(r.CANCELED,"User canceled the upload/download."):new u(r.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new S(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0,l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){i=setTimeout(()=>{i=null,e(d,2===a)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let n;if(l)return void c();if(e||2===a||o){c(),h.call(null,e,...t);return}r<64&&(r*=2),1===a?(a=2,n=0):n=(r+Math.random())*1e3,u(n)}let f=!1;function p(e){f||(f=!0,c(),!l&&(null!==i?(e||(a=2),clearTimeout(i),u(0)):e||(a=1)))}return u(0),s=setTimeout(()=>{o=!0,p(!0)},n),p}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class S{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function k(...e){let t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(E())return new Blob(e);throw new u(r.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let A="base64",N="base64url",R="data_url";class P{constructor(e,t){this.data=e,this.contentType=t||null}}function D(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):(64512&r)==55296?n<e.length-1&&(64512&e.charCodeAt(n+1))==56320?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):(64512&r)==56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function x(e,t){let n;switch(e){case A:{let n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw g(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case N:{let n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw g(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{n=function(e){if("undefined"==typeof atob)throw new u(r.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw g(e,"Invalid character found")}let i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i}class O{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw g(R,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class L{constructor(e,t){let n=0,r="";w(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(!w(this.data_))return new L(new Uint8Array(this.data_.buffer,e,t-e),!0);{var n,r,i;let s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new L(s)}}static getBlob(...e){if(E()){let t=e.map(e=>e instanceof L?e.data_:e);return new L(k.apply(null,t))}{let t=e.map(e=>v(e)?function(e,t){return new P(D(t))}("raw",e).data:e.data_),n=0;t.forEach(e=>{n+=e.byteLength});let r=new Uint8Array(n),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new L(r,!0)}}uploadData(){return this.data_}}function M(e){var t;let n;try{n=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=n)||Array.isArray(t)?null:n}function U(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function F(e,t){return t}class V{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||F}}let q=null;function B(){if(q)return q;let e=[];e.push(new V("bucket")),e.push(new V("generation")),e.push(new V("metageneration")),e.push(new V("name","fullPath",!0));let t=new V("name");t.xform=function(e,t){return!v(t)||t.length<2?t:U(t)},e.push(t);let n=new V("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new V("timeCreated")),e.push(new V("updated")),e.push(new V("md5Hash",null,!0)),e.push(new V("cacheControl",null,!0)),e.push(new V("contentDisposition",null,!0)),e.push(new V("contentEncoding",null,!0)),e.push(new V("contentLanguage",null,!0)),e.push(new V("contentType",null,!0)),e.push(new V("metadata","customMetadata",!0)),q=e}function j(e,t,n){let r=M(t);return null===r?null:function(e,t,n){let r={};r.type="file";let i=n.length;for(let e=0;e<i;e++){let i=n[e];r[i.local]=i.xform(r,t[i.server])}return Object.defineProperty(r,"ref",{get:function(){let t=new _(r.bucket,r.fullPath);return e._makeStorageReference(t)}}),r}(e,r,n)}class z{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function $(e){if(!e)throw d()}function H(e){return function(t,n){var i,s;let o;return 401===t.getStatus()?o=t.getErrorText().includes("Firebase App Check token is invalid")?new u(r.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new u(r.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,o=new u(r.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,o=new u(r.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):o=n,o.status=t.getStatus(),o.serverResponse=n.serverResponse,o}}class W{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=i.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=i.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=i.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,i){if(this.sent_)throw m("cannot .send() more than once");if((0,o.isCloudWorkstation)(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(let e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw m("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw m("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return -1}}getResponse(){if(!this.sent_)throw m("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw m("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class K extends W{initXhr(){this.xhr_.responseType="text"}}function G(){return new K}class Q{constructor(e,t){this._service=e,t instanceof _?this._location=t:this._location=_.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Q(e,t)}get root(){let e=new _(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return U(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new _(this._location.bucket,e);return new Q(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new u(r.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function Y(e,t){let n=t?.[h];return null==n?null:_.makeFromBucketSpec(n,e)}class X{constructor(e,t,n,r,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=l,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=_.makeFromBucketSpec(r,this._host):this._bucket=Y(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=_.makeFromBucketSpec(this._url,e):this._bucket=Y(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){b("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){b("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,s._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Q(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new y(p());{let s=function(e,t,n,r,i,s,o=!0,a=!1){let l=I(e.urlParams),h=e.url+l,u=Object.assign({},e.headers);return t&&(u["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(u.Authorization="Firebase "+n),u["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==r&&(u["X-Firebase-AppCheck"]=r),new C(h,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o,a)}(e,this._appId,n,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let J="@firebase/storage",Z="0.14.0",ee="storage";function et(e,t,n){var i;let s;return i=e=(0,o.getModularInstance)(e),i._throwIfRoot("uploadBytes"),s=function(e,t,n,i,s){let o,a=t.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"},h=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();l["Content-Type"]="multipart/related; boundary="+h;let c=((o=Object.assign({},s)).fullPath=t.path,o.size=i.size(),o.contentType||(o.contentType=i&&i.type()||"application/octet-stream"),o),d="--"+h+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){let n={},r=t.length;for(let i=0;i<r;i++){let r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+h+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",f=L.getBlob(d,i,"\r\n--"+h+"--");if(null===f)throw new u(r.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");let p={name:c.fullPath},g=T(a,e.host,e._protocol),m=e.maxUploadRetryTime,_=new z(g,"POST",function(t,r){let i=j(e,r,n);return $(null!==i),i},m);return _.urlParams=p,_.headers=l,_.body=f.uploadData(),_.errorHandler=H(t),_}(i.storage,i._location,B(),new L(t,!0),n),i.storage.makeRequestWithTokens(s,G).then(e=>({metadata:e,ref:i}))}function en(e){var t,n,i,s;let a,l,h,c,d;return(t=e=(0,o.getModularInstance)(e))._throwIfRoot("getDownloadURL"),n=t.storage,i=t._location,s=B(),a=T(i.fullServerUrl(),n.host,n._protocol),l=n.maxOperationRetryTime,h=new z(a,"GET",function(e,t){let r=j(n,t,s);return $(null!==r),function(e,t,n,r){let i=M(t);if(null===i||!v(i.downloadTokens))return null;let s=i.downloadTokens;if(0===s.length)return null;let o=encodeURIComponent;return s.split(",").map(t=>{let i=e.bucket,s=e.fullPath;return T("/b/"+o(i)+"/o/"+o(s),n,r)+I({alt:"media",token:t})})[0]}(r,t,n.host,n._protocol)},l),c=H(i),h.errorHandler=function(e,t){var n;let s=c(e,t);return 404===e.getStatus()&&(n=i.path,s=new u(r.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")),s.serverResponse=t.serverResponse,s},d=h,t.storage.makeRequestWithTokens(d,G).then(e=>{if(null===e)throw new u(r.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function er(e,t){var n=e=(0,o.getModularInstance)(e);if(!(t&&/^[A-Za-z]+:\/\//.test(t)))return function e(t,n){var i;let s,o,a;if(t instanceof X){if(null==t._bucket)throw new u(r.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+h+"' property when initializing the app?");let i=new Q(t,t._bucket);return null!=n?e(i,n):i}if(void 0===n)return t;return i=t._location.path,s=n.split("/").filter(e=>e.length>0).join("/"),o=0===i.length?s:i+"/"+s,a=new _(t._location.bucket,o),new Q(t.storage,a)}(n,t);if(n instanceof X)return new Q(n,t);throw f("To use ref(service, url), the first argument must be a Storage instance.")}function ei(e=(0,s.getApp)(),t){e=(0,o.getModularInstance)(e);let n=(0,s._getProvider)(e,ee).getImmediate({identifier:t}),r=(0,o.getDefaultEmulatorHostnameAndPort)("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`;let i=(0,o.isCloudWorkstation)(t);i&&((0,o.pingServer)(`https://${e.host}/b`),(0,o.updateEmulatorBanner)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:(0,o.createMockUserToken)(s,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(0,s._registerComponent)(new a.Component(ee,function(e,{instanceIdentifier:t}){return new X(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,s.SDK_VERSION)},"PUBLIC").setMultipleInstances(!0)),(0,s.registerVersion)(J,Z,""),(0,s.registerVersion)(J,Z,"esm2020"),e.s(["getDownloadURL",()=>en,"getStorage",()=>ei,"ref",()=>er,"uploadBytes",()=>et],27215),e.s([],61086)},6245,52831,61978,e=>{"use strict";let t,n,r,i,s,o;var a=e.i(47167);e.i(14539);var l=e.i(76510);e.i(51718);var h=e.i(18357);e.i(36180);var u=e.i(98925);e.i(1465);var c=e.i(34991);e.i(61086);var d=e.i(27215),f=e.i(92953),p=e.i(97427),g=e.i(8070);function m(e,t){let n={};for(let r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function _(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>_(e));if("function"==typeof e||"object"==typeof e)return m(e,e=>_(e));throw Error("Data cannot be encoded in JSON: "+e)}function y(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{let t=Number(e.value);if(isNaN(t))throw Error("Data cannot be decoded from JSON: "+e);return t}default:throw Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>y(e)):"function"==typeof e||"object"==typeof e?m(e,e=>y(e)):e}let v="functions",w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class E extends p.FirebaseError{constructor(e,t,n){super(`${v}/${e}`,t||""),this.details=n,Object.setPrototypeOf(this,E.prototype)}}function b(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r;try{let e=t&&t.error;if(e){let t=e.status;if("string"==typeof t){if(!w[t])return new E("internal","internal");r=w[t],i=t}let s=e.message;"string"==typeof s&&(i=s),n=e.details,void 0!==n&&(n=y(n))}}catch(e){}return"ok"===r?null:new E(r,i,n)}class T{constructor(e,t,n,r){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,(0,f._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||n.get().then(e=>this.messaging=e,()=>{}),this.appCheck||r?.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{let e=await this.auth.getToken();return e?.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){let t=await this.getAuthToken();return{authToken:t,messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let I="us-central1",C=/^data: (.*?)(?:\n|$)/;class S{constructor(e,t,n,r,i=I,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new T(e,t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=I}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;if(null!==this.emulatorOrigin){let n=this.emulatorOrigin;return`${n}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function k(e){return e.emulatorOrigin&&(0,p.isCloudWorkstation)(e.emulatorOrigin)?"include":void 0}async function A(e,t,n,r,i){let s;n["Content-Type"]="application/json";try{s=await r(e,{method:"POST",body:JSON.stringify(t),headers:n,credentials:k(i)})}catch(e){return{status:0,json:null}}let o=null;try{o=await s.json()}catch(e){}return{status:s.status,json:o}}async function N(e,t){let n={},r=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),null!==r.appCheckToken&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}async function R(e,t,n,r){var i;let s,o={data:n=_(n)},a=await N(e,r),l=(i=r.timeout||7e4,s=null,{promise:new Promise((e,t)=>{s=setTimeout(()=>{t(new E("deadline-exceeded","deadline-exceeded"))},i)}),cancel:()=>{s&&clearTimeout(s)}}),h=await Promise.race([A(t,o,a,e.fetchImpl,e),l.promise,e.cancelAllRequests]);if(l.cancel(),!h)throw new E("cancelled","Firebase Functions instance was deleted.");let u=b(h.status,h.json);if(u)throw u;if(!h.json)throw new E("internal","Response is not valid JSON object.");let c=h.json.data;if(void 0===c&&(c=h.json.result),void 0===c)throw new E("internal","Response is missing data field.");return{data:y(c)}}async function P(e,t,n,r){var i,s,o,a;let l,h,u,c,d,f={data:n=_(n)},p=await N(e,r);p["Content-Type"]="application/json",p.Accept="text/event-stream";try{u=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(f),headers:p,signal:r?.signal,credentials:k(e)})}catch(t){if(t instanceof Error&&"AbortError"===t.name){let e=new E("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let e=b(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let g=new Promise((e,t)=>{c=e,d=t});r?.signal?.addEventListener("abort",()=>{let e=new E("cancelled","Request was cancelled.");d(e)});let m=(i=u.body.getReader(),s=c,o=d,a=r?.signal,l=(e,t)=>{let n=e.match(C);if(!n)return;let r=n[1];try{let e=JSON.parse(r);if("result"in e)return void s(y(e.result));if("message"in e)return void t.enqueue(y(e.message));if("error"in e){let n=b(0,e);t.error(n),o(n);return}}catch(e){if(e instanceof E){t.error(e),o(e);return}}},h=new TextDecoder,new ReadableStream({start(e){let t="";return n();async function n(){if(a?.aborted){let t=new E("cancelled","Request was cancelled");return e.error(t),o(t),Promise.resolve()}try{let{value:r,done:s}=await i.read();if(s){t.trim()&&l(t.trim(),e),e.close();return}if(a?.aborted){let t=new E("cancelled","Request was cancelled");e.error(t),o(t),await i.cancel();return}let u=(t+=h.decode(r,{stream:!0})).split("\n");for(let n of(t=u.pop()||"",u))n.trim()&&l(n.trim(),e);return n()}catch(n){let t=n instanceof E?n:b(0,null);e.error(t),o(t)}}},cancel:()=>i.cancel()}));return{stream:{[Symbol.asyncIterator](){let e=m.getReader();return{async next(){let{value:t,done:n}=await e.read();return{value:t,done:n}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:g}}let D="@firebase/functions",x="0.13.1";function O(e=(0,f.getApp)(),t=I){let n=(0,f._getProvider)((0,p.getModularInstance)(e),v).getImmediate({identifier:t}),r=(0,p.getDefaultEmulatorHostnameAndPort)("functions");return r&&function(e,t,n){var r;let i;r=(0,p.getModularInstance)(e),i=(0,p.isCloudWorkstation)(t),r.emulatorOrigin=`http${i?"s":""}://${t}:${n}`,i&&((0,p.pingServer)(r.emulatorOrigin+"/backends"),(0,p.updateEmulatorBanner)("Functions",!0))}(n,...r),n}function L(e,t,n){var r;let i;return r=(0,p.getModularInstance)(e),(i=e=>{var i,s,o,a;let l;return i=r,s=t,o=e,a=n||{},l=i._url(s),R(i,l,o,a)}).stream=(e,n)=>{var i,s,o,a;let l;return i=r,s=t,o=e,a=n,l=i._url(s),P(i,l,o,a||{})},i}(0,f._registerComponent)(new g.Component(v,(e,{instanceIdentifier:t})=>new S(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("messaging-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,f.registerVersion)(D,x,void 0),(0,f.registerVersion)(D,x,"esm2020"),e.s(["getFunctions",()=>O,"httpsCallable",()=>L],52831),e.s([],61978);let M={apiKey:a.default.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:a.default.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"realmsrpg-test.firebaseapp.com",projectId:a.default.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:a.default.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:a.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:a.default.env.NEXT_PUBLIC_FIREBASE_APP_ID,databaseURL:a.default.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL},U=null;async function F(){try{let e=await fetch("/__/firebase/init.json");if(!e.ok)throw Error("Failed to fetch Firebase config from hosting");return await e.json()}catch(e){return console.warn("Using local Firebase config (not deployed to Firebase Hosting):",e),M}}async function V(){if((0,l.getApps)().length>0)t=(0,l.getApps)()[0];else{let e=await F();e.authDomain||(e.authDomain="realmsrpg-test.firebaseapp.com"),t=(0,l.initializeApp)(e)}return n=(0,h.getAuth)(t),r=(0,u.getFirestore)(t),i=(0,c.getDatabase)(t),s=(0,d.getStorage)(t),o=O(t),{app:t,auth:n,db:r,rtdb:i,storage:s,functions:o}}async function q(){return U||(U=V().then(()=>{})),U}q().catch(e=>{console.error("Failed to initialize Firebase:",e)}),e.s(["auth",()=>n,"db",()=>r,"functions",()=>o,"rtdb",()=>i,"storage",()=>s,"waitForFirebase",()=>q],6245)}]);