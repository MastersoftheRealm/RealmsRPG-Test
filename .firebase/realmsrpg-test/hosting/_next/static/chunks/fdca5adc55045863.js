(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,80787,e=>{"use strict";var r=e.i(43476),s=e.i(71645),t=e.i(18566);e.i(64485);var a=e.i(48114),i=e.i(47099);e.i(79121);var l=e.i(49838);let n={archetype:"1. Archetype",species:"2. Species",ancestry:"3. Ancestry",abilities:"4. Abilities",skills:"5. Skills",feats:"6. Feats",equipment:"7. Equipment",powers:"8. Powers",finalize:"9. Finalize"};function d(){let{currentStep:e,completedSteps:s,setStep:t,canNavigateToStep:a,resetCreator:d}=(0,i.useCharacterCreatorStore)();return(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1 p-2 bg-gray-100 rounded-lg mb-4",children:[i.STEP_ORDER.map(i=>{let d=e===i,c=s.includes(i),o=a(i);return(0,r.jsxs)("button",{onClick:()=>t(i),disabled:!o,className:(0,l.cn)("px-3 py-2 rounded-lg text-sm font-medium transition-all",d&&"bg-primary-600 text-white shadow-md",!d&&c&&"bg-green-100 text-green-700 hover:bg-green-200",!d&&!c&&o&&"bg-white text-gray-600 hover:bg-gray-50",!d&&!c&&!o&&"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[c&&!d&&"âœ“ ",n[i]]},i)}),(0,r.jsx)("button",{onClick:()=>{confirm("Are you sure you want to restart? All progress will be lost.")&&d()},className:"ml-auto px-3 py-2 rounded-lg text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors",children:"Restart"})]})}let c=["strength","vitality","agility","acuity","intelligence","charisma"],o={power:{title:"Power",description:"Focus on supernatural, magical, or extraordinary abilities. You excel at manipulating energy and casting powerful effects."},"powered-martial":{title:"Powered-Martial",description:"A balanced blend of martial prowess and supernatural abilities. You can fight effectively while also wielding power."},martial:{title:"Martial",description:"Master of physical combat and martial techniques. You rely on skill, training, and physical prowess."}};var m=e.i(66923),x=e.i(84614),h=e.i(75254);let p=(0,h.default)("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),u=(0,h.default)("scale",[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]]);var g=e.i(39312),b=e.i(90597),y=e.i(40437),j=e.i(6416);let f={strength:{name:"Strength",description:"Physical power, melee damage, and carrying capacity",defenseLink:"Might"},vitality:{name:"Vitality",description:"Health, endurance, and resistance to physical effects",defenseLink:"Fortitude"},agility:{name:"Agility",description:"Speed, dexterity, reflexes, and finesse attacks",defenseLink:"Reflex"},acuity:{name:"Acuity",description:"Perception, awareness, and ranged accuracy",defenseLink:"Discernment"},intelligence:{name:"Intelligence",description:"Knowledge, reasoning, and mental power",defenseLink:"Mental Fortitude"},charisma:{name:"Charisma",description:"Force of personality, leadership, and social influence",defenseLink:"Resolve"}},N=["strength","vitality","agility","acuity","intelligence","charisma"];var v=e.i(94278);let w=["Strength","Vitality","Agility","Acuity","Intelligence","Charisma"];function C({skill:e,value:t,onAllocate:a,canIncrease:i}){let[n,d]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:(0,l.cn)("p-3 rounded-lg border transition-colors",t>0?"bg-primary-50 border-primary-200":"bg-gray-50 border-gray-200"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>d(!n),className:"text-gray-400 hover:text-gray-600 text-sm",children:"â„¹ï¸"}),(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.name})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>a(-1),disabled:0===t,className:(0,l.cn)("w-7 h-7 rounded flex items-center justify-center font-bold",t>0?"bg-gray-200 hover:bg-gray-300 text-gray-700":"bg-gray-100 text-gray-300 cursor-not-allowed"),children:"âˆ’"}),(0,r.jsx)("span",{className:(0,l.cn)("w-8 text-center font-bold",t>0?"text-primary-700":"text-gray-400"),children:t}),(0,r.jsx)("button",{onClick:()=>a(1),disabled:!i,className:(0,l.cn)("w-7 h-7 rounded flex items-center justify-center font-bold",i?"bg-primary-600 hover:bg-primary-700 text-white":"bg-gray-100 text-gray-300 cursor-not-allowed"),children:"+"})]})]}),n&&e.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2",children:e.description})]})}var k=e.i(51206),S=e.i(22016),A=e.i(7233),q=e.i(33060),P=e.i(36121),_=e.i(37727);let M=(0,h.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.i(91065);var T=e.i(29460),Y=e.i(78689),$=e.i(46775);let L=[{id:"name",label:"Name",field:"name",type:"string"},{id:"cost",label:"Energy",field:"cost",type:"number"}],O=[{id:"name",label:"Name",field:"name",type:"string"},{id:"cost",label:"TP",field:"cost",type:"number"}];e.i(36180);var R=e.i(98925),F=e.i(67426);function z({isOpen:e,onClose:s,issues:t,onContinueAnyway:a}){if(!e)return null;let i=t.some(e=>"error"===e.severity),n=0===t.length;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl max-w-lg w-full max-h-[80vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:(0,l.cn)("p-4 border-b flex items-center gap-3",n?"bg-green-50":i?"bg-red-50":"bg-amber-50"),children:[(0,r.jsx)("span",{className:"text-2xl",children:n?"âœ…":i?"âš ï¸":"ðŸ“‹"}),(0,r.jsx)("h2",{className:"text-xl font-bold",children:n?"Character Ready!":i?"Issues Found":"Review Needed"})]}),(0,r.jsx)("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:n?(0,r.jsx)("p",{className:"text-gray-600 text-center py-8",children:'Your character is complete and ready for adventure! Click "Create Character" to save.'}):(0,r.jsx)("div",{className:"space-y-3",children:t.map((e,s)=>(0,r.jsxs)("div",{className:(0,l.cn)("p-3 rounded-lg flex gap-3","error"===e.severity?"bg-red-50":"bg-amber-50"),children:[(0,r.jsx)("span",{className:"text-xl flex-shrink-0",children:e.emoji}),(0,r.jsx)("p",{className:"text-gray-700",children:e.message})]},s))})}),(0,r.jsxs)("div",{className:"p-4 border-t flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:n?"Close":"Go Back & Fix"}),!i&&!n&&a&&(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600",children:"Continue Anyway"})]})]})})}e.s([],97189),e.i(97189);let E={archetype:function(){let{draft:e,setArchetype:t,nextStep:a}=(0,i.useCharacterCreatorStore)(),[n,d]=(0,s.useState)(e.archetype?.type||null),[m,x]=(0,s.useState)(e.pow_abil||e.mart_abil||null),[h,p]=(0,s.useState)(e.mart_abil||null),u=e.archetype?.type!==void 0,g=n&&m&&("powered-martial"!==n||h);return u?(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your Archetype"}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-green-800 mb-2",children:o[e.archetype.type].title}),(0,r.jsx)("p",{className:"text-green-700 mb-4",children:o[e.archetype.type].description}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[e.pow_abil&&(0,r.jsxs)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full",children:["Power Ability: ",e.pow_abil.charAt(0).toUpperCase()+e.pow_abil.slice(1)]}),e.mart_abil&&(0,r.jsxs)("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full",children:["Martial Ability: ",e.mart_abil.charAt(0).toUpperCase()+e.mart_abil.slice(1)]})]})]}),(0,r.jsx)("button",{onClick:()=>{d(null),x(null),p(null),i.useCharacterCreatorStore.setState({draft:{...e,archetype:void 0,pow_abil:void 0,mart_abil:void 0}})},className:"text-gray-600 hover:text-gray-900 underline",children:"Choose a different archetype"})]}):(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Choose Your Archetype"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Your archetype defines your character's approach to combat and supernatural abilities."}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:Object.entries(o).map(([e,s])=>(0,r.jsxs)("button",{onClick:()=>{d(e),x(null),p(null)},className:(0,l.cn)("p-6 rounded-xl border-2 text-left transition-all",n===e?"border-primary-600 bg-primary-50 shadow-lg":"border-gray-200 bg-white hover:border-gray-300 hover:shadow"),children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:s.description})]},e))}),n&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"powered-martial"===n?"Choose Your Power and Martial Abilities":`Choose Your ${"power"===n?"Power":"Martial"} Ability`}),"powered-martial"===n?(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Power Ability"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:c.map(e=>(0,r.jsx)("button",{onClick:()=>x(e),disabled:h===e,className:(0,l.cn)("px-3 py-2 rounded-lg text-sm font-medium transition-colors",m===e?"bg-purple-600 text-white":h===e?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-200 hover:border-purple-400"),children:e.charAt(0).toUpperCase()+e.slice(1)},`power-${e}`))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-red-700 mb-2",children:"Martial Ability"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:c.map(e=>(0,r.jsx)("button",{onClick:()=>p(e),disabled:m===e,className:(0,l.cn)("px-3 py-2 rounded-lg text-sm font-medium transition-colors",h===e?"bg-red-600 text-white":m===e?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-200 hover:border-red-400"),children:e.charAt(0).toUpperCase()+e.slice(1)},`martial-${e}`))})]})]}):(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:c.map(e=>(0,r.jsx)("button",{onClick:()=>x(e),className:(0,l.cn)("px-4 py-3 rounded-lg font-medium transition-colors",m===e?"power"===n?"bg-purple-600 text-white":"bg-red-600 text-white":"bg-white border border-gray-200 hover:border-gray-400"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,r.jsx)("button",{onClick:()=>{n&&m&&("powered-martial"!==n||h)&&(t(n,m,"powered-martial"===n?h:void 0),a())},disabled:!g,className:(0,l.cn)("w-full py-3 rounded-xl font-bold text-lg transition-colors",g?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"Confirm Archetype"})]})},species:function(){let{draft:e,nextStep:t,prevStep:a,setSpecies:n}=(0,i.useCharacterCreatorStore)(),{data:d,isLoading:c}=(0,m.useSpecies)(),{data:o}=(0,m.useTraits)(),[x,h]=(0,s.useState)(null);return c?(0,r.jsx)("div",{className:"max-w-4xl mx-auto flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Choose Your Species"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Your species defines your character's physical traits and inherent abilities."}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:d?.map(s=>{var t;let a=e.ancestry?.id===s.id,i=x===s.id,d=(t=s.id,o?o.filter(e=>e.species?.includes(t)):[]);return(0,r.jsxs)("div",{className:(0,l.cn)("rounded-xl border-2 overflow-hidden transition-all",a?"border-primary-600 bg-primary-50":"border-gray-200 bg-white hover:border-gray-300"),children:[(0,r.jsxs)("button",{onClick:()=>{n(s.id,s.name)},className:"w-full p-4 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:s.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs px-2 py-0.5 bg-gray-100 rounded capitalize",children:s.size}),(0,r.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-gray-100 rounded",children:["Speed ",s.speed]})]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:s.description}),s.ability_bonuses&&Object.keys(s.ability_bonuses).length>0&&(0,r.jsx)("div",{className:"flex gap-1 mt-2",children:Object.entries(s.ability_bonuses).map(([e,s])=>(0,r.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded",children:[e.substring(0,3).toUpperCase()," +",s]},e))})]}),d.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),h(i?null:s.id)},className:"w-full px-4 py-2 text-sm text-primary-600 hover:bg-primary-50 border-t border-gray-200",children:i?"Hide Traits â–²":`Show ${d.length} Traits â–¼`}),i&&(0,r.jsx)("div",{className:"px-4 pb-4 border-t border-gray-200 bg-gray-50",children:(0,r.jsx)("div",{className:"space-y-2 mt-3",children:d.map(e=>(0,r.jsxs)("div",{className:"p-2 bg-white rounded border border-gray-100",children:[(0,r.jsx)("span",{className:"font-medium text-sm",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.description})]},e.id))})})]})]},s.id)})}),(!d||0===d.length)&&(0,r.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8",children:(0,r.jsx)("p",{className:"text-amber-700 text-center",children:"No species data available. Please check Firebase connection."})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{onClick:t,disabled:!e.ancestry?.id,className:(0,l.cn)("px-8 py-3 rounded-xl font-bold transition-colors",e.ancestry?.id?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"Continue â†’"})]})]})},ancestry:function(){let{draft:e,nextStep:t,prevStep:a,setStep:l}=(0,i.useCharacterCreatorStore)(),{data:n}=(0,m.useSpecies)(),{data:d}=(0,m.useTraits)(),c=(0,s.useMemo)(()=>n&&e.ancestry?.id?n.find(r=>r.id===e.ancestry?.id):null,[n,e.ancestry?.id]),o=(0,s.useMemo)(()=>{if(!d||!c)return[];let e=d.filter(e=>e.species?.includes(c.id)||e.species?.includes(c.name)),r=c.traits?.map(e=>d.find(r=>r.name.toLowerCase()===e.toLowerCase()||r.id===e)).filter(Boolean)||[],s=[...e];return r.forEach(e=>{s.some(r=>r.id===e.id)||s.push(e)}),s},[d,c]);return c?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirm Your Ancestry"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Review your species' traits and characteristics before continuing."}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-primary-50 to-white border-2 border-primary-200 rounded-xl p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-primary-900 mb-1",children:c.name}),(0,r.jsx)("p",{className:"text-gray-600 max-w-xl",children:c.description})]}),(0,r.jsx)("button",{onClick:()=>l("species"),className:"text-sm text-primary-600 hover:text-primary-800 underline",children:"Change Species"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg px-3 py-2 border border-gray-200",children:[(0,r.jsx)(p,{className:"w-5 h-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 block",children:"Size"}),(0,r.jsx)("span",{className:"font-medium capitalize",children:c.sizes?.join(", ")||c.size})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg px-3 py-2 border border-gray-200",children:[(0,r.jsx)(g.Zap,{className:"w-5 h-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 block",children:"Speed"}),(0,r.jsxs)("span",{className:"font-medium",children:[c.speed," sq"]})]})]}),c.ave_height&&(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg px-3 py-2 border border-gray-200",children:[(0,r.jsx)(x.User,{className:"w-5 h-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 block",children:"Avg Height"}),(0,r.jsxs)("span",{className:"font-medium",children:[c.ave_height," cm"]})]})]}),c.ave_weight&&(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg px-3 py-2 border border-gray-200",children:[(0,r.jsx)(u,{className:"w-5 h-5 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 block",children:"Avg Weight"}),(0,r.jsxs)("span",{className:"font-medium",children:[c.ave_weight," kg"]})]})]})]}),c.ability_bonuses&&Object.keys(c.ability_bonuses).length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Ability Bonuses"}),(0,r.jsx)("div",{className:"flex gap-2 flex-wrap",children:Object.entries(c.ability_bonuses).map(([e,s])=>(0,r.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[e.charAt(0).toUpperCase()+e.slice(1)," +",s]},e))})]})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden mb-6",children:[(0,r.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:(0,r.jsxs)("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[(0,r.jsx)(b.Heart,{className:"w-5 h-5 text-primary-600"}),"Species Traits",(0,r.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",o.length," trait",1!==o.length?"s":"",")"]})]})}),(0,r.jsx)("div",{className:"divide-y divide-gray-100",children:o.length>0?o.map(e=>(0,r.jsxs)("div",{className:"px-4 py-3 hover:bg-gray-50",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]},e.id)):(0,r.jsx)("div",{className:"px-4 py-6 text-center text-gray-500",children:"No specific traits defined for this species."})})]}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-8",children:(0,r.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,r.jsx)("strong",{children:"Ready to continue?"})," These traits will be automatically applied to your character. You can change your species at any time by going back."]})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{onClick:t,className:"px-8 py-3 rounded-xl font-bold bg-primary-600 text-white hover:bg-primary-700 transition-colors",children:"Continue â†’"})]})]}):(0,r.jsxs)("div",{className:"max-w-2xl mx-auto text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirm Your Ancestry"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Review your species' traits and characteristics."}),(0,r.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8",children:[(0,r.jsxs)("p",{className:"text-amber-700 mb-4",children:[(0,r.jsx)("strong",{children:"No species selected!"})," Please choose a species first."]}),(0,r.jsx)("button",{onClick:()=>l("species"),className:"px-6 py-2 rounded-lg bg-amber-600 text-white font-medium hover:bg-amber-700",children:"Go to Species Selection"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{disabled:!0,className:"px-8 py-3 rounded-xl font-bold bg-gray-200 text-gray-400 cursor-not-allowed",children:"Continue â†’"})]})]})},abilities:function(){let{draft:e,updateAbility:t,nextStep:a,prevStep:n}=(0,i.useCharacterCreatorStore)(),d=e.level||1,c=e.abilities||{strength:0,vitality:0,agility:0,acuity:0,intelligence:0,charisma:0},o=(0,s.useMemo)(()=>(0,y.calculateAbilityPoints)(d),[d]),m=(0,s.useMemo)(()=>N.reduce((e,r)=>{let s=c[r]||0,t=0;for(let e=1;e<=s;e++)t+=e>j.ABILITY_LIMITS.COST_INCREASE_THRESHOLD?2:1;return s<0&&(t=s),e+t},0),[c]),x=o-m,h=x>=0;return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Assign Ability Scores"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Distribute your ability points. Higher scores cost more at higher values. You can reduce abilities below 0 to gain extra points."}),(0,r.jsxs)("div",{className:(0,l.cn)("flex items-center justify-center gap-4 p-4 rounded-xl mb-6",x>0?"bg-green-50 border border-green-200":x<0?"bg-red-50 border border-red-200":"bg-gray-50 border border-gray-200"),children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Total Points"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:o})]}),(0,r.jsx)("div",{className:"text-3xl text-gray-300",children:"âˆ’"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Spent"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:m})]}),(0,r.jsx)("div",{className:"text-3xl text-gray-300",children:"="}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Remaining"}),(0,r.jsx)("div",{className:(0,l.cn)("text-2xl font-bold",x>0?"text-green-600":x<0?"text-red-600":"text-gray-600"),children:x})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:N.map(s=>{let a=c[s]||0,i=f[s],n=(0,y.getAbilityIncreaseCost)(a),d=e.pow_abil===s||e.mart_abil===s;return(0,r.jsxs)("div",{className:(0,l.cn)("p-4 rounded-xl border-2 bg-white",d?"border-amber-400":"border-gray-200"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:i.name}),d&&(0,r.jsx)("span",{className:"text-xs text-amber-600 font-medium",children:"Archetype Ability"})]}),(0,r.jsxs)("span",{className:"text-xs text-gray-400",children:["â†’ ",i.defenseLink]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:i.description}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("button",{onClick:()=>{let e;return e=c[s]||0,void((0,y.canDecreaseAbility)(e)&&t(s,e-1))},disabled:!(0,y.canDecreaseAbility)(a),className:(0,l.cn)("w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold transition-colors",(0,y.canDecreaseAbility)(a)?"bg-gray-200 hover:bg-gray-300 text-gray-700":"bg-gray-100 text-gray-300 cursor-not-allowed"),children:"âˆ’"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:(0,l.cn)("text-3xl font-bold",a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"),children:a>=0?`+${a}`:a}),(0,r.jsxs)("div",{className:"text-xs text-gray-400",children:["Cost: ",n]})]}),(0,r.jsx)("button",{onClick:()=>{let e;return e=c[s]||0,void((0,y.getAbilityIncreaseCost)(e),(0,y.canIncreaseAbility)(e,x,!0)&&t(s,e+1))},disabled:!(0,y.canIncreaseAbility)(a,x,!0),className:(0,l.cn)("w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold transition-colors",(0,y.canIncreaseAbility)(a,x,!0)?"bg-primary-600 hover:bg-primary-700 text-white":"bg-gray-100 text-gray-300 cursor-not-allowed"),children:"+"})]})]},s)})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:n,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:"â† Back"}),(0,r.jsx)("button",{onClick:a,disabled:!h,className:(0,l.cn)("px-8 py-3 rounded-xl font-bold transition-colors",h?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"Continue â†’"})]})]})},skills:function(){let{draft:e,nextStep:t,prevStep:a,updateDraft:n}=(0,i.useCharacterCreatorStore)(),{data:d,isLoading:c}=(0,v.useRTDBSkills)(),[o,m]=(0,s.useState)(null),x=(0,y.calculateSkillPoints)(e.level||1),[h,p]=(0,s.useState)(()=>e.skills||{}),u=x-(0,s.useMemo)(()=>Object.values(h).reduce((e,r)=>e+r,0),[h]),g=(0,s.useMemo)(()=>{if(!d)return{};let e={};d.forEach(r=>{let s=r.ability||r.category||"General";e[s]||(e[s]=[]),e[s].push(r)});let r={};return w.forEach(s=>{e[s]&&(r[s]=e[s])}),Object.keys(e).filter(e=>!w.includes(e)).forEach(s=>{r[s]=e[s]}),r},[d]),b=(0,s.useCallback)((e,r)=>{p(s=>{let t=Math.max(0,(s[e]||0)+r);if(r>0&&u<=0)return s;if(0===t){let{[e]:r,...t}=s;return t}return{...s,[e]:t}})},[u]);return c?(0,r.jsx)("div",{className:"max-w-4xl mx-auto flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Allocate Skills"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Distribute your skill points to define your character's trained abilities."})]}),(0,r.jsxs)("div",{className:(0,l.cn)("px-4 py-2 rounded-xl font-bold text-lg",u>0?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"),children:[u," / ",x," Points"]})]}),(0,r.jsx)("div",{className:"space-y-4 mb-8",children:Object.entries(g).map(([e,s])=>{let t=s.reduce((e,r)=>e+(h[r.id]||0),0),a=o===e||null===o;return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[(0,r.jsxs)("button",{onClick:()=>m(o===e?null:e),className:"w-full px-4 py-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:e}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[s.length," skills"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t>0&&(0,r.jsxs)("span",{className:"px-2 py-0.5 text-sm bg-primary-100 text-primary-700 rounded",children:[t," pts"]}),(0,r.jsx)("span",{className:(0,l.cn)("transition-transform",a&&"rotate-180"),children:"â–¼"})]})]}),a&&(0,r.jsx)("div",{className:"p-4 grid md:grid-cols-2 gap-3",children:s.map(e=>(0,r.jsx)(C,{skill:e,value:h[e.id]||0,onAllocate:r=>b(e.id,r),canIncrease:u>0},e.id))})]},e)})}),(!d||0===d.length)&&(0,r.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8",children:(0,r.jsx)("p",{className:"text-amber-700 text-center",children:"No skill data available. Please check Firebase connection."})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{onClick:()=>{n({skills:h}),t()},className:"px-8 py-3 rounded-xl font-bold bg-primary-600 text-white hover:bg-primary-700 transition-colors",children:"Continue â†’"})]})]})},feats:function(){let{draft:e,nextStep:t,prevStep:a,updateDraft:n}=(0,i.useCharacterCreatorStore)(),{data:d,isLoading:c}=(0,k.useRTDBFeats)(),[o,m]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[p,u]=(0,s.useState)(!0),[g,b]=(0,s.useState)(!0),[j,f]=(0,s.useState)(null),N=(0,y.calculateMaxCharacterFeats)(e.level||1),v=(0,s.useMemo)(()=>e.feats?.map(e=>e.id)||[],[e.feats]),w=(0,s.useMemo)(()=>{if(!d)return[];let e=new Set;return d.forEach(r=>r.category&&e.add(r.category)),Array.from(e).sort()},[d]),C=(0,s.useMemo)(()=>d?d.filter(r=>{if(o){let e=o.toLowerCase();if(!(r.name.toLowerCase().includes(e)||r.description?.toLowerCase().includes(e)||r.tags.some(r=>r.toLowerCase().includes(e))))return!1}return(!!p||!!r.char_feat)&&(!!g||!r.char_feat)&&(!x||r.category===x)&&!(r.lvl_req>(e.level||1))}):[],[d,o,p,g,x,e.level]),S=r=>{if(v.includes(r.id))n({feats:e.feats?.filter(e=>e.id!==r.id)||[]});else{if(v.length>=N)return;n({feats:[...e.feats||[],{id:r.id,name:r.name,description:r.description,type:r.char_feat?"character":"archetype"}]})}};return c?(0,r.jsx)("div",{className:"max-w-5xl mx-auto flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Select Feats"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Choose feats that grant special abilities and bonuses."})]}),(0,r.jsxs)("div",{className:(0,l.cn)("px-4 py-2 rounded-xl font-bold text-lg",v.length<N?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"),children:[v.length," / ",N," Feats"]})]}),v.length>0&&(0,r.jsxs)("div",{className:"bg-primary-50 rounded-xl p-4 mb-6",children:[(0,r.jsx)("h3",{className:"font-medium text-primary-800 mb-2",children:"Selected Feats"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.feats?.map(e=>(0,r.jsxs)("span",{className:"px-3 py-1 bg-white text-primary-700 rounded-full text-sm flex items-center gap-2",children:[e.name,(0,r.jsx)("button",{onClick:()=>S({id:e.id,name:e.name}),className:"hover:text-red-500",children:"Ã—"})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl p-4 mb-6 shadow-sm flex flex-wrap gap-4 items-center",children:[(0,r.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),placeholder:"Search feats...",className:"flex-1 min-w-[200px] px-3 py-2 border border-gray-300 rounded-lg"}),(0,r.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg",children:[(0,r.jsx)("option",{value:"",children:"All Categories"}),w.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:p,onChange:e=>u(e.target.checked),className:"w-4 h-4 rounded text-primary-600"}),(0,r.jsx)("span",{className:"text-sm",children:"Archetype"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:g,onChange:e=>b(e.target.checked),className:"w-4 h-4 rounded text-primary-600"}),(0,r.jsx)("span",{className:"text-sm",children:"Character"})]})]}),(0,r.jsxs)("div",{className:"space-y-2 mb-8 max-h-[500px] overflow-y-auto",children:[C.map(s=>{let t=v.includes(s.id),a=j===s.id,i=(r=>{let s=e.abilities||{};for(let e=0;e<r.ability_req.length;e++){let t=r.ability_req[e].toLowerCase(),a=r.abil_req_val[e]||0;if((s[t]||0)<a)return{met:!1,reason:`Requires ${r.ability_req[e]} ${a}+`}}return{met:!0}})(s),n=v.length<N||t;return(0,r.jsxs)("div",{className:(0,l.cn)("bg-white rounded-lg border overflow-hidden transition-all",t?"border-primary-400 bg-primary-50":"border-gray-200",!i.met&&"opacity-60"),children:[(0,r.jsxs)("div",{className:"p-3 flex items-center gap-3",children:[(0,r.jsx)("button",{onClick:()=>i.met&&n&&S(s),disabled:!i.met||!n,className:(0,l.cn)("w-6 h-6 rounded border-2 flex items-center justify-center flex-shrink-0",t?"bg-primary-600 border-primary-600 text-white":i.met&&n?"border-gray-300 hover:border-primary-400":"border-gray-200 bg-gray-100 cursor-not-allowed"),children:t&&"âœ“"}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:s.name}),s.char_feat&&(0,r.jsx)("span",{className:"px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded",children:"Character"}),s.category&&(0,r.jsx)("span",{className:"px-1.5 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:s.category}),!i.met&&(0,r.jsx)("span",{className:"px-1.5 py-0.5 text-xs bg-red-100 text-red-600 rounded",children:i.reason})]})}),(0,r.jsx)("button",{onClick:()=>f(a?null:s.id),className:"text-gray-400 hover:text-gray-600",children:a?"â–²":"â–¼"})]}),a&&(0,r.jsxs)("div",{className:"px-3 pb-3 pt-2 border-t border-gray-100",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700",children:s.description}),s.tags.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:s.tags.map(e=>(0,r.jsx)("span",{className:"px-1.5 py-0.5 text-xs bg-primary-50 text-primary-700 rounded",children:e},e))})]})]},s.id)}),0===C.length&&(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No feats match your filters."})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{onClick:t,className:"px-8 py-3 rounded-xl font-bold bg-primary-600 text-white hover:bg-primary-700 transition-colors",children:"Continue â†’"})]})]})},equipment:function(){let{draft:e,nextStep:t,prevStep:a,updateDraft:n}=(0,i.useCharacterCreatorStore)(),{data:d,isLoading:c}=(0,m.useEquipment)(),[o,x]=(0,s.useState)("weapon"),[h,p]=(0,s.useState)(""),u=(0,s.useMemo)(()=>Math.max(...Object.values(e.abilities||{}).filter(e=>"number"==typeof e),0),[e.abilities]),g=10*(0,y.calculateTrainingPoints)(e.level||1,u),b=(0,s.useMemo)(()=>(e.equipment?.inventory||[]).map(e=>({id:String(e.id),name:e.name,type:"equipment",cost:e.cost||0,damage:e.damage,armor:e.armor,properties:Array.isArray(e.properties)?e.properties.map(e=>"string"==typeof e?e:e.name):[]})),[e.equipment?.inventory]),j=g-(0,s.useMemo)(()=>b.reduce((e,r)=>e+(r.cost||0),0),[b]),f=(0,s.useMemo)(()=>d?d.filter(e=>{if(e.type!==o)return!1;if(h){let r=h.toLowerCase();if(!e.name.toLowerCase().includes(r)&&!e.description?.toLowerCase().includes(r))return!1}return!0}):[],[d,o,h]),N=r=>{let s=b.some(e=>e.id===r.id),t=e.equipment?.inventory||[];if(s)n({equipment:{...e.equipment,inventory:t.filter(e=>String(e.id)!==r.id)}});else{if(r.gold_cost>j)return;let s={id:r.id,name:r.name,cost:r.gold_cost,damage:r.damage,armor:r.armor_value,properties:r.properties};n({equipment:{...e.equipment,inventory:[...t,s]}})}};return c?(0,r.jsx)("div",{className:"max-w-5xl mx-auto flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Choose Equipment"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Select your starting weapons, armor, and gear."})]}),(0,r.jsxs)("div",{className:(0,l.cn)("px-4 py-2 rounded-xl font-bold text-lg",j>0?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:[j," / ",g," Gold"]})]}),b.length>0&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800 mb-2",children:"Selected Equipment"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map(e=>(0,r.jsxs)("span",{className:"px-3 py-1 bg-white border border-gray-200 rounded-full text-sm flex items-center gap-2",children:[e.name,(0,r.jsxs)("span",{className:"text-amber-600 text-xs",children:[e.cost,"g"]}),(0,r.jsx)("button",{onClick:()=>N({id:e.id,name:e.name,gold_cost:e.cost,type:"equipment",properties:[],description:""}),className:"hover:text-red-500",children:"Ã—"})]},e.id))})]}),(0,r.jsx)("div",{className:"flex gap-2 mb-4",children:["weapon","armor","equipment"].map(e=>(0,r.jsxs)("button",{onClick:()=>x(e),className:(0,l.cn)("px-4 py-2 rounded-lg font-medium capitalize transition-colors",o===e?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e,"s"]},e))}),(0,r.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:`Search ${o}s...`,className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-4"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-3 mb-8 max-h-[400px] overflow-y-auto",children:[f.map(e=>{let s=b.some(r=>r.id===e.id),t=e.gold_cost<=j||s;return(0,r.jsxs)("button",{onClick:()=>t&&N(e),disabled:!t,className:(0,l.cn)("p-4 rounded-lg border text-left transition-all",s?"border-primary-400 bg-primary-50":t?"border-gray-200 bg-white hover:border-gray-300":"border-gray-200 bg-gray-100 opacity-60 cursor-not-allowed"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,r.jsx)("span",{className:"w-5 h-5 rounded-full bg-primary-600 text-white text-xs flex items-center justify-center",children:"âœ“"}),(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.name})]}),(0,r.jsxs)("span",{className:(0,l.cn)("font-bold",t?"text-amber-600":"text-red-500"),children:[e.gold_cost,"g"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.damage&&(0,r.jsx)("span",{className:"px-2 py-0.5 bg-red-50 text-red-700 rounded",children:e.damage}),e.armor_value&&(0,r.jsxs)("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 rounded",children:["+",e.armor_value," Armor"]})]}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),e.properties.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.properties.slice(0,3).map(e=>(0,r.jsx)("span",{className:"px-1.5 py-0.5 text-xs bg-gray-100 rounded",children:e},e)),e.properties.length>3&&(0,r.jsxs)("span",{className:"text-xs text-gray-400",children:["+",e.properties.length-3," more"]})]})]},e.id)}),0===f.length&&(0,r.jsxs)("div",{className:"col-span-2 text-center py-8 text-gray-500",children:["No ",o,"s found."]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:bg-gray-100",children:"â† Back"}),(0,r.jsx)("button",{onClick:t,className:"px-8 py-3 rounded-xl font-bold bg-primary-600 text-white hover:bg-primary-700 transition-colors",children:"Continue â†’"})]})]})},powers:function(){let{draft:e,updateDraft:t,nextStep:a,prevStep:l}=(0,i.useCharacterCreatorStore)(),[n,d]=(0,s.useState)(!1),[c,o]=(0,s.useState)(!1),{data:x=[],isLoading:h}=(0,$.useUserPowers)(),{data:p=[],isLoading:u}=(0,$.useUserTechniques)(),{data:g}=(0,m.usePowerParts)(),{data:b}=(0,m.useTechniqueParts)(),y=e.powers||[],j=e.techniques||[],f=(0,s.useMemo)(()=>new Set(y.map(e=>String(e.id))),[y]),N=(0,s.useMemo)(()=>new Set(j.map(e=>String(e.id))),[j]),v=(0,s.useMemo)(()=>x.map(e=>{let r=e.damage?.[0];return(0,Y.transformPower)({id:e.docId,name:e.name,description:e.description,parts:e.parts?.map(e=>String(e.name||e.id))||[],damage:r?`${r.amount}d${r.size}${r.type?` ${r.type}`:""}`:void 0})}),[x]),w=(0,s.useMemo)(()=>p.map(e=>{let r=e.damage?.[0];return(0,Y.transformTechnique)({id:e.docId,name:e.name,description:e.description,parts:e.parts?.map(e=>String(e.name||e.id))||[],damage:r?`${r.amount}d${r.size}${r.type?` ${r.type}`:""}`:void 0})}),[p]),C=(0,s.useMemo)(()=>v.filter(e=>f.has(e.id)),[v,f]),k=(0,s.useMemo)(()=>w.filter(e=>N.has(e.id)),[w,N]),R=(0,s.useCallback)(e=>{t({powers:e.map(e=>({id:e.id,name:e.name}))}),d(!1)},[t]),F=(0,s.useCallback)(e=>{t({techniques:e.map(e=>({id:e.id,name:e.name}))}),o(!1)},[t]),z=(0,s.useCallback)(e=>{t({powers:y.filter(r=>String(r.id)!==e)})},[y,t]),E=(0,s.useCallback)(e=>{t({techniques:j.filter(r=>String(r.id)!==e)})},[j,t]),I=x.length>0||p.length>0;return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Powers & Techniques"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Select powers and techniques from your library for your character to know."})]}),!h&&!u&&!I&&(0,r.jsxs)("div",{className:"bg-muted/30 border border-border rounded-xl p-8 text-center mb-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(q.Wand2,{className:"w-8 h-8 text-muted-foreground"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No Powers or Techniques Yet"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Create powers and techniques in your library first, then come back to add them to your character."}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,r.jsxs)(S.default,{href:"/power-creator",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:[(0,r.jsx)(A.Plus,{className:"w-4 h-4"}),"Create Power",(0,r.jsx)(M,{className:"w-3 h-3"})]}),(0,r.jsxs)(S.default,{href:"/technique-creator",className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-border text-foreground hover:bg-muted transition-colors",children:[(0,r.jsx)(A.Plus,{className:"w-4 h-4"}),"Create Technique",(0,r.jsx)(M,{className:"w-3 h-3"})]})]})]}),(I||h)&&(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,r.jsx)(q.Wand2,{className:"w-5 h-5 text-primary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Powers"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[y.length," power",1!==y.length?"s":""," selected"]})]})]}),(0,r.jsxs)("button",{onClick:()=>d(!0),disabled:0===x.length,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(A.Plus,{className:"w-4 h-4"}),"Add Powers"]})]}),C.length>0?(0,r.jsx)("div",{className:"space-y-2",children:C.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-card",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(q.Wand2,{className:"w-4 h-4 text-primary"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.name}),void 0!==e.cost&&(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.cost," ",e.costLabel]})]}),(0,r.jsx)("button",{onClick:()=>z(e.id),className:"p-1 rounded hover:bg-destructive/10 text-destructive transition-colors",title:"Remove power",children:(0,r.jsx)(_.X,{className:"w-4 h-4"})})]},e.id))}):x.length>0?(0,r.jsx)("div",{className:"p-4 rounded-lg border border-dashed border-border text-center text-muted-foreground",children:'No powers selected. Click "Add Powers" to choose from your library.'}):(0,r.jsxs)("div",{className:"p-4 rounded-lg border border-dashed border-border text-center",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"No powers in your library. "}),(0,r.jsxs)(S.default,{href:"/power-creator",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Create one ",(0,r.jsx)(M,{className:"w-3 h-3"})]})]})]}),(I||u)&&(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-orange-500/10 flex items-center justify-center",children:(0,r.jsx)(P.Swords,{className:"w-5 h-5 text-orange-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Techniques"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[j.length," technique",1!==j.length?"s":""," selected"]})]})]}),(0,r.jsxs)("button",{onClick:()=>o(!0),disabled:0===p.length,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-orange-500 text-white hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(A.Plus,{className:"w-4 h-4"}),"Add Techniques"]})]}),k.length>0?(0,r.jsx)("div",{className:"space-y-2",children:k.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-card",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(P.Swords,{className:"w-4 h-4 text-orange-500"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.name}),void 0!==e.cost&&(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.cost," ",e.costLabel]})]}),(0,r.jsx)("button",{onClick:()=>E(e.id),className:"p-1 rounded hover:bg-destructive/10 text-destructive transition-colors",title:"Remove technique",children:(0,r.jsx)(_.X,{className:"w-4 h-4"})})]},e.id))}):p.length>0?(0,r.jsx)("div",{className:"p-4 rounded-lg border border-dashed border-border text-center text-muted-foreground",children:'No techniques selected. Click "Add Techniques" to choose from your library.'}):(0,r.jsxs)("div",{className:"p-4 rounded-lg border border-dashed border-border text-center",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"No techniques in your library. "}),(0,r.jsxs)(S.default,{href:"/technique-creator",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Create one ",(0,r.jsx)(M,{className:"w-3 h-3"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-6 border-t border-border",children:[(0,r.jsx)("button",{onClick:l,className:"px-6 py-3 rounded-xl font-medium text-muted-foreground hover:bg-muted transition-colors",children:"â† Back"}),(0,r.jsx)("button",{onClick:a,className:"px-8 py-3 rounded-xl font-bold bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Continue â†’"})]}),(0,r.jsx)(T.ItemSelectionModal,{isOpen:n,onClose:()=>d(!1),onConfirm:R,items:v,title:"Select Powers",description:"Choose powers from your library for your character to know.",initialSelectedIds:f,sortOptions:L,searchPlaceholder:"Search powers...",loading:h}),(0,r.jsx)(T.ItemSelectionModal,{isOpen:c,onClose:()=>o(!1),onConfirm:F,items:w,title:"Select Techniques",description:"Choose techniques from your library for your character to know.",initialSelectedIds:N,sortOptions:O,searchPlaceholder:"Search techniques...",loading:u})]})},finalize:function(){let e=(0,t.useRouter)(),{user:n}=(0,a.useAuth)(),{draft:d,updateDraft:c,getCharacter:o,resetCreator:m,prevStep:x}=(0,i.useCharacterCreatorStore)(),[h,p]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),[b,j]=(0,s.useState)(!1),f=(0,s.useMemo)(()=>{let e=[],r=d.level||1;d.name?.trim()||e.push({emoji:"ðŸ“",message:"Your hero needs a name! Give them something legendary.",severity:"error"}),d.archetype?.type||e.push({emoji:"ðŸŽ­",message:"You haven't selected an archetype yet! Head back to the Archetype tab.",severity:"error"}),d.ancestry?.id||e.push({emoji:"ðŸŒŸ",message:"You need to choose your species! Head to the Species tab.",severity:"error"});let s=(0,y.calculateAbilityPoints)(r)-(d.abilities?Object.values(d.abilities).reduce((e,r)=>r<=0?e:r<=3?e+r:e+3+(r-3)*2,0):0);s>0?e.push({emoji:"âš¡",message:`You still have ${s} ability point${1===s?"":"s"} to spend!`,severity:"warning"}):s<0&&e.push({emoji:"âš¡",message:`You've overspent ability points by ${Math.abs(s)}!`,severity:"error"});let t=(0,y.calculateSkillPoints)(r)-((d.skills?Object.values(d.skills).reduce((e,r)=>e+(r||0),0):0)+(d.defenseSkills?Object.values(d.defenseSkills).reduce((e,r)=>e+2*(r||0),0):0));t>0?e.push({emoji:"ðŸ“š",message:`You have ${t} skill point${1===t?"":"s"} left to spend!`,severity:"warning"}):t<0&&e.push({emoji:"ðŸ“š",message:`You've overspent skill points by ${Math.abs(t)}!`,severity:"error"});let a=(0,y.calculateHealthEnergyPool)(r,"PLAYER")-((d.healthPoints||0)+(d.energyPoints||0));a>0&&e.push({emoji:"â¤ï¸",message:`You have ${a} Health-Energy point${1===a?"":"s"} to allocate!`,severity:"warning"});let i=d.abilities?Math.max(...Object.values(d.abilities).filter(e=>"number"==typeof e)):0,l=(0,y.calculateTrainingPoints)(r,i)-(d.trainingPointsSpent||0);l<0&&e.push({emoji:"ðŸŽ¯",message:`You've overspent training points by ${Math.abs(l)}!`,severity:"error"});let n=(d.equipment?.items||[]).reduce((e,r)=>e+(r.cost||0),0);n>200&&e.push({emoji:"ðŸ’°",message:`You've overspent currency by ${n-200}gp!`,severity:"error"});let c=d.archetype?.type,o=d.archetypeFeats||[],m=0;if("power"===c?m=1:"powered-martial"===c?m=2:"martial"===c&&(m=3),o.length<m){let r=m-o.length;e.push({emoji:"ðŸ’ª",message:`You need to select ${r} more archetype feat${1===r?"":"s"}!`,severity:"warning"})}return(d.feats||[]).length<1&&e.push({emoji:"ðŸŒ ",message:"You need to select a character feat!",severity:"warning"}),e},[d]),N=async()=>{if(!n)return void g("You must be logged in to save a character");if(!d.name?.trim())return void g("Please enter a character name");try{p(!0),g(null),j(!1);let r=o(),s=await (0,R.addDoc)((0,R.collection)(F.db,"users",n.uid,"character"),{...r,userId:n.uid,createdAt:R.Timestamp.now(),updatedAt:R.Timestamp.now()});m(),e.push(`/characters/${s.id}`)}catch(e){console.error("Error saving character:",e),g("Failed to save character. Please try again.")}finally{p(!1)}};return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Finalize Your Character"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Add the final details to bring your character to life."}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Character Name *"}),(0,r.jsx)("input",{type:"text",value:d.name||"",onChange:e=>c({name:e.target.value}),placeholder:"Enter your character's name",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Character Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Level:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:d.level||1})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Archetype:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:d.archetype?.type?d.archetype.type.charAt(0).toUpperCase()+d.archetype.type.slice(1):"Not selected"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Species:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:d.ancestry?.name||"Not selected"})]}),d.pow_abil&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Power Ability:"}),(0,r.jsx)("span",{className:"ml-2 font-medium capitalize",children:d.pow_abil})]}),d.mart_abil&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Martial Ability:"}),(0,r.jsx)("span",{className:"ml-2 font-medium capitalize",children:d.mart_abil})]})]}),d.abilities&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,r.jsx)("span",{className:"text-gray-500 text-sm",children:"Abilities:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:Object.entries(d.abilities).map(([e,s])=>(0,r.jsxs)("span",{className:(0,l.cn)("px-2 py-1 rounded text-sm font-medium",s>0?"bg-green-100 text-green-700":s<0?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"),children:[e.charAt(0).toUpperCase(),": ",s>=0?`+${s}`:s]},e))})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),(0,r.jsx)("textarea",{value:d.description||"",onChange:e=>c({description:e.target.value}),placeholder:"Describe your character's appearance, personality, or background...",rows:4,className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors resize-none"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,r.jsx)("textarea",{value:d.notes||"",onChange:e=>c({notes:e.target.value}),placeholder:"Any additional notes about your character...",rows:3,className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors resize-none"})]}),u&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700",children:u}),f.length>0&&(0,r.jsxs)("div",{className:(0,l.cn)("mb-6 p-4 rounded-xl",f.some(e=>"error"===e.severity)?"bg-red-50 border border-red-200":"bg-amber-50 border border-amber-200"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"text-xl",children:f.some(e=>"error"===e.severity)?"âš ï¸":"ðŸ“‹"}),(0,r.jsxs)("span",{className:"font-medium",children:[f.filter(e=>"error"===e.severity).length," error",1!==f.filter(e=>"error"===e.severity).length?"s":"",","," ",f.filter(e=>"warning"===e.severity).length," warning",1!==f.filter(e=>"warning"===e.severity).length?"s":""]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:'Click "Review & Create" to see all issues before saving.'})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:x,disabled:h,className:"px-6 py-3 rounded-xl font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors disabled:opacity-50",children:"â† Back"}),(0,r.jsx)("button",{onClick:()=>{j(!0)},disabled:h,className:(0,l.cn)("px-8 py-3 rounded-xl font-bold transition-colors flex items-center gap-2",h?"bg-gray-200 text-gray-400 cursor-not-allowed":f.some(e=>"error"===e.severity)?"bg-amber-500 text-white hover:bg-amber-600":"bg-green-600 text-white hover:bg-green-700"),children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):f.length>0?(0,r.jsx)(r.Fragment,{children:"ðŸ“‹ Review & Create"}):(0,r.jsx)(r.Fragment,{children:"âœ“ Create Character"})})]}),(0,r.jsx)(z,{isOpen:b,onClose:()=>j(!1),issues:f,onContinueAnyway:f.every(e=>"error"!==e.severity)?N:void 0})]})}};function I(){let e=(0,t.useRouter)(),{user:l,loading:n}=(0,a.useAuth)(),{currentStep:c}=(0,i.useCharacterCreatorStore)();if((0,s.useEffect)(()=>{n||l||e.push("/login?redirect=/characters/new")},[n,l,e]),n)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})});if(!l)return null;let o=E[c];return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Character"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Follow the steps below to build your character"})]}),(0,r.jsx)(d,{}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6 md:p-8",children:(0,r.jsx)(o,{})})]})})}e.s(["default",()=>I],80787)}]);