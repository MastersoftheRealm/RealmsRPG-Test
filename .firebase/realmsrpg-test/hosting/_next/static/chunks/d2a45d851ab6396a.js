(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33060,e=>{"use strict";let t=(0,e.i(75254).default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);e.s(["Wand2",()=>t],33060)},39312,e=>{"use strict";let t=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],39312)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},7559,e=>{"use strict";let t=(0,e.i(75254).default)("sword",[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]]);e.s(["Sword",()=>t],7559)},20278,75505,80853,17494,22853,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["Target",()=>a],20278);let r=(0,t.default)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);e.s(["FolderOpen",()=>r],75505);var s=e.i(43476),l=e.i(71645),n=e.i(37727),o=e.i(55436);let i=(0,t.default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var c=e.i(39312),d=e.i(7559),p=e.i(98919),m=e.i(31278);e.i(79121);var u=e.i(49838);let x={power:{icon:(0,s.jsx)(c.Zap,{className:"w-5 h-5"}),color:"text-blue-600",emptyText:"No saved powers found. Create some powers first!"},technique:{icon:(0,s.jsx)(d.Sword,{className:"w-5 h-5"}),color:"text-red-600",emptyText:"No saved techniques found. Create some techniques first!"},item:{icon:(0,s.jsx)(p.Shield,{className:"w-5 h-5"}),color:"text-amber-600",emptyText:"No saved items found. Create some items first!"},creature:{icon:(0,s.jsx)(i,{className:"w-5 h-5"}),color:"text-green-600",emptyText:"No saved creatures found. Create some creatures first!"}};function _({isOpen:e,onClose:t,onSelect:a,items:r,isLoading:i,error:c,itemType:d,title:p}){let[_,g]=(0,l.useState)(""),h=x[d],y=p||`Load ${d.charAt(0).toUpperCase()+d.slice(1)}`,N=(0,l.useMemo)(()=>{if(!r)return[];if(!_.trim())return r;let e=_.toLowerCase();return r.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))},[r,_]);return e?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),(0,s.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 max-h-[80vh] flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:h.color,children:h.icon}),(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:y})]}),(0,s.jsx)("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,s.jsx)(n.X,{className:"w-5 h-5"})})]}),(0,s.jsx)("div",{className:"px-6 py-3 border-b border-gray-100",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",value:_,onChange:e=>g(e.target.value),placeholder:`Search ${d}s...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:i?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(m.Loader2,{className:"w-8 h-8 text-primary-600 animate-spin"})}):c?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsxs)("p",{className:"text-red-600",children:["Error loading library: ",c.message]})}):0===N.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-500",children:r?.length===0?h.emptyText:"No matching items found."})}):(0,s.jsx)("div",{className:"space-y-2",children:N.map(e=>(0,s.jsxs)("button",{onClick:()=>{a(e),t(),g("")},className:(0,u.cn)("w-full text-left p-4 rounded-lg border border-gray-200","hover:border-primary-300 hover:bg-primary-50 transition-colors","focus:outline-none focus:ring-2 focus:ring-primary-500"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:(0,u.cn)("opacity-60",h.color),children:h.icon}),(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:e.name})]}),e.description&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-600 line-clamp-2",children:e.description})]},e.id))})}),(0,s.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,s.jsxs)("p",{className:"text-sm text-gray-500 text-center",children:[r?.length||0," ",d,"(s) in your library"]})})]})]}):null}e.s(["LoadFromLibraryModal",()=>_],80853);let g={primary:"bg-primary-600 hover:bg-primary-700 disabled:hover:bg-primary-600",power:"bg-primary-600 hover:bg-primary-700 disabled:hover:bg-primary-600",technique:"bg-red-600 hover:bg-red-700 disabled:hover:bg-red-600",item:"bg-amber-600 hover:bg-amber-700 disabled:hover:bg-amber-600"};function h({value:e,onChange:t,min:a=0,max:r=99,step:l=1,label:n,size:o="md",variant:i="primary",disabled:c=!1,className:d}){let p={sm:{button:"w-6 h-6 text-sm",display:"w-6 text-sm",label:"text-xs"},md:{button:"w-7 h-7 text-base",display:"w-8 text-base",label:"text-sm"},lg:{button:"w-9 h-9 text-lg",display:"w-10 text-lg",label:"text-base"}}[o];return(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center gap-2",d),children:[n&&(0,s.jsx)("span",{className:(0,u.cn)("text-gray-600 font-medium",p.label),children:n}),(0,s.jsx)("button",{type:"button",onClick:()=>{!c&&e>a&&t(Math.max(a,e-l))},disabled:c||e<=a,className:(0,u.cn)("rounded bg-gray-200 hover:bg-gray-300 flex items-center justify-center font-bold transition-colors","disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-gray-200",p.button),"aria-label":"Decrease",children:"−"}),(0,s.jsx)("span",{className:(0,u.cn)("text-center font-semibold",p.display),children:e}),(0,s.jsx)("button",{type:"button",onClick:()=>{!c&&e<r&&t(Math.min(r,e+l))},disabled:c||e>=r,className:(0,u.cn)("rounded text-white flex items-center justify-center font-bold transition-colors","disabled:opacity-50 disabled:cursor-not-allowed",g[i],p.button),"aria-label":"Increase",children:"+"})]})}e.s(["NumberStepper",()=>h],17494),e.i(81547),e.i(92006),e.i(15324),e.i(3504),e.s([],22853)},3504,e=>{"use strict";var t=e.i(81547);let a=[{name:"Common",low:25,ipLow:0,ipHigh:4},{name:"Uncommon",low:100,ipLow:4.01,ipHigh:6},{name:"Rare",low:500,ipLow:6.01,ipHigh:8},{name:"Epic",low:2500,ipLow:8.01,ipHigh:11},{name:"Legendary",low:1e4,ipLow:11.01,ipHigh:14},{name:"Mythic",low:5e4,ipLow:14.01,ipHigh:16},{name:"Ascended",low:1e5,ipLow:16.01,ipHigh:1/0}];function r(e){return!!e&&!!("id"in e&&void 0!==e.id&&t.GENERAL_PROPERTY_IDS.has(e.id)||"name"in e&&e.name&&t.GENERAL_PROPERTY_NAMES.has(e.name))}function s(e,t){let r=Math.max(0,t),s=Math.max(0,e),l="Common",n=0;for(let e of a)if(r>=e.ipLow&&r<=e.ipHigh){l=e.name,n=e.low*(1+.125*s);break}let o=a.find(e=>e.name===l);return o&&(n=Math.max(n,o.low)),{currencyCost:Math.floor(n),rarity:l}}function l(e,a){let r=0,s=0,l=0;return(e||[]).forEach(e=>{let n=(0,t.findByIdOrName)(a,e);if(!n)return;let o=e.op_1_lvl||0,i=n.base_ip||0,c=n.op_1_ip||0,d=n.base_tp||0,p=n.op_1_tp||0,m=n.base_c||0,u=n.op_1_c||0;r+=i+c*o,s+=d+p*o,l+=m+u*o}),{totalIP:r,totalTP:s,totalCurrency:l}}function n(e,a){var r;let n,o,i=e.properties||[],c=l(i,a),{currencyCost:d,rarity:p}=s(c.totalCurrency,c.totalIP),m=Array.isArray(r=e.damage)?r.filter(e=>e&&e.amount&&e.size&&e.type&&"none"!==e.type).map(e=>`${e.amount}d${e.size} ${e.type}`).join(", "):"",u=function(e){let a=(e||[]).find(e=>e.id===t.PROPERTY_IDS.RANGE||"Range"===e.name);if(!a)return"Melee";let r=a.op_1_lvl||0;return`${8+8*r} Spaces`}(i),x=(n=(i||[]).find(e=>e.id===t.PROPERTY_IDS.DAMAGE_REDUCTION||"Damage Reduction"===e.name))?1+(n.op_1_lvl||0):0,_=(o=[],(i||[]).forEach(e=>{let r=(0,t.findByIdOrName)(a,e);if(!r)return;let s=e.op_1_lvl||0,l=r.base_tp||0,n=r.op_1_tp||0,i=s>0?n*s:0,c=l+i;c>0&&o.push({id:r.id||0,name:r.name||"",level:s,baseTP:l,optionTP:i,totalTP:c,description:r.description||""})}),o);return{name:e.name||"",armamentType:e.armamentType||"Weapon",description:e.description||"",rarity:p,currencyCost:d,goldCost:d,totalIP:c.totalIP,totalTP:c.totalTP,totalCurrency:c.totalCurrency,range:u,damage:m,damageReduction:x,proficiencies:_}}e.s(["calculateCurrencyCostAndRarity",()=>s,"calculateItemCosts",()=>l,"deriveItemDisplay",()=>n,"isGeneralProperty",()=>r])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},55900,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],55900)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},98919,e=>{"use strict";let t=(0,e.i(75254).default)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);e.s(["Shield",()=>t],98919)},84004,44604,e=>{"use strict";e.i(45872);var t=e.i(43476),a=e.i(22016);function r(){return(0,t.jsx)("footer",{className:"w-full bg-gray-400 border-t border-[#707070] h-10 flex items-center justify-center mt-auto",children:(0,t.jsxs)("div",{className:"w-full max-w-[1440px] px-4 sm:px-6 lg:px-24 flex items-center justify-between",children:[(0,t.jsx)(a.default,{href:"/terms",className:"font-semibold text-lg text-gray-800 hover:text-gray-900 transition-colors whitespace-nowrap",children:"Terms of Service"}),(0,t.jsx)(a.default,{href:"/privacy",className:"font-semibold text-lg text-gray-800 hover:text-gray-900 transition-colors whitespace-nowrap",children:"Privacy Policy"}),(0,t.jsx)("a",{href:"mailto:RealmsRoleplayGame@gmail.com",className:"font-semibold text-lg text-gray-800 hover:text-gray-900 transition-colors whitespace-nowrap",children:"Contact"}),(0,t.jsx)("a",{href:"https://discord.gg/Dbd5X9FQFJ",target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-lg text-gray-800 hover:text-gray-900 transition-colors whitespace-nowrap",children:"Discord"})]})})}e.s(["Footer",()=>r],44604),e.i(23495),e.s([],84004)},92006,81547,15324,e=>{"use strict";let t={TRUE_DAMAGE:1,ADDITIONAL_DAMAGE:6,SPLIT_DAMAGE_DICE:5,REACTION:2,LONG_ACTION:3,QUICK_OR_FREE_ACTION:4,POWER_REACTION:82,POWER_LONG_ACTION:81,POWER_QUICK_OR_FREE_ACTION:83,ADD_WEAPON_ATTACK:7,RECKLESS:8,PASS_THROUGH:9,SPIN:10,STUN:11,WIND_UP:12,KNOCKBACK:13,SLOW:14,DAZE:15,WIDE_SWING:16,ENEMY_STRENGTH_REDUCTION:17,REACH:18,EXPOSE:19,ENEMY_ATTACK_REDUCTION:20,BLEED:21,LINE_OF_EFFECT:88,CONE_OF_EFFECT:89,CYLINDER_OF_EFFECT:231,SPHERE_OF_EFFECT:232,TRAIL_OF_EFFECT:233,PIERCE_TARGETS_ON_PATH:234,ADD_MULTIPLE_TARGETS:235,EXPANDING_AREA_OF_EFFECT:236,TARGET_ONE_IN_AREA:237,EXCLUDE_AREA:238,POWER_RANGE:292,DURATION_ROUND:289,DURATION_MINUTE:290,DURATION_HOUR:291,DURATION_DAYS:293,DURATION_PERMANENT:294},a={DAMAGE_REDUCTION:1,ARMOR_STRENGTH_REQUIREMENT:2,ARMOR_AGILITY_REQUIREMENT:3,ARMOR_VITALITY_REQUIREMENT:4,AGILITY_REDUCTION:5,WEAPON_STRENGTH_REQUIREMENT:6,WEAPON_AGILITY_REQUIREMENT:7,WEAPON_VITALITY_REQUIREMENT:8,WEAPON_ACUITY_REQUIREMENT:9,WEAPON_INTELLIGENCE_REQUIREMENT:10,WEAPON_CHARISMA_REQUIREMENT:11,SPLIT_DAMAGE_DICE:12,RANGE:13,TWO_HANDED:14,SHIELD_BASE:15,ARMOR_BASE:16,WEAPON_DAMAGE:17,DAMAGE_TYPE_RESISTANCE:18,BLUDGEONING_VULNERABILITY:19,PIERCING_VULNERABILITY:20,SLASHING_VULNERABILITY:21,CRITICAL_RANGE_PLUS_1:22,CRITICAL_RANGE:23,CRITICAL_MULTIPLIER:24,THROWN:25,FINESSE:26,DAMAGED:27,GRAZE:28,LOADING:29,KNOCKBACK:30,WOUNDING:31,SLOW:32,TOPPLE:33,EXPOSE:34,CHARGING:35,HIDDEN:36,AMMUNITION:37,BLEED:38,SHIELD_AMOUNT:39,SHIELD_DAMAGE:40,REACH:41,MOUNTED:42,VERSATILE:43,CLEAVE:44,INTERCHANGEABLE:45,BLOCK:46,QUICK:47,PULL:48},r=new Set([a.SHIELD_BASE,a.ARMOR_BASE,a.RANGE,a.TWO_HANDED,a.SPLIT_DAMAGE_DICE,a.DAMAGE_REDUCTION,a.WEAPON_DAMAGE,a.AGILITY_REDUCTION,a.WEAPON_STRENGTH_REQUIREMENT,a.WEAPON_AGILITY_REQUIREMENT,a.WEAPON_VITALITY_REQUIREMENT,a.WEAPON_ACUITY_REQUIREMENT,a.WEAPON_INTELLIGENCE_REQUIREMENT,a.WEAPON_CHARISMA_REQUIREMENT,a.ARMOR_STRENGTH_REQUIREMENT,a.ARMOR_AGILITY_REQUIREMENT,a.ARMOR_VITALITY_REQUIREMENT]),s=new Set(["Shield Base","Armor Base","Range","Two-Handed","Split Damage Dice","Damage Reduction","Weapon Damage","Agility Reduction","Weapon Strength Requirement","Weapon Agility Requirement","Weapon Vitality Requirement","Weapon Acuity Requirement","Weapon Intelligence Requirement","Weapon Charisma Requirement","Armor Strength Requirement","Armor Agility Requirement","Armor Vitality Requirement"]);function l(e,t){if(Array.isArray(e)&&t){if(void 0!==t.id&&null!==t.id){let a=e.find(e=>("string"==typeof e.id?parseInt(e.id,10):e.id)===("string"==typeof t.id?parseInt(t.id,10):t.id));if(a)return a}if(t.name)return e.find(e=>e.name===t.name)}}function n(e,t){let a=void 0!==e.part;return 1===t?a?e.op_1_lvl??e.opt1Level??0:e.op_1_lvl??0:2===t?a?e.op_2_lvl??e.opt2Level??0:e.op_2_lvl??0:a?e.op_3_lvl??e.opt3Level??0:e.op_3_lvl??0}function o(e=[],t=[]){let a=0,r=0,s=1,i=1,c=1,d=!1,p=0,m=[];e.forEach(e=>{let o;if(!(o=void 0!==e.part?e.part:l(t,e)))return;let u=n(e,1),x=n(e,2),_=n(e,3),g=e.applyDuration||!1,h=(o.base_en||0)+(o.op_1_en||0)*u+(o.op_2_en||0)*x+(o.op_3_en||0)*_,y=o.duration,N=o.percentage;y?(c*=h,d=!0):N?(s*=h,g&&(i*=h)):(a+=h,g&&(r+=h));let b=Math.floor((o.base_tp||0)+(o.op_1_tp||0)*u+(o.op_2_tp||0)*x+(o.op_3_tp||0)*_);if(b>0){let e=`${b} TP: ${o.name}`;u>0&&(e+=` (Opt1 ${u})`),x>0&&(e+=` (Opt2 ${x})`),_>0&&(e+=` (Opt3 ${_})`),m.push(e)}p+=b}),d||(c=0);let u=a*s+(c+1)*r*i-r*i;return{totalEnergy:Math.ceil(u),totalTP:p,tpSources:m,energyRaw:u}}function i(e,t){let a="Basic";return"quick"===e?a="Quick":"free"===e?a="Free":"long3"===e?a="Long (3)":"long4"===e&&(a="Long (4)"),t?`${a} Reaction`:`${a} Action`}function c(e=[],a=[]){let r=e.find(e=>Number(e.part?.id??e.id)===t.POWER_RANGE||"Power Range"===(e.part?.name||e.name));if(!r)return"1 space";let s=3+3*n(r,1);return`${s} ${s>1?"spaces":"space"}`}function d(e=[],a=[]){let r=[t.SPHERE_OF_EFFECT,t.CYLINDER_OF_EFFECT,t.CONE_OF_EFFECT,t.LINE_OF_EFFECT,t.TRAIL_OF_EFFECT],s=["Sphere","Cylinder","Cone","Line","Trail"];for(let t=0;t<r.length;t++)if(e.find(e=>Number(e.part?.id??e.id)===r[t]||(e.part?.name||e.name)===`${s[t]} of Effect`))return s[t];return"1 target"}function p(e=[],a=[]){let r=(t,a)=>e.find(e=>Number(e.part?.id??e.id)===t||(e.part?.name||e.name)===a),s=e=>e?n(e,1):0;if(r(t.DURATION_PERMANENT,"Duration (Permanent)"))return"Permanent";let l=r(t.DURATION_ROUND,"Duration (Round)");if(l){let e=2+s(l);return`${e} ${e>1?"rounds":"round"}`}let o=r(t.DURATION_MINUTE,"Duration (Minute)");if(o){let e=[1,10,30][s(o)]||1;return`${e} minute${e>1?"s":""}`}let i=r(t.DURATION_HOUR,"Duration (Hour)");if(i){let e=[1,6,12][s(i)]||1;return`${e} hour${e>1?"s":""}`}let c=r(t.DURATION_DAYS,"Duration (Days)");if(c){let e=[1,10,20,30][s(c)]||1;return`${e} day${e>1?"s":""}`}return"1 round"}function m(e,a){let r=Array.isArray(e.parts)?e.parts.map(e=>({id:e.id,name:e.name,op_1_lvl:e.op_1_lvl||0,op_2_lvl:e.op_2_lvl||0,op_3_lvl:e.op_3_lvl||0,applyDuration:e.applyDuration||!1})):[],s=o(r,a),i=function(e=[],a=[]){let r="Basic",s=!1;return e.forEach(e=>{let o;if(e.part?.id!==void 0)o=Number(e.part.id);else if(void 0!==e.id)o=e.id;else if(e.part?.name||e.name){let t=l(a,{name:e.part?.name||e.name});o=t?Number(t.id):void 0}let i=n(e,1);o===t.POWER_REACTION?s=!0:o===t.POWER_QUICK_OR_FREE_ACTION?0===i?r="Quick":1===i&&(r="Free"):o===t.POWER_LONG_ACTION&&(0===i?r="Long (3)":1===i&&(r="Long (4)"))}),s?`${r} Reaction`:`${r} Action`}(r,a),m=c(r,a),u=d(r,a),x=p(r,a),_=r.map(e=>{let t,r,s,n,o,i=l(a,e);return i?(t=e.op_1_lvl||0,r=e.op_2_lvl||0,s=e.op_3_lvl||0,n=Math.floor((i.base_tp||0)+(i.op_1_tp||0)*t+(i.op_2_tp||0)*r+(i.op_3_tp||0)*s),o=i.name,t>0&&(o+=` (Opt1 ${t})`),r>0&&(o+=` (Opt2 ${r})`),s>0&&(o+=` (Opt3 ${s})`),n>0&&(o+=` | TP: ${n}`),{text:o,description:i.description||"",finalTP:n,hasTP:n>0}):null}).filter(e=>null!==e);return{name:e.name||"",description:e.description||"",actionType:i,range:m,area:u,duration:x,energy:s.totalEnergy,tp:s.totalTP,tpSources:s.tpSources,partChips:_}}function u(e){if(!Array.isArray(e))return"";let t=e.find(e=>e&&e.amount&&e.size&&e.type&&"none"!==e.type);return t?`${t.amount}d${t.size} ${t.type}`:""}function x(e){return e&&e.amount&&e.size&&"0"!==e.amount&&"0"!==e.size?`+${e.amount}d${e.size}`:""}function _(e,t){let a="Basic";return"quick"===e?a="Quick":"free"===e?a="Free":"long3"===e?a="Long (3)":"long4"===e&&(a="Long (4)"),t?`${a} Reaction`:`${a} Action`}function g(e=[],a=[]){let r=0,s=1,n=0,o=[];e.forEach(e=>{let i=l(a,{id:e.id??e.part?.id,name:e.name??e.part?.name});if(!i)return;let c=e.op_1_lvl||0,d=e.op_2_lvl||0,p=e.op_3_lvl||0,m=(i.base_en||0)+(i.op_1_en||0)*c+(i.op_2_en||0)*d+(i.op_3_en||0)*p;i.percentage?s*=m:r+=m;let u=(i.op_1_tp||0)*c;(("string"==typeof i.id?parseInt(i.id,10):i.id)===t.ADDITIONAL_DAMAGE||"Additional Damage"===i.name)&&(u=Math.floor(u));let x=Math.floor((i.base_tp||0)+u+(i.op_2_tp||0)*d+(i.op_3_tp||0)*p);if(x>0){let e=`${x} TP: ${i.name}`;c>0&&(e+=` (Opt1 ${c})`),d>0&&(e+=` (Opt2 ${d})`),p>0&&(e+=` (Opt3 ${p})`),o.push(e)}n+=x});let i=r*s;return{totalEnergy:Math.ceil(i),totalTP:n,tpSources:o,energyRaw:i}}function h(e,a){let r=Array.isArray(e.parts)?e.parts.map(e=>({id:e.id,name:e.name,op_1_lvl:e.op_1_lvl||0,op_2_lvl:e.op_2_lvl||0,op_3_lvl:e.op_3_lvl||0})):[],s=g(r,a),n=function(e=[],a=[]){let r="Basic",s=!1;return e.forEach(e=>{let n=e.id;if(void 0===n&&e.name){let t=l(a,{name:e.name});n=t?.id!==void 0?Number(t.id):void 0}let o=e.op_1_lvl||0;n===t.REACTION?s=!0:n===t.QUICK_OR_FREE_ACTION?0===o?r="Quick":1===o&&(r="Free"):n===t.LONG_ACTION?0===o?r="Long (3)":1===o&&(r="Long (4)"):"Reaction"===e.name?s=!0:"Quick or Free Action"===e.name?0===o?r="Quick":1===o&&(r="Free"):"Long Action"===e.name&&(0===o?r="Long (3)":1===o&&(r="Long (4)"))}),s?`${r} Reaction`:`${r} Action`}(r,a),o=x(e.damage),i=e.weapon&&(e.weapon.name||e.weapon.id)?e.weapon.name||`Weapon #${e.weapon.id}`:"Unarmed",c=r.map(e=>{let r,s,n,o,i,c,d=l(a,e);return d?(r=e.op_1_lvl||0,s=e.op_2_lvl||0,n=e.op_3_lvl||0,o=(d.op_1_tp||0)*r,(("string"==typeof d.id?parseInt(d.id,10):d.id)===t.ADDITIONAL_DAMAGE||"Additional Damage"===d.name)&&(o=Math.floor(o)),i=Math.floor((d.base_tp||0)+o+(d.op_2_tp||0)*s+(d.op_3_tp||0)*n),c=d.name||"",r>0&&(c+=` (Opt1 ${r})`),s>0&&(c+=` (Opt2 ${s})`),n>0&&(c+=` (Opt3 ${n})`),i>0&&(c+=` | TP: ${i}`),{text:c,description:d.description||"",finalTP:i,hasTP:i>0}):null}).filter(e=>null!==e);return{name:e.name||"",description:e.description||"",weaponName:i,actionType:n,damageStr:o,energy:s.totalEnergy,tp:s.totalTP,tpSources:s.tpSources,partChips:c}}e.s(["GENERAL_PROPERTY_IDS",0,r,"GENERAL_PROPERTY_NAMES",0,s,"PART_IDS",0,t,"PROPERTY_IDS",0,a,"findByIdOrName",()=>l],81547),e.s(["calculatePowerCosts",()=>o,"computeActionTypeFromSelection",()=>i,"deriveArea",()=>d,"deriveDuration",()=>p,"derivePowerDisplay",()=>m,"deriveRange",()=>c,"formatPowerDamage",()=>u],92006),e.s(["calculateTechniqueCosts",()=>g,"computeActionTypeFromSelection",()=>_,"deriveTechniqueDisplay",()=>h,"formatTechniqueDamage",()=>x],15324)},24522,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(37727),s=e.i(7233),l=e.i(64659),n=e.i(55900),o=e.i(33060),i=e.i(39312),c=e.i(20278),d=e.i(52571),p=e.i(75505);e.i(79121);var m=e.i(49838);e.i(84004);var u=e.i(23495);e.i(64485);var x=e.i(66923),_=e.i(46775);e.i(28856);var g=e.i(82943),h=e.i(67426);e.i(61978);var y=e.i(52831),N=e.i(80853),b=e.i(17494);e.i(22853);var v=e.i(92006);let f=[{value:"basic",label:"Basic Action"},{value:"quick",label:"Quick Action"},{value:"free",label:"Free Action"},{value:"long3",label:"Long Action (3 AP)"},{value:"long4",label:"Long Action (4 AP)"}],E=["none","magic","fire","cold","lightning","physical","necrotic","radiant","psychic","poison","sonic"],j=[4,6,8,10,12],A=["Action","Activation","Area of Effect","Duration","Target","Special","Restriction"],R=new Set(["Power Quick or Free Action","Power Long Action","Power Reaction","Sphere of Effect","Cylinder of Effect","Cone of Effect","Line of Effect","Trail of Effect","Magic Damage","Light Damage","Elemental Damage","Poison or Necrotic Damage","Sonic Damage","Spiritual Damage","Psychic Damage","Physical Damage","Duration (Round)","Duration (Minute)","Duration (Hour)","Duration (Days)","Duration (Permanent)","Focus for Duration","No Harm or Adaptation for Duration","Duration Ends On Activation","Sustain for Duration","Power Range"]),T={Action:{bg:"bg-blue-100",border:"border-blue-300",text:"text-blue-800",hoverBg:"hover:bg-blue-200"},Activation:{bg:"bg-teal-100",border:"border-teal-300",text:"text-teal-800",hoverBg:"hover:bg-teal-200"},"Area of Effect":{bg:"bg-green-100",border:"border-green-300",text:"text-green-800",hoverBg:"hover:bg-green-200"},Duration:{bg:"bg-purple-100",border:"border-purple-300",text:"text-purple-800",hoverBg:"hover:bg-purple-200"},Target:{bg:"bg-orange-100",border:"border-orange-300",text:"text-orange-800",hoverBg:"hover:bg-orange-200"},Special:{bg:"bg-amber-100",border:"border-amber-300",text:"text-amber-800",hoverBg:"hover:bg-amber-200"},Restriction:{bg:"bg-red-100",border:"border-red-300",text:"text-red-800",hoverBg:"hover:bg-red-200"}};function w({selectedPart:e,index:s,onRemove:o,onUpdate:i,allParts:c}){let[d,p]=(0,a.useState)(!0),{part:m}=e,u=(0,a.useMemo)(()=>["any",...Array.from(new Set(c.map(e=>e.category))).sort()],[c]),x=(0,a.useMemo)(()=>{let t=e.selectedCategory;return t&&"any"!==t?c.filter(e=>e.category===t).sort((e,t)=>e.name.localeCompare(t.name)):c.sort((e,t)=>e.name.localeCompare(t.name))},[c,e.selectedCategory]),_=e=>{let t=m[`op_${e}_desc`],a=m[`op_${e}_en`],r=m[`op_${e}_tp`];return t&&""!==t.trim()||void 0!==a&&0!==a||void 0!==r&&0!==r},g=(m.base_en||0)+(m.op_1_en||0)*e.op_1_lvl+(m.op_2_en||0)*e.op_2_lvl+(m.op_3_en||0)*e.op_3_lvl,h=(m.base_tp||0)+(m.op_1_tp||0)*e.op_1_lvl+(m.op_2_tp||0)*e.op_2_lvl+(m.op_3_tp||0)*e.op_3_lvl;return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gray-50 px-4 py-3 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>p(!d),className:"text-gray-500 hover:text-gray-700",children:d?(0,t.jsx)(n.ChevronUp,{className:"w-5 h-5"}):(0,t.jsx)(l.ChevronDown,{className:"w-5 h-5"})}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:m.name}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["EN: ",g.toFixed(1)," | TP: ",Math.floor(h)]})]}),(0,t.jsx)("button",{type:"button",onClick:o,className:"text-gray-400 hover:text-red-500",children:(0,t.jsx)(r.X,{className:"w-5 h-5"})})]}),d&&(0,t.jsxs)("div",{className:"px-4 py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,t.jsx)("select",{value:e.selectedCategory,onChange:e=>i({selectedCategory:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:u.map(e=>(0,t.jsx)("option",{value:e,children:"any"===e?"All Categories":e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Part"}),(0,t.jsx)("select",{value:x.findIndex(e=>e.id===m.id),onChange:e=>{let t=x[parseInt(e.target.value)];t&&i({part:t,op_1_lvl:0,op_2_lvl:0,op_3_lvl:0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:x.map((e,a)=>(0,t.jsx)("option",{value:a,children:e.name},e.id))})]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:m.description}),(0,t.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:["Base Energy: ",(0,t.jsx)("strong",{children:m.base_en})]}),(0,t.jsxs)("span",{className:"text-gray-600",children:["Base TP: ",(0,t.jsx)("strong",{children:m.base_tp})]})]}),(_(1)||_(2)||_(3))&&(0,t.jsxs)("div",{className:"space-y-3 pt-2 border-t border-gray-100",children:[_(1)&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Option 1:"," ",(0,t.jsxs)("span",{className:"text-gray-500",children:["EN ",(m.op_1_en||0)>=0?"+":"",m.op_1_en||0,", TP"," ",(m.op_1_tp||0)>=0?"+":"",m.op_1_tp||0]})]}),(0,t.jsx)(b.NumberStepper,{value:e.op_1_lvl,onChange:e=>i({op_1_lvl:e}),label:"Level:"})]}),m.op_1_desc&&(0,t.jsx)("p",{className:"text-sm text-gray-600",children:m.op_1_desc})]}),_(2)&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Option 2:"," ",(0,t.jsxs)("span",{className:"text-gray-500",children:["EN ",(m.op_2_en||0)>=0?"+":"",m.op_2_en||0,", TP"," ",(m.op_2_tp||0)>=0?"+":"",m.op_2_tp||0]})]}),(0,t.jsx)(b.NumberStepper,{value:e.op_2_lvl,onChange:e=>i({op_2_lvl:e}),label:"Level:"})]}),m.op_2_desc&&(0,t.jsx)("p",{className:"text-sm text-gray-600",children:m.op_2_desc})]}),_(3)&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Option 3:"," ",(0,t.jsxs)("span",{className:"text-gray-500",children:["EN ",(m.op_3_en||0)>=0?"+":"",m.op_3_en||0,", TP"," ",(m.op_3_tp||0)>=0?"+":"",m.op_3_tp||0]})]}),(0,t.jsx)(b.NumberStepper,{value:e.op_3_lvl,onChange:e=>i({op_3_lvl:e}),label:"Level:"})]}),m.op_3_desc&&(0,t.jsx)("p",{className:"text-sm text-gray-600",children:m.op_3_desc})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.applyDuration,onChange:e=>i({applyDuration:e.target.checked}),className:"rounded border-gray-300"}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"Apply to Duration"})]})]})]})}function C({part:e,onAdd:r}){let[s,l]=(0,a.useState)(!1),n=T[e.category]||T.Special;return(0,t.jsxs)("div",{className:(0,m.cn)("rounded-lg border px-3 py-2 cursor-pointer transition-all",n.bg,n.border,n.hoverBg),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("span",{className:(0,m.cn)("text-sm font-medium",n.text),onClick:()=>l(!s),children:e.name}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),r()},className:(0,m.cn)("w-6 h-6 rounded-full flex items-center justify-center text-white font-bold text-sm","bg-primary-600 hover:bg-primary-700"),children:"+"})]}),s&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20 text-sm space-y-1",children:[(0,t.jsx)("p",{className:n.text,children:e.description||"No description available."}),e.op_1_desc&&(0,t.jsxs)("p",{className:"text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Option 1:"})," ",e.op_1_desc]}),e.op_2_desc&&(0,t.jsxs)("p",{className:"text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Option 2:"})," ",e.op_2_desc]}),e.op_3_desc&&(0,t.jsxs)("p",{className:"text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Option 3:"})," ",e.op_3_desc]})]})]})}function I({advPart:e,index:r,onRemove:s,onUpdate:l}){let[n,o]=(0,a.useState)(!1),{part:i}=e,c=T[i.category]||T.Special,d=e=>{let t=i[`op_${e}_desc`];return t&&""!==t.trim()};return(0,t.jsxs)("div",{className:(0,m.cn)("rounded-lg border px-3 py-2 transition-all",c.bg,c.border),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("span",{className:(0,m.cn)("text-sm font-medium cursor-pointer",c.text),onClick:()=>o(!n),children:[i.name,(e.op_1_lvl>0||e.op_2_lvl>0||e.op_3_lvl>0)&&(0,t.jsxs)("span",{className:"ml-2 text-xs opacity-75",children:["(",e.op_1_lvl,"/",e.op_2_lvl,"/",e.op_3_lvl,")"]})]}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),s()},className:"w-6 h-6 rounded-full flex items-center justify-center text-white font-bold text-sm bg-red-500 hover:bg-red-600",children:"×"})]}),n&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20 text-sm space-y-2",children:[(0,t.jsx)("p",{className:c.text,children:i.description}),d(1)&&(0,t.jsxs)("div",{className:"bg-white/50 rounded p-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Option 1: EN ",(i.op_1_en||0)>=0?"+":"",i.op_1_en||0,", TP ",(i.op_1_tp||0)>=0?"+":"",i.op_1_tp||0]}),(0,t.jsx)(b.NumberStepper,{value:e.op_1_lvl,onChange:e=>l({op_1_lvl:e}),label:""})]}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:i.op_1_desc})]}),d(2)&&(0,t.jsxs)("div",{className:"bg-white/50 rounded p-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Option 2: EN ",(i.op_2_en||0)>=0?"+":"",i.op_2_en||0,", TP ",(i.op_2_tp||0)>=0?"+":"",i.op_2_tp||0]}),(0,t.jsx)(b.NumberStepper,{value:e.op_2_lvl,onChange:e=>l({op_2_lvl:e}),label:""})]}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:i.op_2_desc})]}),d(3)&&(0,t.jsxs)("div",{className:"bg-white/50 rounded p-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Option 3: EN ",(i.op_3_en||0)>=0?"+":"",i.op_3_en||0,", TP ",(i.op_3_tp||0)>=0?"+":"",i.op_3_tp||0]}),(0,t.jsx)(b.NumberStepper,{value:e.op_3_lvl,onChange:e=>l({op_3_lvl:e}),label:""})]}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:i.op_3_desc})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.applyDuration,onChange:e=>l({applyDuration:e.target.checked}),className:"rounded border-gray-300"}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"Apply Duration"})]})]})]})}function D({powerParts:e,selectedAdvancedParts:r,onAdd:s,onRemove:o,onUpdate:i}){let[c,d]=(0,a.useState)(!1),p=(0,a.useCallback)(t=>e.filter(e=>e.mechanic&&e.category===t&&!R.has(e.name)),[e]);return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>d(!c),className:"w-full px-6 py-4 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[c?(0,t.jsx)(n.ChevronUp,{className:"w-5 h-5 text-gray-500"}):(0,t.jsx)(l.ChevronDown,{className:"w-5 h-5 text-gray-500"}),(0,t.jsx)("span",{className:"font-bold text-gray-900",children:"Advanced Power Mechanics"})]}),!c&&r.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[r.slice(0,5).map((e,a)=>{let r=T[e.part.category]||T.Special;return(0,t.jsx)("span",{className:(0,m.cn)("px-2 py-0.5 rounded text-xs font-medium",r.bg,r.text),children:e.part.name},a)}),r.length>5&&(0,t.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-gray-200 text-gray-600",children:["+",r.length-5," more"]})]})]}),c&&(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[r.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-bold text-gray-700 mb-3",children:"Added Advanced Mechanics"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e,a)=>(0,t.jsx)(I,{advPart:e,index:a,onRemove:()=>o(a),onUpdate:e=>i(a,e)},a))})]}),(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:A.map(e=>{let a=p(e);return 0===a.length?null:(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-bold text-gray-700 mb-2",children:e}),(0,t.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,t.jsx)(C,{part:e,onAdd:()=>s(e)},e.id))})]},e)})})]})]})}function O(){let{user:e}=(0,g.useAuthStore)(),[r,l]=(0,a.useState)(""),[n,u]=(0,a.useState)(""),[R,T]=(0,a.useState)([]),[C,I]=(0,a.useState)([]),[O,P]=(0,a.useState)("basic"),[L,S]=(0,a.useState)(!1),[M,k]=(0,a.useState)({amount:0,size:6,type:"none"}),[U,G]=(0,a.useState)(!1),[F,$]=(0,a.useState)(null),[H,W]=(0,a.useState)(!1),{data:B=[],isLoading:Q,error:z}=(0,x.usePowerParts)(),{data:Y,isLoading:q,error:K}=(0,_.useUserPowers)(),V=(0,a.useMemo)(()=>[...R.map(e=>({part:e.part,op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl,applyDuration:e.applyDuration})),...C.map(e=>({part:e.part,op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl,applyDuration:e.applyDuration}))],[R,C]),X=(0,a.useMemo)(()=>(0,v.calculatePowerCosts)(V,B),[V,B]),Z=(0,a.useMemo)(()=>(0,v.computeActionTypeFromSelection)(O,L),[O,L]),J=(0,a.useMemo)(()=>(0,v.deriveRange)(V,B),[V,B]),ee=(0,a.useMemo)(()=>(0,v.deriveArea)(V,B),[V,B]),et=(0,a.useMemo)(()=>(0,v.deriveDuration)(V,B),[V,B]),ea=(0,a.useCallback)(()=>{0!==B.length&&T(e=>[...e,{part:B[0],op_1_lvl:0,op_2_lvl:0,op_3_lvl:0,applyDuration:!1,selectedCategory:"any"}])},[B]),er=(0,a.useCallback)(e=>{T(t=>t.filter((t,a)=>a!==e))},[]),es=(0,a.useCallback)((e,t)=>{T(a=>a.map((a,r)=>r===e?{...a,...t}:a))},[]),el=(0,a.useCallback)(e=>{C.some(t=>t.part.id===e.id)||I(t=>[...t,{part:e,op_1_lvl:0,op_2_lvl:0,op_3_lvl:0,applyDuration:!1}])},[C]),en=(0,a.useCallback)(e=>{I(t=>t.filter((t,a)=>a!==e))},[]),eo=(0,a.useCallback)((e,t)=>{I(a=>a.map((a,r)=>r===e?{...a,...t}:a))},[]),ei=async()=>{if(!r.trim())return void $({type:"error",text:"Please enter a power name"});if(!e)return void $({type:"error",text:"You must be logged in to save"});G(!0),$(null);try{let e=(0,y.httpsCallable)(h.functions,"savePowerToLibrary"),t=[...R.map(e=>({id:Number(e.part.id),name:e.part.name,op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl,applyDuration:e.applyDuration})),...C.map(e=>({id:Number(e.part.id),name:e.part.name,op_1_lvl:e.op_1_lvl,op_2_lvl:e.op_2_lvl,op_3_lvl:e.op_3_lvl,applyDuration:e.applyDuration,isAdvanced:!0}))],a="none"!==M.type&&M.amount>0?[{amount:M.amount,size:M.size,type:M.type}]:[];await e({powerName:r.trim(),powerDescription:n.trim(),parts:t,damage:a}),$({type:"success",text:"Power saved successfully!"}),setTimeout(()=>{l(""),u(""),T([]),I([]),k({amount:0,size:6,type:"none"}),$(null)},2e3)}catch(e){console.error("Error saving power:",e),$({type:"error",text:`Failed to save: ${e.message}`})}finally{G(!1)}},ec=(0,a.useCallback)(e=>{l(e.name||""),u(e.description||"");let t=e.parts||e.powerParts||[],a=[],r=[];for(let e of t){let t=B.find(t=>t.id===String(e.id)||t.name===e.name);if(t){let s={part:t,op_1_lvl:e.op_1_lvl||0,op_2_lvl:e.op_2_lvl||0,op_3_lvl:e.op_3_lvl||0,applyDuration:e.applyDuration||!1};e.isAdvanced||t.mechanic&&A.includes(t.category)?r.push(s):a.push({...s,selectedCategory:t.category||"any"})}}T(a),I(r);let s=[];if(Array.isArray(e.damage)?s=e.damage:e.damage&&"object"==typeof e.damage&&(s=[{amount:e.damage.dice||e.damage.amount||0,size:e.damage.sides||e.damage.size||6,type:e.damage.type||"none"}]),s.length>0){let e=s[0];k({amount:e.amount||0,size:e.size||6,type:e.type||"none"})}else k({amount:0,size:6,type:"none"});$({type:"success",text:"Power loaded successfully!"}),setTimeout(()=>$(null),2e3)},[B]);return Q?(0,t.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})}):z?(0,t.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:(0,t.jsxs)("p",{className:"text-red-700",children:["Failed to load power parts: ",z.message]})})}):(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[(0,t.jsx)(o.Wand2,{className:"w-8 h-8 text-primary-600"}),"Power Creator"]}),(0,t.jsx)("p",{className:"text-gray-600",children:"Design custom powers by combining power parts. Each part contributes to the total energy cost and training point requirements."})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>W(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[(0,t.jsx)(p.FolderOpen,{className:"w-5 h-5"}),"Load from Library"]})]}),(0,t.jsx)(N.LoadFromLibraryModal,{isOpen:H,onClose:()=>W(!1),onSelect:ec,items:Y,isLoading:q,error:K,itemType:"power",title:"Load Power from Library"}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Power Name *"}),(0,t.jsx)("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Enter power name...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,t.jsx)("textarea",{value:n,onChange:e=>u(e.target.value),placeholder:"Describe what your power does...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Action Type"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,t.jsx)("select",{value:O,onChange:e=>P(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg",children:f.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:L,onChange:e=>S(e.target.checked),className:"rounded border-gray-300"}),(0,t.jsx)("span",{className:"text-sm",children:"Reaction"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Power Parts (",R.length,")"]}),(0,t.jsxs)("button",{type:"button",onClick:ea,className:"flex items-center gap-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[(0,t.jsx)(s.Plus,{className:"w-4 h-4"}),"Add Part"]})]}),0===R.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(d.Info,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:'No parts added yet. Click "Add Part" to begin building your power.'})]}):(0,t.jsx)("div",{className:"space-y-4",children:R.map((e,a)=>(0,t.jsx)(w,{selectedPart:e,index:a,onRemove:()=>er(a),onUpdate:e=>es(a,e),allParts:B},a))})]}),(0,t.jsx)(D,{powerParts:B,selectedAdvancedParts:C,onAdd:el,onRemove:en,onUpdate:eo}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Damage (Optional)"}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsx)(b.NumberStepper,{value:M.amount,onChange:e=>k(t=>({...t,amount:e})),label:"Dice:",min:0,max:20}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"font-bold text-lg",children:"d"}),(0,t.jsx)("select",{value:M.size,onChange:e=>k(t=>({...t,size:parseInt(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded-lg",children:j.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsx)("select",{value:M.type,onChange:e=>k(t=>({...t,type:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg",children:E.map(e=>(0,t.jsx)("option",{value:e,children:"none"===e?"No damage":e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),"none"!==M.type&&M.amount>0&&(0,t.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Damage: ",(0,t.jsxs)("strong",{children:[M.amount,"d",M.size," ",M.type]})]})]})]}),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 sticky top-24",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Power Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[(0,t.jsx)(i.Zap,{className:"w-6 h-6 mx-auto text-blue-600 mb-1"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:X.totalEnergy}),(0,t.jsx)("div",{className:"text-xs text-blue-600",children:"Energy Cost"})]}),(0,t.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[(0,t.jsx)(c.Target,{className:"w-6 h-6 mx-auto text-purple-600 mb-1"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:X.totalTP}),(0,t.jsx)("div",{className:"text-xs text-purple-600",children:"Training Points"})]})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Action:"}),(0,t.jsx)("span",{className:"font-medium",children:Z})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Range:"}),(0,t.jsx)("span",{className:"font-medium",children:J})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Area:"}),(0,t.jsx)("span",{className:"font-medium",children:ee})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,t.jsx)("span",{className:"font-medium",children:et})]})]}),X.tpSources.length>0&&(0,t.jsxs)("div",{className:"border-t border-gray-100 pt-4 mb-6",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"TP Breakdown"}),(0,t.jsx)("ul",{className:"text-xs text-gray-600 space-y-1",children:X.tpSources.map((e,a)=>(0,t.jsxs)("li",{children:["• ",e]},a))})]}),F&&(0,t.jsx)("div",{className:(0,m.cn)("mb-4 p-3 rounded-lg text-sm","success"===F.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:F.text}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("button",{type:"button",onClick:ei,disabled:U||!r.trim(),className:(0,m.cn)("w-full py-3 rounded-xl font-bold transition-colors",U||!r.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:U?"Saving...":"Save to Library"}),(0,t.jsx)("button",{type:"button",onClick:()=>{l(""),u(""),T([]),I([]),P("basic"),S(!1),k({amount:0,size:6,type:"none"}),$(null)},className:"w-full py-2 rounded-xl font-medium text-gray-600 hover:bg-gray-100 transition-colors",children:"Reset"})]})]})})]})]})}function P(){return(0,t.jsx)(u.ProtectedRoute,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,t.jsx)(O,{})})})}e.s(["default",()=>P],24522)}]);